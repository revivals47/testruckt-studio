<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <style>:root {
  --color: black;
  --bg: white;
  --head-bg: white;
  --link: #338;

  --blue: #ccf;
  --red: #fcc;
  --yellow: #ffc;
  --green: #cfc;
}

[data-theme='dark'] {
  --color: white;
  --bg: black;
  --head-bg: #333;
  --link: #aaf;

  --blue: #225;
  --red: #522;
  --yellow: #552;
  --green: #252;
}

html,
body {
  margin: 0;
  padding: 0;
  color: var(--color);
  background: var(--bg);
}

.app {
  margin: 10px;
  padding: 0;
}

.files-list {
  margin: 10px 0 0;
  width: 100%;
  border-collapse: collapse;
}
.files-list__head {
  border: 1px solid #999;
}
.files-list__head > tr > th {
  padding: 10px;
  border: 1px solid #999;
  text-align: left;
  font-weight: normal;
  background: var(--head-bg);
}
.files-list__body {
}
.files-list__file {
  cursor: pointer;
}
.files-list__file:hover {
  background: var(--blue);
}
.files-list__file > td {
  padding: 10px;
  border: 1px solid #999;
}
.files-list__file > td:first-child::before {
  content: '\01F4C4';
  margin-right: 1em;
}
.files-list__file_low {
  background: var(--red);
}
.files-list__file_medium {
  background: var(--yellow);
}
.files-list__file_high {
  background: var(--green);
}
.files-list__file_folder > td:first-child::before {
  content: '\01F4C1';
  margin-right: 1em;
}

.file-header {
  border: 1px solid #999;
  display: flex;
  justify-content: space-between;
  align-items: center;
  position: sticky;
  top: 0;
  background: var(--bg);
}

.file-header__back {
  margin: 10px;
  cursor: pointer;
  flex-shrink: 0;
  flex-grow: 0;
  text-decoration: underline;
  color: var(--link);
}

.file-header__name {
  margin: 10px;
  flex-shrink: 2;
  flex-grow: 2;
}

.file-header__stat {
  margin: 10px;
  flex-shrink: 0;
  flex-grow: 0;
}

.file-content {
  margin: 10px 0 0;
  border: 1px solid #999;
  padding: 10px;
  counter-reset: line;
  display: flex;
  flex-direction: column;
}

.code-line::before {
  content: counter(line);
  margin-right: 10px;
}
.code-line {
  margin: 0;
  padding: 0.3em;
  height: 1em;
  counter-increment: line;
}
.code-line_covered {
  background: var(--green);
}
.code-line_uncovered {
  background: var(--red);
}

#theme-toggle-label {
  margin-left: 1ch;
}
</style>
</head>
<body>
    <div id="root"></div>
    <script>
        var data = {"files":[{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","cli","src","main.rs"],"content":"use clap::{Parser, Subcommand};\nuse testruct_core::{Project, Template};\n\n#[derive(Parser)]\n#[command(author, version, about = \"Utilities for the Testruct desktop suite\")]\nstruct Cli {\n    #[command(subcommand)]\n    command: Commands,\n}\n\n#[derive(Subcommand)]\nenum Commands {\n    /// Launch the GTK user interface\n    Ui,\n    /// List available templates from the default library\n    Templates,\n}\n\nfn main() -\u003e anyhow::Result\u003c()\u003e {\n    let cli = Cli::parse();\n    match cli.command {\n        Commands::Ui =\u003e {\n            #[cfg(feature = \"ui\")]\n            {\n                let exit = testruct_ui::launch(Default::default());\n                std::process::exit(exit.value());\n            }\n            #[cfg(not(feature = \"ui\"))]\n            {\n                anyhow::bail!(\"UI feature not enabled\");\n            }\n        }\n        Commands::Templates =\u003e {\n            let mut project = Project::default();\n            project.templates.register(Template::single_page(\n                \"A4 Reading\",\n                testruct_core::CanvasLayout::new(testruct_core::Size::new(595.0, 842.0)),\n            ));\n            for template in project.templates.iter() {\n                println!(\"{}\", template.name);\n            }\n        }\n    }\n    Ok(())\n}\n","traces":[{"line":19,"address":[],"length":0,"stats":{"Line":0}},{"line":20,"address":[],"length":0,"stats":{"Line":0}},{"line":21,"address":[],"length":0,"stats":{"Line":0}},{"line":30,"address":[],"length":0,"stats":{"Line":0}},{"line":34,"address":[],"length":0,"stats":{"Line":0}},{"line":35,"address":[],"length":0,"stats":{"Line":0}},{"line":37,"address":[],"length":0,"stats":{"Line":0}},{"line":39,"address":[],"length":0,"stats":{"Line":0}},{"line":40,"address":[],"length":0,"stats":{"Line":0}},{"line":44,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":10},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","core","src","document","builder.rs"],"content":"use super::{Document, DocumentId, Page};\nuse serde::{Deserialize, Serialize};\nuse thiserror::Error;\n\n#[derive(Debug, Default, Serialize, Deserialize)]\npub struct DocumentBuilder {\n    pub title: Option\u003cString\u003e,\n    pub author: Option\u003cString\u003e,\n    pub pages: Vec\u003cPage\u003e,\n}\n\nimpl DocumentBuilder {\n    pub fn new() -\u003e Self {\n        Self::default()\n    }\n\n    pub fn with_title(mut self, title: impl Into\u003cString\u003e) -\u003e Self {\n        self.title = Some(title.into());\n        self\n    }\n\n    pub fn with_author(mut self, author: impl Into\u003cString\u003e) -\u003e Self {\n        self.author = Some(author.into());\n        self\n    }\n\n    pub fn add_page(mut self, page: Page) -\u003e Self {\n        self.pages.push(page);\n        self\n    }\n\n    pub fn build(self) -\u003e Result\u003cDocument, DocumentBuilderError\u003e {\n        let metadata = super::metadata::DocumentMetadata::new(\n            self.title.unwrap_or_else(|| \"Untitled\".into()),\n            self.author.unwrap_or_else(|| \"\".into()),\n        );\n\n        if self.pages.is_empty() {\n            return Err(DocumentBuilderError::EmptyDocument);\n        }\n\n        Ok(Document {\n            id: DocumentId::new(),\n            metadata,\n            pages: self.pages,\n            styles: Default::default(),\n        })\n    }\n}\n\n#[derive(Debug, Error)]\npub enum DocumentBuilderError {\n    #[error(\"document must contain at least one page\")]\n    EmptyDocument,\n}\n","traces":[{"line":13,"address":[],"length":0,"stats":{"Line":1}},{"line":14,"address":[],"length":0,"stats":{"Line":1}},{"line":17,"address":[],"length":0,"stats":{"Line":1}},{"line":18,"address":[],"length":0,"stats":{"Line":2}},{"line":19,"address":[],"length":0,"stats":{"Line":1}},{"line":22,"address":[],"length":0,"stats":{"Line":0}},{"line":23,"address":[],"length":0,"stats":{"Line":0}},{"line":24,"address":[],"length":0,"stats":{"Line":0}},{"line":27,"address":[],"length":0,"stats":{"Line":1}},{"line":28,"address":[],"length":0,"stats":{"Line":3}},{"line":29,"address":[],"length":0,"stats":{"Line":1}},{"line":32,"address":[],"length":0,"stats":{"Line":1}},{"line":34,"address":[],"length":0,"stats":{"Line":2}},{"line":35,"address":[],"length":0,"stats":{"Line":4}},{"line":38,"address":[],"length":0,"stats":{"Line":2}},{"line":39,"address":[],"length":0,"stats":{"Line":0}},{"line":42,"address":[],"length":0,"stats":{"Line":1}},{"line":43,"address":[],"length":0,"stats":{"Line":2}},{"line":44,"address":[],"length":0,"stats":{"Line":2}},{"line":45,"address":[],"length":0,"stats":{"Line":1}},{"line":46,"address":[],"length":0,"stats":{"Line":1}}],"covered":17,"coverable":21},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","core","src","document","metadata.rs"],"content":"use serde::{Deserialize, Serialize};\nuse super::PageSize;\n\n#[derive(Clone, Debug, Serialize, Deserialize)]\npub struct DocumentMetadata {\n    pub title: String,\n    pub author: String,\n    pub tags: Vec\u003cString\u003e,\n    #[serde(default)]\n    pub page_size: PageSize,\n    pub created_at: chrono::DateTime\u003cchrono::Utc\u003e,\n    pub updated_at: chrono::DateTime\u003cchrono::Utc\u003e,\n}\n\nimpl Default for DocumentMetadata {\n    fn default() -\u003e Self {\n        Self::new(\"\", \"\")\n    }\n}\n\nimpl DocumentMetadata {\n    pub fn new(title: impl Into\u003cString\u003e, author: impl Into\u003cString\u003e) -\u003e Self {\n        let now = chrono::Utc::now();\n        Self {\n            title: title.into(),\n            author: author.into(),\n            tags: Vec::new(),\n            page_size: PageSize::A4,\n            created_at: now,\n            updated_at: now,\n        }\n    }\n\n    pub fn touch(\u0026mut self) {\n        self.updated_at = chrono::Utc::now();\n    }\n}\n\n#[derive(Clone, Debug, Serialize, Deserialize, Default)]\npub struct PageMetadata {\n    pub name: String,\n    pub notes: Option\u003cString\u003e,\n}\n","traces":[{"line":16,"address":[],"length":0,"stats":{"Line":0}},{"line":17,"address":[],"length":0,"stats":{"Line":0}},{"line":22,"address":[],"length":0,"stats":{"Line":1}},{"line":23,"address":[],"length":0,"stats":{"Line":2}},{"line":25,"address":[],"length":0,"stats":{"Line":3}},{"line":26,"address":[],"length":0,"stats":{"Line":3}},{"line":27,"address":[],"length":0,"stats":{"Line":2}},{"line":34,"address":[],"length":0,"stats":{"Line":0}},{"line":35,"address":[],"length":0,"stats":{"Line":0}}],"covered":5,"coverable":9},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","core","src","document","mod.rs"],"content":"mod builder;\nmod metadata;\nmod page;\nmod page_size;\n\nuse serde::{Deserialize, Serialize};\nuse std::collections::HashMap;\nuse std::fmt;\n\npub use builder::{DocumentBuilder, DocumentBuilderError};\npub use metadata::{DocumentMetadata, PageMetadata};\npub use page::{\n    Page, PageId, DocumentElement, ShapeKind,\n    FrameElement, TextElement, ImageElement, ShapeElement\n};\npub use page_size::PageSize;\n\n#[derive(Clone, Copy, Debug, PartialEq, Eq, Hash, Serialize, Deserialize)]\npub struct DocumentId(uuid::Uuid);\n\nimpl DocumentId {\n    pub fn new() -\u003e Self {\n        Self(uuid::Uuid::new_v4())\n    }\n}\n\nimpl fmt::Display for DocumentId {\n    fn fmt(\u0026self, f: \u0026mut fmt::Formatter\u003c'_\u003e) -\u003e fmt::Result {\n        write!(f, \"{}\", self.0)\n    }\n}\n\n#[derive(Clone, Debug, Serialize, Deserialize)]\npub struct Document {\n    pub id: DocumentId,\n    pub metadata: DocumentMetadata,\n    pub pages: Vec\u003cPage\u003e,\n    #[serde(default)]\n    pub styles: HashMap\u003cString, String\u003e,\n}\n\nimpl Document {\n    pub fn empty(title: impl Into\u003cString\u003e) -\u003e Self {\n        DocumentBuilder::new()\n            .with_title(title)\n            .add_page(Page::empty())\n            .build()\n            .expect(\"empty document always valid\")\n    }\n\n    pub fn page(\u0026self, id: PageId) -\u003e Option\u003c\u0026Page\u003e {\n        self.pages.iter().find(|p| p.id == id)\n    }\n\n    pub fn pages(\u0026self) -\u003e impl Iterator\u003cItem = \u0026Page\u003e {\n        self.pages.iter()\n    }\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n\n    #[test]\n    fn builds_empty_document() {\n        let doc = Document::empty(\"Test\");\n        assert_eq!(doc.metadata.title, \"Test\");\n        assert_eq!(doc.pages.len(), 1);\n    }\n}\n","traces":[{"line":22,"address":[],"length":0,"stats":{"Line":1}},{"line":23,"address":[],"length":0,"stats":{"Line":1}},{"line":28,"address":[],"length":0,"stats":{"Line":0}},{"line":29,"address":[],"length":0,"stats":{"Line":0}},{"line":43,"address":[],"length":0,"stats":{"Line":1}},{"line":44,"address":[],"length":0,"stats":{"Line":1}},{"line":45,"address":[],"length":0,"stats":{"Line":2}},{"line":46,"address":[],"length":0,"stats":{"Line":2}},{"line":51,"address":[],"length":0,"stats":{"Line":0}},{"line":52,"address":[],"length":0,"stats":{"Line":0}},{"line":55,"address":[],"length":0,"stats":{"Line":0}},{"line":56,"address":[],"length":0,"stats":{"Line":0}}],"covered":6,"coverable":12},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","core","src","document","page.rs"],"content":"use super::PageMetadata;\nuse serde::{Deserialize, Serialize};\n\n#[derive(Clone, Copy, Debug, PartialEq, Eq, Hash, Serialize, Deserialize)]\npub struct PageId(uuid::Uuid);\n\nimpl PageId {\n    pub fn new() -\u003e Self {\n        Self(uuid::Uuid::new_v4())\n    }\n}\n\n#[derive(Clone, Debug, Serialize, Deserialize)]\npub struct Page {\n    pub id: PageId,\n    pub metadata: PageMetadata,\n    pub elements: Vec\u003cDocumentElement\u003e,\n}\n\nimpl Page {\n    pub fn empty() -\u003e Self {\n        Self {\n            id: PageId::new(),\n            metadata: PageMetadata::default(),\n            elements: Vec::new(),\n        }\n    }\n\n    pub fn add_element(\u0026mut self, element: DocumentElement) {\n        self.elements.push(element);\n    }\n\n    /// Bring an element to the front (top of z-order stack)\n    pub fn bring_to_front(\u0026mut self, element_id: uuid::Uuid) -\u003e bool {\n        if let Some(pos) = self.elements.iter().position(|e| e.id() == element_id) {\n            let element = self.elements.remove(pos);\n            self.elements.push(element);\n            true\n        } else {\n            false\n        }\n    }\n\n    /// Send an element to the back (bottom of z-order stack)\n    pub fn send_to_back(\u0026mut self, element_id: uuid::Uuid) -\u003e bool {\n        if let Some(pos) = self.elements.iter().position(|e| e.id() == element_id) {\n            let element = self.elements.remove(pos);\n            self.elements.insert(0, element);\n            true\n        } else {\n            false\n        }\n    }\n\n    /// Move an element forward one position in z-order\n    pub fn bring_forward(\u0026mut self, element_id: uuid::Uuid) -\u003e bool {\n        if let Some(pos) = self.elements.iter().position(|e| e.id() == element_id) {\n            if pos \u003c self.elements.len() - 1 {\n                self.elements.swap(pos, pos + 1);\n                true\n            } else {\n                false  // Already at front\n            }\n        } else {\n            false\n        }\n    }\n\n    /// Move an element backward one position in z-order\n    pub fn send_backward(\u0026mut self, element_id: uuid::Uuid) -\u003e bool {\n        if let Some(pos) = self.elements.iter().position(|e| e.id() == element_id) {\n            if pos \u003e 0 {\n                self.elements.swap(pos, pos - 1);\n                true\n            } else {\n                false  // Already at back\n            }\n        } else {\n            false\n        }\n    }\n\n    /// Get the z-order index of an element (0 = back, len-1 = front)\n    pub fn z_order(\u0026self, element_id: uuid::Uuid) -\u003e Option\u003cusize\u003e {\n        self.elements.iter().position(|e| e.id() == element_id)\n    }\n}\n\n#[derive(Clone, Debug, Serialize, Deserialize)]\npub enum DocumentElement {\n    Frame(FrameElement),\n    Text(TextElement),\n    Image(ImageElement),\n    Shape(ShapeElement),\n}\n\nimpl DocumentElement {\n    /// Get the ID of any document element\n    pub fn id(\u0026self) -\u003e uuid::Uuid {\n        match self {\n            DocumentElement::Frame(f) =\u003e f.id,\n            DocumentElement::Text(t) =\u003e t.id,\n            DocumentElement::Image(i) =\u003e i.id,\n            DocumentElement::Shape(s) =\u003e s.id,\n        }\n    }\n}\n\n#[derive(Clone, Debug, Serialize, Deserialize)]\npub struct FrameElement {\n    pub id: uuid::Uuid,\n    pub bounds: super::super::layout::Rect,\n    pub children: Vec\u003cDocumentElement\u003e,\n}\n\n#[derive(Clone, Debug, Serialize, Deserialize)]\npub struct TextElement {\n    pub id: uuid::Uuid,\n    pub content: String,\n    pub style: crate::typography::TextStyle,\n    pub bounds: super::super::layout::Rect,\n}\n\n#[derive(Clone, Debug, Serialize, Deserialize)]\npub struct ImageElement {\n    pub id: uuid::Uuid,\n    pub source: crate::workspace::assets::AssetRef,\n    pub bounds: super::super::layout::Rect,\n}\n\n#[derive(Clone, Debug, Serialize, Deserialize)]\npub struct ShapeElement {\n    pub id: uuid::Uuid,\n    pub kind: ShapeKind,\n    pub bounds: super::super::layout::Rect,\n    pub stroke: Option\u003ccrate::typography::Color\u003e,\n    pub fill: Option\u003ccrate::typography::Color\u003e,\n}\n\n#[derive(Clone, Debug, Serialize, Deserialize)]\npub enum ShapeKind {\n    Rectangle,\n    Ellipse,\n    Line,\n    Arrow,\n    Polygon,\n}\n","traces":[{"line":8,"address":[],"length":0,"stats":{"Line":1}},{"line":9,"address":[],"length":0,"stats":{"Line":1}},{"line":21,"address":[],"length":0,"stats":{"Line":1}},{"line":23,"address":[],"length":0,"stats":{"Line":2}},{"line":24,"address":[],"length":0,"stats":{"Line":1}},{"line":25,"address":[],"length":0,"stats":{"Line":1}},{"line":29,"address":[],"length":0,"stats":{"Line":0}},{"line":30,"address":[],"length":0,"stats":{"Line":0}},{"line":34,"address":[],"length":0,"stats":{"Line":0}},{"line":35,"address":[],"length":0,"stats":{"Line":0}},{"line":36,"address":[],"length":0,"stats":{"Line":0}},{"line":37,"address":[],"length":0,"stats":{"Line":0}},{"line":38,"address":[],"length":0,"stats":{"Line":0}},{"line":40,"address":[],"length":0,"stats":{"Line":0}},{"line":45,"address":[],"length":0,"stats":{"Line":0}},{"line":46,"address":[],"length":0,"stats":{"Line":0}},{"line":47,"address":[],"length":0,"stats":{"Line":0}},{"line":48,"address":[],"length":0,"stats":{"Line":0}},{"line":49,"address":[],"length":0,"stats":{"Line":0}},{"line":51,"address":[],"length":0,"stats":{"Line":0}},{"line":56,"address":[],"length":0,"stats":{"Line":0}},{"line":57,"address":[],"length":0,"stats":{"Line":0}},{"line":58,"address":[],"length":0,"stats":{"Line":0}},{"line":59,"address":[],"length":0,"stats":{"Line":0}},{"line":60,"address":[],"length":0,"stats":{"Line":0}},{"line":62,"address":[],"length":0,"stats":{"Line":0}},{"line":65,"address":[],"length":0,"stats":{"Line":0}},{"line":70,"address":[],"length":0,"stats":{"Line":0}},{"line":71,"address":[],"length":0,"stats":{"Line":0}},{"line":72,"address":[],"length":0,"stats":{"Line":0}},{"line":73,"address":[],"length":0,"stats":{"Line":0}},{"line":74,"address":[],"length":0,"stats":{"Line":0}},{"line":76,"address":[],"length":0,"stats":{"Line":0}},{"line":79,"address":[],"length":0,"stats":{"Line":0}},{"line":84,"address":[],"length":0,"stats":{"Line":0}},{"line":85,"address":[],"length":0,"stats":{"Line":0}},{"line":99,"address":[],"length":0,"stats":{"Line":0}},{"line":100,"address":[],"length":0,"stats":{"Line":0}},{"line":101,"address":[],"length":0,"stats":{"Line":0}},{"line":102,"address":[],"length":0,"stats":{"Line":0}},{"line":103,"address":[],"length":0,"stats":{"Line":0}},{"line":104,"address":[],"length":0,"stats":{"Line":0}}],"covered":6,"coverable":42},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","core","src","document","page_size.rs"],"content":"//! Page size definitions and presets\n\nuse crate::layout::Size;\nuse serde::{Deserialize, Serialize};\n\n/// Common page size presets\n#[derive(Clone, Copy, Debug, Serialize, Deserialize, PartialEq)]\npub enum PageSize {\n    /// A4 size (210mm x 297mm = 595 x 842 points at 72 DPI)\n    A4,\n    /// Letter size (8.5\" x 11\" = 612 x 792 points at 72 DPI)\n    Letter,\n    /// A3 size (297mm x 420mm = 842 x 1191 points at 72 DPI)\n    A3,\n    /// A5 size (148mm x 210mm = 420 x 595 points at 72 DPI)\n    A5,\n    /// Tabloid/B4 size (11\" x 17\" = 792 x 1224 points at 72 DPI)\n    Tabloid,\n    /// Square (512 x 512 points)\n    Square,\n    /// Custom size (width x height in points)\n    Custom(f32, f32),\n}\n\nimpl Default for PageSize {\n    fn default() -\u003e Self {\n        PageSize::A4\n    }\n}\n\nimpl PageSize {\n    /// Get the size in points\n    pub fn to_size(\u0026self) -\u003e Size {\n        match self {\n            PageSize::A4 =\u003e Size::new(595.0, 842.0),\n            PageSize::Letter =\u003e Size::new(612.0, 792.0),\n            PageSize::A3 =\u003e Size::new(842.0, 1191.0),\n            PageSize::A5 =\u003e Size::new(420.0, 595.0),\n            PageSize::Tabloid =\u003e Size::new(792.0, 1224.0),\n            PageSize::Square =\u003e Size::new(512.0, 512.0),\n            PageSize::Custom(width, height) =\u003e Size::new(*width, *height),\n        }\n    }\n\n    /// Get the name of the page size\n    pub fn name(\u0026self) -\u003e \u0026str {\n        match self {\n            PageSize::A4 =\u003e \"A4\",\n            PageSize::Letter =\u003e \"Letter\",\n            PageSize::A3 =\u003e \"A3\",\n            PageSize::A5 =\u003e \"A5\",\n            PageSize::Tabloid =\u003e \"Tabloid\",\n            PageSize::Square =\u003e \"Square\",\n            PageSize::Custom(_, _) =\u003e \"Custom\",\n        }\n    }\n\n    /// Get all available preset sizes\n    pub fn presets() -\u003e \u0026'static [PageSize] {\n        \u0026[\n            PageSize::A4,\n            PageSize::Letter,\n            PageSize::A3,\n            PageSize::A5,\n            PageSize::Tabloid,\n            PageSize::Square,\n        ]\n    }\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n\n    #[test]\n    fn test_a4_size() {\n        let size = PageSize::A4.to_size();\n        assert_eq!(size.width, 595.0);\n        assert_eq!(size.height, 842.0);\n    }\n\n    #[test]\n    fn test_custom_size() {\n        let size = PageSize::Custom(800.0, 600.0).to_size();\n        assert_eq!(size.width, 800.0);\n        assert_eq!(size.height, 600.0);\n    }\n\n    #[test]\n    fn test_default_is_a4() {\n        assert_eq!(PageSize::default(), PageSize::A4);\n    }\n}\n","traces":[{"line":26,"address":[],"length":0,"stats":{"Line":1}},{"line":27,"address":[],"length":0,"stats":{"Line":1}},{"line":33,"address":[],"length":0,"stats":{"Line":2}},{"line":34,"address":[],"length":0,"stats":{"Line":2}},{"line":35,"address":[],"length":0,"stats":{"Line":1}},{"line":36,"address":[],"length":0,"stats":{"Line":0}},{"line":37,"address":[],"length":0,"stats":{"Line":0}},{"line":38,"address":[],"length":0,"stats":{"Line":0}},{"line":39,"address":[],"length":0,"stats":{"Line":0}},{"line":40,"address":[],"length":0,"stats":{"Line":0}},{"line":41,"address":[],"length":0,"stats":{"Line":5}},{"line":46,"address":[],"length":0,"stats":{"Line":0}},{"line":47,"address":[],"length":0,"stats":{"Line":0}},{"line":48,"address":[],"length":0,"stats":{"Line":0}},{"line":49,"address":[],"length":0,"stats":{"Line":0}},{"line":50,"address":[],"length":0,"stats":{"Line":0}},{"line":51,"address":[],"length":0,"stats":{"Line":0}},{"line":52,"address":[],"length":0,"stats":{"Line":0}},{"line":53,"address":[],"length":0,"stats":{"Line":0}},{"line":54,"address":[],"length":0,"stats":{"Line":0}},{"line":59,"address":[],"length":0,"stats":{"Line":0}},{"line":60,"address":[],"length":0,"stats":{"Line":0}},{"line":61,"address":[],"length":0,"stats":{"Line":0}},{"line":62,"address":[],"length":0,"stats":{"Line":0}},{"line":63,"address":[],"length":0,"stats":{"Line":0}},{"line":64,"address":[],"length":0,"stats":{"Line":0}},{"line":65,"address":[],"length":0,"stats":{"Line":0}},{"line":66,"address":[],"length":0,"stats":{"Line":0}}],"covered":6,"coverable":28},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","core","src","layout","canvas.rs"],"content":"use super::{Point, Rect, Size};\nuse serde::{Deserialize, Serialize};\n\n#[derive(Clone, Debug, Serialize, Deserialize)]\npub struct CanvasLayout {\n    pub page_size: Size,\n    pub margin: f32,\n    pub sections: Vec\u003cLayoutSection\u003e,\n}\n\nimpl CanvasLayout {\n    pub fn new(page_size: Size) -\u003e Self {\n        Self {\n            page_size,\n            margin: 16.0,\n            sections: Vec::new(),\n        }\n    }\n\n    pub fn add_section(\u0026mut self, section: LayoutSection) {\n        self.sections.push(section);\n    }\n\n    pub fn section_at(\u0026self, point: Point) -\u003e Option\u003c\u0026LayoutSection\u003e {\n        self.sections.iter().find(|section| section.bounds.contains(point))\n    }\n}\n\n#[derive(Clone, Debug, Serialize, Deserialize)]\npub struct LayoutSection {\n    pub id: uuid::Uuid,\n    pub name: String,\n    pub bounds: Rect,\n}\n\nimpl LayoutSection {\n    pub fn new(name: impl Into\u003cString\u003e, bounds: Rect) -\u003e Self {\n        Self {\n            id: uuid::Uuid::new_v4(),\n            name: name.into(),\n            bounds,\n        }\n    }\n}\n","traces":[{"line":12,"address":[],"length":0,"stats":{"Line":0}},{"line":16,"address":[],"length":0,"stats":{"Line":0}},{"line":20,"address":[],"length":0,"stats":{"Line":0}},{"line":21,"address":[],"length":0,"stats":{"Line":0}},{"line":24,"address":[],"length":0,"stats":{"Line":0}},{"line":25,"address":[],"length":0,"stats":{"Line":0}},{"line":37,"address":[],"length":0,"stats":{"Line":0}},{"line":39,"address":[],"length":0,"stats":{"Line":0}},{"line":40,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":9},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","core","src","layout","engine.rs"],"content":"use super::{CanvasLayout, Rect, Size};\nuse serde::{Deserialize, Serialize};\nuse thiserror::Error;\n\n#[derive(Clone, Debug, Serialize, Deserialize)]\npub struct LayoutRequest {\n    pub canvas: CanvasLayout,\n    pub available_area: Size,\n}\n\n#[derive(Clone, Debug, Serialize, Deserialize)]\npub struct LayoutResult {\n    pub frames: Vec\u003cRect\u003e,\n}\n\n#[derive(Debug, Error)]\npub enum LayoutError {\n    #[error(\"insufficient room to place widget\" )]\n    NotEnoughRoom,\n}\n\npub struct LayoutEngine;\n\nimpl LayoutEngine {\n    pub fn compute(request: \u0026LayoutRequest) -\u003e Result\u003cLayoutResult, LayoutError\u003e {\n        let mut frames = Vec::new();\n        for section in \u0026request.canvas.sections {\n            if section.bounds.size.width \u003e request.available_area.width\n                || section.bounds.size.height \u003e request.available_area.height\n            {\n                return Err(LayoutError::NotEnoughRoom);\n            }\n            frames.push(section.bounds);\n        }\n        Ok(LayoutResult { frames })\n    }\n}\n","traces":[{"line":25,"address":[],"length":0,"stats":{"Line":0}},{"line":26,"address":[],"length":0,"stats":{"Line":0}},{"line":27,"address":[],"length":0,"stats":{"Line":0}},{"line":28,"address":[],"length":0,"stats":{"Line":0}},{"line":29,"address":[],"length":0,"stats":{"Line":0}},{"line":31,"address":[],"length":0,"stats":{"Line":0}},{"line":33,"address":[],"length":0,"stats":{"Line":0}},{"line":35,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":8},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","core","src","layout","geometry.rs"],"content":"use serde::{Deserialize, Serialize};\n\n#[derive(Clone, Copy, Debug, Default, PartialEq, Serialize, Deserialize)]\npub struct Point {\n    pub x: f32,\n    pub y: f32,\n}\n\nimpl Point {\n    pub fn new(x: f32, y: f32) -\u003e Self {\n        Self { x, y }\n    }\n}\n\n#[derive(Clone, Copy, Debug, Default, PartialEq, Serialize, Deserialize)]\npub struct Size {\n    pub width: f32,\n    pub height: f32,\n}\n\nimpl Size {\n    pub fn new(width: f32, height: f32) -\u003e Self {\n        Self { width, height }\n    }\n}\n\n#[derive(Clone, Copy, Debug, Default, PartialEq, Serialize, Deserialize)]\npub struct Rect {\n    pub origin: Point,\n    pub size: Size,\n}\n\nimpl Rect {\n    pub fn new(origin: Point, size: Size) -\u003e Self {\n        Self { origin, size }\n    }\n\n    pub fn contains(\u0026self, point: Point) -\u003e bool {\n        point.x \u003e= self.origin.x\n            \u0026\u0026 point.y \u003e= self.origin.y\n            \u0026\u0026 point.x \u003c= self.origin.x + self.size.width\n            \u0026\u0026 point.y \u003c= self.origin.y + self.size.height\n    }\n}\n","traces":[{"line":10,"address":[],"length":0,"stats":{"Line":7}},{"line":22,"address":[],"length":0,"stats":{"Line":5}},{"line":34,"address":[],"length":0,"stats":{"Line":3}},{"line":38,"address":[],"length":0,"stats":{"Line":0}},{"line":39,"address":[],"length":0,"stats":{"Line":0}},{"line":40,"address":[],"length":0,"stats":{"Line":0}},{"line":41,"address":[],"length":0,"stats":{"Line":0}},{"line":42,"address":[],"length":0,"stats":{"Line":0}}],"covered":3,"coverable":8},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","core","src","layout","mod.rs"],"content":"//! Layout primitives and canvas composition utilities.\n\nmod geometry;\nmod canvas;\nmod engine;\n\npub use canvas::{CanvasLayout, LayoutSection};\npub use engine::{LayoutEngine, LayoutRequest, LayoutResult};\npub use geometry::{Point, Rect, Size};\n","traces":[],"covered":0,"coverable":0},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","core","src","lib.rs"],"content":"//! Core domain model for the Testruct desktop rewrite.\n//!\n//! The new codebase aims for a clear separation of responsibilities by\n//! breaking large modules into smaller files. Each module provides a single\n//! cohesive feature so that files stay around 500 lines or less.\n\npub mod document;\npub mod layout;\npub mod template;\npub mod typography;\npub mod workspace;\n\npub use document::{Document, DocumentId, PageId};\npub use layout::{CanvasLayout, LayoutEngine, Point, Rect, Size};\npub use template::Template;\npub use workspace::{AssetCatalog, AssetRef, CommandHistory, Project, ProjectSettings};\n","traces":[],"covered":0,"coverable":0},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","core","src","template","definition.rs"],"content":"use super::style::TemplateStyle;\nuse crate::layout::CanvasLayout;\nuse crate::document::PageMetadata;\nuse serde::{Deserialize, Serialize};\n\n#[derive(Clone, Copy, Debug, PartialEq, Eq, Hash, Serialize, Deserialize)]\npub struct TemplateId(uuid::Uuid);\n\nimpl TemplateId {\n    pub fn new() -\u003e Self {\n        Self(uuid::Uuid::new_v4())\n    }\n}\n\n#[derive(Clone, Debug, Serialize, Deserialize)]\npub struct Template {\n    pub id: TemplateId,\n    pub name: String,\n    pub description: Option\u003cString\u003e,\n    pub pages: Vec\u003cTemplatePage\u003e,\n    pub style: TemplateStyle,\n}\n\nimpl Template {\n    pub fn single_page(name: impl Into\u003cString\u003e, layout: CanvasLayout) -\u003e Self {\n        Self {\n            id: TemplateId::new(),\n            name: name.into(),\n            description: None,\n            pages: vec![TemplatePage {\n                metadata: PageMetadata::default(),\n                layout,\n            }],\n            style: TemplateStyle::default(),\n        }\n    }\n}\n\n#[derive(Clone, Debug, Serialize, Deserialize)]\npub struct TemplatePage {\n    pub metadata: PageMetadata,\n    pub layout: CanvasLayout,\n}\n","traces":[{"line":10,"address":[],"length":0,"stats":{"Line":0}},{"line":11,"address":[],"length":0,"stats":{"Line":0}},{"line":25,"address":[],"length":0,"stats":{"Line":0}},{"line":27,"address":[],"length":0,"stats":{"Line":0}},{"line":28,"address":[],"length":0,"stats":{"Line":0}},{"line":30,"address":[],"length":0,"stats":{"Line":0}},{"line":34,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":7},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","core","src","template","library.rs"],"content":"use super::{Template, TemplateId};\nuse serde::{Deserialize, Serialize};\nuse std::collections::HashMap;\n\n#[derive(Clone, Debug, Default, Serialize, Deserialize)]\npub struct TemplateLibrary {\n    templates: HashMap\u003cTemplateId, Template\u003e,\n}\n\nimpl TemplateLibrary {\n    pub fn register(\u0026mut self, template: Template) -\u003e TemplateRef {\n        let id = template.id;\n        self.templates.insert(id, template);\n        TemplateRef { id }\n    }\n\n    pub fn get(\u0026self, id: TemplateId) -\u003e Option\u003cTemplate\u003e {\n        self.templates.get(\u0026id).cloned()\n    }\n\n    pub fn iter(\u0026self) -\u003e impl Iterator\u003cItem = Template\u003e + '_ {\n        self.templates.values().cloned()\n    }\n}\n\n#[derive(Clone, Copy, Debug, Serialize, Deserialize, PartialEq, Eq, Hash)]\npub struct TemplateRef {\n    pub id: TemplateId,\n}\n","traces":[{"line":11,"address":[],"length":0,"stats":{"Line":0}},{"line":12,"address":[],"length":0,"stats":{"Line":0}},{"line":13,"address":[],"length":0,"stats":{"Line":0}},{"line":17,"address":[],"length":0,"stats":{"Line":0}},{"line":18,"address":[],"length":0,"stats":{"Line":0}},{"line":21,"address":[],"length":0,"stats":{"Line":0}},{"line":22,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":7},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","core","src","template","mod.rs"],"content":"//! Template definitions and catalog management.\n\nmod definition;\nmod library;\nmod style;\n\npub use definition::{Template, TemplateId, TemplatePage};\npub use library::{TemplateLibrary, TemplateRef};\npub use style::{TemplateStyle, ThemeColors};\n","traces":[],"covered":0,"coverable":0},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","core","src","template","style.rs"],"content":"use crate::typography::Color;\nuse serde::{Deserialize, Serialize};\n\n#[derive(Clone, Debug, Serialize, Deserialize)]\npub struct TemplateStyle {\n    pub theme: ThemeColors,\n    pub font_family: String,\n}\n\nimpl Default for TemplateStyle {\n    fn default() -\u003e Self {\n        Self {\n            theme: ThemeColors::default(),\n            font_family: \"Inter\".into(),\n        }\n    }\n}\n\n#[derive(Clone, Debug, Serialize, Deserialize)]\npub struct ThemeColors {\n    pub background: Color,\n    pub accent: Color,\n    pub text: Color,\n}\n\nimpl Default for ThemeColors {\n    fn default() -\u003e Self {\n        Self {\n            background: Color::from_rgb(0.95, 0.95, 0.95),\n            accent: Color::from_rgb(0.3, 0.5, 0.9),\n            text: Color::from_rgb(0.1, 0.1, 0.1),\n        }\n    }\n}\n","traces":[{"line":11,"address":[],"length":0,"stats":{"Line":0}},{"line":13,"address":[],"length":0,"stats":{"Line":0}},{"line":14,"address":[],"length":0,"stats":{"Line":0}},{"line":27,"address":[],"length":0,"stats":{"Line":0}},{"line":29,"address":[],"length":0,"stats":{"Line":0}},{"line":30,"address":[],"length":0,"stats":{"Line":0}},{"line":31,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":7},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","core","src","typography","color.rs"],"content":"use serde::{Deserialize, Serialize};\n\n#[derive(Clone, Copy, Debug, Serialize, Deserialize, PartialEq, Default)]\npub struct Color {\n    #[serde(default)]\n    pub r: f32,\n    #[serde(default)]\n    pub g: f32,\n    #[serde(default)]\n    pub b: f32,\n    #[serde(default = \"Color::default_alpha\")]\n    pub a: f32,\n}\n\nimpl Color {\n    pub fn from_rgb(r: f32, g: f32, b: f32) -\u003e Self {\n        Self { r, g, b, a: 1.0 }\n    }\n\n    pub fn with_alpha(self, a: f32) -\u003e Self {\n        Self { a, ..self }\n    }\n\n    fn default_alpha() -\u003e f32 {\n        1.0\n    }\n}\n\n#[derive(Clone, Debug, Default, Serialize, Deserialize)]\npub struct Palette {\n    pub primary: Color,\n    pub secondary: Color,\n    pub background: Color,\n}\n","traces":[{"line":16,"address":[],"length":0,"stats":{"Line":12}},{"line":20,"address":[],"length":0,"stats":{"Line":0}},{"line":24,"address":[],"length":0,"stats":{"Line":0}},{"line":25,"address":[],"length":0,"stats":{"Line":0}}],"covered":1,"coverable":4},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","core","src","typography","font_catalog.rs"],"content":"use serde::{Deserialize, Serialize};\nuse std::collections::HashMap;\n\n#[derive(Clone, Debug, Serialize, Deserialize)]\npub struct FontCatalog {\n    fonts: HashMap\u003cString, FontDescriptor\u003e,\n}\n\nimpl FontCatalog {\n    pub fn new() -\u003e Self {\n        Self {\n            fonts: HashMap::new(),\n        }\n    }\n\n    pub fn register(\u0026mut self, descriptor: FontDescriptor) {\n        self.fonts.insert(descriptor.family.clone(), descriptor);\n    }\n\n    pub fn find(\u0026self, family: \u0026str) -\u003e Option\u003c\u0026FontDescriptor\u003e {\n        self.fonts.get(family)\n    }\n}\n\n#[derive(Clone, Debug, Serialize, Deserialize)]\npub struct FontDescriptor {\n    pub family: String,\n    pub weights: Vec\u003csuper::text_style::FontWeight\u003e,\n}\n","traces":[{"line":10,"address":[],"length":0,"stats":{"Line":0}},{"line":12,"address":[],"length":0,"stats":{"Line":0}},{"line":16,"address":[],"length":0,"stats":{"Line":0}},{"line":17,"address":[],"length":0,"stats":{"Line":0}},{"line":20,"address":[],"length":0,"stats":{"Line":0}},{"line":21,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":6},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","core","src","typography","mod.rs"],"content":"//! Typography and color utilities.\n\nmod color;\nmod text_style;\nmod font_catalog;\npub mod rich_text;\n\npub use color::{Color, Palette};\npub use font_catalog::{FontCatalog, FontDescriptor};\npub use text_style::{TextAlignment, TextStyle, FontWeight};\npub use rich_text::{RichText, TextRun};\n","traces":[],"covered":0,"coverable":0},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","core","src","typography","rich_text.rs"],"content":"//! Rich text support with formatting runs\n//!\n//! Allows applying different text styles to different regions of text.\n\nuse super::{TextStyle, FontWeight};\nuse serde::{Deserialize, Serialize};\n\n/// A run of text with consistent formatting\n#[derive(Clone, Debug, Serialize, Deserialize)]\npub struct TextRun {\n    pub text: String,\n    pub style: TextStyle,\n}\n\n/// Rich text composed of multiple runs with different styles\n#[derive(Clone, Debug, Serialize, Deserialize)]\npub struct RichText {\n    pub runs: Vec\u003cTextRun\u003e,\n}\n\nimpl RichText {\n    /// Create rich text from a plain string with a base style\n    pub fn from_plain(text: \u0026str, style: TextStyle) -\u003e Self {\n        Self {\n            runs: vec![TextRun {\n                text: text.to_string(),\n                style,\n            }],\n        }\n    }\n\n    /// Get the complete text without formatting\n    pub fn get_plain_text(\u0026self) -\u003e String {\n        self.runs.iter().map(|run| run.text.as_str()).collect::\u003cVec\u003c_\u003e\u003e().join(\"\")\n    }\n\n    /// Get the total text length in characters\n    pub fn text_length(\u0026self) -\u003e usize {\n        self.runs.iter().map(|run| run.text.len()).sum()\n    }\n\n    /// Validate that indices are within bounds\n    fn validate_range(\u0026self, start: usize, end: usize) -\u003e bool {\n        let len = self.text_length();\n        start \u003c= len \u0026\u0026 end \u003c= len\n    }\n\n    /// Normalize range (swap if start \u003e end)\n    fn normalize_range(\u0026self, start: usize, end: usize) -\u003e (usize, usize) {\n        if start \u003c= end {\n            (start, end)\n        } else {\n            (end, start)\n        }\n    }\n\n    /// Apply bold to a character range\n    pub fn apply_bold(\u0026mut self, start: usize, end: usize) {\n        self.apply_style_to_range(start, end, |style| {\n            style.weight = FontWeight::Bold;\n        });\n    }\n\n    /// Remove bold from a character range\n    pub fn remove_bold(\u0026mut self, start: usize, end: usize) {\n        self.apply_style_to_range(start, end, |style| {\n            style.weight = FontWeight::Regular;\n        });\n    }\n\n    /// Apply italic to a character range\n    pub fn apply_italic(\u0026mut self, start: usize, end: usize) {\n        self.apply_style_to_range(start, end, |style| {\n            style.italic = true;\n        });\n    }\n\n    /// Remove italic from a character range\n    pub fn remove_italic(\u0026mut self, start: usize, end: usize) {\n        self.apply_style_to_range(start, end, |style| {\n            style.italic = false;\n        });\n    }\n\n    /// Apply underline to a character range\n    pub fn apply_underline(\u0026mut self, start: usize, end: usize) {\n        self.apply_style_to_range(start, end, |style| {\n            style.underline = true;\n        });\n    }\n\n    /// Remove underline from a character range\n    pub fn remove_underline(\u0026mut self, start: usize, end: usize) {\n        self.apply_style_to_range(start, end, |style| {\n            style.underline = false;\n        });\n    }\n\n    /// Apply strikethrough to a character range\n    pub fn apply_strikethrough(\u0026mut self, start: usize, end: usize) {\n        self.apply_style_to_range(start, end, |style| {\n            style.strikethrough = true;\n        });\n    }\n\n    /// Remove strikethrough from a character range\n    pub fn remove_strikethrough(\u0026mut self, start: usize, end: usize) {\n        self.apply_style_to_range(start, end, |style| {\n            style.strikethrough = false;\n        });\n    }\n\n    /// Apply a style modification function to a character range\n    fn apply_style_to_range\u003cF\u003e(\u0026mut self, start: usize, end: usize, modifier: F)\n    where\n        F: Fn(\u0026mut TextStyle),\n    {\n        // Normalize range (swap if needed)\n        let (start, end) = self.normalize_range(start, end);\n\n        // Validate range bounds\n        if !self.validate_range(start, end) {\n            // Range is out of bounds, return without applying changes\n            return;\n        }\n\n        // If start == end, nothing to do\n        if start == end {\n            return;\n        }\n\n        let mut char_index = 0;\n        let mut new_runs = Vec::new();\n\n        for run in \u0026self.runs {\n            let run_start = char_index;\n            let run_end = char_index + run.text.len();\n\n            if run_end \u003c= start || run_start \u003e= end {\n                // No overlap - keep run as is\n                new_runs.push(run.clone());\n            } else {\n                // There's overlap - need to split the run\n                let overlap_start = start.saturating_sub(run_start);\n                let overlap_end = (end - run_start).min(run.text.len());\n\n                // Part before overlap\n                if overlap_start \u003e 0 {\n                    new_runs.push(TextRun {\n                        text: run.text[..overlap_start].to_string(),\n                        style: run.style.clone(),\n                    });\n                }\n\n                // Overlapped part - apply modification\n                let mut modified_style = run.style.clone();\n                modifier(\u0026mut modified_style);\n                new_runs.push(TextRun {\n                    text: run.text[overlap_start..overlap_end].to_string(),\n                    style: modified_style,\n                });\n\n                // Part after overlap\n                if overlap_end \u003c run.text.len() {\n                    new_runs.push(TextRun {\n                        text: run.text[overlap_end..].to_string(),\n                        style: run.style.clone(),\n                    });\n                }\n            }\n\n            char_index = run_end;\n        }\n\n        // Merge consecutive runs with the same style\n        self.runs = self.merge_runs(new_runs);\n    }\n\n    /// Merge consecutive runs that have the same style\n    fn merge_runs(\u0026self, runs: Vec\u003cTextRun\u003e) -\u003e Vec\u003cTextRun\u003e {\n        if runs.is_empty() {\n            return runs;\n        }\n\n        let mut merged = Vec::new();\n        let mut current_run = runs[0].clone();\n\n        for run in \u0026runs[1..] {\n            if styles_equal(\u0026current_run.style, \u0026run.style) {\n                // Merge with current run\n                current_run.text.push_str(\u0026run.text);\n            } else {\n                // Start a new run\n                merged.push(current_run);\n                current_run = run.clone();\n            }\n        }\n        merged.push(current_run);\n\n        merged\n    }\n\n    /// Check if text has bold formatting in the range\n    pub fn has_bold(\u0026self, start: usize, end: usize) -\u003e bool {\n        self.check_style(start, end, |style| style.weight == FontWeight::Bold)\n    }\n\n    /// Check if text has italic formatting in the range\n    pub fn has_italic(\u0026self, start: usize, end: usize) -\u003e bool {\n        self.check_style(start, end, |style| style.italic)\n    }\n\n    /// Check if text has underline formatting in the range\n    pub fn has_underline(\u0026self, start: usize, end: usize) -\u003e bool {\n        self.check_style(start, end, |style| style.underline)\n    }\n\n    /// Check if a style property matches across the range\n    fn check_style\u003cF\u003e(\u0026self, start: usize, end: usize, checker: F) -\u003e bool\n    where\n        F: Fn(\u0026TextStyle) -\u003e bool,\n    {\n        let start = start.min(end);\n        let end = start.max(end);\n\n        let mut char_index = 0;\n        for run in \u0026self.runs {\n            let run_start = char_index;\n            let run_end = char_index + run.text.len();\n\n            if run_end \u003e start \u0026\u0026 run_start \u003c end {\n                if !checker(\u0026run.style) {\n                    return false;\n                }\n            }\n\n            char_index = run_end;\n        }\n\n        true\n    }\n}\n\n/// Check if two TextStyles are equal\nfn styles_equal(a: \u0026TextStyle, b: \u0026TextStyle) -\u003e bool {\n    a.font_family == b.font_family\n        \u0026\u0026 a.font_size == b.font_size\n        \u0026\u0026 a.weight == b.weight\n        \u0026\u0026 a.alignment == b.alignment\n        \u0026\u0026 a.color == b.color\n        \u0026\u0026 a.italic == b.italic\n        \u0026\u0026 a.underline == b.underline\n        \u0026\u0026 a.strikethrough == b.strikethrough\n        \u0026\u0026 a.background_color == b.background_color\n        \u0026\u0026 a.line_height == b.line_height\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n\n    #[test]\n    fn test_rich_text_from_plain() {\n        let style = TextStyle::default();\n        let text = RichText::from_plain(\"Hello World\", style.clone());\n\n        assert_eq!(text.get_plain_text(), \"Hello World\");\n        assert_eq!(text.runs.len(), 1);\n    }\n\n    #[test]\n    fn test_apply_bold() {\n        let style = TextStyle::default();\n        let mut text = RichText::from_plain(\"Hello World\", style);\n\n        text.apply_bold(0, 5);\n\n        assert!(text.has_bold(0, 5));\n        assert!(!text.has_bold(6, 11));\n    }\n\n    #[test]\n    fn test_apply_italic() {\n        let style = TextStyle::default();\n        let mut text = RichText::from_plain(\"Hello World\", style);\n\n        text.apply_italic(6, 11);\n\n        assert!(!text.has_italic(0, 5));\n        assert!(text.has_italic(6, 11));\n    }\n\n    #[test]\n    fn test_multiple_formatting() {\n        let style = TextStyle::default();\n        let mut text = RichText::from_plain(\"Hello World\", style);\n\n        text.apply_bold(0, 5);\n        text.apply_italic(6, 11);\n        text.apply_underline(0, 11);\n\n        assert!(text.has_bold(0, 5));\n        assert!(text.has_italic(6, 11));\n        assert!(text.has_underline(0, 11));\n    }\n\n    #[test]\n    fn test_run_merging() {\n        let style = TextStyle::default();\n        let mut text = RichText::from_plain(\"Hello\", style);\n\n        text.apply_bold(0, 5);\n        text.remove_bold(0, 5);\n\n        // Should merge back to single run\n        assert_eq!(text.runs.len(), 1);\n    }\n}\n","traces":[{"line":23,"address":[],"length":0,"stats":{"Line":5}},{"line":25,"address":[],"length":0,"stats":{"Line":10}},{"line":33,"address":[],"length":0,"stats":{"Line":1}},{"line":34,"address":[],"length":0,"stats":{"Line":7}},{"line":38,"address":[],"length":0,"stats":{"Line":7}},{"line":39,"address":[],"length":0,"stats":{"Line":41}},{"line":43,"address":[],"length":0,"stats":{"Line":7}},{"line":44,"address":[],"length":0,"stats":{"Line":21}},{"line":45,"address":[],"length":0,"stats":{"Line":14}},{"line":49,"address":[],"length":0,"stats":{"Line":7}},{"line":50,"address":[],"length":0,"stats":{"Line":7}},{"line":51,"address":[],"length":0,"stats":{"Line":7}},{"line":53,"address":[],"length":0,"stats":{"Line":0}},{"line":58,"address":[],"length":0,"stats":{"Line":3}},{"line":59,"address":[],"length":0,"stats":{"Line":15}},{"line":60,"address":[],"length":0,"stats":{"Line":3}},{"line":65,"address":[],"length":0,"stats":{"Line":1}},{"line":66,"address":[],"length":0,"stats":{"Line":5}},{"line":67,"address":[],"length":0,"stats":{"Line":1}},{"line":72,"address":[],"length":0,"stats":{"Line":2}},{"line":73,"address":[],"length":0,"stats":{"Line":10}},{"line":74,"address":[],"length":0,"stats":{"Line":2}},{"line":79,"address":[],"length":0,"stats":{"Line":0}},{"line":80,"address":[],"length":0,"stats":{"Line":0}},{"line":81,"address":[],"length":0,"stats":{"Line":0}},{"line":86,"address":[],"length":0,"stats":{"Line":1}},{"line":87,"address":[],"length":0,"stats":{"Line":7}},{"line":88,"address":[],"length":0,"stats":{"Line":3}},{"line":93,"address":[],"length":0,"stats":{"Line":0}},{"line":94,"address":[],"length":0,"stats":{"Line":0}},{"line":95,"address":[],"length":0,"stats":{"Line":0}},{"line":100,"address":[],"length":0,"stats":{"Line":0}},{"line":101,"address":[],"length":0,"stats":{"Line":0}},{"line":102,"address":[],"length":0,"stats":{"Line":0}},{"line":107,"address":[],"length":0,"stats":{"Line":0}},{"line":108,"address":[],"length":0,"stats":{"Line":0}},{"line":109,"address":[],"length":0,"stats":{"Line":0}},{"line":114,"address":[],"length":0,"stats":{"Line":7}},{"line":119,"address":[],"length":0,"stats":{"Line":35}},{"line":122,"address":[],"length":0,"stats":{"Line":21}},{"line":124,"address":[],"length":0,"stats":{"Line":0}},{"line":128,"address":[],"length":0,"stats":{"Line":7}},{"line":129,"address":[],"length":0,"stats":{"Line":0}},{"line":132,"address":[],"length":0,"stats":{"Line":14}},{"line":133,"address":[],"length":0,"stats":{"Line":14}},{"line":135,"address":[],"length":0,"stats":{"Line":27}},{"line":136,"address":[],"length":0,"stats":{"Line":20}},{"line":137,"address":[],"length":0,"stats":{"Line":30}},{"line":139,"address":[],"length":0,"stats":{"Line":20}},{"line":141,"address":[],"length":0,"stats":{"Line":3}},{"line":144,"address":[],"length":0,"stats":{"Line":36}},{"line":145,"address":[],"length":0,"stats":{"Line":45}},{"line":148,"address":[],"length":0,"stats":{"Line":11}},{"line":149,"address":[],"length":0,"stats":{"Line":6}},{"line":150,"address":[],"length":0,"stats":{"Line":6}},{"line":151,"address":[],"length":0,"stats":{"Line":2}},{"line":156,"address":[],"length":0,"stats":{"Line":27}},{"line":157,"address":[],"length":0,"stats":{"Line":9}},{"line":158,"address":[],"length":0,"stats":{"Line":27}},{"line":159,"address":[],"length":0,"stats":{"Line":27}},{"line":160,"address":[],"length":0,"stats":{"Line":9}},{"line":164,"address":[],"length":0,"stats":{"Line":20}},{"line":165,"address":[],"length":0,"stats":{"Line":6}},{"line":166,"address":[],"length":0,"stats":{"Line":6}},{"line":167,"address":[],"length":0,"stats":{"Line":2}},{"line":172,"address":[],"length":0,"stats":{"Line":10}},{"line":176,"address":[],"length":0,"stats":{"Line":28}},{"line":180,"address":[],"length":0,"stats":{"Line":7}},{"line":181,"address":[],"length":0,"stats":{"Line":14}},{"line":182,"address":[],"length":0,"stats":{"Line":0}},{"line":185,"address":[],"length":0,"stats":{"Line":14}},{"line":186,"address":[],"length":0,"stats":{"Line":21}},{"line":188,"address":[],"length":0,"stats":{"Line":14}},{"line":189,"address":[],"length":0,"stats":{"Line":21}},{"line":191,"address":[],"length":0,"stats":{"Line":0}},{"line":194,"address":[],"length":0,"stats":{"Line":28}},{"line":195,"address":[],"length":0,"stats":{"Line":14}},{"line":198,"address":[],"length":0,"stats":{"Line":21}},{"line":200,"address":[],"length":0,"stats":{"Line":7}},{"line":204,"address":[],"length":0,"stats":{"Line":3}},{"line":205,"address":[],"length":0,"stats":{"Line":18}},{"line":209,"address":[],"length":0,"stats":{"Line":3}},{"line":210,"address":[],"length":0,"stats":{"Line":12}},{"line":214,"address":[],"length":0,"stats":{"Line":1}},{"line":215,"address":[],"length":0,"stats":{"Line":4}},{"line":219,"address":[],"length":0,"stats":{"Line":7}},{"line":223,"address":[],"length":0,"stats":{"Line":28}},{"line":224,"address":[],"length":0,"stats":{"Line":28}},{"line":226,"address":[],"length":0,"stats":{"Line":14}},{"line":227,"address":[],"length":0,"stats":{"Line":37}},{"line":228,"address":[],"length":0,"stats":{"Line":32}},{"line":229,"address":[],"length":0,"stats":{"Line":48}},{"line":231,"address":[],"length":0,"stats":{"Line":28}},{"line":232,"address":[],"length":0,"stats":{"Line":9}},{"line":233,"address":[],"length":0,"stats":{"Line":2}},{"line":237,"address":[],"length":0,"stats":{"Line":14}},{"line":240,"address":[],"length":0,"stats":{"Line":5}},{"line":245,"address":[],"length":0,"stats":{"Line":7}},{"line":246,"address":[],"length":0,"stats":{"Line":7}},{"line":247,"address":[],"length":0,"stats":{"Line":7}},{"line":248,"address":[],"length":0,"stats":{"Line":7}},{"line":249,"address":[],"length":0,"stats":{"Line":3}},{"line":250,"address":[],"length":0,"stats":{"Line":3}},{"line":251,"address":[],"length":0,"stats":{"Line":3}},{"line":252,"address":[],"length":0,"stats":{"Line":0}},{"line":253,"address":[],"length":0,"stats":{"Line":0}},{"line":254,"address":[],"length":0,"stats":{"Line":0}},{"line":255,"address":[],"length":0,"stats":{"Line":0}}],"covered":87,"coverable":108},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","core","src","typography","text_style.rs"],"content":"use super::Color;\nuse serde::{Deserialize, Serialize};\n\n#[derive(Clone, Debug, Serialize, Deserialize)]\npub struct TextStyle {\n    pub font_family: String,\n    pub font_size: f32,\n    pub weight: FontWeight,\n    pub alignment: TextAlignment,\n    pub color: Color,\n    pub italic: bool,\n    pub underline: bool,\n    pub strikethrough: bool,\n    pub background_color: Option\u003cColor\u003e,\n    pub line_height: f32,  // : 1.0 = 1.5 = 1.5\n}\n\nimpl Default for TextStyle {\n    fn default() -\u003e Self {\n        Self {\n            font_family: \"Inter\".into(),\n            font_size: 14.0,\n            weight: FontWeight::Regular,\n            alignment: TextAlignment::Start,\n            color: Color::from_rgb(0.1, 0.1, 0.1),\n            italic: false,\n            underline: false,\n            strikethrough: false,\n            background_color: None,\n            line_height: 1.0,  // \n        }\n    }\n}\n\n#[derive(Clone, Copy, Debug, Serialize, Deserialize, PartialEq, Eq)]\npub enum FontWeight {\n    Thin,\n    Light,\n    Regular,\n    Medium,\n    Bold,\n    Black,\n}\n\n#[derive(Clone, Copy, Debug, Serialize, Deserialize, PartialEq, Eq)]\npub enum TextAlignment {\n    Start,\n    Center,\n    End,\n    Justified,\n}\n","traces":[{"line":19,"address":[],"length":0,"stats":{"Line":12}},{"line":21,"address":[],"length":0,"stats":{"Line":36}},{"line":25,"address":[],"length":0,"stats":{"Line":12}}],"covered":3,"coverable":3},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","core","src","workspace","assets.rs"],"content":"use serde::{Deserialize, Serialize};\nuse std::collections::HashMap;\nuse std::path::{Path, PathBuf};\n\n#[derive(Clone, Debug, Serialize, Deserialize)]\npub struct AssetCatalog {\n    assets: HashMap\u003cAssetRef, AssetMetadata\u003e,\n}\n\nimpl AssetCatalog {\n    pub fn new() -\u003e Self {\n        Self {\n            assets: HashMap::new(),\n        }\n    }\n\n    pub fn register(\u0026mut self, path: impl AsRef\u003cPath\u003e) -\u003e AssetRef {\n        let id = AssetRef::new();\n        self.assets.insert(\n            id,\n            AssetMetadata {\n                id,\n                path: path.as_ref().to_path_buf(),\n            },\n        );\n        id\n    }\n\n    pub fn get(\u0026self, id: AssetRef) -\u003e Option\u003c\u0026AssetMetadata\u003e {\n        self.assets.get(\u0026id)\n    }\n}\n\n#[derive(Clone, Copy, Debug, PartialEq, Eq, Hash, Serialize, Deserialize)]\npub struct AssetRef(uuid::Uuid);\n\nimpl AssetRef {\n    pub fn new() -\u003e Self {\n        Self(uuid::Uuid::new_v4())\n    }\n}\n\n#[derive(Clone, Debug, Serialize, Deserialize)]\npub struct AssetMetadata {\n    pub id: AssetRef,\n    pub path: PathBuf,\n}\n","traces":[{"line":11,"address":[],"length":0,"stats":{"Line":0}},{"line":13,"address":[],"length":0,"stats":{"Line":0}},{"line":17,"address":[],"length":0,"stats":{"Line":0}},{"line":18,"address":[],"length":0,"stats":{"Line":0}},{"line":19,"address":[],"length":0,"stats":{"Line":0}},{"line":20,"address":[],"length":0,"stats":{"Line":0}},{"line":21,"address":[],"length":0,"stats":{"Line":0}},{"line":22,"address":[],"length":0,"stats":{"Line":0}},{"line":23,"address":[],"length":0,"stats":{"Line":0}},{"line":26,"address":[],"length":0,"stats":{"Line":0}},{"line":29,"address":[],"length":0,"stats":{"Line":0}},{"line":30,"address":[],"length":0,"stats":{"Line":0}},{"line":38,"address":[],"length":0,"stats":{"Line":0}},{"line":39,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":14},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","core","src","workspace","history.rs"],"content":"use serde::{Deserialize, Serialize};\nuse std::collections::VecDeque;\n\n#[derive(Clone, Debug, Serialize, Deserialize)]\npub struct CommandHistory {\n    entries: VecDeque\u003cHistoryEntry\u003e,\n    limit: usize,\n}\n\nimpl CommandHistory {\n    pub fn with_limit(limit: usize) -\u003e Self {\n        Self {\n            entries: VecDeque::with_capacity(limit),\n            limit,\n        }\n    }\n\n    pub fn push(\u0026mut self, entry: HistoryEntry) {\n        if self.entries.len() == self.limit {\n            self.entries.pop_front();\n        }\n        self.entries.push_back(entry);\n    }\n\n    pub fn iter(\u0026self) -\u003e impl Iterator\u003cItem = \u0026HistoryEntry\u003e {\n        self.entries.iter()\n    }\n}\n\n#[derive(Clone, Debug, Serialize, Deserialize)]\npub struct HistoryEntry {\n    pub description: String,\n    pub timestamp: chrono::DateTime\u003cchrono::Utc\u003e,\n}\n\nimpl HistoryEntry {\n    pub fn new(description: impl Into\u003cString\u003e) -\u003e Self {\n        Self {\n            description: description.into(),\n            timestamp: chrono::Utc::now(),\n        }\n    }\n}\n","traces":[{"line":11,"address":[],"length":0,"stats":{"Line":0}},{"line":13,"address":[],"length":0,"stats":{"Line":0}},{"line":18,"address":[],"length":0,"stats":{"Line":0}},{"line":19,"address":[],"length":0,"stats":{"Line":0}},{"line":20,"address":[],"length":0,"stats":{"Line":0}},{"line":22,"address":[],"length":0,"stats":{"Line":0}},{"line":25,"address":[],"length":0,"stats":{"Line":0}},{"line":26,"address":[],"length":0,"stats":{"Line":0}},{"line":37,"address":[],"length":0,"stats":{"Line":0}},{"line":39,"address":[],"length":0,"stats":{"Line":0}},{"line":40,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":11},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","core","src","workspace","mod.rs"],"content":"//! Workspace state and asset management for the editor.\n\npub mod assets;\npub mod history;\npub mod project;\n\npub use assets::{AssetCatalog, AssetRef};\npub use history::{CommandHistory, HistoryEntry};\npub use project::{Project, ProjectSettings};\n","traces":[],"covered":0,"coverable":0},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","core","src","workspace","project.rs"],"content":"use crate::document::{Document, DocumentId};\nuse crate::template::{TemplateLibrary, TemplateRef};\nuse serde::{Deserialize, Serialize};\nuse std::collections::HashMap;\n\n#[derive(Clone, Debug, Serialize, Deserialize)]\npub struct Project {\n    pub name: String,\n    pub settings: ProjectSettings,\n    pub documents: HashMap\u003cDocumentId, Document\u003e,\n    pub templates: TemplateLibrary,\n}\n\nimpl Project {\n    pub fn new(name: impl Into\u003cString\u003e) -\u003e Self {\n        Self {\n            name: name.into(),\n            settings: ProjectSettings::default(),\n            documents: HashMap::new(),\n            templates: TemplateLibrary::default(),\n        }\n    }\n\n    pub fn add_document(\u0026mut self, document: Document) {\n        self.documents.insert(document.id, document);\n    }\n\n    pub fn document(\u0026self, id: DocumentId) -\u003e Option\u003c\u0026Document\u003e {\n        self.documents.get(\u0026id)\n    }\n\n    pub fn document_mut(\u0026mut self, id: DocumentId) -\u003e Option\u003c\u0026mut Document\u003e {\n        self.documents.get_mut(\u0026id)\n    }\n\n    pub fn apply_template(\u0026self, template: TemplateRef) -\u003e Option\u003cDocument\u003e {\n        self.templates.get(template.id).map(|tmpl| {\n            let mut builder = crate::document::DocumentBuilder::new().with_title(\u0026tmpl.name);\n            for page in \u0026tmpl.pages {\n                builder = builder.add_page(crate::document::Page {\n                    id: crate::document::PageId::new(),\n                    metadata: page.metadata.clone(),\n                    elements: Vec::new(),\n                });\n            }\n            builder.build().expect(\"template produces document\")\n        })\n    }\n}\n\nimpl Default for Project {\n    fn default() -\u003e Self {\n        Self::new(\"Untitled Project\")\n    }\n}\n\n#[derive(Clone, Debug, Serialize, Deserialize)]\npub struct ProjectSettings {\n    pub autosave_minutes: u32,\n    pub workspace_root: std::path::PathBuf,\n\n    // Canvas settings\n    pub default_canvas_width: f32,\n    pub default_canvas_height: f32,\n\n    // Grid settings\n    pub grid_size: f32,\n    pub snap_to_grid: bool,\n\n    // Guide settings\n    pub snap_to_guides: bool,\n    pub snap_distance: f32,\n\n    // Autosave settings\n    pub autosave_enabled: bool,\n}\n\nimpl Default for ProjectSettings {\n    fn default() -\u003e Self {\n        Self {\n            autosave_minutes: 5,\n            workspace_root: std::env::current_dir().unwrap_or_else(|_| std::path::PathBuf::from(\".\")),\n            default_canvas_width: 595.0,\n            default_canvas_height: 842.0,\n            grid_size: 10.0,\n            snap_to_grid: true,\n            snap_to_guides: true,\n            snap_distance: 5.0,\n            autosave_enabled: true,\n        }\n    }\n}\n","traces":[{"line":15,"address":[],"length":0,"stats":{"Line":0}},{"line":17,"address":[],"length":0,"stats":{"Line":0}},{"line":18,"address":[],"length":0,"stats":{"Line":0}},{"line":19,"address":[],"length":0,"stats":{"Line":0}},{"line":20,"address":[],"length":0,"stats":{"Line":0}},{"line":24,"address":[],"length":0,"stats":{"Line":0}},{"line":25,"address":[],"length":0,"stats":{"Line":0}},{"line":28,"address":[],"length":0,"stats":{"Line":0}},{"line":29,"address":[],"length":0,"stats":{"Line":0}},{"line":32,"address":[],"length":0,"stats":{"Line":0}},{"line":33,"address":[],"length":0,"stats":{"Line":0}},{"line":36,"address":[],"length":0,"stats":{"Line":0}},{"line":37,"address":[],"length":0,"stats":{"Line":0}},{"line":38,"address":[],"length":0,"stats":{"Line":0}},{"line":39,"address":[],"length":0,"stats":{"Line":0}},{"line":40,"address":[],"length":0,"stats":{"Line":0}},{"line":41,"address":[],"length":0,"stats":{"Line":0}},{"line":42,"address":[],"length":0,"stats":{"Line":0}},{"line":43,"address":[],"length":0,"stats":{"Line":0}},{"line":46,"address":[],"length":0,"stats":{"Line":0}},{"line":52,"address":[],"length":0,"stats":{"Line":0}},{"line":53,"address":[],"length":0,"stats":{"Line":0}},{"line":79,"address":[],"length":0,"stats":{"Line":0}},{"line":82,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":24},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","db","src","item_bank.rs"],"content":"//! Item bank operations\n//!\n//! Provides CRUD operations and search functionality for the item database.\n\nuse crate::models::{Item, Passage, ItemType, Difficulty};\nuse crate::schema;\nuse anyhow::Result;\nuse chrono::Utc;\nuse rusqlite::{Connection, params};\nuse std::path::Path;\nuse tracing::{debug, info};\nuse uuid::Uuid;\n\n/// ItemBank manages access to the SQLite database\npub struct ItemBank {\n    conn: Connection,\n}\n\nimpl ItemBank {\n    /// Create a new ItemBank at the specified path\n    pub fn new(path: \u0026Path) -\u003e Result\u003cSelf\u003e {\n        let conn = Connection::open(path)?;\n        schema::init_schema(\u0026conn)?;\n\n        Ok(Self { conn })\n    }\n\n    /// Create an in-memory ItemBank for testing\n    #[allow(dead_code)]\n    pub fn memory() -\u003e Result\u003cSelf\u003e {\n        let conn = Connection::open_in_memory()?;\n        schema::init_schema(\u0026conn)?;\n\n        Ok(Self { conn })\n    }\n\n    // ========== Item operations ==========\n\n    /// Insert a new item\n    pub fn insert_item(\u0026self, item: \u0026Item) -\u003e Result\u003c()\u003e {\n        debug!(\"Inserting item: {}\", item.id);\n\n        self.conn.execute(\n            \"INSERT INTO items (id, title, description, content, item_type, difficulty, passage_id, created_at, updated_at)\n             VALUES (?1, ?2, ?3, ?4, ?5, ?6, ?7, ?8, ?9)\",\n            params![\n                item.id.to_string(),\n                \u0026item.title,\n                \u0026item.description,\n                \u0026item.content,\n                item.item_type.as_str(),\n                item.difficulty.as_str(),\n                item.passage_id.map(|id| id.to_string()),\n                item.created_at.to_rfc3339(),\n                item.updated_at.to_rfc3339(),\n            ],\n        )?;\n\n        // Insert associated skills\n        for skill_id in \u0026item.skill_ids {\n            self.conn.execute(\n                \"INSERT INTO item_skills (item_id, skill_id) VALUES (?1, ?2)\",\n                params![item.id.to_string(), skill_id.to_string()],\n            )?;\n        }\n\n        info!(\"Item {} inserted\", item.id);\n        Ok(())\n    }\n\n    /// Get an item by ID\n    pub fn get_item(\u0026self, id: \u0026Uuid) -\u003e Result\u003cOption\u003cItem\u003e\u003e {\n        let mut stmt = self.conn.prepare(\n            \"SELECT id, title, description, content, item_type, difficulty, passage_id, created_at, updated_at\n             FROM items WHERE id = ?1\"\n        )?;\n\n        let mut item = stmt.query_row(params![id.to_string()], |row| {\n            let created_at_str = row.get::\u003c_, String\u003e(7)?;\n            let updated_at_str = row.get::\u003c_, String\u003e(8)?;\n\n            let created_at = chrono::DateTime::parse_from_rfc3339(\u0026created_at_str)\n                .map_err(|_| rusqlite::Error::InvalidParameterName(\"created_at\".to_string()))?\n                .with_timezone(\u0026Utc);\n\n            let updated_at = chrono::DateTime::parse_from_rfc3339(\u0026updated_at_str)\n                .map_err(|_| rusqlite::Error::InvalidParameterName(\"updated_at\".to_string()))?\n                .with_timezone(\u0026Utc);\n\n            Ok(Item {\n                id: Uuid::parse_str(\u0026row.get::\u003c_, String\u003e(0)?).unwrap(),\n                title: row.get(1)?,\n                description: row.get(2)?,\n                content: row.get(3)?,\n                item_type: parse_item_type(\u0026row.get::\u003c_, String\u003e(4)?),\n                difficulty: parse_difficulty(\u0026row.get::\u003c_, String\u003e(5)?),\n                skill_ids: Vec::new(),\n                passage_id: row.get::\u003c_, Option\u003cString\u003e\u003e(6)?.map(|s| Uuid::parse_str(\u0026s).unwrap()),\n                created_at,\n                updated_at,\n            })\n        }).ok();\n\n        // Load skill IDs from item_skills table\n        if let Some(ref mut item) = item {\n            let mut skill_stmt = self.conn.prepare(\n                \"SELECT skill_id FROM item_skills WHERE item_id = ?1 ORDER BY skill_id\"\n            )?;\n\n            let skills: Vec\u003cUuid\u003e = skill_stmt.query_map(params![id.to_string()], |row| {\n                let skill_id_str: String = row.get(0)?;\n                Ok(Uuid::parse_str(\u0026skill_id_str).unwrap_or_default())\n            })?\n            .collect::\u003cResult\u003cVec\u003c_\u003e, _\u003e\u003e()?;\n\n            item.skill_ids = skills;\n        }\n\n        Ok(item)\n    }\n\n    /// Load skill IDs for items from the database\n    fn load_skill_ids(\u0026self, items: \u0026mut [Item]) -\u003e Result\u003c()\u003e {\n        for item in items {\n            let mut skill_stmt = self.conn.prepare(\n                \"SELECT skill_id FROM item_skills WHERE item_id = ?1 ORDER BY skill_id\"\n            )?;\n\n            let skills: Vec\u003cUuid\u003e = skill_stmt.query_map(params![item.id.to_string()], |row| {\n                let skill_id_str: String = row.get(0)?;\n                Ok(Uuid::parse_str(\u0026skill_id_str).unwrap_or_default())\n            })?\n            .collect::\u003cResult\u003cVec\u003c_\u003e, _\u003e\u003e()?;\n\n            item.skill_ids = skills;\n        }\n        Ok(())\n    }\n\n    /// Get all items with optional filtering\n    pub fn get_all_items(\u0026self, limit: Option\u003ci64\u003e) -\u003e Result\u003cVec\u003cItem\u003e\u003e {\n        let mut stmt = self.conn.prepare(\n            \"SELECT id, title, description, content, item_type, difficulty, passage_id, created_at, updated_at\n             FROM items ORDER BY created_at DESC LIMIT ?1\"\n        )?;\n\n        let mut items = stmt.query_map(params![limit.unwrap_or(1000)], |row| {\n            let created_at_str = row.get::\u003c_, String\u003e(7)?;\n            let updated_at_str = row.get::\u003c_, String\u003e(8)?;\n\n            let created_at = chrono::DateTime::parse_from_rfc3339(\u0026created_at_str)\n                .map_err(|_| rusqlite::Error::InvalidParameterName(\"created_at\".to_string()))?\n                .with_timezone(\u0026Utc);\n\n            let updated_at = chrono::DateTime::parse_from_rfc3339(\u0026updated_at_str)\n                .map_err(|_| rusqlite::Error::InvalidParameterName(\"updated_at\".to_string()))?\n                .with_timezone(\u0026Utc);\n\n            Ok(Item {\n                id: Uuid::parse_str(\u0026row.get::\u003c_, String\u003e(0)?).unwrap(),\n                title: row.get(1)?,\n                description: row.get(2)?,\n                content: row.get(3)?,\n                item_type: parse_item_type(\u0026row.get::\u003c_, String\u003e(4)?),\n                difficulty: parse_difficulty(\u0026row.get::\u003c_, String\u003e(5)?),\n                skill_ids: Vec::new(),\n                passage_id: row.get::\u003c_, Option\u003cString\u003e\u003e(6)?.map(|s| Uuid::parse_str(\u0026s).unwrap()),\n                created_at,\n                updated_at,\n            })\n        })?\n        .collect::\u003cResult\u003cVec\u003c_\u003e, _\u003e\u003e()?;\n\n        // Load skill IDs for all items\n        self.load_skill_ids(\u0026mut items)?;\n\n        Ok(items)\n    }\n\n    /// Search items by title\n    pub fn search_items(\u0026self, query: \u0026str) -\u003e Result\u003cVec\u003cItem\u003e\u003e {\n        debug!(\"Searching for items: {}\", query);\n\n        let search_pattern = format!(\"%{}%\", query);\n        let mut stmt = self.conn.prepare(\n            \"SELECT id, title, description, content, item_type, difficulty, passage_id, created_at, updated_at\n             FROM items WHERE title LIKE ?1 OR content LIKE ?1 ORDER BY created_at DESC LIMIT 100\"\n        )?;\n\n        let mut items = stmt.query_map(params![\u0026search_pattern], |row| {\n            let created_at_str = row.get::\u003c_, String\u003e(7)?;\n            let updated_at_str = row.get::\u003c_, String\u003e(8)?;\n\n            let created_at = chrono::DateTime::parse_from_rfc3339(\u0026created_at_str)\n                .map_err(|_| rusqlite::Error::InvalidParameterName(\"created_at\".to_string()))?\n                .with_timezone(\u0026Utc);\n\n            let updated_at = chrono::DateTime::parse_from_rfc3339(\u0026updated_at_str)\n                .map_err(|_| rusqlite::Error::InvalidParameterName(\"updated_at\".to_string()))?\n                .with_timezone(\u0026Utc);\n\n            Ok(Item {\n                id: Uuid::parse_str(\u0026row.get::\u003c_, String\u003e(0)?).unwrap(),\n                title: row.get(1)?,\n                description: row.get(2)?,\n                content: row.get(3)?,\n                item_type: parse_item_type(\u0026row.get::\u003c_, String\u003e(4)?),\n                difficulty: parse_difficulty(\u0026row.get::\u003c_, String\u003e(5)?),\n                skill_ids: Vec::new(),\n                passage_id: row.get::\u003c_, Option\u003cString\u003e\u003e(6)?.map(|s| Uuid::parse_str(\u0026s).unwrap()),\n                created_at,\n                updated_at,\n            })\n        })?\n        .collect::\u003cResult\u003cVec\u003c_\u003e, _\u003e\u003e()?;\n\n        // Load skill IDs for all search results\n        self.load_skill_ids(\u0026mut items)?;\n\n        Ok(items)\n    }\n\n    /// Filter items by difficulty\n    pub fn get_items_by_difficulty(\u0026self, difficulty: Difficulty) -\u003e Result\u003cVec\u003cItem\u003e\u003e {\n        debug!(\"Getting items by difficulty: {:?}\", difficulty);\n\n        let mut stmt = self.conn.prepare(\n            \"SELECT id, title, description, content, item_type, difficulty, passage_id, created_at, updated_at\n             FROM items WHERE difficulty = ?1 ORDER BY created_at DESC\"\n        )?;\n\n        let mut items = stmt.query_map(params![difficulty.as_str()], |row| {\n            let created_at_str = row.get::\u003c_, String\u003e(7)?;\n            let updated_at_str = row.get::\u003c_, String\u003e(8)?;\n\n            let created_at = chrono::DateTime::parse_from_rfc3339(\u0026created_at_str)\n                .map_err(|_| rusqlite::Error::InvalidParameterName(\"created_at\".to_string()))?\n                .with_timezone(\u0026Utc);\n\n            let updated_at = chrono::DateTime::parse_from_rfc3339(\u0026updated_at_str)\n                .map_err(|_| rusqlite::Error::InvalidParameterName(\"updated_at\".to_string()))?\n                .with_timezone(\u0026Utc);\n\n            Ok(Item {\n                id: Uuid::parse_str(\u0026row.get::\u003c_, String\u003e(0)?).unwrap(),\n                title: row.get(1)?,\n                description: row.get(2)?,\n                content: row.get(3)?,\n                item_type: parse_item_type(\u0026row.get::\u003c_, String\u003e(4)?),\n                difficulty: parse_difficulty(\u0026row.get::\u003c_, String\u003e(5)?),\n                skill_ids: Vec::new(),\n                passage_id: row.get::\u003c_, Option\u003cString\u003e\u003e(6)?.map(|s| Uuid::parse_str(\u0026s).unwrap()),\n                created_at,\n                updated_at,\n            })\n        })?\n        .collect::\u003cResult\u003cVec\u003c_\u003e, _\u003e\u003e()?;\n\n        // Load skill IDs for items filtered by difficulty\n        self.load_skill_ids(\u0026mut items)?;\n\n        Ok(items)\n    }\n\n    /// Delete an item\n    pub fn delete_item(\u0026self, id: \u0026Uuid) -\u003e Result\u003c()\u003e {\n        debug!(\"Deleting item: {}\", id);\n\n        self.conn.execute(\n            \"DELETE FROM items WHERE id = ?1\",\n            params![id.to_string()],\n        )?;\n\n        info!(\"Item {} deleted\", id);\n        Ok(())\n    }\n\n    // ========== Passage operations ==========\n\n    /// Insert a new passage\n    pub fn insert_passage(\u0026self, passage: \u0026Passage) -\u003e Result\u003c()\u003e {\n        self.conn.execute(\n            \"INSERT INTO passages (id, title, content, source, created_at, updated_at)\n             VALUES (?1, ?2, ?3, ?4, ?5, ?6)\",\n            params![\n                passage.id.to_string(),\n                \u0026passage.title,\n                \u0026passage.content,\n                \u0026passage.source,\n                passage.created_at.to_rfc3339(),\n                passage.updated_at.to_rfc3339(),\n            ],\n        )?;\n\n        info!(\"Passage {} inserted\", passage.id);\n        Ok(())\n    }\n\n    /// Get a passage by ID\n    pub fn get_passage(\u0026self, id: \u0026Uuid) -\u003e Result\u003cOption\u003cPassage\u003e\u003e {\n        let mut stmt = self.conn.prepare(\n            \"SELECT id, title, content, source, created_at, updated_at FROM passages WHERE id = ?1\"\n        )?;\n\n        let passage = stmt.query_row(params![id.to_string()], |row| {\n            let created_at_str = row.get::\u003c_, String\u003e(4)?;\n            let updated_at_str = row.get::\u003c_, String\u003e(5)?;\n\n            let created_at = chrono::DateTime::parse_from_rfc3339(\u0026created_at_str)\n                .map_err(|_| rusqlite::Error::InvalidParameterName(\"created_at\".to_string()))?\n                .with_timezone(\u0026Utc);\n\n            let updated_at = chrono::DateTime::parse_from_rfc3339(\u0026updated_at_str)\n                .map_err(|_| rusqlite::Error::InvalidParameterName(\"updated_at\".to_string()))?\n                .with_timezone(\u0026Utc);\n\n            Ok(Passage {\n                id: Uuid::parse_str(\u0026row.get::\u003c_, String\u003e(0)?).unwrap(),\n                title: row.get(1)?,\n                content: row.get(2)?,\n                source: row.get(3)?,\n                created_at,\n                updated_at,\n            })\n        }).ok();\n\n        Ok(passage)\n    }\n\n    // ========== Statistics ==========\n\n    /// Get total item count\n    pub fn count_items(\u0026self) -\u003e Result\u003ci64\u003e {\n        let count: i64 = self.conn.query_row(\n            \"SELECT COUNT(*) FROM items\",\n            [],\n            |row| row.get(0)\n        )?;\n\n        Ok(count)\n    }\n\n    /// Get count by item type\n    pub fn count_items_by_type(\u0026self, item_type: ItemType) -\u003e Result\u003ci64\u003e {\n        let count: i64 = self.conn.query_row(\n            \"SELECT COUNT(*) FROM items WHERE item_type = ?1\",\n            params![item_type.as_str()],\n            |row| row.get(0)\n        )?;\n\n        Ok(count)\n    }\n}\n\n/// Helper function to parse ItemType from string\nfn parse_item_type(s: \u0026str) -\u003e ItemType {\n    match s {\n        \"multiple_choice\" =\u003e ItemType::MultipleChoice,\n        \"short_answer\" =\u003e ItemType::ShortAnswer,\n        \"essay\" =\u003e ItemType::Essay,\n        \"fill_in_the_blank\" =\u003e ItemType::FillInTheBlank,\n        \"matching\" =\u003e ItemType::Matching,\n        \"true_false\" =\u003e ItemType::TrueFalse,\n        _ =\u003e ItemType::MultipleChoice,\n    }\n}\n\n/// Helper function to parse Difficulty from string\nfn parse_difficulty(s: \u0026str) -\u003e Difficulty {\n    match s {\n        \"easy\" =\u003e Difficulty::Easy,\n        \"medium\" =\u003e Difficulty::Medium,\n        \"hard\" =\u003e Difficulty::Hard,\n        _ =\u003e Difficulty::Medium,\n    }\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n\n    #[test]\n    fn test_item_bank_creation() -\u003e Result\u003c()\u003e {\n        let _bank = ItemBank::memory()?;\n        Ok(())\n    }\n\n    #[test]\n    fn test_insert_and_get_item() -\u003e Result\u003c()\u003e {\n        let bank = ItemBank::memory()?;\n\n        let item = Item {\n            id: Uuid::new_v4(),\n            title: \"Test Item\".to_string(),\n            description: Some(\"Test description\".to_string()),\n            content: \"What is 2+2?\".to_string(),\n            item_type: ItemType::MultipleChoice,\n            difficulty: Difficulty::Easy,\n            skill_ids: vec![],\n            passage_id: None,\n            created_at: Utc::now(),\n            updated_at: Utc::now(),\n        };\n\n        bank.insert_item(\u0026item)?;\n        let retrieved = bank.get_item(\u0026item.id)?;\n\n        assert!(retrieved.is_some());\n        assert_eq!(retrieved.unwrap().title, \"Test Item\");\n\n        Ok(())\n    }\n\n    #[test]\n    fn test_count_items() -\u003e Result\u003c()\u003e {\n        let bank = ItemBank::memory()?;\n\n        assert_eq!(bank.count_items()?, 0);\n\n        let item = Item {\n            id: Uuid::new_v4(),\n            title: \"Test Item\".to_string(),\n            description: None,\n            content: \"Content\".to_string(),\n            item_type: ItemType::MultipleChoice,\n            difficulty: Difficulty::Medium,\n            skill_ids: vec![],\n            passage_id: None,\n            created_at: Utc::now(),\n            updated_at: Utc::now(),\n        };\n\n        bank.insert_item(\u0026item)?;\n        assert_eq!(bank.count_items()?, 1);\n\n        Ok(())\n    }\n}\n","traces":[{"line":21,"address":[],"length":0,"stats":{"Line":0}},{"line":22,"address":[],"length":0,"stats":{"Line":0}},{"line":23,"address":[],"length":0,"stats":{"Line":0}},{"line":25,"address":[],"length":0,"stats":{"Line":0}},{"line":30,"address":[],"length":0,"stats":{"Line":3}},{"line":31,"address":[],"length":0,"stats":{"Line":6}},{"line":32,"address":[],"length":0,"stats":{"Line":6}},{"line":34,"address":[],"length":0,"stats":{"Line":3}},{"line":40,"address":[],"length":0,"stats":{"Line":2}},{"line":41,"address":[],"length":0,"stats":{"Line":2}},{"line":43,"address":[],"length":0,"stats":{"Line":4}},{"line":46,"address":[],"length":0,"stats":{"Line":2}},{"line":47,"address":[],"length":0,"stats":{"Line":4}},{"line":48,"address":[],"length":0,"stats":{"Line":2}},{"line":49,"address":[],"length":0,"stats":{"Line":2}},{"line":50,"address":[],"length":0,"stats":{"Line":2}},{"line":51,"address":[],"length":0,"stats":{"Line":4}},{"line":52,"address":[],"length":0,"stats":{"Line":4}},{"line":53,"address":[],"length":0,"stats":{"Line":4}},{"line":54,"address":[],"length":0,"stats":{"Line":4}},{"line":55,"address":[],"length":0,"stats":{"Line":4}},{"line":60,"address":[],"length":0,"stats":{"Line":2}},{"line":61,"address":[],"length":0,"stats":{"Line":0}},{"line":63,"address":[],"length":0,"stats":{"Line":0}},{"line":67,"address":[],"length":0,"stats":{"Line":2}},{"line":68,"address":[],"length":0,"stats":{"Line":2}},{"line":72,"address":[],"length":0,"stats":{"Line":1}},{"line":73,"address":[],"length":0,"stats":{"Line":3}},{"line":78,"address":[],"length":0,"stats":{"Line":7}},{"line":79,"address":[],"length":0,"stats":{"Line":3}},{"line":80,"address":[],"length":0,"stats":{"Line":3}},{"line":82,"address":[],"length":0,"stats":{"Line":3}},{"line":83,"address":[],"length":0,"stats":{"Line":1}},{"line":84,"address":[],"length":0,"stats":{"Line":2}},{"line":86,"address":[],"length":0,"stats":{"Line":3}},{"line":87,"address":[],"length":0,"stats":{"Line":1}},{"line":88,"address":[],"length":0,"stats":{"Line":2}},{"line":91,"address":[],"length":0,"stats":{"Line":4}},{"line":92,"address":[],"length":0,"stats":{"Line":2}},{"line":93,"address":[],"length":0,"stats":{"Line":2}},{"line":94,"address":[],"length":0,"stats":{"Line":2}},{"line":95,"address":[],"length":0,"stats":{"Line":3}},{"line":96,"address":[],"length":0,"stats":{"Line":3}},{"line":97,"address":[],"length":0,"stats":{"Line":1}},{"line":98,"address":[],"length":0,"stats":{"Line":3}},{"line":99,"address":[],"length":0,"stats":{"Line":1}},{"line":100,"address":[],"length":0,"stats":{"Line":1}},{"line":102,"address":[],"length":0,"stats":{"Line":2}},{"line":105,"address":[],"length":0,"stats":{"Line":2}},{"line":106,"address":[],"length":0,"stats":{"Line":3}},{"line":110,"address":[],"length":0,"stats":{"Line":7}},{"line":111,"address":[],"length":0,"stats":{"Line":0}},{"line":112,"address":[],"length":0,"stats":{"Line":0}},{"line":116,"address":[],"length":0,"stats":{"Line":2}},{"line":119,"address":[],"length":0,"stats":{"Line":1}},{"line":123,"address":[],"length":0,"stats":{"Line":0}},{"line":124,"address":[],"length":0,"stats":{"Line":0}},{"line":125,"address":[],"length":0,"stats":{"Line":0}},{"line":129,"address":[],"length":0,"stats":{"Line":0}},{"line":130,"address":[],"length":0,"stats":{"Line":0}},{"line":131,"address":[],"length":0,"stats":{"Line":0}},{"line":135,"address":[],"length":0,"stats":{"Line":0}},{"line":137,"address":[],"length":0,"stats":{"Line":0}},{"line":141,"address":[],"length":0,"stats":{"Line":0}},{"line":142,"address":[],"length":0,"stats":{"Line":0}},{"line":147,"address":[],"length":0,"stats":{"Line":0}},{"line":148,"address":[],"length":0,"stats":{"Line":0}},{"line":149,"address":[],"length":0,"stats":{"Line":0}},{"line":151,"address":[],"length":0,"stats":{"Line":0}},{"line":152,"address":[],"length":0,"stats":{"Line":0}},{"line":153,"address":[],"length":0,"stats":{"Line":0}},{"line":155,"address":[],"length":0,"stats":{"Line":0}},{"line":156,"address":[],"length":0,"stats":{"Line":0}},{"line":157,"address":[],"length":0,"stats":{"Line":0}},{"line":160,"address":[],"length":0,"stats":{"Line":0}},{"line":161,"address":[],"length":0,"stats":{"Line":0}},{"line":162,"address":[],"length":0,"stats":{"Line":0}},{"line":163,"address":[],"length":0,"stats":{"Line":0}},{"line":164,"address":[],"length":0,"stats":{"Line":0}},{"line":165,"address":[],"length":0,"stats":{"Line":0}},{"line":166,"address":[],"length":0,"stats":{"Line":0}},{"line":167,"address":[],"length":0,"stats":{"Line":0}},{"line":168,"address":[],"length":0,"stats":{"Line":0}},{"line":169,"address":[],"length":0,"stats":{"Line":0}},{"line":175,"address":[],"length":0,"stats":{"Line":0}},{"line":177,"address":[],"length":0,"stats":{"Line":0}},{"line":181,"address":[],"length":0,"stats":{"Line":0}},{"line":182,"address":[],"length":0,"stats":{"Line":0}},{"line":184,"address":[],"length":0,"stats":{"Line":0}},{"line":185,"address":[],"length":0,"stats":{"Line":0}},{"line":190,"address":[],"length":0,"stats":{"Line":0}},{"line":191,"address":[],"length":0,"stats":{"Line":0}},{"line":192,"address":[],"length":0,"stats":{"Line":0}},{"line":194,"address":[],"length":0,"stats":{"Line":0}},{"line":195,"address":[],"length":0,"stats":{"Line":0}},{"line":196,"address":[],"length":0,"stats":{"Line":0}},{"line":198,"address":[],"length":0,"stats":{"Line":0}},{"line":199,"address":[],"length":0,"stats":{"Line":0}},{"line":200,"address":[],"length":0,"stats":{"Line":0}},{"line":203,"address":[],"length":0,"stats":{"Line":0}},{"line":204,"address":[],"length":0,"stats":{"Line":0}},{"line":205,"address":[],"length":0,"stats":{"Line":0}},{"line":206,"address":[],"length":0,"stats":{"Line":0}},{"line":207,"address":[],"length":0,"stats":{"Line":0}},{"line":208,"address":[],"length":0,"stats":{"Line":0}},{"line":209,"address":[],"length":0,"stats":{"Line":0}},{"line":210,"address":[],"length":0,"stats":{"Line":0}},{"line":211,"address":[],"length":0,"stats":{"Line":0}},{"line":212,"address":[],"length":0,"stats":{"Line":0}},{"line":218,"address":[],"length":0,"stats":{"Line":0}},{"line":220,"address":[],"length":0,"stats":{"Line":0}},{"line":224,"address":[],"length":0,"stats":{"Line":0}},{"line":225,"address":[],"length":0,"stats":{"Line":0}},{"line":227,"address":[],"length":0,"stats":{"Line":0}},{"line":232,"address":[],"length":0,"stats":{"Line":0}},{"line":233,"address":[],"length":0,"stats":{"Line":0}},{"line":234,"address":[],"length":0,"stats":{"Line":0}},{"line":236,"address":[],"length":0,"stats":{"Line":0}},{"line":237,"address":[],"length":0,"stats":{"Line":0}},{"line":238,"address":[],"length":0,"stats":{"Line":0}},{"line":240,"address":[],"length":0,"stats":{"Line":0}},{"line":241,"address":[],"length":0,"stats":{"Line":0}},{"line":242,"address":[],"length":0,"stats":{"Line":0}},{"line":245,"address":[],"length":0,"stats":{"Line":0}},{"line":246,"address":[],"length":0,"stats":{"Line":0}},{"line":247,"address":[],"length":0,"stats":{"Line":0}},{"line":248,"address":[],"length":0,"stats":{"Line":0}},{"line":249,"address":[],"length":0,"stats":{"Line":0}},{"line":250,"address":[],"length":0,"stats":{"Line":0}},{"line":251,"address":[],"length":0,"stats":{"Line":0}},{"line":252,"address":[],"length":0,"stats":{"Line":0}},{"line":253,"address":[],"length":0,"stats":{"Line":0}},{"line":254,"address":[],"length":0,"stats":{"Line":0}},{"line":260,"address":[],"length":0,"stats":{"Line":0}},{"line":262,"address":[],"length":0,"stats":{"Line":0}},{"line":266,"address":[],"length":0,"stats":{"Line":0}},{"line":267,"address":[],"length":0,"stats":{"Line":0}},{"line":269,"address":[],"length":0,"stats":{"Line":0}},{"line":271,"address":[],"length":0,"stats":{"Line":0}},{"line":274,"address":[],"length":0,"stats":{"Line":0}},{"line":275,"address":[],"length":0,"stats":{"Line":0}},{"line":281,"address":[],"length":0,"stats":{"Line":0}},{"line":282,"address":[],"length":0,"stats":{"Line":0}},{"line":285,"address":[],"length":0,"stats":{"Line":0}},{"line":286,"address":[],"length":0,"stats":{"Line":0}},{"line":287,"address":[],"length":0,"stats":{"Line":0}},{"line":288,"address":[],"length":0,"stats":{"Line":0}},{"line":289,"address":[],"length":0,"stats":{"Line":0}},{"line":290,"address":[],"length":0,"stats":{"Line":0}},{"line":291,"address":[],"length":0,"stats":{"Line":0}},{"line":295,"address":[],"length":0,"stats":{"Line":0}},{"line":296,"address":[],"length":0,"stats":{"Line":0}},{"line":300,"address":[],"length":0,"stats":{"Line":0}},{"line":301,"address":[],"length":0,"stats":{"Line":0}},{"line":305,"address":[],"length":0,"stats":{"Line":0}},{"line":306,"address":[],"length":0,"stats":{"Line":0}},{"line":307,"address":[],"length":0,"stats":{"Line":0}},{"line":309,"address":[],"length":0,"stats":{"Line":0}},{"line":310,"address":[],"length":0,"stats":{"Line":0}},{"line":311,"address":[],"length":0,"stats":{"Line":0}},{"line":313,"address":[],"length":0,"stats":{"Line":0}},{"line":314,"address":[],"length":0,"stats":{"Line":0}},{"line":315,"address":[],"length":0,"stats":{"Line":0}},{"line":318,"address":[],"length":0,"stats":{"Line":0}},{"line":319,"address":[],"length":0,"stats":{"Line":0}},{"line":320,"address":[],"length":0,"stats":{"Line":0}},{"line":321,"address":[],"length":0,"stats":{"Line":0}},{"line":322,"address":[],"length":0,"stats":{"Line":0}},{"line":323,"address":[],"length":0,"stats":{"Line":0}},{"line":325,"address":[],"length":0,"stats":{"Line":0}},{"line":327,"address":[],"length":0,"stats":{"Line":0}},{"line":333,"address":[],"length":0,"stats":{"Line":2}},{"line":334,"address":[],"length":0,"stats":{"Line":8}},{"line":337,"address":[],"length":0,"stats":{"Line":4}},{"line":340,"address":[],"length":0,"stats":{"Line":2}},{"line":344,"address":[],"length":0,"stats":{"Line":0}},{"line":345,"address":[],"length":0,"stats":{"Line":0}},{"line":347,"address":[],"length":0,"stats":{"Line":0}},{"line":348,"address":[],"length":0,"stats":{"Line":0}},{"line":351,"address":[],"length":0,"stats":{"Line":0}},{"line":356,"address":[],"length":0,"stats":{"Line":1}},{"line":357,"address":[],"length":0,"stats":{"Line":1}},{"line":358,"address":[],"length":0,"stats":{"Line":2}},{"line":359,"address":[],"length":0,"stats":{"Line":0}},{"line":360,"address":[],"length":0,"stats":{"Line":0}},{"line":361,"address":[],"length":0,"stats":{"Line":0}},{"line":362,"address":[],"length":0,"stats":{"Line":0}},{"line":363,"address":[],"length":0,"stats":{"Line":0}},{"line":364,"address":[],"length":0,"stats":{"Line":0}},{"line":369,"address":[],"length":0,"stats":{"Line":1}},{"line":370,"address":[],"length":0,"stats":{"Line":1}},{"line":371,"address":[],"length":0,"stats":{"Line":2}},{"line":372,"address":[],"length":0,"stats":{"Line":0}},{"line":373,"address":[],"length":0,"stats":{"Line":0}},{"line":374,"address":[],"length":0,"stats":{"Line":0}}],"covered":57,"coverable":195},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","db","src","lib.rs"],"content":"//! Testruct Database\n//!\n//! Provides SQLite-based storage for item banks, templates, and document metadata.\n\npub mod item_bank;\npub mod models;\npub mod schema;\n\npub use item_bank::ItemBank;\npub use models::{Item, Passage, Choice, Tag};\n\nuse anyhow::Result;\nuse std::path::Path;\nuse tracing::info;\n\n/// Initialize a new database at the specified path\npub fn initialize_database(path: \u0026Path) -\u003e Result\u003cItemBank\u003e {\n    info!(\"Initializing database at: {}\", path.display());\n    ItemBank::new(path)\n}\n\n#[cfg(test)]\nmod tests {\n    #[test]\n    fn test_module_loads() {\n        // Basic module loading test\n        assert!(true);\n    }\n}\n","traces":[{"line":17,"address":[],"length":0,"stats":{"Line":0}},{"line":18,"address":[],"length":0,"stats":{"Line":0}},{"line":19,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":3},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","db","src","models.rs"],"content":"//! Data models for the item bank\n//!\n//! Defines structures for items, passages, choices, and tags.\n\nuse chrono::{DateTime, Utc};\nuse serde::{Deserialize, Serialize};\nuse uuid::Uuid;\n\n/// An item in the item bank (test question)\n#[derive(Clone, Debug, Serialize, Deserialize)]\npub struct Item {\n    pub id: Uuid,\n    pub title: String,\n    pub description: Option\u003cString\u003e,\n    pub content: String,\n    pub item_type: ItemType,\n    pub difficulty: Difficulty,\n    pub skill_ids: Vec\u003cUuid\u003e,\n    pub passage_id: Option\u003cUuid\u003e,\n    pub created_at: DateTime\u003cUtc\u003e,\n    pub updated_at: DateTime\u003cUtc\u003e,\n}\n\n/// Type of item (question format)\n#[derive(Clone, Debug, Copy, Serialize, Deserialize, PartialEq, Eq)]\npub enum ItemType {\n    MultipleChoice,\n    ShortAnswer,\n    Essay,\n    FillInTheBlank,\n    Matching,\n    TrueFalse,\n}\n\nimpl ItemType {\n    pub fn as_str(\u0026self) -\u003e \u0026'static str {\n        match self {\n            ItemType::MultipleChoice =\u003e \"multiple_choice\",\n            ItemType::ShortAnswer =\u003e \"short_answer\",\n            ItemType::Essay =\u003e \"essay\",\n            ItemType::FillInTheBlank =\u003e \"fill_in_the_blank\",\n            ItemType::Matching =\u003e \"matching\",\n            ItemType::TrueFalse =\u003e \"true_false\",\n        }\n    }\n}\n\n/// Difficulty level of an item\n#[derive(Clone, Debug, Copy, Serialize, Deserialize, PartialEq, Eq, PartialOrd, Ord)]\npub enum Difficulty {\n    Easy = 1,\n    Medium = 2,\n    Hard = 3,\n}\n\nimpl Difficulty {\n    pub fn as_str(\u0026self) -\u003e \u0026'static str {\n        match self {\n            Difficulty::Easy =\u003e \"easy\",\n            Difficulty::Medium =\u003e \"medium\",\n            Difficulty::Hard =\u003e \"hard\",\n        }\n    }\n}\n\n/// A passage/text that items can reference\n#[derive(Clone, Debug, Serialize, Deserialize)]\npub struct Passage {\n    pub id: Uuid,\n    pub title: String,\n    pub content: String,\n    pub source: Option\u003cString\u003e,\n    pub created_at: DateTime\u003cUtc\u003e,\n    pub updated_at: DateTime\u003cUtc\u003e,\n}\n\n/// A choice option for multiple choice items\n#[derive(Clone, Debug, Serialize, Deserialize)]\npub struct Choice {\n    pub id: Uuid,\n    pub item_id: Uuid,\n    pub text: String,\n    pub is_correct: bool,\n    pub order: i32,\n}\n\n/// A tag for organizing items\n#[derive(Clone, Debug, Serialize, Deserialize)]\npub struct Tag {\n    pub id: Uuid,\n    pub name: String,\n    pub category: String,\n}\n\n/// A skill/standard that items can address\n#[derive(Clone, Debug, Serialize, Deserialize)]\npub struct Skill {\n    pub id: Uuid,\n    pub name: String,\n    pub code: String,\n    pub description: Option\u003cString\u003e,\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n\n    #[test]\n    fn test_item_type_display() {\n        assert_eq!(ItemType::MultipleChoice.as_str(), \"multiple_choice\");\n    }\n\n    #[test]\n    fn test_difficulty_ordering() {\n        assert!(Difficulty::Easy \u003c Difficulty::Medium);\n        assert!(Difficulty::Medium \u003c Difficulty::Hard);\n    }\n}\n","traces":[{"line":36,"address":[],"length":0,"stats":{"Line":3}},{"line":37,"address":[],"length":0,"stats":{"Line":3}},{"line":38,"address":[],"length":0,"stats":{"Line":3}},{"line":39,"address":[],"length":0,"stats":{"Line":0}},{"line":40,"address":[],"length":0,"stats":{"Line":0}},{"line":41,"address":[],"length":0,"stats":{"Line":0}},{"line":42,"address":[],"length":0,"stats":{"Line":0}},{"line":43,"address":[],"length":0,"stats":{"Line":0}},{"line":57,"address":[],"length":0,"stats":{"Line":2}},{"line":58,"address":[],"length":0,"stats":{"Line":2}},{"line":59,"address":[],"length":0,"stats":{"Line":1}},{"line":60,"address":[],"length":0,"stats":{"Line":1}},{"line":61,"address":[],"length":0,"stats":{"Line":0}}],"covered":7,"coverable":13},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","db","src","schema.rs"],"content":"//! Database schema definitions\n//!\n//! Defines SQL schema for item bank tables.\n\nuse rusqlite::Connection;\nuse anyhow::Result;\nuse tracing::debug;\n\n/// Initialize the database schema\npub fn init_schema(conn: \u0026Connection) -\u003e Result\u003c()\u003e {\n    debug!(\"Initializing database schema\");\n\n    // Items table\n    conn.execute(\n        \"CREATE TABLE IF NOT EXISTS items (\n            id TEXT PRIMARY KEY,\n            title TEXT NOT NULL,\n            description TEXT,\n            content TEXT NOT NULL,\n            item_type TEXT NOT NULL,\n            difficulty TEXT NOT NULL,\n            passage_id TEXT,\n            created_at TEXT NOT NULL,\n            updated_at TEXT NOT NULL\n        )\",\n        [],\n    )?;\n\n    // Passages table\n    conn.execute(\n        \"CREATE TABLE IF NOT EXISTS passages (\n            id TEXT PRIMARY KEY,\n            title TEXT NOT NULL,\n            content TEXT NOT NULL,\n            source TEXT,\n            created_at TEXT NOT NULL,\n            updated_at TEXT NOT NULL\n        )\",\n        [],\n    )?;\n\n    // Choices table (for multiple choice items)\n    conn.execute(\n        \"CREATE TABLE IF NOT EXISTS choices (\n            id TEXT PRIMARY KEY,\n            item_id TEXT NOT NULL,\n            text TEXT NOT NULL,\n            is_correct INTEGER NOT NULL,\n            \\\"order\\\" INTEGER NOT NULL,\n            FOREIGN KEY(item_id) REFERENCES items(id) ON DELETE CASCADE\n        )\",\n        [],\n    )?;\n\n    // Tags table\n    conn.execute(\n        \"CREATE TABLE IF NOT EXISTS tags (\n            id TEXT PRIMARY KEY,\n            name TEXT NOT NULL,\n            category TEXT NOT NULL\n        )\",\n        [],\n    )?;\n\n    // Item-Tag associations\n    conn.execute(\n        \"CREATE TABLE IF NOT EXISTS item_tags (\n            item_id TEXT NOT NULL,\n            tag_id TEXT NOT NULL,\n            PRIMARY KEY(item_id, tag_id),\n            FOREIGN KEY(item_id) REFERENCES items(id) ON DELETE CASCADE,\n            FOREIGN KEY(tag_id) REFERENCES tags(id) ON DELETE CASCADE\n        )\",\n        [],\n    )?;\n\n    // Skills table\n    conn.execute(\n        \"CREATE TABLE IF NOT EXISTS skills (\n            id TEXT PRIMARY KEY,\n            name TEXT NOT NULL,\n            code TEXT UNIQUE NOT NULL,\n            description TEXT\n        )\",\n        [],\n    )?;\n\n    // Item-Skill associations\n    conn.execute(\n        \"CREATE TABLE IF NOT EXISTS item_skills (\n            item_id TEXT NOT NULL,\n            skill_id TEXT NOT NULL,\n            PRIMARY KEY(item_id, skill_id),\n            FOREIGN KEY(item_id) REFERENCES items(id) ON DELETE CASCADE,\n            FOREIGN KEY(skill_id) REFERENCES skills(id) ON DELETE CASCADE\n        )\",\n        [],\n    )?;\n\n    // Usage history table\n    conn.execute(\n        \"CREATE TABLE IF NOT EXISTS usage_history (\n            id TEXT PRIMARY KEY,\n            item_id TEXT NOT NULL,\n            used_at TEXT NOT NULL,\n            paper_id TEXT,\n            FOREIGN KEY(item_id) REFERENCES items(id) ON DELETE CASCADE\n        )\",\n        [],\n    )?;\n\n    // Create indices for performance\n    create_indices(conn)?;\n\n    debug!(\"Database schema initialized\");\n    Ok(())\n}\n\n/// Create indices for better query performance\nfn create_indices(conn: \u0026Connection) -\u003e Result\u003c()\u003e {\n    // Index on item_type for efficient filtering\n    conn.execute(\n        \"CREATE INDEX IF NOT EXISTS idx_items_type ON items(item_type)\",\n        [],\n    )?;\n\n    // Index on difficulty for efficient filtering\n    conn.execute(\n        \"CREATE INDEX IF NOT EXISTS idx_items_difficulty ON items(difficulty)\",\n        [],\n    )?;\n\n    // Index on item_id for choices\n    conn.execute(\n        \"CREATE INDEX IF NOT EXISTS idx_choices_item ON choices(item_id)\",\n        [],\n    )?;\n\n    // Index on item_id for item_tags\n    conn.execute(\n        \"CREATE INDEX IF NOT EXISTS idx_item_tags_item ON item_tags(item_id)\",\n        [],\n    )?;\n\n    // Index on tag_id for item_tags\n    conn.execute(\n        \"CREATE INDEX IF NOT EXISTS idx_item_tags_tag ON item_tags(tag_id)\",\n        [],\n    )?;\n\n    // Index on item_id for item_skills\n    conn.execute(\n        \"CREATE INDEX IF NOT EXISTS idx_item_skills_item ON item_skills(item_id)\",\n        [],\n    )?;\n\n    // Index on item_id for usage_history\n    conn.execute(\n        \"CREATE INDEX IF NOT EXISTS idx_usage_item ON usage_history(item_id)\",\n        [],\n    )?;\n\n    debug!(\"Database indices created\");\n    Ok(())\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n    use rusqlite::Connection;\n\n    #[test]\n    fn test_schema_init() -\u003e Result\u003c()\u003e {\n        let conn = Connection::open_in_memory()?;\n        init_schema(\u0026conn)?;\n\n        // Verify tables exist\n        let mut stmt = conn.prepare(\n            \"SELECT name FROM sqlite_master WHERE type='table' ORDER BY name\"\n        )?;\n\n        let tables: Vec\u003cString\u003e = stmt.query_map([], |row| row.get(0))?\n            .collect::\u003cResult\u003cVec\u003c_\u003e, _\u003e\u003e()?;\n\n        assert!(tables.contains(\u0026\"items\".to_string()));\n        assert!(tables.contains(\u0026\"passages\".to_string()));\n        assert!(tables.contains(\u0026\"choices\".to_string()));\n        assert!(tables.contains(\u0026\"tags\".to_string()));\n\n        Ok(())\n    }\n}\n","traces":[{"line":10,"address":[],"length":0,"stats":{"Line":4}},{"line":11,"address":[],"length":0,"stats":{"Line":4}},{"line":14,"address":[],"length":0,"stats":{"Line":8}},{"line":30,"address":[],"length":0,"stats":{"Line":8}},{"line":43,"address":[],"length":0,"stats":{"Line":8}},{"line":56,"address":[],"length":0,"stats":{"Line":8}},{"line":66,"address":[],"length":0,"stats":{"Line":8}},{"line":78,"address":[],"length":0,"stats":{"Line":8}},{"line":89,"address":[],"length":0,"stats":{"Line":8}},{"line":101,"address":[],"length":0,"stats":{"Line":8}},{"line":113,"address":[],"length":0,"stats":{"Line":8}},{"line":115,"address":[],"length":0,"stats":{"Line":4}},{"line":116,"address":[],"length":0,"stats":{"Line":4}},{"line":120,"address":[],"length":0,"stats":{"Line":4}},{"line":122,"address":[],"length":0,"stats":{"Line":8}},{"line":128,"address":[],"length":0,"stats":{"Line":8}},{"line":134,"address":[],"length":0,"stats":{"Line":8}},{"line":140,"address":[],"length":0,"stats":{"Line":8}},{"line":146,"address":[],"length":0,"stats":{"Line":8}},{"line":152,"address":[],"length":0,"stats":{"Line":8}},{"line":158,"address":[],"length":0,"stats":{"Line":8}},{"line":163,"address":[],"length":0,"stats":{"Line":4}},{"line":164,"address":[],"length":0,"stats":{"Line":4}}],"covered":23,"coverable":23},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","ui","src","app","actions.rs"],"content":"use gtk4::{gio, glib, prelude::*};\n\npub fn register_global_actions(app: \u0026gtk4::Application) {\n    add_action(app, \"quit\", |application| {\n        application.quit();\n    });\n\n    let actions: [(\u0026str, Option\u003c\u0026str\u003e); 7] = [\n        (\"new\", Some(\"\u003cPrimary\u003en\")),\n        (\"open\", Some(\"\u003cPrimary\u003eo\")),\n        (\"save\", Some(\"\u003cPrimary\u003es\")),\n        (\"undo\", Some(\"\u003cPrimary\u003ez\")),\n        (\"redo\", Some(\"\u003cPrimary\u003e\u003cShift\u003ez\")),\n        (\"toggle-guides\", Some(\"F7\")),\n        (\"toggle-grid\", Some(\"F8\")),\n    ];\n\n    for (name, accel) in actions {\n        let name_owned = name.to_string();\n        add_action(app, name, move |_| tracing::info!(action = %name_owned, \"triggered\"));\n        if let Some(accel) = accel {\n            app.set_accels_for_action(\u0026format!(\"app.{name}\"), \u0026[accel]);\n        }\n    }\n\n    glib::set_application_name(\"Testruct Studio\");\n}\n\nfn add_action\u003cF\u003e(app: \u0026gtk4::Application, name: \u0026str, callback: F)\nwhere\n    F: Fn(\u0026gtk4::Application) + 'static,\n{\n    let action = gio::SimpleAction::new(name, None);\n    let application_ref = app.clone();\n    action.connect_activate(move |_, _| callback(\u0026application_ref));\n    app.add_action(\u0026action);\n}\n","traces":[{"line":3,"address":[],"length":0,"stats":{"Line":0}},{"line":4,"address":[],"length":0,"stats":{"Line":0}},{"line":5,"address":[],"length":0,"stats":{"Line":0}},{"line":8,"address":[],"length":0,"stats":{"Line":0}},{"line":9,"address":[],"length":0,"stats":{"Line":0}},{"line":10,"address":[],"length":0,"stats":{"Line":0}},{"line":11,"address":[],"length":0,"stats":{"Line":0}},{"line":12,"address":[],"length":0,"stats":{"Line":0}},{"line":13,"address":[],"length":0,"stats":{"Line":0}},{"line":14,"address":[],"length":0,"stats":{"Line":0}},{"line":15,"address":[],"length":0,"stats":{"Line":0}},{"line":18,"address":[],"length":0,"stats":{"Line":0}},{"line":19,"address":[],"length":0,"stats":{"Line":0}},{"line":20,"address":[],"length":0,"stats":{"Line":0}},{"line":21,"address":[],"length":0,"stats":{"Line":0}},{"line":22,"address":[],"length":0,"stats":{"Line":0}},{"line":26,"address":[],"length":0,"stats":{"Line":0}},{"line":29,"address":[],"length":0,"stats":{"Line":0}},{"line":33,"address":[],"length":0,"stats":{"Line":0}},{"line":34,"address":[],"length":0,"stats":{"Line":0}},{"line":35,"address":[],"length":0,"stats":{"Line":0}},{"line":36,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":22},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","ui","src","app","mod.rs"],"content":"mod state;\nmod actions;\n\nuse gtk4::{gio, glib, prelude::*, Application};\nuse crate::window::MainWindow;\n\npub use state::AppState;\n\n#[derive(Clone, Debug)]\npub struct AppConfig {\n    pub application_id: String,\n}\n\nimpl Default for AppConfig {\n    fn default() -\u003e Self {\n        Self {\n            application_id: \"com.testruct.desktop\".into(),\n        }\n    }\n}\n\npub struct TestructApplication {\n    app: Application,\n}\n\nimpl TestructApplication {\n    pub fn new(config: AppConfig) -\u003e Self {\n        // Use builder pattern for proper GTK4 initialization (works better on macOS)\n        // Set HANDLES_OPEN flag to properly handle file open requests on macOS\n        let app = gtk4::Application::builder()\n            .application_id(\u0026config.application_id)\n            .flags(gio::ApplicationFlags::HANDLES_OPEN)\n            .build();\n        actions::register_global_actions(\u0026app);\n        Self { app }\n    }\n\n    pub fn run(self) -\u003e glib::ExitCode {\n        // Initialize logging\n        tracing_subscriber::fmt::init();\n\n        eprintln!(\" Starting GTK application...\");\n        eprintln!(\"  Window should appear on your screen...\");\n        eprintln!(\" Connecting signal handlers...\");\n\n        // On macOS, the app is opened via the open signal, not activate\n        // We handle both signals to support different launching methods\n\n        self.app.connect_activate(|app| {\n            eprintln!(\" ACTIVATE SIGNAL FIRED!\");\n            let state = AppState::default();\n            let window = MainWindow::build(app, state);\n            window.present();\n            eprintln!(\" Window presented\");\n        });\n\n        self.app.connect_open(|app, _files, _hint| {\n            eprintln!(\" OPEN SIGNAL FIRED! (macOS startup)\");\n            let state = AppState::default();\n            let window = MainWindow::build(app, state);\n            eprintln!(\" Window created from open signal\");\n            window.present();\n            eprintln!(\" Window presented to screen\");\n        });\n\n        eprintln!(\" Calling app.run()...\");\n        let exit_code = self.app.run();\n        eprintln!(\" Application terminated with code: {:?}\", exit_code);\n        exit_code\n    }\n}\n","traces":[{"line":15,"address":[],"length":0,"stats":{"Line":0}},{"line":17,"address":[],"length":0,"stats":{"Line":0}},{"line":27,"address":[],"length":0,"stats":{"Line":0}},{"line":30,"address":[],"length":0,"stats":{"Line":0}},{"line":31,"address":[],"length":0,"stats":{"Line":0}},{"line":32,"address":[],"length":0,"stats":{"Line":0}},{"line":34,"address":[],"length":0,"stats":{"Line":0}},{"line":38,"address":[],"length":0,"stats":{"Line":0}},{"line":40,"address":[],"length":0,"stats":{"Line":0}},{"line":42,"address":[],"length":0,"stats":{"Line":0}},{"line":43,"address":[],"length":0,"stats":{"Line":0}},{"line":44,"address":[],"length":0,"stats":{"Line":0}},{"line":49,"address":[],"length":0,"stats":{"Line":0}},{"line":50,"address":[],"length":0,"stats":{"Line":0}},{"line":51,"address":[],"length":0,"stats":{"Line":0}},{"line":52,"address":[],"length":0,"stats":{"Line":0}},{"line":53,"address":[],"length":0,"stats":{"Line":0}},{"line":54,"address":[],"length":0,"stats":{"Line":0}},{"line":57,"address":[],"length":0,"stats":{"Line":0}},{"line":58,"address":[],"length":0,"stats":{"Line":0}},{"line":59,"address":[],"length":0,"stats":{"Line":0}},{"line":60,"address":[],"length":0,"stats":{"Line":0}},{"line":61,"address":[],"length":0,"stats":{"Line":0}},{"line":62,"address":[],"length":0,"stats":{"Line":0}},{"line":63,"address":[],"length":0,"stats":{"Line":0}},{"line":66,"address":[],"length":0,"stats":{"Line":0}},{"line":67,"address":[],"length":0,"stats":{"Line":0}},{"line":68,"address":[],"length":0,"stats":{"Line":0}},{"line":69,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":29},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","ui","src","app","state.rs"],"content":"use std::sync::{Arc, Mutex};\n\nuse testruct_core::{Document, DocumentId, Project};\nuse testruct_core::workspace::assets::AssetCatalog;\nuse testruct_db::ItemBank;\nuse crate::undo_redo::UndoRedoStack;\n\n#[derive(Clone)]\npub struct AppState {\n    inner: Arc\u003cMutex\u003cAppShared\u003e\u003e,\n}\n\nimpl Default for AppState {\n    fn default() -\u003e Self {\n        // Initialize in-memory database for item bank\n        let item_bank = ItemBank::memory().expect(\"Failed to initialize item bank\");\n\n        let app_state = Self {\n            inner: Arc::new(Mutex::new(AppShared {\n                project: Project::default(),\n                active_document: None,\n                undo_redo_stack: Arc::new(Mutex::new(crate::undo_redo::UndoRedoStack::default())),\n                item_bank: Arc::new(Mutex::new(item_bank)),\n                asset_catalog: Arc::new(Mutex::new(AssetCatalog::new())),\n            })),\n        };\n\n        // Initialize with a default document\n        {\n            let mut inner = app_state.inner.lock().expect(\"state\");\n            let doc = testruct_core::document::DocumentBuilder::new()\n                .with_title(\"Untitled\")\n                .add_page(testruct_core::document::Page::empty())\n                .build()\n                .expect(\"document\");\n\n            let doc_id = doc.id;\n            inner.project.add_document(doc);\n            inner.active_document = Some(doc_id);\n        }\n\n        app_state\n    }\n}\n\nimpl AppState {\n    pub fn project(\u0026self) -\u003e Project {\n        self.inner.lock().expect(\"state\").project.clone()\n    }\n\n    pub fn active_document(\u0026self) -\u003e Option\u003cDocument\u003e {\n        let inner = self.inner.lock().expect(\"state\");\n        inner\n            .active_document\n            .and_then(|id| inner.project.document(id).cloned())\n    }\n\n    pub fn with_active_document\u003cF, R\u003e(\u0026self, f: F) -\u003e Option\u003cR\u003e\n    where\n        F: FnOnce(\u0026mut Document) -\u003e R,\n    {\n        let mut inner = self.inner.lock().expect(\"state\");\n        if let Some(doc_id) = inner.active_document {\n            if let Some(doc) = inner.project.document_mut(doc_id) {\n                return Some(f(doc));\n            }\n        }\n        None\n    }\n\n    pub fn undo_redo_stack(\u0026self) -\u003e std::sync::Arc\u003cstd::sync::Mutex\u003cUndoRedoStack\u003e\u003e {\n        let inner = self.inner.lock().expect(\"state\");\n        inner.undo_redo_stack.clone()\n    }\n\n    pub fn with_undo_stack\u003cF, R\u003e(\u0026self, f: F) -\u003e R\n    where\n        F: FnOnce(\u0026mut UndoRedoStack) -\u003e R,\n    {\n        let inner = self.inner.lock().expect(\"state\");\n        let mut stack = inner.undo_redo_stack.lock().expect(\"undo stack\");\n        f(\u0026mut stack)\n    }\n\n    pub fn can_undo(\u0026self) -\u003e bool {\n        self.with_undo_stack(|stack| stack.can_undo())\n    }\n\n    pub fn can_redo(\u0026self) -\u003e bool {\n        self.with_undo_stack(|stack| stack.can_redo())\n    }\n\n    pub fn undo(\u0026self) -\u003e bool {\n        self.with_undo_stack(|stack| stack.undo())\n    }\n\n    pub fn redo(\u0026self) -\u003e bool {\n        self.with_undo_stack(|stack| stack.redo())\n    }\n\n    pub fn push_command(\u0026self, command: Box\u003cdyn crate::undo_redo::Command\u003e) {\n        let stack = {\n            let inner = self.inner.lock().expect(\"state\");\n            inner.undo_redo_stack.clone()\n        };\n        let mut undo_stack = stack.lock().expect(\"undo stack\");\n        undo_stack.push(command);\n    }\n\n    pub fn add_element_to_active_page(\u0026self, element: testruct_core::document::DocumentElement) -\u003e Result\u003c(), String\u003e {\n        let mut inner = self.inner.lock().expect(\"state\");\n        if let Some(doc_id) = inner.active_document {\n            if let Some(doc) = inner.project.document_mut(doc_id) {\n                if !doc.pages.is_empty() {\n                    doc.pages[0].add_element(element);\n                    return Ok(());\n                }\n            }\n        }\n        Err(\"No active document or pages\".to_string())\n    }\n\n    pub fn item_bank(\u0026self) -\u003e Arc\u003cMutex\u003cItemBank\u003e\u003e {\n        let inner = self.inner.lock().expect(\"state\");\n        inner.item_bank.clone()\n    }\n\n    pub fn asset_catalog(\u0026self) -\u003e Arc\u003cMutex\u003cAssetCatalog\u003e\u003e {\n        let inner = self.inner.lock().expect(\"state\");\n        inner.asset_catalog.clone()\n    }\n\n    /// Add a new page to the active document\n    pub fn add_page(\u0026self) -\u003e Result\u003c(), String\u003e {\n        let mut inner = self.inner.lock().expect(\"state\");\n        if let Some(doc_id) = inner.active_document {\n            if let Some(doc) = inner.project.document_mut(doc_id) {\n                doc.pages.push(testruct_core::document::Page::empty());\n                return Ok(());\n            }\n        }\n        Err(\"No active document\".to_string())\n    }\n\n    /// Delete a page from the active document by index\n    pub fn delete_page(\u0026self, index: usize) -\u003e Result\u003c(), String\u003e {\n        let mut inner = self.inner.lock().expect(\"state\");\n        if let Some(doc_id) = inner.active_document {\n            if let Some(doc) = inner.project.document_mut(doc_id) {\n                if index \u003c doc.pages.len() \u0026\u0026 doc.pages.len() \u003e 1 {\n                    doc.pages.remove(index);\n                    return Ok(());\n                }\n                return Err(\"Cannot delete the only page\".to_string());\n            }\n        }\n        Err(\"No active document\".to_string())\n    }\n\n    /// Duplicate a page in the active document\n    pub fn duplicate_page(\u0026self, index: usize) -\u003e Result\u003c(), String\u003e {\n        let mut inner = self.inner.lock().expect(\"state\");\n        if let Some(doc_id) = inner.active_document {\n            if let Some(doc) = inner.project.document_mut(doc_id) {\n                if index \u003c doc.pages.len() {\n                    let page_clone = doc.pages[index].clone();\n                    doc.pages.insert(index + 1, page_clone);\n                    return Ok(());\n                }\n                return Err(\"Page index out of bounds\".to_string());\n            }\n        }\n        Err(\"No active document\".to_string())\n    }\n\n    /// Move a page up in the active document\n    pub fn move_page_up(\u0026self, index: usize) -\u003e Result\u003c(), String\u003e {\n        let mut inner = self.inner.lock().expect(\"state\");\n        if let Some(doc_id) = inner.active_document {\n            if let Some(doc) = inner.project.document_mut(doc_id) {\n                if index \u003e 0 \u0026\u0026 index \u003c doc.pages.len() {\n                    doc.pages.swap(index, index - 1);\n                    return Ok(());\n                }\n                return Err(\"Cannot move page up from first position\".to_string());\n            }\n        }\n        Err(\"No active document\".to_string())\n    }\n\n    /// Move a page down in the active document\n    pub fn move_page_down(\u0026self, index: usize) -\u003e Result\u003c(), String\u003e {\n        let mut inner = self.inner.lock().expect(\"state\");\n        if let Some(doc_id) = inner.active_document {\n            if let Some(doc) = inner.project.document_mut(doc_id) {\n                if index \u003c doc.pages.len() - 1 {\n                    doc.pages.swap(index, index + 1);\n                    return Ok(());\n                }\n                return Err(\"Cannot move page down from last position\".to_string());\n            }\n        }\n        Err(\"No active document\".to_string())\n    }\n\n    /// Get the total number of pages in the active document\n    pub fn page_count(\u0026self) -\u003e usize {\n        if let Some(doc) = self.active_document() {\n            doc.pages.len()\n        } else {\n            0\n        }\n    }\n\n    /// Get all object IDs in the first page of the active document\n    pub fn get_all_object_ids(\u0026self) -\u003e Vec\u003cuuid::Uuid\u003e {\n        if let Some(doc) = self.active_document() {\n            if let Some(page) = doc.pages.first() {\n                page.elements\n                    .iter()\n                    .map(|element| match element {\n                        testruct_core::document::DocumentElement::Shape(shape) =\u003e shape.id,\n                        testruct_core::document::DocumentElement::Text(text) =\u003e text.id,\n                        testruct_core::document::DocumentElement::Image(image) =\u003e image.id,\n                        testruct_core::document::DocumentElement::Frame(frame) =\u003e frame.id,\n                    })\n                    .collect()\n            } else {\n                Vec::new()\n            }\n        } else {\n            Vec::new()\n        }\n    }\n\n}\n\nstruct AppShared {\n    project: Project,\n    active_document: Option\u003cDocumentId\u003e,\n    undo_redo_stack: Arc\u003cMutex\u003cUndoRedoStack\u003e\u003e,\n    item_bank: Arc\u003cMutex\u003cItemBank\u003e\u003e,\n    asset_catalog: Arc\u003cMutex\u003cAssetCatalog\u003e\u003e,\n}\n","traces":[{"line":14,"address":[],"length":0,"stats":{"Line":0}},{"line":16,"address":[],"length":0,"stats":{"Line":0}},{"line":19,"address":[],"length":0,"stats":{"Line":0}},{"line":30,"address":[],"length":0,"stats":{"Line":0}},{"line":31,"address":[],"length":0,"stats":{"Line":0}},{"line":33,"address":[],"length":0,"stats":{"Line":0}},{"line":37,"address":[],"length":0,"stats":{"Line":0}},{"line":38,"address":[],"length":0,"stats":{"Line":0}},{"line":39,"address":[],"length":0,"stats":{"Line":0}},{"line":42,"address":[],"length":0,"stats":{"Line":0}},{"line":47,"address":[],"length":0,"stats":{"Line":0}},{"line":48,"address":[],"length":0,"stats":{"Line":0}},{"line":51,"address":[],"length":0,"stats":{"Line":0}},{"line":52,"address":[],"length":0,"stats":{"Line":0}},{"line":53,"address":[],"length":0,"stats":{"Line":0}},{"line":54,"address":[],"length":0,"stats":{"Line":0}},{"line":55,"address":[],"length":0,"stats":{"Line":0}},{"line":58,"address":[],"length":0,"stats":{"Line":0}},{"line":62,"address":[],"length":0,"stats":{"Line":0}},{"line":63,"address":[],"length":0,"stats":{"Line":0}},{"line":64,"address":[],"length":0,"stats":{"Line":0}},{"line":65,"address":[],"length":0,"stats":{"Line":0}},{"line":68,"address":[],"length":0,"stats":{"Line":0}},{"line":71,"address":[],"length":0,"stats":{"Line":0}},{"line":72,"address":[],"length":0,"stats":{"Line":0}},{"line":73,"address":[],"length":0,"stats":{"Line":0}},{"line":76,"address":[],"length":0,"stats":{"Line":0}},{"line":80,"address":[],"length":0,"stats":{"Line":0}},{"line":81,"address":[],"length":0,"stats":{"Line":0}},{"line":82,"address":[],"length":0,"stats":{"Line":0}},{"line":85,"address":[],"length":0,"stats":{"Line":0}},{"line":86,"address":[],"length":0,"stats":{"Line":0}},{"line":89,"address":[],"length":0,"stats":{"Line":0}},{"line":90,"address":[],"length":0,"stats":{"Line":0}},{"line":93,"address":[],"length":0,"stats":{"Line":0}},{"line":94,"address":[],"length":0,"stats":{"Line":0}},{"line":97,"address":[],"length":0,"stats":{"Line":0}},{"line":98,"address":[],"length":0,"stats":{"Line":0}},{"line":101,"address":[],"length":0,"stats":{"Line":0}},{"line":102,"address":[],"length":0,"stats":{"Line":0}},{"line":103,"address":[],"length":0,"stats":{"Line":0}},{"line":104,"address":[],"length":0,"stats":{"Line":0}},{"line":106,"address":[],"length":0,"stats":{"Line":0}},{"line":107,"address":[],"length":0,"stats":{"Line":0}},{"line":110,"address":[],"length":0,"stats":{"Line":0}},{"line":111,"address":[],"length":0,"stats":{"Line":0}},{"line":112,"address":[],"length":0,"stats":{"Line":0}},{"line":113,"address":[],"length":0,"stats":{"Line":0}},{"line":114,"address":[],"length":0,"stats":{"Line":0}},{"line":115,"address":[],"length":0,"stats":{"Line":0}},{"line":116,"address":[],"length":0,"stats":{"Line":0}},{"line":120,"address":[],"length":0,"stats":{"Line":0}},{"line":123,"address":[],"length":0,"stats":{"Line":0}},{"line":124,"address":[],"length":0,"stats":{"Line":0}},{"line":125,"address":[],"length":0,"stats":{"Line":0}},{"line":128,"address":[],"length":0,"stats":{"Line":0}},{"line":129,"address":[],"length":0,"stats":{"Line":0}},{"line":130,"address":[],"length":0,"stats":{"Line":0}},{"line":134,"address":[],"length":0,"stats":{"Line":0}},{"line":135,"address":[],"length":0,"stats":{"Line":0}},{"line":136,"address":[],"length":0,"stats":{"Line":0}},{"line":137,"address":[],"length":0,"stats":{"Line":0}},{"line":138,"address":[],"length":0,"stats":{"Line":0}},{"line":139,"address":[],"length":0,"stats":{"Line":0}},{"line":142,"address":[],"length":0,"stats":{"Line":0}},{"line":146,"address":[],"length":0,"stats":{"Line":0}},{"line":147,"address":[],"length":0,"stats":{"Line":0}},{"line":148,"address":[],"length":0,"stats":{"Line":0}},{"line":149,"address":[],"length":0,"stats":{"Line":0}},{"line":150,"address":[],"length":0,"stats":{"Line":0}},{"line":151,"address":[],"length":0,"stats":{"Line":0}},{"line":152,"address":[],"length":0,"stats":{"Line":0}},{"line":154,"address":[],"length":0,"stats":{"Line":0}},{"line":157,"address":[],"length":0,"stats":{"Line":0}},{"line":161,"address":[],"length":0,"stats":{"Line":0}},{"line":162,"address":[],"length":0,"stats":{"Line":0}},{"line":163,"address":[],"length":0,"stats":{"Line":0}},{"line":164,"address":[],"length":0,"stats":{"Line":0}},{"line":165,"address":[],"length":0,"stats":{"Line":0}},{"line":166,"address":[],"length":0,"stats":{"Line":0}},{"line":167,"address":[],"length":0,"stats":{"Line":0}},{"line":168,"address":[],"length":0,"stats":{"Line":0}},{"line":170,"address":[],"length":0,"stats":{"Line":0}},{"line":173,"address":[],"length":0,"stats":{"Line":0}},{"line":177,"address":[],"length":0,"stats":{"Line":0}},{"line":178,"address":[],"length":0,"stats":{"Line":0}},{"line":179,"address":[],"length":0,"stats":{"Line":0}},{"line":180,"address":[],"length":0,"stats":{"Line":0}},{"line":181,"address":[],"length":0,"stats":{"Line":0}},{"line":182,"address":[],"length":0,"stats":{"Line":0}},{"line":183,"address":[],"length":0,"stats":{"Line":0}},{"line":185,"address":[],"length":0,"stats":{"Line":0}},{"line":188,"address":[],"length":0,"stats":{"Line":0}},{"line":192,"address":[],"length":0,"stats":{"Line":0}},{"line":193,"address":[],"length":0,"stats":{"Line":0}},{"line":194,"address":[],"length":0,"stats":{"Line":0}},{"line":195,"address":[],"length":0,"stats":{"Line":0}},{"line":196,"address":[],"length":0,"stats":{"Line":0}},{"line":197,"address":[],"length":0,"stats":{"Line":0}},{"line":198,"address":[],"length":0,"stats":{"Line":0}},{"line":200,"address":[],"length":0,"stats":{"Line":0}},{"line":203,"address":[],"length":0,"stats":{"Line":0}},{"line":207,"address":[],"length":0,"stats":{"Line":0}},{"line":208,"address":[],"length":0,"stats":{"Line":0}},{"line":209,"address":[],"length":0,"stats":{"Line":0}},{"line":211,"address":[],"length":0,"stats":{"Line":0}},{"line":216,"address":[],"length":0,"stats":{"Line":0}},{"line":217,"address":[],"length":0,"stats":{"Line":0}},{"line":218,"address":[],"length":0,"stats":{"Line":0}},{"line":219,"address":[],"length":0,"stats":{"Line":0}},{"line":221,"address":[],"length":0,"stats":{"Line":0}},{"line":222,"address":[],"length":0,"stats":{"Line":0}},{"line":223,"address":[],"length":0,"stats":{"Line":0}},{"line":224,"address":[],"length":0,"stats":{"Line":0}},{"line":225,"address":[],"length":0,"stats":{"Line":0}},{"line":229,"address":[],"length":0,"stats":{"Line":0}},{"line":232,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":117},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","ui","src","canvas","dirty_region.rs"],"content":"//! Dirty region tracking for optimized rendering\n//!\n//! Tracks which areas of the canvas have changed and need to be redrawn.\n//! This allows for efficient partial redraws instead of redrawing the entire canvas.\n\nuse testruct_core::layout::Rect;\nuse std::cell::RefCell;\nuse std::rc::Rc;\n\n/// Represents a region that needs to be redrawn\n#[derive(Clone, Debug, Default)]\npub struct DirtyRegion {\n    rects: Vec\u003cRect\u003e,\n    is_full_redraw: bool,\n}\n\nimpl DirtyRegion {\n    /// Create a new empty dirty region\n    pub fn new() -\u003e Self {\n        Self {\n            rects: Vec::new(),\n            is_full_redraw: false,\n        }\n    }\n\n    /// Mark the entire canvas as needing redraw\n    pub fn mark_full_redraw(\u0026mut self) {\n        self.is_full_redraw = true;\n        self.rects.clear();\n    }\n\n    /// Add a rectangle to the dirty region\n    pub fn add_rect(\u0026mut self, rect: Rect) {\n        if self.is_full_redraw {\n            return;\n        }\n\n        // If adding too many rects, just do full redraw\n        if self.rects.len() \u003e 10 {\n            self.mark_full_redraw();\n            return;\n        }\n\n        // Check if new rect overlaps with existing rects and merge\n        self.rects.push(rect);\n        self.merge_overlapping_rects();\n    }\n\n    /// Merge overlapping rectangles to optimize region\n    fn merge_overlapping_rects(\u0026mut self) {\n        let mut merged = true;\n        while merged {\n            merged = false;\n            let mut i = 0;\n            while i \u003c self.rects.len() {\n                let mut j = i + 1;\n                while j \u003c self.rects.len() {\n                    if self.rects_overlap(self.rects[i], self.rects[j]) {\n                        let merged_rect = self.merge_rects(self.rects[i], self.rects[j]);\n                        self.rects[i] = merged_rect;\n                        self.rects.remove(j);\n                        merged = true;\n                        break;\n                    }\n                    j += 1;\n                }\n                if merged {\n                    break;\n                }\n                i += 1;\n            }\n        }\n    }\n\n    /// Check if two rectangles overlap or are adjacent\n    fn rects_overlap(\u0026self, r1: Rect, r2: Rect) -\u003e bool {\n        let padding = 5.0; // Merge if close together\n        r1.origin.x - padding \u003c= r2.origin.x + r2.size.width\n            \u0026\u0026 r1.origin.x + r1.size.width + padding \u003e= r2.origin.x\n            \u0026\u0026 r1.origin.y - padding \u003c= r2.origin.y + r2.size.height\n            \u0026\u0026 r1.origin.y + r1.size.height + padding \u003e= r2.origin.y\n    }\n\n    /// Merge two rectangles into their bounding box\n    fn merge_rects(\u0026self, r1: Rect, r2: Rect) -\u003e Rect {\n        let min_x = r1.origin.x.min(r2.origin.x);\n        let min_y = r1.origin.y.min(r2.origin.y);\n        let max_x = (r1.origin.x + r1.size.width).max(r2.origin.x + r2.size.width);\n        let max_y = (r1.origin.y + r1.size.height).max(r2.origin.y + r2.size.height);\n\n        Rect {\n            origin: testruct_core::layout::Point {\n                x: min_x,\n                y: min_y,\n            },\n            size: testruct_core::layout::Size {\n                width: max_x - min_x,\n                height: max_y - min_y,\n            },\n        }\n    }\n\n    /// Check if full redraw is needed\n    pub fn needs_full_redraw(\u0026self) -\u003e bool {\n        self.is_full_redraw\n    }\n\n    /// Get rectangles that need redraw\n    pub fn get_rects(\u0026self) -\u003e Vec\u003cRect\u003e {\n        self.rects.clone()\n    }\n\n    /// Clear the dirty region\n    pub fn clear(\u0026mut self) {\n        self.rects.clear();\n        self.is_full_redraw = false;\n    }\n\n    /// Check if there are any dirty regions\n    pub fn is_empty(\u0026self) -\u003e bool {\n        !self.is_full_redraw \u0026\u0026 self.rects.is_empty()\n    }\n}\n\n/// Thread-safe dirty region tracker\npub type DirtyRegionTracker = Rc\u003cRefCell\u003cDirtyRegion\u003e\u003e;\n\n/// Create a new dirty region tracker\npub fn new_tracker() -\u003e DirtyRegionTracker {\n    Rc::new(RefCell::new(DirtyRegion::new()))\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n\n    #[test]\n    fn test_mark_full_redraw() {\n        let mut region = DirtyRegion::new();\n        region.mark_full_redraw();\n        assert!(region.needs_full_redraw());\n        assert!(region.get_rects().is_empty());\n    }\n\n    #[test]\n    fn test_add_rect() {\n        let mut region = DirtyRegion::new();\n        let rect = Rect {\n            origin: testruct_core::layout::Point { x: 0.0, y: 0.0 },\n            size: testruct_core::layout::Size {\n                width: 100.0,\n                height: 100.0,\n            },\n        };\n\n        region.add_rect(rect);\n        assert!(!region.is_empty());\n        assert_eq!(region.get_rects().len(), 1);\n    }\n\n    #[test]\n    fn test_merge_overlapping_rects() {\n        let mut region = DirtyRegion::new();\n        let rect1 = Rect {\n            origin: testruct_core::layout::Point { x: 0.0, y: 0.0 },\n            size: testruct_core::layout::Size {\n                width: 100.0,\n                height: 100.0,\n            },\n        };\n\n        let rect2 = Rect {\n            origin: testruct_core::layout::Point { x: 50.0, y: 50.0 },\n            size: testruct_core::layout::Size {\n                width: 100.0,\n                height: 100.0,\n            },\n        };\n\n        region.add_rect(rect1);\n        region.add_rect(rect2);\n\n        // Should merge overlapping rects\n        assert!(region.get_rects().len() \u003c= 2);\n    }\n\n    #[test]\n    fn test_too_many_rects_triggers_full_redraw() {\n        let mut region = DirtyRegion::new();\n\n        for i in 0..15 {\n            let rect = Rect {\n                origin: testruct_core::layout::Point {\n                    x: (i * 50) as f32,\n                    y: 0.0,\n                },\n                size: testruct_core::layout::Size {\n                    width: 40.0,\n                    height: 40.0,\n                },\n            };\n            region.add_rect(rect);\n        }\n\n        // Should trigger full redraw when too many rects\n        assert!(region.needs_full_redraw());\n    }\n}\n","traces":[{"line":19,"address":[],"length":0,"stats":{"Line":4}},{"line":21,"address":[],"length":0,"stats":{"Line":4}},{"line":27,"address":[],"length":0,"stats":{"Line":2}},{"line":28,"address":[],"length":0,"stats":{"Line":2}},{"line":29,"address":[],"length":0,"stats":{"Line":4}},{"line":33,"address":[],"length":0,"stats":{"Line":18}},{"line":34,"address":[],"length":0,"stats":{"Line":18}},{"line":35,"address":[],"length":0,"stats":{"Line":3}},{"line":39,"address":[],"length":0,"stats":{"Line":15}},{"line":40,"address":[],"length":0,"stats":{"Line":2}},{"line":41,"address":[],"length":0,"stats":{"Line":1}},{"line":45,"address":[],"length":0,"stats":{"Line":42}},{"line":46,"address":[],"length":0,"stats":{"Line":28}},{"line":50,"address":[],"length":0,"stats":{"Line":14}},{"line":51,"address":[],"length":0,"stats":{"Line":28}},{"line":52,"address":[],"length":0,"stats":{"Line":29}},{"line":53,"address":[],"length":0,"stats":{"Line":15}},{"line":54,"address":[],"length":0,"stats":{"Line":30}},{"line":55,"address":[],"length":0,"stats":{"Line":168}},{"line":56,"address":[],"length":0,"stats":{"Line":140}},{"line":57,"address":[],"length":0,"stats":{"Line":580}},{"line":58,"address":[],"length":0,"stats":{"Line":884}},{"line":59,"address":[],"length":0,"stats":{"Line":5}},{"line":60,"address":[],"length":0,"stats":{"Line":1}},{"line":61,"address":[],"length":0,"stats":{"Line":3}},{"line":62,"address":[],"length":0,"stats":{"Line":1}},{"line":63,"address":[],"length":0,"stats":{"Line":1}},{"line":65,"address":[],"length":0,"stats":{"Line":220}},{"line":67,"address":[],"length":0,"stats":{"Line":70}},{"line":68,"address":[],"length":0,"stats":{"Line":1}},{"line":70,"address":[],"length":0,"stats":{"Line":69}},{"line":76,"address":[],"length":0,"stats":{"Line":221}},{"line":77,"address":[],"length":0,"stats":{"Line":442}},{"line":78,"address":[],"length":0,"stats":{"Line":442}},{"line":79,"address":[],"length":0,"stats":{"Line":221}},{"line":80,"address":[],"length":0,"stats":{"Line":2}},{"line":81,"address":[],"length":0,"stats":{"Line":1}},{"line":85,"address":[],"length":0,"stats":{"Line":1}},{"line":86,"address":[],"length":0,"stats":{"Line":4}},{"line":87,"address":[],"length":0,"stats":{"Line":4}},{"line":88,"address":[],"length":0,"stats":{"Line":4}},{"line":89,"address":[],"length":0,"stats":{"Line":4}},{"line":92,"address":[],"length":0,"stats":{"Line":2}},{"line":96,"address":[],"length":0,"stats":{"Line":1}},{"line":104,"address":[],"length":0,"stats":{"Line":2}},{"line":105,"address":[],"length":0,"stats":{"Line":2}},{"line":109,"address":[],"length":0,"stats":{"Line":3}},{"line":110,"address":[],"length":0,"stats":{"Line":6}},{"line":114,"address":[],"length":0,"stats":{"Line":0}},{"line":115,"address":[],"length":0,"stats":{"Line":0}},{"line":116,"address":[],"length":0,"stats":{"Line":0}},{"line":120,"address":[],"length":0,"stats":{"Line":1}},{"line":121,"address":[],"length":0,"stats":{"Line":3}},{"line":129,"address":[],"length":0,"stats":{"Line":0}},{"line":130,"address":[],"length":0,"stats":{"Line":0}}],"covered":50,"coverable":55},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","ui","src","canvas","input.rs"],"content":"use gtk4::{prelude::*, DrawingArea, EventControllerMotion, GestureClick, GestureDrag, EventControllerKey};\nuse gtk4::gdk;\nuse crate::canvas::{CanvasRenderState, tools::{ToolMode, ShapeFactory}, selection::HitTest, mouse::{test_resize_handle, calculate_resize_bounds, CanvasMousePos, ResizeHandle}, rendering::{snap_rect_to_grid, snap_to_guide, GuideOrientation}};\nuse crate::app::AppState;\nuse testruct_core::layout::{Point, Rect, Size};\nuse testruct_core::document::DocumentElement;\n\n/// Initialize pointer events for canvas\npub fn wire_pointer_events(\n    drawing_area: \u0026DrawingArea,\n    render_state: \u0026CanvasRenderState,\n    _app_state: \u0026AppState,\n) {\n    drawing_area.set_focusable(true);\n\n    // Keyboard event controller\n    let key_controller = EventControllerKey::new();\n    let render_state_keyboard = render_state.clone();\n    let app_state_keyboard = _app_state.clone();\n    let drawing_area_keyboard = drawing_area.clone();\n\n    key_controller.connect_key_pressed(move |_controller, keyval, _keycode, state| {\n        let render_state_kbd = render_state_keyboard.clone();\n        let tool_state_ref = render_state_kbd.tool_state.borrow();\n        let in_text_editing = tool_state_ref.editing_text_id.is_some();\n        let editing_text_id = tool_state_ref.editing_text_id;\n        let mut cursor_pos = tool_state_ref.editing_cursor_pos;\n        drop(tool_state_ref);\n\n        // Determine if shift and control are pressed\n        let shift_pressed = state.contains(gtk4::gdk::ModifierType::SHIFT_MASK);\n        let ctrl_pressed = state.contains(gtk4::gdk::ModifierType::CONTROL_MASK);\n\n        // Handle Ctrl+Shift+I to insert image\n        if ctrl_pressed \u0026\u0026 shift_pressed \u0026\u0026 keyval == gtk4::gdk::Key::i {\n            app_state_keyboard.with_active_document(|doc| {\n                if let Some(page) = doc.pages.first_mut() {\n                    let image = DocumentElement::Image(testruct_core::document::ImageElement {\n                        id: uuid::Uuid::new_v4(),\n                        source: testruct_core::workspace::assets::AssetRef::new(),\n                        bounds: testruct_core::layout::Rect {\n                            origin: testruct_core::layout::Point { x: 100.0, y: 100.0 },\n                            size: testruct_core::layout::Size { width: 200.0, height: 150.0 },\n                        },\n                    });\n                    page.elements.push(image);\n                }\n            });\n            drawing_area_keyboard.queue_draw();\n            tracing::info!(\" Image inserted\");\n            return gtk4::glib::Propagation::Stop;\n        }\n\n        // Handle Ctrl+Shift+S to save as template\n        if ctrl_pressed \u0026\u0026 shift_pressed \u0026\u0026 keyval == gtk4::gdk::Key::s {\n            if let Some(document) = app_state_keyboard.active_document() {\n                let template_name = chrono::Local::now().format(\"template_%Y%m%d_%H%M%S\").to_string();\n                match crate::templates::save_template(\u0026template_name, \u0026document) {\n                    Ok(_) =\u003e {\n                        tracing::info!(\" Document saved as template: {}\", template_name);\n                    }\n                    Err(e) =\u003e {\n                        tracing::error!(\"Failed to save template: {}\", e);\n                    }\n                }\n            }\n            return gtk4::glib::Propagation::Stop;\n        }\n\n        // Handle text alignment shortcuts (Ctrl+L, Ctrl+E, Ctrl+R, Ctrl+C)\n        if ctrl_pressed \u0026\u0026 in_text_editing {\n            if let Some(text_id) = editing_text_id {\n                let alignment = match keyval {\n                    gtk4::gdk::Key::l =\u003e Some(testruct_core::typography::TextAlignment::Start),\n                    gtk4::gdk::Key::r =\u003e Some(testruct_core::typography::TextAlignment::End),\n                    gtk4::gdk::Key::e =\u003e Some(testruct_core::typography::TextAlignment::End),\n                    gtk4::gdk::Key::c =\u003e Some(testruct_core::typography::TextAlignment::Center),\n                    gtk4::gdk::Key::j =\u003e Some(testruct_core::typography::TextAlignment::Justified),\n                    _ =\u003e None,\n                };\n\n                if let Some(new_alignment) = alignment {\n                    app_state_keyboard.with_active_document(|doc| {\n                        if let Some(page) = doc.pages.first_mut() {\n                            for element in \u0026mut page.elements {\n                                if let DocumentElement::Text(text) = element {\n                                    if text.id == text_id {\n                                        text.style.alignment = new_alignment;\n                                    }\n                                }\n                            }\n                        }\n                    });\n                    drawing_area_keyboard.queue_draw();\n                    let align_name = match new_alignment {\n                        testruct_core::typography::TextAlignment::Start =\u003e \"Left\",\n                        testruct_core::typography::TextAlignment::Center =\u003e \"Center\",\n                        testruct_core::typography::TextAlignment::End =\u003e \"Right\",\n                        testruct_core::typography::TextAlignment::Justified =\u003e \"Justified\",\n                    };\n                    tracing::info!(\" Text alignment changed to: {}\", align_name);\n                    return gtk4::glib::Propagation::Stop;\n                }\n            }\n        }\n\n        // Handle text editing keys\n        if in_text_editing {\n            if let Some(text_id) = editing_text_id {\n                let app_state_kbd = app_state_keyboard.clone();\n\n                match keyval {\n                    gtk4::gdk::Key::Escape =\u003e {\n                        // Exit text editing mode\n                        let mut tool_state = render_state_kbd.tool_state.borrow_mut();\n                        tool_state.editing_text_id = None;\n                        tool_state.editing_cursor_pos = 0;\n                        drop(tool_state);\n                        drawing_area_keyboard.queue_draw();\n                        tracing::info!(\" Exited text editing mode\");\n                        return gtk4::glib::Propagation::Stop;\n                    }\n                    gtk4::gdk::Key::BackSpace =\u003e {\n                        // Delete character before cursor\n                        if cursor_pos \u003e 0 {\n                            app_state_kbd.with_active_document(|doc| {\n                                if let Some(page) = doc.pages.first_mut() {\n                                    for element in \u0026mut page.elements {\n                                        if let DocumentElement::Text(text) = element {\n                                            if text.id == text_id {\n                                                if cursor_pos \u003c= text.content.len() \u0026\u0026 cursor_pos \u003e 0 {\n                                                    text.content.remove(cursor_pos - 1);\n                                                    cursor_pos -= 1;\n                                                }\n                                            }\n                                        }\n                                    }\n                                }\n                            });\n                            let mut tool_state = render_state_kbd.tool_state.borrow_mut();\n                            tool_state.editing_cursor_pos = cursor_pos;\n                            drop(tool_state);\n                            drawing_area_keyboard.queue_draw();\n                            tracing::info!(\" Deleted character at cursor position {}\", cursor_pos);\n                        }\n                        return gtk4::glib::Propagation::Stop;\n                    }\n                    gtk4::gdk::Key::Delete =\u003e {\n                        // Delete character at cursor\n                        app_state_kbd.with_active_document(|doc| {\n                            if let Some(page) = doc.pages.first_mut() {\n                                for element in \u0026mut page.elements {\n                                    if let DocumentElement::Text(text) = element {\n                                        if text.id == text_id {\n                                            if cursor_pos \u003c text.content.len() {\n                                                text.content.remove(cursor_pos);\n                                            }\n                                        }\n                                    }\n                                }\n                            }\n                        });\n                        drawing_area_keyboard.queue_draw();\n                        tracing::info!(\" Deleted character at cursor position {}\", cursor_pos);\n                        return gtk4::glib::Propagation::Stop;\n                    }\n                    gtk4::gdk::Key::Left =\u003e {\n                        // Move cursor left\n                        if cursor_pos \u003e 0 {\n                            cursor_pos -= 1;\n                            let mut tool_state = render_state_kbd.tool_state.borrow_mut();\n                            tool_state.editing_cursor_pos = cursor_pos;\n                            drop(tool_state);\n                            drawing_area_keyboard.queue_draw();\n                            tracing::debug!(\"Cursor moved to position {}\", cursor_pos);\n                        }\n                        return gtk4::glib::Propagation::Stop;\n                    }\n                    gtk4::gdk::Key::Right =\u003e {\n                        // Move cursor right\n                        if let Some(document) = app_state_kbd.active_document() {\n                            if let Some(page) = document.pages.first() {\n                                for element in \u0026page.elements {\n                                    if let DocumentElement::Text(text) = element {\n                                        if text.id == text_id \u0026\u0026 cursor_pos \u003c text.content.len() {\n                                            cursor_pos += 1;\n                                        }\n                                    }\n                                }\n                            }\n                        }\n                        let mut tool_state = render_state_kbd.tool_state.borrow_mut();\n                        tool_state.editing_cursor_pos = cursor_pos;\n                        drop(tool_state);\n                        drawing_area_keyboard.queue_draw();\n                        tracing::debug!(\"Cursor moved to position {}\", cursor_pos);\n                        return gtk4::glib::Propagation::Stop;\n                    }\n                    gtk4::gdk::Key::Home =\u003e {\n                        // Move cursor to start\n                        cursor_pos = 0;\n                        let mut tool_state = render_state_kbd.tool_state.borrow_mut();\n                        tool_state.editing_cursor_pos = cursor_pos;\n                        drop(tool_state);\n                        drawing_area_keyboard.queue_draw();\n                        tracing::debug!(\"Cursor moved to start\");\n                        return gtk4::glib::Propagation::Stop;\n                    }\n                    gtk4::gdk::Key::End =\u003e {\n                        // Move cursor to end\n                        if let Some(document) = app_state_kbd.active_document() {\n                            if let Some(page) = document.pages.first() {\n                                for element in \u0026page.elements {\n                                    if let DocumentElement::Text(text) = element {\n                                        if text.id == text_id {\n                                            cursor_pos = text.content.len();\n                                        }\n                                    }\n                                }\n                            }\n                        }\n                        let mut tool_state = render_state_kbd.tool_state.borrow_mut();\n                        tool_state.editing_cursor_pos = cursor_pos;\n                        drop(tool_state);\n                        drawing_area_keyboard.queue_draw();\n                        tracing::debug!(\"Cursor moved to end\");\n                        return gtk4::glib::Propagation::Stop;\n                    }\n                    _ =\u003e {\n                        // Try to handle as text input\n                        if let Some(ch) = keyval.to_unicode() {\n                            if ch.is_ascii() \u0026\u0026 !ch.is_control() {\n                                app_state_kbd.with_active_document(|doc| {\n                                    if let Some(page) = doc.pages.first_mut() {\n                                        for element in \u0026mut page.elements {\n                                            if let DocumentElement::Text(text) = element {\n                                                if text.id == text_id {\n                                                    text.content.insert(cursor_pos, ch);\n                                                    cursor_pos += 1;\n                                                }\n                                            }\n                                        }\n                                    }\n                                });\n                                let mut tool_state = render_state_kbd.tool_state.borrow_mut();\n                                tool_state.editing_cursor_pos = cursor_pos;\n                                drop(tool_state);\n                                drawing_area_keyboard.queue_draw();\n                                tracing::debug!(\" Inserted character '{}' at position {}\", ch, cursor_pos - 1);\n                                return gtk4::glib::Propagation::Stop;\n                            }\n                        }\n                    }\n                }\n            }\n        }\n\n        // Handle object movement when NOT in text editing\n        let movement_amount = if shift_pressed { 10.0 } else { 1.0 };\n\n        // Handle arrow keys for object movement\n        let handled = match keyval {\n            gtk4::gdk::Key::Left =\u003e {\n                if !in_text_editing {\n                    move_selected_objects(\u0026render_state_keyboard, \u0026app_state_keyboard, -movement_amount, 0.0);\n                    drawing_area_keyboard.queue_draw();\n                    tracing::info!(\" Move left ({}px)\", movement_amount as i32);\n                    true\n                } else {\n                    false\n                }\n            }\n            gtk4::gdk::Key::Right =\u003e {\n                if !in_text_editing {\n                    move_selected_objects(\u0026render_state_keyboard, \u0026app_state_keyboard, movement_amount, 0.0);\n                    drawing_area_keyboard.queue_draw();\n                    tracing::info!(\" Move right ({}px)\", movement_amount as i32);\n                    true\n                } else {\n                    false\n                }\n            }\n            gtk4::gdk::Key::Up =\u003e {\n                if !in_text_editing {\n                    move_selected_objects(\u0026render_state_keyboard, \u0026app_state_keyboard, 0.0, -movement_amount);\n                    drawing_area_keyboard.queue_draw();\n                    tracing::info!(\" Move up ({}px)\", movement_amount as i32);\n                    true\n                } else {\n                    false\n                }\n            }\n            gtk4::gdk::Key::Down =\u003e {\n                if !in_text_editing {\n                    move_selected_objects(\u0026render_state_keyboard, \u0026app_state_keyboard, 0.0, movement_amount);\n                    drawing_area_keyboard.queue_draw();\n                    tracing::info!(\" Move down ({}px)\", movement_amount as i32);\n                    true\n                } else {\n                    false\n                }\n            }\n            _ =\u003e false,\n        };\n\n        if handled {\n            gtk4::glib::Propagation::Stop\n        } else {\n            gtk4::glib::Propagation::Proceed\n        }\n    });\n    drawing_area.add_controller(key_controller);\n\n    // Motion controller for mouse movement\n    let motion = EventControllerMotion::new();\n    let render_state_motion = render_state.clone();\n    let drawing_area_cursor = drawing_area.clone();\n    let app_state_motion = _app_state.clone();\n    motion.connect_motion(move |_controller, x, y| {\n        let state = render_state_motion.clone();\n        tracing::debug!(\"pointer moved: x={}, y={}\", x, y);\n\n        // Get canvas position\n        let config = state.config.borrow();\n        let ruler_config = state.ruler_config.borrow();\n        let screen_x = x - (ruler_config.size + config.pan_x);\n        let screen_y = y - (ruler_config.size + config.pan_y);\n        let doc_x = screen_x / config.zoom;\n        let doc_y = screen_y / config.zoom;\n        drop(config);\n        drop(ruler_config);\n\n        let canvas_mouse_pos = CanvasMousePos {\n            x: doc_x,\n            y: doc_y,\n        };\n\n        // Check if cursor is over a resize handle of selected objects\n        let selected = state.selected_ids.borrow();\n        let mut cursor_name = \"default\";\n\n        if let Some(document) = app_state_motion.active_document() {\n            if let Some(page) = document.pages.first() {\n                for selected_id in selected.iter() {\n                    // Find the selected element\n                    for element in \u0026page.elements {\n                        let (elem_id, bounds) = match element {\n                            testruct_core::document::DocumentElement::Shape(shape) =\u003e (shape.id, \u0026shape.bounds),\n                            testruct_core::document::DocumentElement::Text(text) =\u003e (text.id, \u0026text.bounds),\n                            testruct_core::document::DocumentElement::Image(image) =\u003e (image.id, \u0026image.bounds),\n                            testruct_core::document::DocumentElement::Frame(frame) =\u003e (frame.id, \u0026frame.bounds),\n                        };\n\n                        if elem_id == *selected_id {\n                            // Test for resize handle hit\n                            if let Some(handle) = test_resize_handle(canvas_mouse_pos, bounds, 8.0) {\n                                cursor_name = match handle {\n                                    ResizeHandle::TopLeft | ResizeHandle::BottomRight =\u003e \"nwse-resize\",\n                                    ResizeHandle::TopRight | ResizeHandle::BottomLeft =\u003e \"nesw-resize\",\n                                    ResizeHandle::Top | ResizeHandle::Bottom =\u003e \"ns-resize\",\n                                    ResizeHandle::Left | ResizeHandle::Right =\u003e \"ew-resize\",\n                                };\n                                break;\n                            }\n                        }\n                    }\n                    if cursor_name != \"default\" {\n                        break;\n                    }\n                }\n            }\n        }\n\n        // Set cursor\n        let cursor = gdk::Cursor::from_name(cursor_name, None);\n        drawing_area_cursor.set_cursor(cursor.as_ref());\n    });\n    drawing_area.add_controller(motion);\n\n    // Click gesture for object selection\n    let click_gesture = GestureClick::new();\n    click_gesture.set_button(gdk::BUTTON_PRIMARY);\n    let render_state_click = render_state.clone();\n    let app_state_click = _app_state.clone();\n    let drawing_area_click = drawing_area.clone();\n\n    click_gesture.connect_pressed(move |gesture, n_press, x, y| {\n        let state = render_state_click.clone();\n        let tool_state = state.tool_state.borrow();\n        let current_tool = tool_state.current_tool;\n        drop(tool_state);\n\n        tracing::debug!(\"canvas click at ({}, {}), tool: {:?}, n_press: {}\", x, y, current_tool, n_press);\n\n        if current_tool == ToolMode::Select {\n            // Get modifier key state\n            let modifier_state = match gesture.last_event(None) {\n                Some(event) =\u003e event.modifier_state(),\n                None =\u003e gdk::ModifierType::empty(),\n            };\n            let shift_pressed = modifier_state.contains(gdk::ModifierType::SHIFT_MASK);\n            let ctrl_pressed = modifier_state.contains(gdk::ModifierType::CONTROL_MASK);\n\n            // Check for double-click (n_press == 2) for text editing\n            if n_press == 2 {\n                // Try to find a text element at this position\n                if let Some(document) = app_state_click.active_document() {\n                    if let Some(page) = document.pages.first() {\n                        let config = state.config.borrow();\n                        let ruler_config = state.ruler_config.borrow();\n                        let screen_x = x - (ruler_config.size + config.pan_x);\n                        let screen_y = y - (ruler_config.size + config.pan_y);\n                        let doc_x = screen_x / config.zoom;\n                        let doc_y = screen_y / config.zoom;\n                        drop(config);\n                        drop(ruler_config);\n\n                        // Check if double-click is on a text element\n                        for element in \u0026page.elements {\n                            if let DocumentElement::Text(text) = element {\n                                let bounds = \u0026text.bounds;\n                                // Check if click is within bounds\n                                if doc_x \u003e= bounds.origin.x as f64 \u0026\u0026 doc_x \u003c= (bounds.origin.x + bounds.size.width) as f64\n                                    \u0026\u0026 doc_y \u003e= bounds.origin.y as f64 \u0026\u0026 doc_y \u003c= (bounds.origin.y + bounds.size.height) as f64 {\n                                    // Enter text editing mode\n                                    let mut tool_state = state.tool_state.borrow_mut();\n                                    tool_state.editing_text_id = Some(text.id);\n                                    tool_state.editing_cursor_pos = text.content.len();\n                                    drop(tool_state);\n                                    drawing_area_click.queue_draw();\n                                    tracing::info!(\" Entered text editing mode for text element: {}\", text.id);\n                                    return;\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n\n            // Get the active document\n            if let Some(document) = app_state_click.active_document() {\n                // Transform screen coordinates to document coordinates\n                let config = state.config.borrow();\n                let ruler_config = state.ruler_config.borrow();\n                let screen_x = x - (ruler_config.size + config.pan_x);\n                let screen_y = y - (ruler_config.size + config.pan_y);\n                let doc_x = screen_x / config.zoom;\n                let doc_y = screen_y / config.zoom;\n                let canvas_mouse_pos = CanvasMousePos::new(doc_x, doc_y);\n                drop(config);\n                drop(ruler_config);\n\n                // Check if clicking on a resize handle of a selected object\n                let selected_ids = state.selected_ids.borrow();\n                let mut resize_detected = false;\n\n                if let Some(page) = document.pages.first() {\n                    for element in \u0026page.elements {\n                        let element_id = match element {\n                            DocumentElement::Shape(shape) =\u003e shape.id,\n                            DocumentElement::Text(text) =\u003e text.id,\n                            DocumentElement::Image(image) =\u003e image.id,\n                            DocumentElement::Frame(frame) =\u003e frame.id,\n                        };\n\n                        // Only check resize handles for selected objects\n                        if !selected_ids.contains(\u0026element_id) {\n                            continue;\n                        }\n\n                        let bounds = match element {\n                            DocumentElement::Shape(shape) =\u003e \u0026shape.bounds,\n                            DocumentElement::Text(text) =\u003e \u0026text.bounds,\n                            DocumentElement::Image(image) =\u003e \u0026image.bounds,\n                            DocumentElement::Frame(frame) =\u003e \u0026frame.bounds,\n                        };\n\n                        // Test for resize handle hit\n                        if let Some(handle) = test_resize_handle(canvas_mouse_pos, bounds, 8.0) {\n                            // Store resize state\n                            let mut tool_state = state.tool_state.borrow_mut();\n                            tool_state.resizing_object_id = Some(element_id);\n                            tool_state.resize_handle = Some(handle);\n                            tool_state.resize_original_bounds = Some(canvas_mouse_pos);\n                            tool_state.drag_start = Some((x, y));\n                            drop(tool_state);\n\n                            tracing::info!(\" Started resizing object {} with handle {:?}\", element_id, handle);\n                            resize_detected = true;\n                            break;\n                        }\n                    }\n                }\n\n                drop(selected_ids);\n\n                // If resize was detected, don't do selection handling\n                if resize_detected {\n                    drawing_area_click.queue_draw();\n                    return;\n                }\n                if let Some(page) = document.pages.first() {\n                    // Build list of objects with their bounds for hit testing\n                    let mut objects: Vec\u003c(uuid::Uuid, Rect)\u003e = Vec::new();\n\n                    for element in \u0026page.elements {\n                        match element {\n                            DocumentElement::Shape(shape) =\u003e {\n                                objects.push((shape.id, shape.bounds.clone()));\n                            }\n                            DocumentElement::Text(text) =\u003e {\n                                objects.push((text.id, text.bounds.clone()));\n                            }\n                            DocumentElement::Image(image) =\u003e {\n                                objects.push((image.id, image.bounds.clone()));\n                            }\n                            DocumentElement::Frame(frame) =\u003e {\n                                objects.push((frame.id, frame.bounds.clone()));\n                            }\n                        }\n                    }\n\n                    // Convert to references for hit testing\n                    let object_refs: Vec\u003c(uuid::Uuid, \u0026Rect)\u003e = objects.iter().map(|(id, bounds)| (*id, bounds)).collect();\n\n                    // Transform screen coordinates to document coordinates\n                    let config = state.config.borrow();\n                    let ruler_config = state.ruler_config.borrow();\n\n                    let screen_x = x - (ruler_config.size + config.pan_x);\n                    let screen_y = y - (ruler_config.size + config.pan_y);\n                    let doc_x = screen_x / config.zoom;\n                    let doc_y = screen_y / config.zoom;\n\n                    drop(config);\n                    drop(ruler_config);\n\n                    // Perform hit test\n                    if let Some(clicked_id) = HitTest::hit_test(\u0026object_refs, doc_x, doc_y) {\n                        tracing::info!(\" Hit test: selected object {}\", clicked_id);\n\n                        // Update selection based on modifier keys\n                        let mut selected = state.selected_ids.borrow_mut();\n\n                        if shift_pressed {\n                            // Shift+click: add to selection\n                            if !selected.contains(\u0026clicked_id) {\n                                selected.push(clicked_id);\n                                tracing::debug!(\"Added object to selection (Shift+click)\");\n                            }\n                        } else if ctrl_pressed {\n                            // Ctrl+click: toggle selection\n                            if let Some(pos) = selected.iter().position(|\u0026id| id == clicked_id) {\n                                selected.remove(pos);\n                                tracing::debug!(\"Removed object from selection (Ctrl+click)\");\n                            } else {\n                                selected.push(clicked_id);\n                                tracing::debug!(\"Toggled object selection (Ctrl+click)\");\n                            }\n                        } else {\n                            // Plain click: single select\n                            selected.clear();\n                            selected.push(clicked_id);\n                            tracing::info!(\"Selected object: {}\", clicked_id);\n                        }\n                        drop(selected);\n                        drawing_area_click.queue_draw();\n                    } else {\n                        // Clicked on empty space: clear selection\n                        let mut selected = state.selected_ids.borrow_mut();\n                        selected.clear();\n                        drop(selected);\n                        drawing_area_click.queue_draw();\n                        tracing::debug!(\"Cleared selection (empty space click)\");\n                    }\n                }\n            }\n        }\n    });\n    drawing_area.add_controller(click_gesture);\n\n    // Drag gesture for shape creation and object movement\n    let drag_gesture = GestureDrag::new();\n    drag_gesture.set_button(gdk::BUTTON_PRIMARY);\n    let render_state_drag = render_state.clone();\n    let drawing_area_drag = drawing_area.clone();\n\n    drag_gesture.connect_drag_begin(move |_gesture, x, y| {\n        let state = render_state_drag.clone();\n        let tool_state = state.tool_state.borrow();\n        let current_tool = tool_state.current_tool;\n        drop(tool_state);\n\n        tracing::debug!(\"drag start at ({}, {}), tool: {:?}\", x, y, current_tool);\n\n        // Store drag start position\n        let mut tool_state = state.tool_state.borrow_mut();\n        tool_state.drag_start = Some((x, y));\n    });\n\n    let render_state_update = render_state.clone();\n    drag_gesture.connect_drag_update(move |_gesture, offset_x, offset_y| {\n        let state = render_state_update.clone();\n        let tool_state = state.tool_state.borrow();\n        if let Some((start_x, start_y)) = tool_state.drag_start {\n            let current_x = start_x + offset_x;\n            let current_y = start_y + offset_y;\n\n            tracing::debug!(\n                \"drag update: from ({}, {}) to ({}, {})\",\n                start_x, start_y, current_x, current_y\n            );\n\n            // Update drag box for preview rendering\n            let (x1, y1, x2, y2) = (start_x, start_y, current_x, current_y);\n            let min_x = x1.min(x2);\n            let min_y = y1.min(y2);\n            let max_x = x1.max(x2);\n            let max_y = y1.max(y2);\n\n            let drag_rect = Rect {\n                origin: Point {\n                    x: min_x as f32,\n                    y: min_y as f32,\n                },\n                size: Size {\n                    width: (max_x - min_x) as f32,\n                    height: (max_y - min_y) as f32,\n                },\n            };\n\n            *state.drag_box.borrow_mut() = Some(drag_rect);\n        }\n\n        drawing_area_drag.queue_draw();\n    });\n\n    let render_state_end = render_state.clone();\n    let drawing_area_end = drawing_area.clone();\n    let app_state_drag_end = _app_state.clone();\n\n    drag_gesture.connect_drag_end(move |_gesture, offset_x, offset_y| {\n        let state = render_state_end.clone();\n        let tool_state = state.tool_state.borrow();\n\n        if let Some((start_x, start_y)) = tool_state.drag_start {\n            let current_x = start_x + offset_x;\n            let current_y = start_y + offset_y;\n            let current_tool = tool_state.current_tool;\n            let is_resizing = tool_state.resizing_object_id.is_some();\n            let resizing_object_id = tool_state.resizing_object_id;\n            let resize_handle = tool_state.resize_handle;\n            let resize_original_bounds = tool_state.resize_original_bounds;\n\n            tracing::debug!(\n                \"drag end: shape creation/move from ({}, {}) to ({}, {})\",\n                start_x, start_y, current_x, current_y\n            );\n\n            if is_resizing \u0026\u0026 (offset_x.abs() \u003e 2.0 || offset_y.abs() \u003e 2.0) {\n                // Apply resize\n                if let (Some(object_id), Some(handle), Some(_mouse_pos)) = (resizing_object_id, resize_handle, resize_original_bounds) {\n                    // Calculate document-space delta\n                    let config = state.config.borrow();\n                    let delta_x = offset_x / config.zoom;\n                    let delta_y = offset_y / config.zoom;\n                    let snap_enabled = config.snap_to_grid;\n                    let grid_spacing = config.grid_spacing;\n                    drop(config);\n\n                    // Get the original bounds from the document\n                    if let Some(mut document) = app_state_drag_end.active_document() {\n                        if let Some(page) = document.pages.first_mut() {\n                            for element in page.elements.iter_mut() {\n                                match element {\n                                    DocumentElement::Shape(shape) if shape.id == object_id =\u003e {\n                                        let mut new_bounds = calculate_resize_bounds(\u0026shape.bounds, handle, delta_x, delta_y);\n                                        if snap_enabled {\n                                            new_bounds = snap_rect_to_grid(\u0026new_bounds, grid_spacing);\n                                        }\n                                        shape.bounds = new_bounds;\n                                        tracing::info!(\" Resized shape {} with handle {:?}\", object_id, handle);\n                                    }\n                                    DocumentElement::Image(image) if image.id == object_id =\u003e {\n                                        let mut new_bounds = calculate_resize_bounds(\u0026image.bounds, handle, delta_x, delta_y);\n                                        if snap_enabled {\n                                            new_bounds = snap_rect_to_grid(\u0026new_bounds, grid_spacing);\n                                        }\n                                        image.bounds = new_bounds;\n                                        tracing::info!(\" Resized image {} with handle {:?}\", object_id, handle);\n                                    }\n                                    DocumentElement::Frame(frame) if frame.id == object_id =\u003e {\n                                        let mut new_bounds = calculate_resize_bounds(\u0026frame.bounds, handle, delta_x, delta_y);\n                                        if snap_enabled {\n                                            new_bounds = snap_rect_to_grid(\u0026new_bounds, grid_spacing);\n                                        }\n                                        frame.bounds = new_bounds;\n                                        tracing::info!(\" Resized frame {} with handle {:?}\", object_id, handle);\n                                    }\n                                    _ =\u003e {}\n                                }\n                            }\n                            // Update the document in app state\n                            app_state_drag_end.with_active_document(|doc| {\n                                *doc = document;\n                            });\n                        }\n                    }\n                }\n            } else if current_tool == ToolMode::Select \u0026\u0026 (offset_x.abs() \u003e 5.0 || offset_y.abs() \u003e 5.0) {\n                // Move selected objects\n                let selected = state.selected_ids.borrow();\n                if !selected.is_empty() {\n                    // Transform screen offset to document offset\n                    let config = state.config.borrow();\n                    let delta_x = offset_x / config.zoom;\n                    let delta_y = offset_y / config.zoom;\n                    let snap_enabled = config.snap_to_grid;\n                    let grid_spacing = config.grid_spacing;\n                    drop(config);\n\n                    let selected_ids: Vec\u003cuuid::Uuid\u003e = selected.clone();\n                    drop(selected);\n\n                    // Move each selected object\n                    if let Some(mut document) = app_state_drag_end.active_document() {\n                        if let Some(page) = document.pages.first_mut() {\n                            for element in page.elements.iter_mut() {\n                                match element {\n                                    DocumentElement::Shape(shape) if selected_ids.contains(\u0026shape.id) =\u003e {\n                                        let mut new_bounds = shape.bounds.clone();\n                                        new_bounds.origin.x += delta_x as f32;\n                                        new_bounds.origin.y += delta_y as f32;\n                                        if snap_enabled {\n                                            new_bounds = snap_rect_to_grid(\u0026new_bounds, grid_spacing);\n                                        }\n                                        shape.bounds = new_bounds;\n                                    }\n                                    DocumentElement::Text(text) if selected_ids.contains(\u0026text.id) =\u003e {\n                                        let mut new_bounds = text.bounds.clone();\n                                        new_bounds.origin.x += delta_x as f32;\n                                        new_bounds.origin.y += delta_y as f32;\n                                        if snap_enabled {\n                                            new_bounds = snap_rect_to_grid(\u0026new_bounds, grid_spacing);\n                                        }\n                                        text.bounds = new_bounds;\n                                    }\n                                    DocumentElement::Image(image) if selected_ids.contains(\u0026image.id) =\u003e {\n                                        let mut new_bounds = image.bounds.clone();\n                                        new_bounds.origin.x += delta_x as f32;\n                                        new_bounds.origin.y += delta_y as f32;\n                                        if snap_enabled {\n                                            new_bounds = snap_rect_to_grid(\u0026new_bounds, grid_spacing);\n                                        }\n                                        image.bounds = new_bounds;\n                                    }\n                                    DocumentElement::Frame(frame) if selected_ids.contains(\u0026frame.id) =\u003e {\n                                        let mut new_bounds = frame.bounds.clone();\n                                        new_bounds.origin.x += delta_x as f32;\n                                        new_bounds.origin.y += delta_y as f32;\n                                        if snap_enabled {\n                                            new_bounds = snap_rect_to_grid(\u0026new_bounds, grid_spacing);\n                                        }\n                                        frame.bounds = new_bounds;\n                                    }\n                                    _ =\u003e {}\n                                }\n                            }\n                            // Update the document in app state\n                            app_state_drag_end.with_active_document(|doc| {\n                                *doc = document;\n                            });\n                            tracing::info!(\" Moved {} selected object(s)\", selected_ids.len());\n                        }\n                    }\n                }\n            } else if current_tool != ToolMode::Select \u0026\u0026 (offset_x.abs() \u003e 5.0 || offset_y.abs() \u003e 5.0) {\n                // Shape creation based on tool\n                let element = match current_tool {\n                    ToolMode::Rectangle =\u003e ShapeFactory::create_rectangle(\n                        start_x.min(current_x),\n                        start_y.min(current_y),\n                        (start_x - current_x).abs(),\n                        (start_y - current_y).abs(),\n                    ),\n                    ToolMode::Circle =\u003e ShapeFactory::create_circle(\n                        start_x.min(current_x),\n                        start_y.min(current_y),\n                        (start_x - current_x).abs(),\n                        (start_y - current_y).abs(),\n                    ),\n                    ToolMode::Line =\u003e ShapeFactory::create_line(\n                        start_x,\n                        start_y,\n                        current_x,\n                        current_y,\n                    ),\n                    ToolMode::Arrow =\u003e ShapeFactory::create_arrow(\n                        start_x,\n                        start_y,\n                        current_x,\n                        current_y,\n                    ),\n                    ToolMode::Image =\u003e ShapeFactory::create_image(\n                        start_x.min(current_x),\n                        start_y.min(current_y),\n                        (start_x - current_x).abs(),\n                        (start_y - current_y).abs(),\n                    ),\n                    ToolMode::Text =\u003e ShapeFactory::create_text(\n                        start_x,\n                        start_y,\n                        (start_x - current_x).abs(),\n                        (start_y - current_y).abs(),\n                        \"New Text\".to_string(),\n                    ),\n                    _ =\u003e return,\n                };\n\n                // Add element to document\n                if let Err(e) = app_state_drag_end.add_element_to_active_page(element) {\n                    tracing::warn!(\"Failed to add element: {}\", e);\n                } else {\n                    tracing::info!(\" {} element added to document\", current_tool.name());\n                }\n            }\n        }\n\n        // Clear drag state\n        drop(tool_state);\n        let mut tool_state = state.tool_state.borrow_mut();\n        tool_state.drag_start = None;\n        tool_state.resizing_object_id = None;\n        tool_state.resize_handle = None;\n        tool_state.resize_original_bounds = None;\n        *state.drag_box.borrow_mut() = None;\n\n        drawing_area_end.queue_draw();\n    });\n\n    drawing_area.add_controller(drag_gesture);\n}\n\n/// Apply guide snapping to bounds\nfn apply_guide_snapping(bounds: \u0026Rect, config: \u0026crate::canvas::rendering::RenderConfig) -\u003e Rect {\n    let mut snapped_bounds = bounds.clone();\n\n    if config.snap_to_guides \u0026\u0026 !config.guides.is_empty() {\n        // Try snapping origin X\n        if let Some(snapped_x) = snap_to_guide(\n            bounds.origin.x,\n            \u0026config.guides,\n            GuideOrientation::Vertical,\n            config.guide_snap_distance,\n        ) {\n            snapped_bounds.origin.x = snapped_x;\n        }\n\n        // Try snapping origin Y\n        if let Some(snapped_y) = snap_to_guide(\n            bounds.origin.y,\n            \u0026config.guides,\n            GuideOrientation::Horizontal,\n            config.guide_snap_distance,\n        ) {\n            snapped_bounds.origin.y = snapped_y;\n        }\n    }\n\n    snapped_bounds\n}\n\n/// Helper function to move selected objects\nfn move_selected_objects(\n    render_state: \u0026CanvasRenderState,\n    app_state: \u0026AppState,\n    delta_x: f64,\n    delta_y: f64,\n) {\n    // Get selected object IDs\n    let selected_ids = render_state.selected_ids.borrow();\n    if selected_ids.is_empty() {\n        return;\n    }\n    let selected_ids_copy = selected_ids.clone();\n    drop(selected_ids);\n\n    // Get snap configuration\n    let config = render_state.config.borrow();\n    let snap_enabled = config.snap_to_grid;\n    let grid_spacing = config.grid_spacing;\n    let config_clone = config.clone();\n    drop(config);\n\n    // Get the active document\n    if let Some(mut document) = app_state.active_document() {\n        if let Some(page) = document.pages.first_mut() {\n            // Move each selected object\n            for element in page.elements.iter_mut() {\n                match element {\n                    DocumentElement::Shape(shape) if selected_ids_copy.contains(\u0026shape.id) =\u003e {\n                        let mut new_bounds = shape.bounds.clone();\n                        new_bounds.origin.x += delta_x as f32;\n                        new_bounds.origin.y += delta_y as f32;\n\n                        // Apply grid snapping if enabled\n                        if snap_enabled {\n                            new_bounds = snap_rect_to_grid(\u0026new_bounds, grid_spacing);\n                        }\n\n                        // Apply guide snapping\n                        new_bounds = apply_guide_snapping(\u0026new_bounds, \u0026config_clone);\n\n                        shape.bounds = new_bounds;\n                    }\n                    DocumentElement::Text(text) if selected_ids_copy.contains(\u0026text.id) =\u003e {\n                        let mut new_bounds = text.bounds.clone();\n                        new_bounds.origin.x += delta_x as f32;\n                        new_bounds.origin.y += delta_y as f32;\n\n                        // Apply grid snapping if enabled\n                        if snap_enabled {\n                            new_bounds = snap_rect_to_grid(\u0026new_bounds, grid_spacing);\n                        }\n\n                        // Apply guide snapping\n                        new_bounds = apply_guide_snapping(\u0026new_bounds, \u0026config_clone);\n\n                        text.bounds = new_bounds;\n                    }\n                    DocumentElement::Image(image) if selected_ids_copy.contains(\u0026image.id) =\u003e {\n                        let mut new_bounds = image.bounds.clone();\n                        new_bounds.origin.x += delta_x as f32;\n                        new_bounds.origin.y += delta_y as f32;\n\n                        // Apply grid snapping if enabled\n                        if snap_enabled {\n                            new_bounds = snap_rect_to_grid(\u0026new_bounds, grid_spacing);\n                        }\n\n                        // Apply guide snapping\n                        new_bounds = apply_guide_snapping(\u0026new_bounds, \u0026config_clone);\n\n                        image.bounds = new_bounds;\n                    }\n                    DocumentElement::Frame(frame) if selected_ids_copy.contains(\u0026frame.id) =\u003e {\n                        let mut new_bounds = frame.bounds.clone();\n                        new_bounds.origin.x += delta_x as f32;\n                        new_bounds.origin.y += delta_y as f32;\n\n                        // Apply grid snapping if enabled\n                        if snap_enabled {\n                            new_bounds = snap_rect_to_grid(\u0026new_bounds, grid_spacing);\n                        }\n\n                        // Apply guide snapping\n                        new_bounds = apply_guide_snapping(\u0026new_bounds, \u0026config_clone);\n\n                        frame.bounds = new_bounds;\n                    }\n                    _ =\u003e {}\n                }\n            }\n\n            // Update the document in app state\n            app_state.with_active_document(|doc| {\n                *doc = document;\n            });\n\n            tracing::debug!(\"Moved {} selected object(s) by ({}, {})\", selected_ids_copy.len(), delta_x, delta_y);\n        }\n    }\n}\n","traces":[{"line":9,"address":[],"length":0,"stats":{"Line":0}},{"line":14,"address":[],"length":0,"stats":{"Line":0}},{"line":17,"address":[],"length":0,"stats":{"Line":0}},{"line":18,"address":[],"length":0,"stats":{"Line":0}},{"line":19,"address":[],"length":0,"stats":{"Line":0}},{"line":20,"address":[],"length":0,"stats":{"Line":0}},{"line":22,"address":[],"length":0,"stats":{"Line":0}},{"line":23,"address":[],"length":0,"stats":{"Line":0}},{"line":24,"address":[],"length":0,"stats":{"Line":0}},{"line":25,"address":[],"length":0,"stats":{"Line":0}},{"line":26,"address":[],"length":0,"stats":{"Line":0}},{"line":27,"address":[],"length":0,"stats":{"Line":0}},{"line":28,"address":[],"length":0,"stats":{"Line":0}},{"line":31,"address":[],"length":0,"stats":{"Line":0}},{"line":32,"address":[],"length":0,"stats":{"Line":0}},{"line":35,"address":[],"length":0,"stats":{"Line":0}},{"line":36,"address":[],"length":0,"stats":{"Line":0}},{"line":37,"address":[],"length":0,"stats":{"Line":0}},{"line":38,"address":[],"length":0,"stats":{"Line":0}},{"line":39,"address":[],"length":0,"stats":{"Line":0}},{"line":40,"address":[],"length":0,"stats":{"Line":0}},{"line":41,"address":[],"length":0,"stats":{"Line":0}},{"line":42,"address":[],"length":0,"stats":{"Line":0}},{"line":43,"address":[],"length":0,"stats":{"Line":0}},{"line":46,"address":[],"length":0,"stats":{"Line":0}},{"line":49,"address":[],"length":0,"stats":{"Line":0}},{"line":50,"address":[],"length":0,"stats":{"Line":0}},{"line":51,"address":[],"length":0,"stats":{"Line":0}},{"line":55,"address":[],"length":0,"stats":{"Line":0}},{"line":56,"address":[],"length":0,"stats":{"Line":0}},{"line":57,"address":[],"length":0,"stats":{"Line":0}},{"line":58,"address":[],"length":0,"stats":{"Line":0}},{"line":60,"address":[],"length":0,"stats":{"Line":0}},{"line":62,"address":[],"length":0,"stats":{"Line":0}},{"line":63,"address":[],"length":0,"stats":{"Line":0}},{"line":67,"address":[],"length":0,"stats":{"Line":0}},{"line":71,"address":[],"length":0,"stats":{"Line":0}},{"line":72,"address":[],"length":0,"stats":{"Line":0}},{"line":73,"address":[],"length":0,"stats":{"Line":0}},{"line":74,"address":[],"length":0,"stats":{"Line":0}},{"line":75,"address":[],"length":0,"stats":{"Line":0}},{"line":76,"address":[],"length":0,"stats":{"Line":0}},{"line":77,"address":[],"length":0,"stats":{"Line":0}},{"line":78,"address":[],"length":0,"stats":{"Line":0}},{"line":79,"address":[],"length":0,"stats":{"Line":0}},{"line":82,"address":[],"length":0,"stats":{"Line":0}},{"line":83,"address":[],"length":0,"stats":{"Line":0}},{"line":84,"address":[],"length":0,"stats":{"Line":0}},{"line":85,"address":[],"length":0,"stats":{"Line":0}},{"line":86,"address":[],"length":0,"stats":{"Line":0}},{"line":87,"address":[],"length":0,"stats":{"Line":0}},{"line":88,"address":[],"length":0,"stats":{"Line":0}},{"line":94,"address":[],"length":0,"stats":{"Line":0}},{"line":95,"address":[],"length":0,"stats":{"Line":0}},{"line":96,"address":[],"length":0,"stats":{"Line":0}},{"line":97,"address":[],"length":0,"stats":{"Line":0}},{"line":98,"address":[],"length":0,"stats":{"Line":0}},{"line":99,"address":[],"length":0,"stats":{"Line":0}},{"line":101,"address":[],"length":0,"stats":{"Line":0}},{"line":102,"address":[],"length":0,"stats":{"Line":0}},{"line":108,"address":[],"length":0,"stats":{"Line":0}},{"line":109,"address":[],"length":0,"stats":{"Line":0}},{"line":110,"address":[],"length":0,"stats":{"Line":0}},{"line":112,"address":[],"length":0,"stats":{"Line":0}},{"line":115,"address":[],"length":0,"stats":{"Line":0}},{"line":116,"address":[],"length":0,"stats":{"Line":0}},{"line":117,"address":[],"length":0,"stats":{"Line":0}},{"line":118,"address":[],"length":0,"stats":{"Line":0}},{"line":119,"address":[],"length":0,"stats":{"Line":0}},{"line":120,"address":[],"length":0,"stats":{"Line":0}},{"line":121,"address":[],"length":0,"stats":{"Line":0}},{"line":125,"address":[],"length":0,"stats":{"Line":0}},{"line":126,"address":[],"length":0,"stats":{"Line":0}},{"line":127,"address":[],"length":0,"stats":{"Line":0}},{"line":128,"address":[],"length":0,"stats":{"Line":0}},{"line":129,"address":[],"length":0,"stats":{"Line":0}},{"line":130,"address":[],"length":0,"stats":{"Line":0}},{"line":131,"address":[],"length":0,"stats":{"Line":0}},{"line":132,"address":[],"length":0,"stats":{"Line":0}},{"line":133,"address":[],"length":0,"stats":{"Line":0}},{"line":140,"address":[],"length":0,"stats":{"Line":0}},{"line":141,"address":[],"length":0,"stats":{"Line":0}},{"line":142,"address":[],"length":0,"stats":{"Line":0}},{"line":143,"address":[],"length":0,"stats":{"Line":0}},{"line":144,"address":[],"length":0,"stats":{"Line":0}},{"line":146,"address":[],"length":0,"stats":{"Line":0}},{"line":150,"address":[],"length":0,"stats":{"Line":0}},{"line":151,"address":[],"length":0,"stats":{"Line":0}},{"line":152,"address":[],"length":0,"stats":{"Line":0}},{"line":153,"address":[],"length":0,"stats":{"Line":0}},{"line":154,"address":[],"length":0,"stats":{"Line":0}},{"line":155,"address":[],"length":0,"stats":{"Line":0}},{"line":156,"address":[],"length":0,"stats":{"Line":0}},{"line":163,"address":[],"length":0,"stats":{"Line":0}},{"line":164,"address":[],"length":0,"stats":{"Line":0}},{"line":165,"address":[],"length":0,"stats":{"Line":0}},{"line":169,"address":[],"length":0,"stats":{"Line":0}},{"line":170,"address":[],"length":0,"stats":{"Line":0}},{"line":171,"address":[],"length":0,"stats":{"Line":0}},{"line":172,"address":[],"length":0,"stats":{"Line":0}},{"line":173,"address":[],"length":0,"stats":{"Line":0}},{"line":174,"address":[],"length":0,"stats":{"Line":0}},{"line":175,"address":[],"length":0,"stats":{"Line":0}},{"line":177,"address":[],"length":0,"stats":{"Line":0}},{"line":181,"address":[],"length":0,"stats":{"Line":0}},{"line":182,"address":[],"length":0,"stats":{"Line":0}},{"line":183,"address":[],"length":0,"stats":{"Line":0}},{"line":184,"address":[],"length":0,"stats":{"Line":0}},{"line":185,"address":[],"length":0,"stats":{"Line":0}},{"line":186,"address":[],"length":0,"stats":{"Line":0}},{"line":192,"address":[],"length":0,"stats":{"Line":0}},{"line":193,"address":[],"length":0,"stats":{"Line":0}},{"line":194,"address":[],"length":0,"stats":{"Line":0}},{"line":195,"address":[],"length":0,"stats":{"Line":0}},{"line":196,"address":[],"length":0,"stats":{"Line":0}},{"line":197,"address":[],"length":0,"stats":{"Line":0}},{"line":201,"address":[],"length":0,"stats":{"Line":0}},{"line":202,"address":[],"length":0,"stats":{"Line":0}},{"line":203,"address":[],"length":0,"stats":{"Line":0}},{"line":204,"address":[],"length":0,"stats":{"Line":0}},{"line":205,"address":[],"length":0,"stats":{"Line":0}},{"line":206,"address":[],"length":0,"stats":{"Line":0}},{"line":207,"address":[],"length":0,"stats":{"Line":0}},{"line":211,"address":[],"length":0,"stats":{"Line":0}},{"line":212,"address":[],"length":0,"stats":{"Line":0}},{"line":213,"address":[],"length":0,"stats":{"Line":0}},{"line":214,"address":[],"length":0,"stats":{"Line":0}},{"line":215,"address":[],"length":0,"stats":{"Line":0}},{"line":216,"address":[],"length":0,"stats":{"Line":0}},{"line":222,"address":[],"length":0,"stats":{"Line":0}},{"line":223,"address":[],"length":0,"stats":{"Line":0}},{"line":224,"address":[],"length":0,"stats":{"Line":0}},{"line":225,"address":[],"length":0,"stats":{"Line":0}},{"line":226,"address":[],"length":0,"stats":{"Line":0}},{"line":227,"address":[],"length":0,"stats":{"Line":0}},{"line":231,"address":[],"length":0,"stats":{"Line":0}},{"line":232,"address":[],"length":0,"stats":{"Line":0}},{"line":233,"address":[],"length":0,"stats":{"Line":0}},{"line":234,"address":[],"length":0,"stats":{"Line":0}},{"line":235,"address":[],"length":0,"stats":{"Line":0}},{"line":236,"address":[],"length":0,"stats":{"Line":0}},{"line":237,"address":[],"length":0,"stats":{"Line":0}},{"line":238,"address":[],"length":0,"stats":{"Line":0}},{"line":239,"address":[],"length":0,"stats":{"Line":0}},{"line":245,"address":[],"length":0,"stats":{"Line":0}},{"line":246,"address":[],"length":0,"stats":{"Line":0}},{"line":247,"address":[],"length":0,"stats":{"Line":0}},{"line":248,"address":[],"length":0,"stats":{"Line":0}},{"line":249,"address":[],"length":0,"stats":{"Line":0}},{"line":250,"address":[],"length":0,"stats":{"Line":0}},{"line":259,"address":[],"length":0,"stats":{"Line":0}},{"line":262,"address":[],"length":0,"stats":{"Line":0}},{"line":264,"address":[],"length":0,"stats":{"Line":0}},{"line":265,"address":[],"length":0,"stats":{"Line":0}},{"line":266,"address":[],"length":0,"stats":{"Line":0}},{"line":267,"address":[],"length":0,"stats":{"Line":0}},{"line":268,"address":[],"length":0,"stats":{"Line":0}},{"line":270,"address":[],"length":0,"stats":{"Line":0}},{"line":274,"address":[],"length":0,"stats":{"Line":0}},{"line":275,"address":[],"length":0,"stats":{"Line":0}},{"line":276,"address":[],"length":0,"stats":{"Line":0}},{"line":277,"address":[],"length":0,"stats":{"Line":0}},{"line":278,"address":[],"length":0,"stats":{"Line":0}},{"line":280,"address":[],"length":0,"stats":{"Line":0}},{"line":284,"address":[],"length":0,"stats":{"Line":0}},{"line":285,"address":[],"length":0,"stats":{"Line":0}},{"line":286,"address":[],"length":0,"stats":{"Line":0}},{"line":287,"address":[],"length":0,"stats":{"Line":0}},{"line":288,"address":[],"length":0,"stats":{"Line":0}},{"line":290,"address":[],"length":0,"stats":{"Line":0}},{"line":294,"address":[],"length":0,"stats":{"Line":0}},{"line":295,"address":[],"length":0,"stats":{"Line":0}},{"line":296,"address":[],"length":0,"stats":{"Line":0}},{"line":297,"address":[],"length":0,"stats":{"Line":0}},{"line":298,"address":[],"length":0,"stats":{"Line":0}},{"line":300,"address":[],"length":0,"stats":{"Line":0}},{"line":303,"address":[],"length":0,"stats":{"Line":0}},{"line":306,"address":[],"length":0,"stats":{"Line":0}},{"line":307,"address":[],"length":0,"stats":{"Line":0}},{"line":309,"address":[],"length":0,"stats":{"Line":0}},{"line":312,"address":[],"length":0,"stats":{"Line":0}},{"line":315,"address":[],"length":0,"stats":{"Line":0}},{"line":316,"address":[],"length":0,"stats":{"Line":0}},{"line":317,"address":[],"length":0,"stats":{"Line":0}},{"line":318,"address":[],"length":0,"stats":{"Line":0}},{"line":319,"address":[],"length":0,"stats":{"Line":0}},{"line":320,"address":[],"length":0,"stats":{"Line":0}},{"line":321,"address":[],"length":0,"stats":{"Line":0}},{"line":324,"address":[],"length":0,"stats":{"Line":0}},{"line":325,"address":[],"length":0,"stats":{"Line":0}},{"line":326,"address":[],"length":0,"stats":{"Line":0}},{"line":327,"address":[],"length":0,"stats":{"Line":0}},{"line":328,"address":[],"length":0,"stats":{"Line":0}},{"line":329,"address":[],"length":0,"stats":{"Line":0}},{"line":330,"address":[],"length":0,"stats":{"Line":0}},{"line":331,"address":[],"length":0,"stats":{"Line":0}},{"line":333,"address":[],"length":0,"stats":{"Line":0}},{"line":334,"address":[],"length":0,"stats":{"Line":0}},{"line":335,"address":[],"length":0,"stats":{"Line":0}},{"line":339,"address":[],"length":0,"stats":{"Line":0}},{"line":340,"address":[],"length":0,"stats":{"Line":0}},{"line":342,"address":[],"length":0,"stats":{"Line":0}},{"line":343,"address":[],"length":0,"stats":{"Line":0}},{"line":344,"address":[],"length":0,"stats":{"Line":0}},{"line":346,"address":[],"length":0,"stats":{"Line":0}},{"line":347,"address":[],"length":0,"stats":{"Line":0}},{"line":348,"address":[],"length":0,"stats":{"Line":0}},{"line":349,"address":[],"length":0,"stats":{"Line":0}},{"line":350,"address":[],"length":0,"stats":{"Line":0}},{"line":351,"address":[],"length":0,"stats":{"Line":0}},{"line":354,"address":[],"length":0,"stats":{"Line":0}},{"line":356,"address":[],"length":0,"stats":{"Line":0}},{"line":357,"address":[],"length":0,"stats":{"Line":0}},{"line":358,"address":[],"length":0,"stats":{"Line":0}},{"line":359,"address":[],"length":0,"stats":{"Line":0}},{"line":360,"address":[],"length":0,"stats":{"Line":0}},{"line":361,"address":[],"length":0,"stats":{"Line":0}},{"line":363,"address":[],"length":0,"stats":{"Line":0}},{"line":367,"address":[],"length":0,"stats":{"Line":0}},{"line":368,"address":[],"length":0,"stats":{"Line":0}},{"line":375,"address":[],"length":0,"stats":{"Line":0}},{"line":376,"address":[],"length":0,"stats":{"Line":0}},{"line":378,"address":[],"length":0,"stats":{"Line":0}},{"line":381,"address":[],"length":0,"stats":{"Line":0}},{"line":382,"address":[],"length":0,"stats":{"Line":0}},{"line":383,"address":[],"length":0,"stats":{"Line":0}},{"line":384,"address":[],"length":0,"stats":{"Line":0}},{"line":385,"address":[],"length":0,"stats":{"Line":0}},{"line":387,"address":[],"length":0,"stats":{"Line":0}},{"line":388,"address":[],"length":0,"stats":{"Line":0}},{"line":389,"address":[],"length":0,"stats":{"Line":0}},{"line":390,"address":[],"length":0,"stats":{"Line":0}},{"line":391,"address":[],"length":0,"stats":{"Line":0}},{"line":393,"address":[],"length":0,"stats":{"Line":0}},{"line":395,"address":[],"length":0,"stats":{"Line":0}},{"line":397,"address":[],"length":0,"stats":{"Line":0}},{"line":398,"address":[],"length":0,"stats":{"Line":0}},{"line":399,"address":[],"length":0,"stats":{"Line":0}},{"line":401,"address":[],"length":0,"stats":{"Line":0}},{"line":402,"address":[],"length":0,"stats":{"Line":0}},{"line":405,"address":[],"length":0,"stats":{"Line":0}},{"line":407,"address":[],"length":0,"stats":{"Line":0}},{"line":408,"address":[],"length":0,"stats":{"Line":0}},{"line":409,"address":[],"length":0,"stats":{"Line":0}},{"line":410,"address":[],"length":0,"stats":{"Line":0}},{"line":411,"address":[],"length":0,"stats":{"Line":0}},{"line":412,"address":[],"length":0,"stats":{"Line":0}},{"line":413,"address":[],"length":0,"stats":{"Line":0}},{"line":414,"address":[],"length":0,"stats":{"Line":0}},{"line":415,"address":[],"length":0,"stats":{"Line":0}},{"line":416,"address":[],"length":0,"stats":{"Line":0}},{"line":419,"address":[],"length":0,"stats":{"Line":0}},{"line":420,"address":[],"length":0,"stats":{"Line":0}},{"line":421,"address":[],"length":0,"stats":{"Line":0}},{"line":423,"address":[],"length":0,"stats":{"Line":0}},{"line":424,"address":[],"length":0,"stats":{"Line":0}},{"line":426,"address":[],"length":0,"stats":{"Line":0}},{"line":427,"address":[],"length":0,"stats":{"Line":0}},{"line":428,"address":[],"length":0,"stats":{"Line":0}},{"line":429,"address":[],"length":0,"stats":{"Line":0}},{"line":430,"address":[],"length":0,"stats":{"Line":0}},{"line":431,"address":[],"length":0,"stats":{"Line":0}},{"line":432,"address":[],"length":0,"stats":{"Line":0}},{"line":441,"address":[],"length":0,"stats":{"Line":0}},{"line":443,"address":[],"length":0,"stats":{"Line":0}},{"line":444,"address":[],"length":0,"stats":{"Line":0}},{"line":445,"address":[],"length":0,"stats":{"Line":0}},{"line":446,"address":[],"length":0,"stats":{"Line":0}},{"line":447,"address":[],"length":0,"stats":{"Line":0}},{"line":448,"address":[],"length":0,"stats":{"Line":0}},{"line":449,"address":[],"length":0,"stats":{"Line":0}},{"line":450,"address":[],"length":0,"stats":{"Line":0}},{"line":451,"address":[],"length":0,"stats":{"Line":0}},{"line":454,"address":[],"length":0,"stats":{"Line":0}},{"line":455,"address":[],"length":0,"stats":{"Line":0}},{"line":457,"address":[],"length":0,"stats":{"Line":0}},{"line":458,"address":[],"length":0,"stats":{"Line":0}},{"line":459,"address":[],"length":0,"stats":{"Line":0}},{"line":460,"address":[],"length":0,"stats":{"Line":0}},{"line":461,"address":[],"length":0,"stats":{"Line":0}},{"line":462,"address":[],"length":0,"stats":{"Line":0}},{"line":463,"address":[],"length":0,"stats":{"Line":0}},{"line":467,"address":[],"length":0,"stats":{"Line":0}},{"line":468,"address":[],"length":0,"stats":{"Line":0}},{"line":471,"address":[],"length":0,"stats":{"Line":0}},{"line":472,"address":[],"length":0,"stats":{"Line":0}},{"line":473,"address":[],"length":0,"stats":{"Line":0}},{"line":474,"address":[],"length":0,"stats":{"Line":0}},{"line":475,"address":[],"length":0,"stats":{"Line":0}},{"line":479,"address":[],"length":0,"stats":{"Line":0}},{"line":481,"address":[],"length":0,"stats":{"Line":0}},{"line":482,"address":[],"length":0,"stats":{"Line":0}},{"line":483,"address":[],"length":0,"stats":{"Line":0}},{"line":484,"address":[],"length":0,"stats":{"Line":0}},{"line":485,"address":[],"length":0,"stats":{"Line":0}},{"line":486,"address":[],"length":0,"stats":{"Line":0}},{"line":488,"address":[],"length":0,"stats":{"Line":0}},{"line":489,"address":[],"length":0,"stats":{"Line":0}},{"line":490,"address":[],"length":0,"stats":{"Line":0}},{"line":495,"address":[],"length":0,"stats":{"Line":0}},{"line":498,"address":[],"length":0,"stats":{"Line":0}},{"line":499,"address":[],"length":0,"stats":{"Line":0}},{"line":500,"address":[],"length":0,"stats":{"Line":0}},{"line":502,"address":[],"length":0,"stats":{"Line":0}},{"line":504,"address":[],"length":0,"stats":{"Line":0}},{"line":506,"address":[],"length":0,"stats":{"Line":0}},{"line":507,"address":[],"length":0,"stats":{"Line":0}},{"line":508,"address":[],"length":0,"stats":{"Line":0}},{"line":509,"address":[],"length":0,"stats":{"Line":0}},{"line":511,"address":[],"length":0,"stats":{"Line":0}},{"line":512,"address":[],"length":0,"stats":{"Line":0}},{"line":514,"address":[],"length":0,"stats":{"Line":0}},{"line":515,"address":[],"length":0,"stats":{"Line":0}},{"line":517,"address":[],"length":0,"stats":{"Line":0}},{"line":518,"address":[],"length":0,"stats":{"Line":0}},{"line":524,"address":[],"length":0,"stats":{"Line":0}},{"line":527,"address":[],"length":0,"stats":{"Line":0}},{"line":528,"address":[],"length":0,"stats":{"Line":0}},{"line":530,"address":[],"length":0,"stats":{"Line":0}},{"line":531,"address":[],"length":0,"stats":{"Line":0}},{"line":532,"address":[],"length":0,"stats":{"Line":0}},{"line":533,"address":[],"length":0,"stats":{"Line":0}},{"line":535,"address":[],"length":0,"stats":{"Line":0}},{"line":536,"address":[],"length":0,"stats":{"Line":0}},{"line":539,"address":[],"length":0,"stats":{"Line":0}},{"line":540,"address":[],"length":0,"stats":{"Line":0}},{"line":543,"address":[],"length":0,"stats":{"Line":0}},{"line":545,"address":[],"length":0,"stats":{"Line":0}},{"line":547,"address":[],"length":0,"stats":{"Line":0}},{"line":548,"address":[],"length":0,"stats":{"Line":0}},{"line":549,"address":[],"length":0,"stats":{"Line":0}},{"line":551,"address":[],"length":0,"stats":{"Line":0}},{"line":553,"address":[],"length":0,"stats":{"Line":0}},{"line":554,"address":[],"length":0,"stats":{"Line":0}},{"line":555,"address":[],"length":0,"stats":{"Line":0}},{"line":557,"address":[],"length":0,"stats":{"Line":0}},{"line":558,"address":[],"length":0,"stats":{"Line":0}},{"line":562,"address":[],"length":0,"stats":{"Line":0}},{"line":563,"address":[],"length":0,"stats":{"Line":0}},{"line":564,"address":[],"length":0,"stats":{"Line":0}},{"line":566,"address":[],"length":0,"stats":{"Line":0}},{"line":567,"address":[],"length":0,"stats":{"Line":0}},{"line":570,"address":[],"length":0,"stats":{"Line":0}},{"line":571,"address":[],"length":0,"stats":{"Line":0}},{"line":572,"address":[],"length":0,"stats":{"Line":0}},{"line":573,"address":[],"length":0,"stats":{"Line":0}},{"line":574,"address":[],"length":0,"stats":{"Line":0}},{"line":580,"address":[],"length":0,"stats":{"Line":0}},{"line":583,"address":[],"length":0,"stats":{"Line":0}},{"line":584,"address":[],"length":0,"stats":{"Line":0}},{"line":585,"address":[],"length":0,"stats":{"Line":0}},{"line":586,"address":[],"length":0,"stats":{"Line":0}},{"line":588,"address":[],"length":0,"stats":{"Line":0}},{"line":589,"address":[],"length":0,"stats":{"Line":0}},{"line":590,"address":[],"length":0,"stats":{"Line":0}},{"line":591,"address":[],"length":0,"stats":{"Line":0}},{"line":592,"address":[],"length":0,"stats":{"Line":0}},{"line":594,"address":[],"length":0,"stats":{"Line":0}},{"line":597,"address":[],"length":0,"stats":{"Line":0}},{"line":598,"address":[],"length":0,"stats":{"Line":0}},{"line":601,"address":[],"length":0,"stats":{"Line":0}},{"line":602,"address":[],"length":0,"stats":{"Line":0}},{"line":603,"address":[],"length":0,"stats":{"Line":0}},{"line":604,"address":[],"length":0,"stats":{"Line":0}},{"line":605,"address":[],"length":0,"stats":{"Line":0}},{"line":606,"address":[],"length":0,"stats":{"Line":0}},{"line":607,"address":[],"length":0,"stats":{"Line":0}},{"line":609,"address":[],"length":0,"stats":{"Line":0}},{"line":610,"address":[],"length":0,"stats":{"Line":0}},{"line":615,"address":[],"length":0,"stats":{"Line":0}},{"line":616,"address":[],"length":0,"stats":{"Line":0}},{"line":617,"address":[],"length":0,"stats":{"Line":0}},{"line":618,"address":[],"length":0,"stats":{"Line":0}},{"line":619,"address":[],"length":0,"stats":{"Line":0}},{"line":621,"address":[],"length":0,"stats":{"Line":0}},{"line":622,"address":[],"length":0,"stats":{"Line":0}},{"line":623,"address":[],"length":0,"stats":{"Line":0}},{"line":624,"address":[],"length":0,"stats":{"Line":0}},{"line":626,"address":[],"length":0,"stats":{"Line":0}},{"line":627,"address":[],"length":0,"stats":{"Line":0}},{"line":628,"address":[],"length":0,"stats":{"Line":0}},{"line":632,"address":[],"length":0,"stats":{"Line":0}},{"line":635,"address":[],"length":0,"stats":{"Line":0}},{"line":638,"address":[],"length":0,"stats":{"Line":0}},{"line":639,"address":[],"length":0,"stats":{"Line":0}},{"line":640,"address":[],"length":0,"stats":{"Line":0}},{"line":642,"address":[],"length":0,"stats":{"Line":0}},{"line":643,"address":[],"length":0,"stats":{"Line":0}},{"line":644,"address":[],"length":0,"stats":{"Line":0}},{"line":646,"address":[],"length":0,"stats":{"Line":0}},{"line":647,"address":[],"length":0,"stats":{"Line":0}},{"line":648,"address":[],"length":0,"stats":{"Line":0}},{"line":649,"address":[],"length":0,"stats":{"Line":0}},{"line":650,"address":[],"length":0,"stats":{"Line":0}},{"line":651,"address":[],"length":0,"stats":{"Line":0}},{"line":652,"address":[],"length":0,"stats":{"Line":0}},{"line":653,"address":[],"length":0,"stats":{"Line":0}},{"line":655,"address":[],"length":0,"stats":{"Line":0}},{"line":656,"address":[],"length":0,"stats":{"Line":0}},{"line":660,"address":[],"length":0,"stats":{"Line":0}},{"line":662,"address":[],"length":0,"stats":{"Line":0}},{"line":664,"address":[],"length":0,"stats":{"Line":0}},{"line":665,"address":[],"length":0,"stats":{"Line":0}},{"line":666,"address":[],"length":0,"stats":{"Line":0}},{"line":667,"address":[],"length":0,"stats":{"Line":0}},{"line":668,"address":[],"length":0,"stats":{"Line":0}},{"line":669,"address":[],"length":0,"stats":{"Line":0}},{"line":672,"address":[],"length":0,"stats":{"Line":0}},{"line":673,"address":[],"length":0,"stats":{"Line":0}},{"line":674,"address":[],"length":0,"stats":{"Line":0}},{"line":675,"address":[],"length":0,"stats":{"Line":0}},{"line":676,"address":[],"length":0,"stats":{"Line":0}},{"line":677,"address":[],"length":0,"stats":{"Line":0}},{"line":678,"address":[],"length":0,"stats":{"Line":0}},{"line":679,"address":[],"length":0,"stats":{"Line":0}},{"line":681,"address":[],"length":0,"stats":{"Line":0}},{"line":682,"address":[],"length":0,"stats":{"Line":0}},{"line":684,"address":[],"length":0,"stats":{"Line":0}},{"line":685,"address":[],"length":0,"stats":{"Line":0}},{"line":686,"address":[],"length":0,"stats":{"Line":0}},{"line":687,"address":[],"length":0,"stats":{"Line":0}},{"line":689,"address":[],"length":0,"stats":{"Line":0}},{"line":690,"address":[],"length":0,"stats":{"Line":0}},{"line":692,"address":[],"length":0,"stats":{"Line":0}},{"line":693,"address":[],"length":0,"stats":{"Line":0}},{"line":694,"address":[],"length":0,"stats":{"Line":0}},{"line":695,"address":[],"length":0,"stats":{"Line":0}},{"line":697,"address":[],"length":0,"stats":{"Line":0}},{"line":698,"address":[],"length":0,"stats":{"Line":0}},{"line":700,"address":[],"length":0,"stats":{"Line":0}},{"line":704,"address":[],"length":0,"stats":{"Line":0}},{"line":705,"address":[],"length":0,"stats":{"Line":0}},{"line":710,"address":[],"length":0,"stats":{"Line":0}},{"line":712,"address":[],"length":0,"stats":{"Line":0}},{"line":713,"address":[],"length":0,"stats":{"Line":0}},{"line":715,"address":[],"length":0,"stats":{"Line":0}},{"line":716,"address":[],"length":0,"stats":{"Line":0}},{"line":717,"address":[],"length":0,"stats":{"Line":0}},{"line":718,"address":[],"length":0,"stats":{"Line":0}},{"line":719,"address":[],"length":0,"stats":{"Line":0}},{"line":720,"address":[],"length":0,"stats":{"Line":0}},{"line":722,"address":[],"length":0,"stats":{"Line":0}},{"line":723,"address":[],"length":0,"stats":{"Line":0}},{"line":726,"address":[],"length":0,"stats":{"Line":0}},{"line":727,"address":[],"length":0,"stats":{"Line":0}},{"line":728,"address":[],"length":0,"stats":{"Line":0}},{"line":729,"address":[],"length":0,"stats":{"Line":0}},{"line":730,"address":[],"length":0,"stats":{"Line":0}},{"line":731,"address":[],"length":0,"stats":{"Line":0}},{"line":732,"address":[],"length":0,"stats":{"Line":0}},{"line":733,"address":[],"length":0,"stats":{"Line":0}},{"line":734,"address":[],"length":0,"stats":{"Line":0}},{"line":735,"address":[],"length":0,"stats":{"Line":0}},{"line":737,"address":[],"length":0,"stats":{"Line":0}},{"line":739,"address":[],"length":0,"stats":{"Line":0}},{"line":740,"address":[],"length":0,"stats":{"Line":0}},{"line":741,"address":[],"length":0,"stats":{"Line":0}},{"line":742,"address":[],"length":0,"stats":{"Line":0}},{"line":743,"address":[],"length":0,"stats":{"Line":0}},{"line":744,"address":[],"length":0,"stats":{"Line":0}},{"line":746,"address":[],"length":0,"stats":{"Line":0}},{"line":748,"address":[],"length":0,"stats":{"Line":0}},{"line":749,"address":[],"length":0,"stats":{"Line":0}},{"line":750,"address":[],"length":0,"stats":{"Line":0}},{"line":751,"address":[],"length":0,"stats":{"Line":0}},{"line":752,"address":[],"length":0,"stats":{"Line":0}},{"line":753,"address":[],"length":0,"stats":{"Line":0}},{"line":755,"address":[],"length":0,"stats":{"Line":0}},{"line":757,"address":[],"length":0,"stats":{"Line":0}},{"line":758,"address":[],"length":0,"stats":{"Line":0}},{"line":759,"address":[],"length":0,"stats":{"Line":0}},{"line":760,"address":[],"length":0,"stats":{"Line":0}},{"line":761,"address":[],"length":0,"stats":{"Line":0}},{"line":762,"address":[],"length":0,"stats":{"Line":0}},{"line":764,"address":[],"length":0,"stats":{"Line":0}},{"line":766,"address":[],"length":0,"stats":{"Line":0}},{"line":770,"address":[],"length":0,"stats":{"Line":0}},{"line":771,"address":[],"length":0,"stats":{"Line":0}},{"line":773,"address":[],"length":0,"stats":{"Line":0}},{"line":777,"address":[],"length":0,"stats":{"Line":0}},{"line":779,"address":[],"length":0,"stats":{"Line":0}},{"line":780,"address":[],"length":0,"stats":{"Line":0}},{"line":781,"address":[],"length":0,"stats":{"Line":0}},{"line":782,"address":[],"length":0,"stats":{"Line":0}},{"line":783,"address":[],"length":0,"stats":{"Line":0}},{"line":784,"address":[],"length":0,"stats":{"Line":0}},{"line":786,"address":[],"length":0,"stats":{"Line":0}},{"line":787,"address":[],"length":0,"stats":{"Line":0}},{"line":788,"address":[],"length":0,"stats":{"Line":0}},{"line":789,"address":[],"length":0,"stats":{"Line":0}},{"line":790,"address":[],"length":0,"stats":{"Line":0}},{"line":792,"address":[],"length":0,"stats":{"Line":0}},{"line":793,"address":[],"length":0,"stats":{"Line":0}},{"line":794,"address":[],"length":0,"stats":{"Line":0}},{"line":795,"address":[],"length":0,"stats":{"Line":0}},{"line":796,"address":[],"length":0,"stats":{"Line":0}},{"line":798,"address":[],"length":0,"stats":{"Line":0}},{"line":799,"address":[],"length":0,"stats":{"Line":0}},{"line":800,"address":[],"length":0,"stats":{"Line":0}},{"line":801,"address":[],"length":0,"stats":{"Line":0}},{"line":802,"address":[],"length":0,"stats":{"Line":0}},{"line":804,"address":[],"length":0,"stats":{"Line":0}},{"line":805,"address":[],"length":0,"stats":{"Line":0}},{"line":806,"address":[],"length":0,"stats":{"Line":0}},{"line":807,"address":[],"length":0,"stats":{"Line":0}},{"line":808,"address":[],"length":0,"stats":{"Line":0}},{"line":810,"address":[],"length":0,"stats":{"Line":0}},{"line":811,"address":[],"length":0,"stats":{"Line":0}},{"line":812,"address":[],"length":0,"stats":{"Line":0}},{"line":813,"address":[],"length":0,"stats":{"Line":0}},{"line":814,"address":[],"length":0,"stats":{"Line":0}},{"line":815,"address":[],"length":0,"stats":{"Line":0}},{"line":817,"address":[],"length":0,"stats":{"Line":0}},{"line":821,"address":[],"length":0,"stats":{"Line":0}},{"line":822,"address":[],"length":0,"stats":{"Line":0}},{"line":824,"address":[],"length":0,"stats":{"Line":0}},{"line":830,"address":[],"length":0,"stats":{"Line":0}},{"line":831,"address":[],"length":0,"stats":{"Line":0}},{"line":832,"address":[],"length":0,"stats":{"Line":0}},{"line":833,"address":[],"length":0,"stats":{"Line":0}},{"line":834,"address":[],"length":0,"stats":{"Line":0}},{"line":835,"address":[],"length":0,"stats":{"Line":0}},{"line":836,"address":[],"length":0,"stats":{"Line":0}},{"line":838,"address":[],"length":0,"stats":{"Line":0}},{"line":841,"address":[],"length":0,"stats":{"Line":0}},{"line":845,"address":[],"length":0,"stats":{"Line":0}},{"line":846,"address":[],"length":0,"stats":{"Line":0}},{"line":848,"address":[],"length":0,"stats":{"Line":0}},{"line":851,"address":[],"length":0,"stats":{"Line":0}},{"line":852,"address":[],"length":0,"stats":{"Line":0}},{"line":853,"address":[],"length":0,"stats":{"Line":0}},{"line":854,"address":[],"length":0,"stats":{"Line":0}},{"line":856,"address":[],"length":0,"stats":{"Line":0}},{"line":861,"address":[],"length":0,"stats":{"Line":0}},{"line":862,"address":[],"length":0,"stats":{"Line":0}},{"line":863,"address":[],"length":0,"stats":{"Line":0}},{"line":864,"address":[],"length":0,"stats":{"Line":0}},{"line":866,"address":[],"length":0,"stats":{"Line":0}},{"line":870,"address":[],"length":0,"stats":{"Line":0}},{"line":874,"address":[],"length":0,"stats":{"Line":0}},{"line":881,"address":[],"length":0,"stats":{"Line":0}},{"line":882,"address":[],"length":0,"stats":{"Line":0}},{"line":883,"address":[],"length":0,"stats":{"Line":0}},{"line":885,"address":[],"length":0,"stats":{"Line":0}},{"line":886,"address":[],"length":0,"stats":{"Line":0}},{"line":889,"address":[],"length":0,"stats":{"Line":0}},{"line":890,"address":[],"length":0,"stats":{"Line":0}},{"line":891,"address":[],"length":0,"stats":{"Line":0}},{"line":892,"address":[],"length":0,"stats":{"Line":0}},{"line":893,"address":[],"length":0,"stats":{"Line":0}},{"line":896,"address":[],"length":0,"stats":{"Line":0}},{"line":897,"address":[],"length":0,"stats":{"Line":0}},{"line":899,"address":[],"length":0,"stats":{"Line":0}},{"line":900,"address":[],"length":0,"stats":{"Line":0}},{"line":901,"address":[],"length":0,"stats":{"Line":0}},{"line":902,"address":[],"length":0,"stats":{"Line":0}},{"line":903,"address":[],"length":0,"stats":{"Line":0}},{"line":904,"address":[],"length":0,"stats":{"Line":0}},{"line":907,"address":[],"length":0,"stats":{"Line":0}},{"line":908,"address":[],"length":0,"stats":{"Line":0}},{"line":912,"address":[],"length":0,"stats":{"Line":0}},{"line":914,"address":[],"length":0,"stats":{"Line":0}},{"line":916,"address":[],"length":0,"stats":{"Line":0}},{"line":917,"address":[],"length":0,"stats":{"Line":0}},{"line":918,"address":[],"length":0,"stats":{"Line":0}},{"line":919,"address":[],"length":0,"stats":{"Line":0}},{"line":922,"address":[],"length":0,"stats":{"Line":0}},{"line":923,"address":[],"length":0,"stats":{"Line":0}},{"line":927,"address":[],"length":0,"stats":{"Line":0}},{"line":929,"address":[],"length":0,"stats":{"Line":0}},{"line":931,"address":[],"length":0,"stats":{"Line":0}},{"line":932,"address":[],"length":0,"stats":{"Line":0}},{"line":933,"address":[],"length":0,"stats":{"Line":0}},{"line":934,"address":[],"length":0,"stats":{"Line":0}},{"line":937,"address":[],"length":0,"stats":{"Line":0}},{"line":938,"address":[],"length":0,"stats":{"Line":0}},{"line":942,"address":[],"length":0,"stats":{"Line":0}},{"line":944,"address":[],"length":0,"stats":{"Line":0}},{"line":946,"address":[],"length":0,"stats":{"Line":0}},{"line":947,"address":[],"length":0,"stats":{"Line":0}},{"line":948,"address":[],"length":0,"stats":{"Line":0}},{"line":949,"address":[],"length":0,"stats":{"Line":0}},{"line":952,"address":[],"length":0,"stats":{"Line":0}},{"line":953,"address":[],"length":0,"stats":{"Line":0}},{"line":957,"address":[],"length":0,"stats":{"Line":0}},{"line":959,"address":[],"length":0,"stats":{"Line":0}},{"line":961,"address":[],"length":0,"stats":{"Line":0}},{"line":966,"address":[],"length":0,"stats":{"Line":0}},{"line":967,"address":[],"length":0,"stats":{"Line":0}},{"line":970,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":590},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","ui","src","canvas","keyboard.rs"],"content":"//! Canvas keyboard input handling\n//!\n//! Implements keyboard shortcuts and command handling for the canvas.\n\n/// Keyboard command\n#[derive(Clone, Copy, Debug, PartialEq, Eq)]\npub enum KeyboardCommand {\n    /// Delete selected objects\n    Delete,\n    /// Undo last action\n    Undo,\n    /// Redo last undone action\n    Redo,\n    /// Select all objects\n    SelectAll,\n    /// Deselect all objects\n    DeselectAll,\n    /// Duplicate selected objects\n    Duplicate,\n    /// Copy to clipboard\n    Copy,\n    /// Paste from clipboard\n    Paste,\n    /// Cut to clipboard\n    Cut,\n    /// Zoom in\n    ZoomIn,\n    /// Zoom out\n    ZoomOut,\n    /// Reset zoom to 100%\n    ZoomReset,\n    /// Move selected objects left\n    MoveLeft,\n    /// Move selected objects right\n    MoveRight,\n    /// Move selected objects up\n    MoveUp,\n    /// Move selected objects down\n    MoveDown,\n    /// Group selected objects\n    Group,\n    /// Ungroup selected objects\n    Ungroup,\n}\n\n/// Detect keyboard command from GTK key event\npub fn detect_keyboard_command(\n    keyval: u32,\n    state: gtk4::gdk::ModifierType,\n) -\u003e Option\u003cKeyboardCommand\u003e {\n    use gtk4::gdk;\n\n    // Key codes (from gdk4-sys or standard X11)\n    const KEY_DELETE: u32 = 0xffff;\n    const KEY_Z: u32 = 0x007a;\n    const KEY_Y: u32 = 0x0079;\n    const KEY_A: u32 = 0x0061;\n    const KEY_D: u32 = 0x0064;\n    const KEY_C: u32 = 0x0063;\n    const KEY_V: u32 = 0x0076;\n    const KEY_X: u32 = 0x0078;\n    const KEY_G: u32 = 0x0067;\n    const KEY_0: u32 = 0x0030;\n    const KEY_PLUS: u32 = 0x002b;\n    const KEY_EQUAL: u32 = 0x003d;\n    const KEY_MINUS: u32 = 0x002d;\n    const KEY_ESCAPE: u32 = 0xff1b;\n    const KEY_LEFT: u32 = 0xff51;\n    const KEY_RIGHT: u32 = 0xff53;\n    const KEY_UP: u32 = 0xff52;\n    const KEY_DOWN: u32 = 0xff54;\n\n    match keyval {\n        // Delete key\n        KEY_DELETE =\u003e Some(KeyboardCommand::Delete),\n\n        // Ctrl+Z: Undo\n        KEY_Z if state.contains(gdk::ModifierType::CONTROL_MASK) =\u003e {\n            Some(KeyboardCommand::Undo)\n        }\n\n        // Ctrl+Y or Ctrl+Shift+Z: Redo\n        KEY_Y if state.contains(gdk::ModifierType::CONTROL_MASK) =\u003e {\n            Some(KeyboardCommand::Redo)\n        }\n        KEY_Z if state.contains(gdk::ModifierType::CONTROL_MASK)\n            \u0026\u0026 state.contains(gdk::ModifierType::SHIFT_MASK) =\u003e\n        {\n            Some(KeyboardCommand::Redo)\n        }\n\n        // Ctrl+A: Select All\n        KEY_A if state.contains(gdk::ModifierType::CONTROL_MASK) =\u003e {\n            Some(KeyboardCommand::SelectAll)\n        }\n\n        // Escape: Deselect All\n        KEY_ESCAPE =\u003e Some(KeyboardCommand::DeselectAll),\n\n        // Ctrl+D: Duplicate\n        KEY_D if state.contains(gdk::ModifierType::CONTROL_MASK) =\u003e {\n            Some(KeyboardCommand::Duplicate)\n        }\n\n        // Ctrl+C: Copy\n        KEY_C if state.contains(gdk::ModifierType::CONTROL_MASK) =\u003e {\n            Some(KeyboardCommand::Copy)\n        }\n\n        // Ctrl+V: Paste\n        KEY_V if state.contains(gdk::ModifierType::CONTROL_MASK) =\u003e {\n            Some(KeyboardCommand::Paste)\n        }\n\n        // Ctrl+X: Cut\n        KEY_X if state.contains(gdk::ModifierType::CONTROL_MASK) =\u003e {\n            Some(KeyboardCommand::Cut)\n        }\n\n        // Ctrl++: Zoom In\n        KEY_PLUS | KEY_EQUAL if state.contains(gdk::ModifierType::CONTROL_MASK) =\u003e {\n            Some(KeyboardCommand::ZoomIn)\n        }\n\n        // Ctrl+-: Zoom Out\n        KEY_MINUS if state.contains(gdk::ModifierType::CONTROL_MASK) =\u003e {\n            Some(KeyboardCommand::ZoomOut)\n        }\n\n        // Ctrl+0: Reset Zoom\n        KEY_0 if state.contains(gdk::ModifierType::CONTROL_MASK) =\u003e {\n            Some(KeyboardCommand::ZoomReset)\n        }\n\n        // Arrow keys for moving objects\n        KEY_LEFT =\u003e Some(KeyboardCommand::MoveLeft),\n        KEY_RIGHT =\u003e Some(KeyboardCommand::MoveRight),\n        KEY_UP =\u003e Some(KeyboardCommand::MoveUp),\n        KEY_DOWN =\u003e Some(KeyboardCommand::MoveDown),\n\n        // Ctrl+G: Group\n        KEY_G if state.contains(gdk::ModifierType::CONTROL_MASK) =\u003e {\n            Some(KeyboardCommand::Group)\n        }\n\n        // Ctrl+Shift+G: Ungroup\n        KEY_G\n            if state.contains(gdk::ModifierType::CONTROL_MASK)\n                \u0026\u0026 state.contains(gdk::ModifierType::SHIFT_MASK) =\u003e\n        {\n            Some(KeyboardCommand::Ungroup)\n        }\n\n        _ =\u003e None,\n    }\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n\n    #[test]\n    fn test_keyboard_command_names() {\n        assert_eq!(\n            format!(\"{:?}\", KeyboardCommand::Delete),\n            \"Delete\"\n        );\n        assert_eq!(\n            format!(\"{:?}\", KeyboardCommand::Undo),\n            \"Undo\"\n        );\n    }\n}\n","traces":[{"line":47,"address":[],"length":0,"stats":{"Line":0}},{"line":73,"address":[],"length":0,"stats":{"Line":0}},{"line":75,"address":[],"length":0,"stats":{"Line":0}},{"line":78,"address":[],"length":0,"stats":{"Line":0}},{"line":79,"address":[],"length":0,"stats":{"Line":0}},{"line":83,"address":[],"length":0,"stats":{"Line":0}},{"line":84,"address":[],"length":0,"stats":{"Line":0}},{"line":86,"address":[],"length":0,"stats":{"Line":0}},{"line":87,"address":[],"length":0,"stats":{"Line":0}},{"line":89,"address":[],"length":0,"stats":{"Line":0}},{"line":93,"address":[],"length":0,"stats":{"Line":0}},{"line":94,"address":[],"length":0,"stats":{"Line":0}},{"line":98,"address":[],"length":0,"stats":{"Line":0}},{"line":101,"address":[],"length":0,"stats":{"Line":0}},{"line":102,"address":[],"length":0,"stats":{"Line":0}},{"line":106,"address":[],"length":0,"stats":{"Line":0}},{"line":107,"address":[],"length":0,"stats":{"Line":0}},{"line":111,"address":[],"length":0,"stats":{"Line":0}},{"line":112,"address":[],"length":0,"stats":{"Line":0}},{"line":116,"address":[],"length":0,"stats":{"Line":0}},{"line":117,"address":[],"length":0,"stats":{"Line":0}},{"line":121,"address":[],"length":0,"stats":{"Line":0}},{"line":122,"address":[],"length":0,"stats":{"Line":0}},{"line":126,"address":[],"length":0,"stats":{"Line":0}},{"line":127,"address":[],"length":0,"stats":{"Line":0}},{"line":131,"address":[],"length":0,"stats":{"Line":0}},{"line":132,"address":[],"length":0,"stats":{"Line":0}},{"line":136,"address":[],"length":0,"stats":{"Line":0}},{"line":137,"address":[],"length":0,"stats":{"Line":0}},{"line":138,"address":[],"length":0,"stats":{"Line":0}},{"line":139,"address":[],"length":0,"stats":{"Line":0}},{"line":142,"address":[],"length":0,"stats":{"Line":0}},{"line":143,"address":[],"length":0,"stats":{"Line":0}},{"line":148,"address":[],"length":0,"stats":{"Line":0}},{"line":149,"address":[],"length":0,"stats":{"Line":0}},{"line":151,"address":[],"length":0,"stats":{"Line":0}},{"line":154,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":37},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","ui","src","canvas","mod.rs"],"content":"pub mod input;\npub mod overlays;\npub mod rendering;\npub mod mouse;\npub mod keyboard;\npub mod selection;\npub mod tools;\npub mod text_editor;\npub mod snapping;\npub mod dirty_region;\n\nuse gtk4::{prelude::*, DrawingArea, Overlay, ScrolledWindow};\nuse std::cell::RefCell;\nuse std::rc::Rc;\n\nuse crate::app::AppState;\nuse rendering::{RenderConfig, RulerConfig};\nuse dirty_region::DirtyRegionTracker;\n\n/// Render state tracking\n#[derive(Clone)]\npub struct CanvasRenderState {\n    pub config: Rc\u003cRefCell\u003cRenderConfig\u003e\u003e,\n    pub ruler_config: Rc\u003cRefCell\u003cRulerConfig\u003e\u003e,\n    pub selected_ids: Rc\u003cRefCell\u003cVec\u003cuuid::Uuid\u003e\u003e\u003e,\n    pub drag_box: Rc\u003cRefCell\u003cOption\u003ctestruct_core::layout::Rect\u003e\u003e\u003e,\n    pub tool_state: Rc\u003cRefCell\u003ctools::ToolState\u003e\u003e,\n    pub dirty_region: DirtyRegionTracker,\n}\n\nimpl Default for CanvasRenderState {\n    fn default() -\u003e Self {\n        Self {\n            config: Rc::new(RefCell::new(RenderConfig::default())),\n            ruler_config: Rc::new(RefCell::new(RulerConfig::default())),\n            selected_ids: Rc::new(RefCell::new(Vec::new())),\n            drag_box: Rc::new(RefCell::new(None)),\n            tool_state: Rc::new(RefCell::new(tools::ToolState::default())),\n            dirty_region: dirty_region::new_tracker(),\n        }\n    }\n}\n\npub struct CanvasView {\n    container: ScrolledWindow,\n    drawing_area: DrawingArea,\n    overlay: Overlay,\n    render_state: CanvasRenderState,\n}\n\nimpl CanvasView {\n    pub fn new(app_state: AppState) -\u003e Self {\n        let drawing_area = DrawingArea::builder()\n            .content_width(1200)\n            .content_height(1600)\n            .build();\n        drawing_area.set_hexpand(true);\n        drawing_area.set_vexpand(true);\n\n        let overlay = Overlay::new();\n        overlay.set_child(Some(\u0026drawing_area));\n        overlays::add_ruler_overlay(\u0026overlay);\n\n        let container = ScrolledWindow::new();\n        container.set_child(Some(\u0026overlay));\n        container.set_hexpand(true);\n        container.set_vexpand(true);\n\n        let render_state = CanvasRenderState::default();\n\n        // Setup drawing function\n        Self::setup_draw_func(\u0026drawing_area, \u0026app_state, \u0026render_state);\n\n        input::wire_pointer_events(\u0026drawing_area, \u0026render_state, \u0026app_state);\n\n        Self {\n            container,\n            drawing_area,\n            overlay,\n            render_state,\n        }\n    }\n\n    /// Setup the Cairo draw function for the canvas\n    fn setup_draw_func(\n        drawing_area: \u0026DrawingArea,\n        app_state: \u0026AppState,\n        render_state: \u0026CanvasRenderState,\n    ) {\n        let app_state_clone = app_state.clone();\n        let render_state = render_state.clone();\n\n        drawing_area.set_draw_func(move |_area, ctx, width, height| {\n            if let Err(e) = Self::draw_canvas(\n                ctx,\n                width as f64,\n                height as f64,\n                \u0026app_state_clone,\n                \u0026render_state,\n            ) {\n                eprintln!(\"Canvas draw error: {}\", e);\n            }\n        });\n    }\n\n    /// Main canvas drawing function\n    fn draw_canvas(\n        ctx: \u0026gtk4::cairo::Context,\n        width: f64,\n        height: f64,\n        app_state: \u0026AppState,\n        render_state: \u0026CanvasRenderState,\n    ) -\u003e Result\u003c(), Box\u003cdyn std::error::Error\u003e\u003e {\n        let ruler_config = render_state.ruler_config.borrow();\n        let config = render_state.config.borrow();\n\n        // Draw background and rulers\n        rendering::draw_background(ctx, width, height, \u0026ruler_config)?;\n\n        // Get the active document\n        let Some(document) = app_state.active_document() else {\n            return Ok(());\n        };\n\n        // Get the first page (for now, single-page support)\n        let Some(page) = document.pages.first() else {\n            return Ok(());\n        };\n\n        // Get page size from document metadata\n        let page_size = document.metadata.page_size.to_size();\n\n        // Draw page border\n        rendering::draw_page_border(ctx, \u0026page_size)?;\n\n        // Apply zoom and pan\n        ctx.translate(ruler_config.size + config.pan_x, ruler_config.size + config.pan_y);\n        ctx.scale(config.zoom, config.zoom);\n\n        // Draw grid if enabled\n        if config.show_grid {\n            rendering::draw_grid(ctx, \u0026page_size)?;\n        }\n\n        // Draw guides if enabled\n        if config.show_guides \u0026\u0026 !config.guides.is_empty() {\n            rendering::draw_guides(ctx, \u0026config.guides, \u0026page_size)?;\n        }\n\n        // Draw page elements\n        let selected = render_state.selected_ids.borrow();\n        Self::draw_elements(ctx, page, \u0026selected, render_state)?;\n\n        Ok(())\n    }\n\n    /// Draw all document elements on the page\n    fn draw_elements(\n        ctx: \u0026gtk4::cairo::Context,\n        page: \u0026testruct_core::document::Page,\n        selected_ids: \u0026[uuid::Uuid],\n        render_state: \u0026CanvasRenderState,\n    ) -\u003e Result\u003c(), Box\u003cdyn std::error::Error\u003e\u003e {\n        for element in \u0026page.elements {\n            Self::draw_element(ctx, element, selected_ids, render_state)?;\n        }\n        Ok(())\n    }\n\n    /// Draw a single document element, recursively handling frames\n    fn draw_element(\n        ctx: \u0026gtk4::cairo::Context,\n        element: \u0026testruct_core::document::DocumentElement,\n        selected_ids: \u0026[uuid::Uuid],\n        render_state: \u0026CanvasRenderState,\n    ) -\u003e Result\u003c(), Box\u003cdyn std::error::Error\u003e\u003e {\n        use testruct_core::document::{DocumentElement, ShapeKind};\n\n        match element {\n            DocumentElement::Frame(frame) =\u003e {\n                // Draw frame border\n                ctx.set_source_rgb(0.9, 0.9, 0.9);\n                ctx.set_line_width(1.0);\n                ctx.rectangle(\n                    frame.bounds.origin.x as f64,\n                    frame.bounds.origin.y as f64,\n                    frame.bounds.size.width as f64,\n                    frame.bounds.size.height as f64,\n                );\n                ctx.stroke()?;\n\n                // Draw frame selection highlight if selected\n                let is_selected = selected_ids.contains(\u0026frame.id);\n                if is_selected {\n                    let selection_color = testruct_core::typography::Color {\n                        r: 0.05,\n                        g: 0.49,\n                        b: 0.86,\n                        a: 1.0,\n                    };\n                    rendering::draw_selection_box(ctx, \u0026frame.bounds, \u0026selection_color)?;\n                    rendering::draw_resize_handles(ctx, \u0026frame.bounds, \u0026selection_color)?;\n                }\n\n                // Recursively draw frame children\n                for child in \u0026frame.children {\n                    Self::draw_element(ctx, child, selected_ids, render_state)?;\n                }\n            }\n            DocumentElement::Text(text) =\u003e {\n                // Use actual bounds from text element\n                let text_bounds = \u0026text.bounds;\n\n                let is_selected = selected_ids.contains(\u0026text.id);\n\n                // Check if this text element is being edited\n                let tool_state = render_state.tool_state.borrow();\n                let is_editing = tool_state.editing_text_id == Some(text.id);\n                let cursor_pos = tool_state.editing_cursor_pos;\n                drop(tool_state);\n\n                rendering::draw_text_element(\n                    ctx,\n                    text_bounds,\n                    \u0026text.content,\n                    \u0026text.style,\n                )?;\n\n                if is_editing {\n                    // Draw editing frame\n                    rendering::draw_text_editing_frame(ctx, text_bounds)?;\n                    // Draw cursor\n                    rendering::draw_text_cursor(\n                        ctx,\n                        text_bounds,\n                        \u0026text.content,\n                        cursor_pos,\n                        \u0026text.style,\n                    )?;\n                } else if is_selected {\n                    let selection_color = testruct_core::typography::Color {\n                        r: 0.05,\n                        g: 0.49,\n                        b: 0.86,\n                        a: 1.0,\n                    };\n                    rendering::draw_selection_box(ctx, text_bounds, \u0026selection_color)?;\n                    rendering::draw_resize_handles(ctx, text_bounds, \u0026selection_color)?;\n                }\n            }\n            DocumentElement::Image(image) =\u003e {\n                // Draw image placeholder with visual feedback\n                rendering::draw_image_placeholder(ctx, \u0026image.bounds)?;\n\n                let is_selected = selected_ids.contains(\u0026image.id);\n                if is_selected {\n                    let selection_color = testruct_core::typography::Color {\n                        r: 0.05,\n                        g: 0.49,\n                        b: 0.86,\n                        a: 1.0,\n                    };\n                    rendering::draw_selection_box(ctx, \u0026image.bounds, \u0026selection_color)?;\n                    rendering::draw_resize_handles(ctx, \u0026image.bounds, \u0026selection_color)?;\n                }\n            }\n            DocumentElement::Shape(shape) =\u003e {\n                match shape.kind {\n                    ShapeKind::Rectangle =\u003e {\n                        rendering::draw_rectangle(\n                            ctx,\n                            \u0026shape.bounds,\n                            \u0026shape.stroke,\n                            \u0026shape.fill,\n                        )?;\n                    }\n                    ShapeKind::Ellipse =\u003e {\n                        rendering::draw_ellipse(\n                            ctx,\n                            \u0026shape.bounds,\n                            \u0026shape.stroke,\n                            \u0026shape.fill,\n                        )?;\n                    }\n                    ShapeKind::Line =\u003e {\n                        rendering::draw_line(ctx, \u0026shape.bounds, \u0026shape.stroke)?;\n                    }\n                    ShapeKind::Arrow =\u003e {\n                        rendering::draw_arrow(ctx, \u0026shape.bounds, \u0026shape.stroke)?;\n                    }\n                    ShapeKind::Polygon =\u003e {\n                        rendering::draw_polygon(ctx, \u0026shape.bounds, \u0026shape.stroke)?;\n                    }\n                }\n\n                let is_selected = selected_ids.contains(\u0026shape.id);\n                if is_selected {\n                    let selection_color = testruct_core::typography::Color {\n                        r: 0.05,\n                        g: 0.49,\n                        b: 0.86,\n                        a: 1.0,\n                    };\n                    rendering::draw_selection_box(ctx, \u0026shape.bounds, \u0026selection_color)?;\n                    rendering::draw_resize_handles(ctx, \u0026shape.bounds, \u0026selection_color)?;\n                }\n            }\n        }\n        Ok(())\n    }\n\n    pub fn container(\u0026self) -\u003e ScrolledWindow {\n        self.container.clone()\n    }\n\n    pub fn drawing_area(\u0026self) -\u003e DrawingArea {\n        self.drawing_area.clone()\n    }\n\n    pub fn overlay(\u0026self) -\u003e Overlay {\n        self.overlay.clone()\n    }\n\n    pub fn render_state(\u0026self) -\u003e \u0026CanvasRenderState {\n        \u0026self.render_state\n    }\n\n    /// Set the current tool mode\n    pub fn set_tool_mode(\u0026self, tool: tools::ToolMode) {\n        self.render_state.tool_state.borrow_mut().current_tool = tool;\n        self.drawing_area.queue_draw();\n    }\n\n    /// Get the current tool mode\n    pub fn get_tool_mode(\u0026self) -\u003e tools::ToolMode {\n        self.render_state.tool_state.borrow().current_tool\n    }\n\n    /// Clear all selected objects\n    pub fn clear_selection(\u0026self) {\n        self.render_state.selected_ids.borrow_mut().clear();\n        self.drawing_area.queue_draw();\n    }\n\n    /// Select a single object by ID\n    pub fn select_object(\u0026self, id: uuid::Uuid) {\n        let mut selected = self.render_state.selected_ids.borrow_mut();\n        selected.clear();\n        selected.push(id);\n        drop(selected);\n        self.drawing_area.queue_draw();\n    }\n\n    /// Add an object to the selection\n    pub fn add_to_selection(\u0026self, id: uuid::Uuid) {\n        let mut selected = self.render_state.selected_ids.borrow_mut();\n        if !selected.contains(\u0026id) {\n            selected.push(id);\n        }\n        drop(selected);\n        self.drawing_area.queue_draw();\n    }\n\n    /// Remove an object from the selection\n    pub fn remove_from_selection(\u0026self, id: uuid::Uuid) {\n        let mut selected = self.render_state.selected_ids.borrow_mut();\n        selected.retain(|\u0026selected_id| selected_id != id);\n        drop(selected);\n        self.drawing_area.queue_draw();\n    }\n\n    /// Toggle object selection\n    pub fn toggle_selection(\u0026self, id: uuid::Uuid) {\n        let mut selected = self.render_state.selected_ids.borrow_mut();\n        if let Some(pos) = selected.iter().position(|\u0026selected_id| selected_id == id) {\n            selected.remove(pos);\n        } else {\n            selected.push(id);\n        }\n        drop(selected);\n        self.drawing_area.queue_draw();\n    }\n}\n","traces":[{"line":32,"address":[],"length":0,"stats":{"Line":0}},{"line":34,"address":[],"length":0,"stats":{"Line":0}},{"line":35,"address":[],"length":0,"stats":{"Line":0}},{"line":36,"address":[],"length":0,"stats":{"Line":0}},{"line":37,"address":[],"length":0,"stats":{"Line":0}},{"line":38,"address":[],"length":0,"stats":{"Line":0}},{"line":39,"address":[],"length":0,"stats":{"Line":0}},{"line":52,"address":[],"length":0,"stats":{"Line":0}},{"line":53,"address":[],"length":0,"stats":{"Line":0}},{"line":57,"address":[],"length":0,"stats":{"Line":0}},{"line":58,"address":[],"length":0,"stats":{"Line":0}},{"line":60,"address":[],"length":0,"stats":{"Line":0}},{"line":61,"address":[],"length":0,"stats":{"Line":0}},{"line":62,"address":[],"length":0,"stats":{"Line":0}},{"line":64,"address":[],"length":0,"stats":{"Line":0}},{"line":65,"address":[],"length":0,"stats":{"Line":0}},{"line":66,"address":[],"length":0,"stats":{"Line":0}},{"line":67,"address":[],"length":0,"stats":{"Line":0}},{"line":69,"address":[],"length":0,"stats":{"Line":0}},{"line":72,"address":[],"length":0,"stats":{"Line":0}},{"line":74,"address":[],"length":0,"stats":{"Line":0}},{"line":85,"address":[],"length":0,"stats":{"Line":0}},{"line":90,"address":[],"length":0,"stats":{"Line":0}},{"line":91,"address":[],"length":0,"stats":{"Line":0}},{"line":93,"address":[],"length":0,"stats":{"Line":0}},{"line":94,"address":[],"length":0,"stats":{"Line":0}},{"line":95,"address":[],"length":0,"stats":{"Line":0}},{"line":96,"address":[],"length":0,"stats":{"Line":0}},{"line":97,"address":[],"length":0,"stats":{"Line":0}},{"line":98,"address":[],"length":0,"stats":{"Line":0}},{"line":99,"address":[],"length":0,"stats":{"Line":0}},{"line":101,"address":[],"length":0,"stats":{"Line":0}},{"line":107,"address":[],"length":0,"stats":{"Line":0}},{"line":114,"address":[],"length":0,"stats":{"Line":0}},{"line":115,"address":[],"length":0,"stats":{"Line":0}},{"line":118,"address":[],"length":0,"stats":{"Line":0}},{"line":121,"address":[],"length":0,"stats":{"Line":0}},{"line":122,"address":[],"length":0,"stats":{"Line":0}},{"line":126,"address":[],"length":0,"stats":{"Line":0}},{"line":127,"address":[],"length":0,"stats":{"Line":0}},{"line":131,"address":[],"length":0,"stats":{"Line":0}},{"line":134,"address":[],"length":0,"stats":{"Line":0}},{"line":137,"address":[],"length":0,"stats":{"Line":0}},{"line":138,"address":[],"length":0,"stats":{"Line":0}},{"line":141,"address":[],"length":0,"stats":{"Line":0}},{"line":142,"address":[],"length":0,"stats":{"Line":0}},{"line":146,"address":[],"length":0,"stats":{"Line":0}},{"line":147,"address":[],"length":0,"stats":{"Line":0}},{"line":151,"address":[],"length":0,"stats":{"Line":0}},{"line":152,"address":[],"length":0,"stats":{"Line":0}},{"line":154,"address":[],"length":0,"stats":{"Line":0}},{"line":158,"address":[],"length":0,"stats":{"Line":0}},{"line":164,"address":[],"length":0,"stats":{"Line":0}},{"line":165,"address":[],"length":0,"stats":{"Line":0}},{"line":167,"address":[],"length":0,"stats":{"Line":0}},{"line":171,"address":[],"length":0,"stats":{"Line":0}},{"line":179,"address":[],"length":0,"stats":{"Line":0}},{"line":180,"address":[],"length":0,"stats":{"Line":0}},{"line":182,"address":[],"length":0,"stats":{"Line":0}},{"line":183,"address":[],"length":0,"stats":{"Line":0}},{"line":184,"address":[],"length":0,"stats":{"Line":0}},{"line":185,"address":[],"length":0,"stats":{"Line":0}},{"line":186,"address":[],"length":0,"stats":{"Line":0}},{"line":187,"address":[],"length":0,"stats":{"Line":0}},{"line":188,"address":[],"length":0,"stats":{"Line":0}},{"line":190,"address":[],"length":0,"stats":{"Line":0}},{"line":193,"address":[],"length":0,"stats":{"Line":0}},{"line":194,"address":[],"length":0,"stats":{"Line":0}},{"line":201,"address":[],"length":0,"stats":{"Line":0}},{"line":202,"address":[],"length":0,"stats":{"Line":0}},{"line":206,"address":[],"length":0,"stats":{"Line":0}},{"line":207,"address":[],"length":0,"stats":{"Line":0}},{"line":210,"address":[],"length":0,"stats":{"Line":0}},{"line":212,"address":[],"length":0,"stats":{"Line":0}},{"line":214,"address":[],"length":0,"stats":{"Line":0}},{"line":217,"address":[],"length":0,"stats":{"Line":0}},{"line":218,"address":[],"length":0,"stats":{"Line":0}},{"line":219,"address":[],"length":0,"stats":{"Line":0}},{"line":220,"address":[],"length":0,"stats":{"Line":0}},{"line":223,"address":[],"length":0,"stats":{"Line":0}},{"line":224,"address":[],"length":0,"stats":{"Line":0}},{"line":225,"address":[],"length":0,"stats":{"Line":0}},{"line":226,"address":[],"length":0,"stats":{"Line":0}},{"line":229,"address":[],"length":0,"stats":{"Line":0}},{"line":231,"address":[],"length":0,"stats":{"Line":0}},{"line":234,"address":[],"length":0,"stats":{"Line":0}},{"line":235,"address":[],"length":0,"stats":{"Line":0}},{"line":236,"address":[],"length":0,"stats":{"Line":0}},{"line":237,"address":[],"length":0,"stats":{"Line":0}},{"line":238,"address":[],"length":0,"stats":{"Line":0}},{"line":240,"address":[],"length":0,"stats":{"Line":0}},{"line":247,"address":[],"length":0,"stats":{"Line":0}},{"line":248,"address":[],"length":0,"stats":{"Line":0}},{"line":251,"address":[],"length":0,"stats":{"Line":0}},{"line":253,"address":[],"length":0,"stats":{"Line":0}},{"line":255,"address":[],"length":0,"stats":{"Line":0}},{"line":256,"address":[],"length":0,"stats":{"Line":0}},{"line":263,"address":[],"length":0,"stats":{"Line":0}},{"line":264,"address":[],"length":0,"stats":{"Line":0}},{"line":267,"address":[],"length":0,"stats":{"Line":0}},{"line":268,"address":[],"length":0,"stats":{"Line":0}},{"line":271,"address":[],"length":0,"stats":{"Line":0}},{"line":272,"address":[],"length":0,"stats":{"Line":0}},{"line":273,"address":[],"length":0,"stats":{"Line":0}},{"line":274,"address":[],"length":0,"stats":{"Line":0}},{"line":279,"address":[],"length":0,"stats":{"Line":0}},{"line":280,"address":[],"length":0,"stats":{"Line":0}},{"line":281,"address":[],"length":0,"stats":{"Line":0}},{"line":282,"address":[],"length":0,"stats":{"Line":0}},{"line":286,"address":[],"length":0,"stats":{"Line":0}},{"line":289,"address":[],"length":0,"stats":{"Line":0}},{"line":292,"address":[],"length":0,"stats":{"Line":0}},{"line":296,"address":[],"length":0,"stats":{"Line":0}},{"line":297,"address":[],"length":0,"stats":{"Line":0}},{"line":304,"address":[],"length":0,"stats":{"Line":0}},{"line":305,"address":[],"length":0,"stats":{"Line":0}},{"line":309,"address":[],"length":0,"stats":{"Line":0}},{"line":312,"address":[],"length":0,"stats":{"Line":0}},{"line":313,"address":[],"length":0,"stats":{"Line":0}},{"line":316,"address":[],"length":0,"stats":{"Line":0}},{"line":317,"address":[],"length":0,"stats":{"Line":0}},{"line":320,"address":[],"length":0,"stats":{"Line":0}},{"line":321,"address":[],"length":0,"stats":{"Line":0}},{"line":324,"address":[],"length":0,"stats":{"Line":0}},{"line":325,"address":[],"length":0,"stats":{"Line":0}},{"line":329,"address":[],"length":0,"stats":{"Line":0}},{"line":330,"address":[],"length":0,"stats":{"Line":0}},{"line":331,"address":[],"length":0,"stats":{"Line":0}},{"line":335,"address":[],"length":0,"stats":{"Line":0}},{"line":336,"address":[],"length":0,"stats":{"Line":0}},{"line":340,"address":[],"length":0,"stats":{"Line":0}},{"line":341,"address":[],"length":0,"stats":{"Line":0}},{"line":342,"address":[],"length":0,"stats":{"Line":0}},{"line":346,"address":[],"length":0,"stats":{"Line":0}},{"line":347,"address":[],"length":0,"stats":{"Line":0}},{"line":348,"address":[],"length":0,"stats":{"Line":0}},{"line":349,"address":[],"length":0,"stats":{"Line":0}},{"line":350,"address":[],"length":0,"stats":{"Line":0}},{"line":351,"address":[],"length":0,"stats":{"Line":0}},{"line":355,"address":[],"length":0,"stats":{"Line":0}},{"line":356,"address":[],"length":0,"stats":{"Line":0}},{"line":357,"address":[],"length":0,"stats":{"Line":0}},{"line":358,"address":[],"length":0,"stats":{"Line":0}},{"line":360,"address":[],"length":0,"stats":{"Line":0}},{"line":361,"address":[],"length":0,"stats":{"Line":0}},{"line":365,"address":[],"length":0,"stats":{"Line":0}},{"line":366,"address":[],"length":0,"stats":{"Line":0}},{"line":367,"address":[],"length":0,"stats":{"Line":0}},{"line":368,"address":[],"length":0,"stats":{"Line":0}},{"line":369,"address":[],"length":0,"stats":{"Line":0}},{"line":373,"address":[],"length":0,"stats":{"Line":0}},{"line":374,"address":[],"length":0,"stats":{"Line":0}},{"line":375,"address":[],"length":0,"stats":{"Line":0}},{"line":376,"address":[],"length":0,"stats":{"Line":0}},{"line":378,"address":[],"length":0,"stats":{"Line":0}},{"line":380,"address":[],"length":0,"stats":{"Line":0}},{"line":381,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":157},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","ui","src","canvas","mouse.rs"],"content":"//! Canvas mouse input handling\n//!\n//! This module implements mouse event handling for object selection,\n//! dragging, and resizing on the canvas.\n\nuse std::cell::RefCell;\nuse std::rc::Rc;\nuse testruct_core::layout::{Point, Rect};\n\n/// Mouse interaction state\n#[derive(Clone, Debug, PartialEq)]\npub enum MouseInteraction {\n    /// No active interaction\n    Idle,\n    /// Dragging an object\n    Dragging {\n        object_id: uuid::Uuid,\n        start_pos: Point,\n        offset_x: f64,\n        offset_y: f64,\n    },\n    /// Resizing an object\n    Resizing {\n        object_id: uuid::Uuid,\n        handle: ResizeHandle,\n        start_pos: Point,\n        original_bounds: Rect,\n    },\n    /// Selection drag (marquee)\n    SelectionDrag {\n        start_pos: Point,\n        current_pos: Point,\n    },\n    /// Creating a guide from ruler\n    CreatingGuide {\n        orientation: GuideOrientation,\n        position: f64,\n    },\n}\n\n/// Which resize handle is being dragged\n#[derive(Clone, Copy, Debug, PartialEq, Eq)]\npub enum ResizeHandle {\n    TopLeft,\n    Top,\n    TopRight,\n    Right,\n    BottomRight,\n    Bottom,\n    BottomLeft,\n    Left,\n}\n\n/// Guide orientation\n#[derive(Clone, Copy, Debug, PartialEq, Eq)]\npub enum GuideOrientation {\n    Horizontal,\n    Vertical,\n}\n\n/// Mouse position in canvas coordinates\n#[derive(Clone, Copy, Debug)]\npub struct CanvasMousePos {\n    pub x: f64,\n    pub y: f64,\n}\n\nimpl CanvasMousePos {\n    pub fn new(x: f64, y: f64) -\u003e Self {\n        Self { x, y }\n    }\n\n    pub fn to_point(self) -\u003e Point {\n        Point::new(self.x as f32, self.y as f32)\n    }\n}\n\n/// Convert widget coordinates to canvas coordinates\npub fn widget_to_canvas(\n    widget_x: f64,\n    widget_y: f64,\n    zoom: f64,\n    pan_x: f64,\n    pan_y: f64,\n    ruler_size: f64,\n) -\u003e CanvasMousePos {\n    let canvas_x = ((widget_x - ruler_size - pan_x) / zoom).max(0.0);\n    let canvas_y = ((widget_y - ruler_size - pan_y) / zoom).max(0.0);\n    CanvasMousePos::new(canvas_x, canvas_y)\n}\n\n/// Test if a point is within a rectangle bounds\npub fn point_in_bounds(point: CanvasMousePos, bounds: \u0026Rect) -\u003e bool {\n    point.x \u003e= bounds.origin.x as f64\n        \u0026\u0026 point.x \u003c= bounds.origin.x as f64 + bounds.size.width as f64\n        \u0026\u0026 point.y \u003e= bounds.origin.y as f64\n        \u0026\u0026 point.y \u003c= bounds.origin.y as f64 + bounds.size.height as f64\n}\n\n/// Test if a point is near a resize handle\npub fn test_resize_handle(\n    point: CanvasMousePos,\n    bounds: \u0026Rect,\n    handle_size: f64,\n) -\u003e Option\u003cResizeHandle\u003e {\n    let half_size = handle_size / 2.0;\n    let handles = [\n        (ResizeHandle::TopLeft, bounds.origin.x as f64, bounds.origin.y as f64),\n        (\n            ResizeHandle::Top,\n            bounds.origin.x as f64 + bounds.size.width as f64 / 2.0,\n            bounds.origin.y as f64,\n        ),\n        (\n            ResizeHandle::TopRight,\n            bounds.origin.x as f64 + bounds.size.width as f64,\n            bounds.origin.y as f64,\n        ),\n        (\n            ResizeHandle::Right,\n            bounds.origin.x as f64 + bounds.size.width as f64,\n            bounds.origin.y as f64 + bounds.size.height as f64 / 2.0,\n        ),\n        (\n            ResizeHandle::BottomRight,\n            bounds.origin.x as f64 + bounds.size.width as f64,\n            bounds.origin.y as f64 + bounds.size.height as f64,\n        ),\n        (\n            ResizeHandle::Bottom,\n            bounds.origin.x as f64 + bounds.size.width as f64 / 2.0,\n            bounds.origin.y as f64 + bounds.size.height as f64,\n        ),\n        (\n            ResizeHandle::BottomLeft,\n            bounds.origin.x as f64,\n            bounds.origin.y as f64 + bounds.size.height as f64,\n        ),\n        (\n            ResizeHandle::Left,\n            bounds.origin.x as f64,\n            bounds.origin.y as f64 + bounds.size.height as f64 / 2.0,\n        ),\n    ];\n\n    for (handle, hx, hy) in handles.iter() {\n        if (point.x - hx).abs() \u003c= half_size \u0026\u0026 (point.y - hy).abs() \u003c= half_size {\n            return Some(*handle);\n        }\n    }\n\n    None\n}\n\n/// Get the new bounds after a resize operation\npub fn calculate_resize_bounds(\n    original_bounds: \u0026Rect,\n    handle: ResizeHandle,\n    delta_x: f64,\n    delta_y: f64,\n) -\u003e Rect {\n    let mut new_bounds = *original_bounds;\n    let delta_x_f32 = delta_x as f32;\n    let delta_y_f32 = delta_y as f32;\n\n    match handle {\n        ResizeHandle::TopLeft =\u003e {\n            new_bounds.origin.x += delta_x_f32;\n            new_bounds.origin.y += delta_y_f32;\n            new_bounds.size.width -= delta_x_f32;\n            new_bounds.size.height -= delta_y_f32;\n        }\n        ResizeHandle::Top =\u003e {\n            new_bounds.origin.y += delta_y_f32;\n            new_bounds.size.height -= delta_y_f32;\n        }\n        ResizeHandle::TopRight =\u003e {\n            new_bounds.origin.y += delta_y_f32;\n            new_bounds.size.width += delta_x_f32;\n            new_bounds.size.height -= delta_y_f32;\n        }\n        ResizeHandle::Right =\u003e {\n            new_bounds.size.width += delta_x_f32;\n        }\n        ResizeHandle::BottomRight =\u003e {\n            new_bounds.size.width += delta_x_f32;\n            new_bounds.size.height += delta_y_f32;\n        }\n        ResizeHandle::Bottom =\u003e {\n            new_bounds.size.height += delta_y_f32;\n        }\n        ResizeHandle::BottomLeft =\u003e {\n            new_bounds.origin.x += delta_x_f32;\n            new_bounds.size.width -= delta_x_f32;\n            new_bounds.size.height += delta_y_f32;\n        }\n        ResizeHandle::Left =\u003e {\n            new_bounds.origin.x += delta_x_f32;\n            new_bounds.size.width -= delta_x_f32;\n        }\n    }\n\n    // Ensure minimum size\n    new_bounds.size.width = new_bounds.size.width.max(10.0);\n    new_bounds.size.height = new_bounds.size.height.max(10.0);\n\n    new_bounds\n}\n\n/// Mouse event handler state\npub struct MouseEventHandler {\n    pub interaction: Rc\u003cRefCell\u003cMouseInteraction\u003e\u003e,\n    pub last_pos: Rc\u003cRefCell\u003cOption\u003cCanvasMousePos\u003e\u003e\u003e,\n}\n\nimpl MouseEventHandler {\n    pub fn new() -\u003e Self {\n        Self {\n            interaction: Rc::new(RefCell::new(MouseInteraction::Idle)),\n            last_pos: Rc::new(RefCell::new(None)),\n        }\n    }\n\n    pub fn start_drag(\u0026self, object_id: uuid::Uuid, pos: CanvasMousePos) {\n        *self.interaction.borrow_mut() = MouseInteraction::Dragging {\n            object_id,\n            start_pos: pos.to_point(),\n            offset_x: 0.0,\n            offset_y: 0.0,\n        };\n        *self.last_pos.borrow_mut() = Some(pos);\n    }\n\n    pub fn start_resize(\n        \u0026self,\n        object_id: uuid::Uuid,\n        handle: ResizeHandle,\n        pos: CanvasMousePos,\n        original_bounds: Rect,\n    ) {\n        *self.interaction.borrow_mut() = MouseInteraction::Resizing {\n            object_id,\n            handle,\n            start_pos: pos.to_point(),\n            original_bounds,\n        };\n        *self.last_pos.borrow_mut() = Some(pos);\n    }\n\n    pub fn start_selection_drag(\u0026self, pos: CanvasMousePos) {\n        *self.interaction.borrow_mut() = MouseInteraction::SelectionDrag {\n            start_pos: pos.to_point(),\n            current_pos: pos.to_point(),\n        };\n        *self.last_pos.borrow_mut() = Some(pos);\n    }\n\n    pub fn update_position(\u0026self, pos: CanvasMousePos) {\n        *self.last_pos.borrow_mut() = Some(pos);\n\n        match *self.interaction.borrow_mut() {\n            MouseInteraction::Dragging {\n                object_id: _,\n                start_pos,\n                ref mut offset_x,\n                ref mut offset_y,\n            } =\u003e {\n                *offset_x = pos.x - start_pos.x as f64;\n                *offset_y = pos.y - start_pos.y as f64;\n            }\n            MouseInteraction::SelectionDrag {\n                start_pos: _,\n                ref mut current_pos,\n            } =\u003e {\n                *current_pos = pos.to_point();\n            }\n            _ =\u003e {}\n        }\n    }\n\n    pub fn end_interaction(\u0026self) {\n        *self.interaction.borrow_mut() = MouseInteraction::Idle;\n        *self.last_pos.borrow_mut() = None;\n    }\n\n    pub fn is_interacting(\u0026self) -\u003e bool {\n        *self.interaction.borrow() != MouseInteraction::Idle\n    }\n}\n\nimpl Default for MouseEventHandler {\n    fn default() -\u003e Self {\n        Self::new()\n    }\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n    use testruct_core::layout::Size;\n\n    #[test]\n    fn test_widget_to_canvas_conversion() {\n        let pos = widget_to_canvas(\n            100.0, 150.0, // widget coords\n            1.0,           // zoom\n            0.0, 0.0,      // pan\n            20.0,          // ruler size\n        );\n        assert_eq!(pos.x, 80.0);\n        assert_eq!(pos.y, 130.0);\n    }\n\n    #[test]\n    fn test_widget_to_canvas_with_zoom() {\n        let pos = widget_to_canvas(\n            100.0, 100.0,  // widget coords\n            2.0,            // 2x zoom\n            0.0, 0.0,       // pan\n            20.0,           // ruler size\n        );\n        assert_eq!(pos.x, 40.0);\n        assert_eq!(pos.y, 40.0);\n    }\n\n    #[test]\n    fn test_point_in_bounds() {\n        let bounds = Rect::new(\n            Point::new(10.0, 10.0),\n            Size::new(100.0, 50.0),\n        );\n\n        assert!(point_in_bounds(CanvasMousePos::new(50.0, 30.0), \u0026bounds));\n        assert!(!point_in_bounds(CanvasMousePos::new(5.0, 30.0), \u0026bounds));\n        assert!(!point_in_bounds(CanvasMousePos::new(150.0, 30.0), \u0026bounds));\n    }\n\n    #[test]\n    fn test_resize_bounds_bottom_right() {\n        let bounds = Rect::new(\n            Point::new(0.0, 0.0),\n            Size::new(100.0, 100.0),\n        );\n\n        let new_bounds = calculate_resize_bounds(\u0026bounds, ResizeHandle::BottomRight, 50.0, 25.0);\n        assert_eq!(new_bounds.size.width, 150.0);\n        assert_eq!(new_bounds.size.height, 125.0);\n    }\n\n    #[test]\n    fn test_mouse_event_handler_drag() {\n        let handler = MouseEventHandler::new();\n        let object_id = uuid::Uuid::new_v4();\n\n        handler.start_drag(object_id, CanvasMousePos::new(0.0, 0.0));\n        handler.update_position(CanvasMousePos::new(50.0, 30.0));\n\n        assert!(handler.is_interacting());\n    }\n}\n","traces":[{"line":69,"address":[],"length":0,"stats":{"Line":7}},{"line":73,"address":[],"length":0,"stats":{"Line":1}},{"line":74,"address":[],"length":0,"stats":{"Line":3}},{"line":79,"address":[],"length":0,"stats":{"Line":2}},{"line":87,"address":[],"length":0,"stats":{"Line":6}},{"line":88,"address":[],"length":0,"stats":{"Line":6}},{"line":89,"address":[],"length":0,"stats":{"Line":6}},{"line":93,"address":[],"length":0,"stats":{"Line":3}},{"line":94,"address":[],"length":0,"stats":{"Line":3}},{"line":95,"address":[],"length":0,"stats":{"Line":4}},{"line":96,"address":[],"length":0,"stats":{"Line":1}},{"line":97,"address":[],"length":0,"stats":{"Line":2}},{"line":101,"address":[],"length":0,"stats":{"Line":0}},{"line":106,"address":[],"length":0,"stats":{"Line":0}},{"line":107,"address":[],"length":0,"stats":{"Line":0}},{"line":108,"address":[],"length":0,"stats":{"Line":0}},{"line":110,"address":[],"length":0,"stats":{"Line":0}},{"line":111,"address":[],"length":0,"stats":{"Line":0}},{"line":112,"address":[],"length":0,"stats":{"Line":0}},{"line":115,"address":[],"length":0,"stats":{"Line":0}},{"line":116,"address":[],"length":0,"stats":{"Line":0}},{"line":117,"address":[],"length":0,"stats":{"Line":0}},{"line":120,"address":[],"length":0,"stats":{"Line":0}},{"line":121,"address":[],"length":0,"stats":{"Line":0}},{"line":122,"address":[],"length":0,"stats":{"Line":0}},{"line":125,"address":[],"length":0,"stats":{"Line":0}},{"line":126,"address":[],"length":0,"stats":{"Line":0}},{"line":127,"address":[],"length":0,"stats":{"Line":0}},{"line":130,"address":[],"length":0,"stats":{"Line":0}},{"line":131,"address":[],"length":0,"stats":{"Line":0}},{"line":132,"address":[],"length":0,"stats":{"Line":0}},{"line":135,"address":[],"length":0,"stats":{"Line":0}},{"line":136,"address":[],"length":0,"stats":{"Line":0}},{"line":137,"address":[],"length":0,"stats":{"Line":0}},{"line":140,"address":[],"length":0,"stats":{"Line":0}},{"line":141,"address":[],"length":0,"stats":{"Line":0}},{"line":142,"address":[],"length":0,"stats":{"Line":0}},{"line":146,"address":[],"length":0,"stats":{"Line":0}},{"line":147,"address":[],"length":0,"stats":{"Line":0}},{"line":148,"address":[],"length":0,"stats":{"Line":0}},{"line":152,"address":[],"length":0,"stats":{"Line":0}},{"line":156,"address":[],"length":0,"stats":{"Line":1}},{"line":162,"address":[],"length":0,"stats":{"Line":2}},{"line":163,"address":[],"length":0,"stats":{"Line":2}},{"line":164,"address":[],"length":0,"stats":{"Line":2}},{"line":166,"address":[],"length":0,"stats":{"Line":1}},{"line":167,"address":[],"length":0,"stats":{"Line":0}},{"line":168,"address":[],"length":0,"stats":{"Line":0}},{"line":169,"address":[],"length":0,"stats":{"Line":0}},{"line":170,"address":[],"length":0,"stats":{"Line":0}},{"line":171,"address":[],"length":0,"stats":{"Line":0}},{"line":173,"address":[],"length":0,"stats":{"Line":0}},{"line":174,"address":[],"length":0,"stats":{"Line":0}},{"line":175,"address":[],"length":0,"stats":{"Line":0}},{"line":177,"address":[],"length":0,"stats":{"Line":0}},{"line":178,"address":[],"length":0,"stats":{"Line":0}},{"line":179,"address":[],"length":0,"stats":{"Line":0}},{"line":180,"address":[],"length":0,"stats":{"Line":0}},{"line":182,"address":[],"length":0,"stats":{"Line":0}},{"line":183,"address":[],"length":0,"stats":{"Line":0}},{"line":185,"address":[],"length":0,"stats":{"Line":1}},{"line":186,"address":[],"length":0,"stats":{"Line":1}},{"line":187,"address":[],"length":0,"stats":{"Line":1}},{"line":189,"address":[],"length":0,"stats":{"Line":0}},{"line":190,"address":[],"length":0,"stats":{"Line":0}},{"line":192,"address":[],"length":0,"stats":{"Line":0}},{"line":193,"address":[],"length":0,"stats":{"Line":0}},{"line":194,"address":[],"length":0,"stats":{"Line":0}},{"line":195,"address":[],"length":0,"stats":{"Line":0}},{"line":197,"address":[],"length":0,"stats":{"Line":0}},{"line":198,"address":[],"length":0,"stats":{"Line":0}},{"line":199,"address":[],"length":0,"stats":{"Line":0}},{"line":204,"address":[],"length":0,"stats":{"Line":1}},{"line":205,"address":[],"length":0,"stats":{"Line":1}},{"line":207,"address":[],"length":0,"stats":{"Line":1}},{"line":217,"address":[],"length":0,"stats":{"Line":1}},{"line":219,"address":[],"length":0,"stats":{"Line":4}},{"line":220,"address":[],"length":0,"stats":{"Line":2}},{"line":224,"address":[],"length":0,"stats":{"Line":1}},{"line":225,"address":[],"length":0,"stats":{"Line":2}},{"line":226,"address":[],"length":0,"stats":{"Line":2}},{"line":227,"address":[],"length":0,"stats":{"Line":1}},{"line":228,"address":[],"length":0,"stats":{"Line":1}},{"line":229,"address":[],"length":0,"stats":{"Line":1}},{"line":231,"address":[],"length":0,"stats":{"Line":1}},{"line":234,"address":[],"length":0,"stats":{"Line":0}},{"line":241,"address":[],"length":0,"stats":{"Line":0}},{"line":242,"address":[],"length":0,"stats":{"Line":0}},{"line":243,"address":[],"length":0,"stats":{"Line":0}},{"line":244,"address":[],"length":0,"stats":{"Line":0}},{"line":245,"address":[],"length":0,"stats":{"Line":0}},{"line":247,"address":[],"length":0,"stats":{"Line":0}},{"line":250,"address":[],"length":0,"stats":{"Line":0}},{"line":251,"address":[],"length":0,"stats":{"Line":0}},{"line":252,"address":[],"length":0,"stats":{"Line":0}},{"line":253,"address":[],"length":0,"stats":{"Line":0}},{"line":255,"address":[],"length":0,"stats":{"Line":0}},{"line":258,"address":[],"length":0,"stats":{"Line":1}},{"line":259,"address":[],"length":0,"stats":{"Line":1}},{"line":261,"address":[],"length":0,"stats":{"Line":1}},{"line":264,"address":[],"length":0,"stats":{"Line":1}},{"line":265,"address":[],"length":0,"stats":{"Line":1}},{"line":266,"address":[],"length":0,"stats":{"Line":1}},{"line":267,"address":[],"length":0,"stats":{"Line":1}},{"line":268,"address":[],"length":0,"stats":{"Line":2}},{"line":269,"address":[],"length":0,"stats":{"Line":1}},{"line":273,"address":[],"length":0,"stats":{"Line":0}},{"line":274,"address":[],"length":0,"stats":{"Line":0}},{"line":275,"address":[],"length":0,"stats":{"Line":0}},{"line":277,"address":[],"length":0,"stats":{"Line":0}},{"line":281,"address":[],"length":0,"stats":{"Line":0}},{"line":282,"address":[],"length":0,"stats":{"Line":0}},{"line":283,"address":[],"length":0,"stats":{"Line":0}},{"line":286,"address":[],"length":0,"stats":{"Line":1}},{"line":287,"address":[],"length":0,"stats":{"Line":1}},{"line":292,"address":[],"length":0,"stats":{"Line":0}},{"line":293,"address":[],"length":0,"stats":{"Line":0}}],"covered":44,"coverable":117},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","ui","src","canvas","overlays.rs"],"content":"use gtk4::{prelude::*, Label, Overlay};\n\npub fn add_ruler_overlay(overlay: \u0026Overlay) {\n    let label = Label::builder().label(\"Rulers TBD\").build();\n    overlay.add_overlay(\u0026label);\n    label.set_margin_top(8);\n    label.set_margin_start(8);\n}\n","traces":[{"line":3,"address":[],"length":0,"stats":{"Line":0}},{"line":4,"address":[],"length":0,"stats":{"Line":0}},{"line":5,"address":[],"length":0,"stats":{"Line":0}},{"line":6,"address":[],"length":0,"stats":{"Line":0}},{"line":7,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":5},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","ui","src","canvas","rendering.rs"],"content":"//! Canvas rendering pipeline - Cairo drawing system\n//!\n//! This module provides the complete drawing implementation for the canvas,\n//! including rulers, grid, guides, and document objects.\n\nuse gtk4::cairo::{self, Context};\nuse gtk4::pango;\nuse testruct_core::layout::{Point, Rect, Size};\nuse testruct_core::typography::Color;\n\n/// Configuration for ruler rendering\n#[derive(Clone, Debug)]\npub struct RulerConfig {\n    pub size: f64,\n    pub bg_color: Color,\n    pub tick_color: Color,\n    pub text_color: Color,\n}\n\nimpl Default for RulerConfig {\n    fn default() -\u003e Self {\n        Self {\n            size: 20.0,\n            bg_color: Color {\n                r: 0.95,\n                g: 0.95,\n                b: 0.95,\n                a: 1.0,\n            },\n            tick_color: Color {\n                r: 0.4,\n                g: 0.4,\n                b: 0.4,\n                a: 1.0,\n            },\n            text_color: Color {\n                r: 0.3,\n                g: 0.3,\n                b: 0.3,\n                a: 1.0,\n            },\n        }\n    }\n}\n\n/// Guide line orientation\n#[derive(Clone, Copy, Debug, PartialEq, Eq)]\npub enum GuideOrientation {\n    Horizontal,\n    Vertical,\n}\n\n/// A single guide line\n#[derive(Clone, Debug)]\npub struct Guide {\n    pub orientation: GuideOrientation,\n    pub position: f32,\n    pub color: Color,\n}\n\nimpl Guide {\n    pub fn new(orientation: GuideOrientation, position: f32) -\u003e Self {\n        Self {\n            orientation,\n            position,\n            color: Color {\n                r: 0.2,\n                g: 0.6,\n                b: 1.0,\n                a: 0.6,\n            },\n        }\n    }\n}\n\n/// Canvas rendering state\n#[derive(Clone, Debug)]\npub struct RenderConfig {\n    pub zoom: f64,\n    pub pan_x: f64,\n    pub pan_y: f64,\n    pub show_grid: bool,\n    pub show_rulers: bool,\n    pub show_guides: bool,\n    pub snap_to_grid: bool,\n    pub grid_spacing: f32,\n    pub guides: Vec\u003cGuide\u003e,\n    pub snap_to_guides: bool,\n    pub guide_snap_distance: f32,\n}\n\nimpl Default for RenderConfig {\n    fn default() -\u003e Self {\n        Self {\n            zoom: 1.0,\n            pan_x: 0.0,\n            pan_y: 0.0,\n            show_grid: true,\n            show_rulers: true,\n            show_guides: true,\n            snap_to_grid: true,\n            grid_spacing: 10.0,\n            guides: Vec::new(),\n            snap_to_guides: true,\n            guide_snap_distance: 5.0,\n        }\n    }\n}\n\n/// Resize handle positions\n#[derive(Clone, Copy, Debug, PartialEq, Eq)]\npub enum ResizeHandle {\n    TopLeft,\n    Top,\n    TopRight,\n    Right,\n    BottomRight,\n    Bottom,\n    BottomLeft,\n    Left,\n}\n\nimpl ResizeHandle {\n    /// Get the screen position of a resize handle\n    pub fn position(self, bounds: \u0026Rect) -\u003e Point {\n        match self {\n            ResizeHandle::TopLeft =\u003e Point::new(bounds.origin.x, bounds.origin.y),\n            ResizeHandle::Top =\u003e Point::new(bounds.origin.x + bounds.size.width / 2.0, bounds.origin.y),\n            ResizeHandle::TopRight =\u003e Point::new(bounds.origin.x + bounds.size.width, bounds.origin.y),\n            ResizeHandle::Right =\u003e Point::new(bounds.origin.x + bounds.size.width, bounds.origin.y + bounds.size.height / 2.0),\n            ResizeHandle::BottomRight =\u003e Point::new(bounds.origin.x + bounds.size.width, bounds.origin.y + bounds.size.height),\n            ResizeHandle::Bottom =\u003e Point::new(bounds.origin.x + bounds.size.width / 2.0, bounds.origin.y + bounds.size.height),\n            ResizeHandle::BottomLeft =\u003e Point::new(bounds.origin.x, bounds.origin.y + bounds.size.height),\n            ResizeHandle::Left =\u003e Point::new(bounds.origin.x, bounds.origin.y + bounds.size.height / 2.0),\n        }\n    }\n\n    pub const SIZE: f64 = 8.0;\n    pub const RESIZE_HANDLE_COUNT: usize = 8;\n\n    pub fn all() -\u003e [Self; 8] {\n        [\n            Self::TopLeft,\n            Self::Top,\n            Self::TopRight,\n            Self::Right,\n            Self::BottomRight,\n            Self::Bottom,\n            Self::BottomLeft,\n            Self::Left,\n        ]\n    }\n}\n\n/// Draw the canvas background and rulers\npub fn draw_background(\n    ctx: \u0026Context,\n    width: f64,\n    height: f64,\n    config: \u0026RulerConfig,\n) -\u003e Result\u003c(), cairo::Error\u003e {\n    // White background\n    ctx.set_source_rgb(1.0, 1.0, 1.0);\n    ctx.paint()?;\n\n    // Draw rulers if enabled\n    if config.size \u003e 0.0 {\n        draw_rulers(ctx, width, height, config)?;\n    }\n\n    Ok(())\n}\n\n/// Draw horizontal and vertical rulers\nfn draw_rulers(\n    ctx: \u0026Context,\n    canvas_width: f64,\n    canvas_height: f64,\n    config: \u0026RulerConfig,\n) -\u003e Result\u003c(), cairo::Error\u003e {\n    let size = config.size;\n\n    // Horizontal ruler background\n    ctx.set_source_rgb(\n        config.bg_color.r as f64,\n        config.bg_color.g as f64,\n        config.bg_color.b as f64,\n    );\n    ctx.rectangle(0.0, 0.0, canvas_width, size);\n    ctx.fill()?;\n\n    // Vertical ruler background\n    ctx.rectangle(0.0, 0.0, size, canvas_height);\n    ctx.fill()?;\n\n    // Ruler ticks and text\n    ctx.set_source_rgb(\n        config.tick_color.r as f64,\n        config.tick_color.g as f64,\n        config.tick_color.b as f64,\n    );\n    ctx.set_line_width(1.0);\n    ctx.set_font_size(9.0);\n\n    // Horizontal ruler markings\n    let mut x = 0.0;\n    while x \u003c= canvas_width - size {\n        let screen_x = x + size;\n        let tick_height = if (x as i32) % 100 == 0 {\n            10.0\n        } else if (x as i32) % 50 == 0 {\n            7.0\n        } else if (x as i32) % 10 == 0 {\n            5.0\n        } else {\n            0.0\n        };\n\n        if tick_height \u003e 0.0 {\n            ctx.move_to(screen_x, size - tick_height);\n            ctx.line_to(screen_x, size);\n            ctx.stroke()?;\n\n            // Draw measurement text\n            if (x as i32) % 100 == 0 \u0026\u0026 x \u003e 0.0 {\n                ctx.set_source_rgb(\n                    config.text_color.r as f64,\n                    config.text_color.g as f64,\n                    config.text_color.b as f64,\n                );\n                let text = format!(\"{}\", x as i32);\n                if let Ok(extents) = ctx.text_extents(\u0026text) {\n                    ctx.move_to(screen_x - extents.width() / 2.0, 12.0);\n                    ctx.show_text(\u0026text)?;\n                }\n                ctx.set_source_rgb(\n                    config.tick_color.r as f64,\n                    config.tick_color.g as f64,\n                    config.tick_color.b as f64,\n                );\n            }\n        }\n        x += 10.0;\n    }\n\n    // Vertical ruler markings\n    let mut y = 0.0;\n    while y \u003c= canvas_height - size {\n        let screen_y = y + size;\n        let tick_width = if (y as i32) % 100 == 0 {\n            10.0\n        } else if (y as i32) % 50 == 0 {\n            7.0\n        } else if (y as i32) % 10 == 0 {\n            5.0\n        } else {\n            0.0\n        };\n\n        if tick_width \u003e 0.0 {\n            ctx.move_to(size - tick_width, screen_y);\n            ctx.line_to(size, screen_y);\n            ctx.stroke()?;\n\n            // Draw measurement text\n            if (y as i32) % 100 == 0 \u0026\u0026 y \u003e 0.0 {\n                ctx.set_source_rgb(\n                    config.text_color.r as f64,\n                    config.text_color.g as f64,\n                    config.text_color.b as f64,\n                );\n                let text = format!(\"{}\", y as i32);\n                ctx.save()?;\n                ctx.move_to(6.0, screen_y + 3.0);\n                ctx.show_text(\u0026text)?;\n                ctx.restore()?;\n                ctx.set_source_rgb(\n                    config.tick_color.r as f64,\n                    config.tick_color.g as f64,\n                    config.tick_color.b as f64,\n                );\n            }\n        }\n        y += 10.0;\n    }\n\n    // Translate context past rulers for content drawing\n    ctx.translate(size, size);\n\n    Ok(())\n}\n\n/// Draw the grid pattern\npub fn draw_grid(\n    ctx: \u0026Context,\n    page_size: \u0026Size,\n) -\u003e Result\u003c(), cairo::Error\u003e {\n    ctx.set_source_rgba(0.9, 0.9, 0.9, 0.5);\n    ctx.set_line_width(0.5);\n\n    let grid_spacing = 10.0;\n\n    // Vertical grid lines\n    let mut x = grid_spacing;\n    while x \u003c page_size.width as f64 {\n        ctx.move_to(x, 0.0);\n        ctx.line_to(x, page_size.height as f64);\n        x += grid_spacing;\n    }\n\n    // Horizontal grid lines\n    let mut y = grid_spacing;\n    while y \u003c page_size.height as f64 {\n        ctx.move_to(0.0, y);\n        ctx.line_to(page_size.width as f64, y);\n        y += grid_spacing;\n    }\n\n    ctx.stroke()?;\n    Ok(())\n}\n\n/// Draw page border\npub fn draw_page_border(\n    ctx: \u0026Context,\n    page_size: \u0026Size,\n) -\u003e Result\u003c(), cairo::Error\u003e {\n    ctx.set_source_rgb(0.8, 0.8, 0.8);\n    ctx.set_line_width(1.0);\n    ctx.rectangle(0.0, 0.0, page_size.width as f64, page_size.height as f64);\n    ctx.stroke()?;\n    Ok(())\n}\n\n/// Draw a selection rectangle\npub fn draw_selection_box(\n    ctx: \u0026Context,\n    bounds: \u0026Rect,\n    stroke_color: \u0026Color,\n) -\u003e Result\u003c(), cairo::Error\u003e {\n    ctx.set_source_rgb(stroke_color.r as f64, stroke_color.g as f64, stroke_color.b as f64);\n    ctx.set_line_width(2.0);\n    ctx.rectangle(\n        bounds.origin.x as f64,\n        bounds.origin.y as f64,\n        bounds.size.width as f64,\n        bounds.size.height as f64\n    );\n    ctx.stroke()?;\n\n    // Semi-transparent fill\n    ctx.set_source_rgba(stroke_color.r as f64, stroke_color.g as f64, stroke_color.b as f64, 0.1);\n    ctx.rectangle(\n        bounds.origin.x as f64,\n        bounds.origin.y as f64,\n        bounds.size.width as f64,\n        bounds.size.height as f64\n    );\n    ctx.fill()?;\n\n    Ok(())\n}\n\n/// Draw resize handles for a selected object\npub fn draw_resize_handles(\n    ctx: \u0026Context,\n    bounds: \u0026Rect,\n    handle_color: \u0026Color,\n) -\u003e Result\u003c(), cairo::Error\u003e {\n    for handle in ResizeHandle::all().iter() {\n        let pos = handle.position(bounds);\n        let half_size = ResizeHandle::SIZE / 2.0;\n\n        ctx.set_source_rgb(handle_color.r as f64, handle_color.g as f64, handle_color.b as f64);\n        ctx.rectangle(\n            pos.x as f64 - half_size,\n            pos.y as f64 - half_size,\n            ResizeHandle::SIZE,\n            ResizeHandle::SIZE,\n        );\n        ctx.fill()?;\n\n        // White border\n        ctx.set_source_rgb(1.0, 1.0, 1.0);\n        ctx.set_line_width(1.0);\n        ctx.rectangle(\n            pos.x as f64 - half_size,\n            pos.y as f64 - half_size,\n            ResizeHandle::SIZE,\n            ResizeHandle::SIZE,\n        );\n        ctx.stroke()?;\n    }\n\n    Ok(())\n}\n\n/// Text element rendering constants\nconst TEXT_PADDING: f64 = 5.0;\n\n/// Draw a text element with line wrapping support\npub fn draw_text_element(\n    ctx: \u0026Context,\n    bounds: \u0026Rect,\n    text: \u0026str,\n    style: \u0026testruct_core::typography::TextStyle,\n) -\u003e Result\u003c(), cairo::Error\u003e {\n    ctx.save()?;\n\n    // Draw background color if specified\n    if let Some(bg_color) = style.background_color {\n        ctx.set_source_rgb(bg_color.r as f64, bg_color.g as f64, bg_color.b as f64);\n        ctx.rectangle(\n            bounds.origin.x as f64,\n            bounds.origin.y as f64,\n            bounds.size.width as f64,\n            bounds.size.height as f64\n        );\n        ctx.fill()?;\n    }\n\n    // Clipping rectangle\n    ctx.rectangle(\n        bounds.origin.x as f64,\n        bounds.origin.y as f64,\n        bounds.size.width as f64,\n        bounds.size.height as f64\n    );\n    ctx.clip();\n\n    // Create Pango layout using pangocairo\n    let layout = pangocairo::functions::create_layout(ctx);\n    layout.set_text(text);\n\n    // Set font with styling\n    let mut font_desc = pango::FontDescription::new();\n    font_desc.set_family(\u0026style.font_family);\n    font_desc.set_size((style.font_size * pango::SCALE as f32) as i32);\n\n    // Apply font weight\n    let pango_weight = match style.weight {\n        testruct_core::typography::FontWeight::Thin =\u003e pango::Weight::Thin,\n        testruct_core::typography::FontWeight::Light =\u003e pango::Weight::Light,\n        testruct_core::typography::FontWeight::Regular =\u003e pango::Weight::Normal,\n        testruct_core::typography::FontWeight::Medium =\u003e pango::Weight::Medium,\n        testruct_core::typography::FontWeight::Bold =\u003e pango::Weight::Bold,\n        testruct_core::typography::FontWeight::Black =\u003e pango::Weight::Ultrabold,\n    };\n    font_desc.set_weight(pango_weight);\n\n    // Apply italic style\n    if style.italic {\n        font_desc.set_style(pango::Style::Italic);\n    }\n\n    layout.set_font_description(Some(\u0026font_desc));\n\n    // Apply text alignment\n    let pango_alignment = match style.alignment {\n        testruct_core::typography::TextAlignment::Start =\u003e pango::Alignment::Left,\n        testruct_core::typography::TextAlignment::Center =\u003e pango::Alignment::Center,\n        testruct_core::typography::TextAlignment::End =\u003e pango::Alignment::Right,\n        testruct_core::typography::TextAlignment::Justified =\u003e pango::Alignment::Center, // Fallback for justified\n    };\n    layout.set_alignment(pango_alignment);\n\n    // Enable text wrapping by setting width constraint\n    // This makes canvas rendering consistent with PDF/SVG export\n    let available_width = (bounds.size.width as f64 - (TEXT_PADDING * 2.0)).max(0.0);\n    layout.set_width((available_width * pango::SCALE as f64) as i32);\n\n    // Apply text decorations\n    let mut attrs = pango::AttrList::new();\n    if style.underline {\n        let underline_attr = pango::AttrInt::new_underline(pango::Underline::Single);\n        attrs.insert(underline_attr);\n    }\n    if style.strikethrough {\n        let strikethrough_attr = pango::AttrInt::new_strikethrough(true);\n        attrs.insert(strikethrough_attr);\n    }\n    layout.set_attributes(Some(\u0026attrs));\n\n    // Set text color and position\n    ctx.set_source_rgb(style.color.r as f64, style.color.g as f64, style.color.b as f64);\n    ctx.translate(bounds.origin.x as f64 + TEXT_PADDING, bounds.origin.y as f64 + TEXT_PADDING);\n\n    // Render layout\n    pangocairo::functions::show_layout(ctx, \u0026layout);\n\n    ctx.restore()?;\n    Ok(())\n}\n\n/// Draw a text cursor for editing mode\npub fn draw_text_cursor(\n    ctx: \u0026Context,\n    bounds: \u0026Rect,\n    _text: \u0026str,\n    cursor_pos: usize,\n    style: \u0026testruct_core::typography::TextStyle,\n) -\u003e Result\u003c(), cairo::Error\u003e {\n    ctx.save()?;\n\n    let x_offset = bounds.origin.x as f64 + TEXT_PADDING;\n    let y_offset = bounds.origin.y as f64 + TEXT_PADDING;\n\n    // Estimate cursor x position based on font size and character count\n    // Average character width is approximately 60% of font size for monospace\n    // and ~40-50% for proportional fonts. We use an approximation here.\n    let char_width = (style.font_size as f64) * 0.5;\n    let cursor_x = x_offset + (cursor_pos as f64 * char_width);\n\n    // Draw text cursor as a thin vertical line\n    ctx.set_source_rgb(0.0, 0.5, 1.0); // Blue cursor\n    ctx.set_line_width(2.0);\n    ctx.move_to(cursor_x, y_offset);\n    ctx.line_to(cursor_x, y_offset + (bounds.size.height as f64 - TEXT_PADDING));\n    ctx.stroke()?;\n\n    ctx.restore()?;\n    Ok(())\n}\n\n/// Draw a frame to indicate text editing mode\npub fn draw_text_editing_frame(\n    ctx: \u0026Context,\n    bounds: \u0026Rect,\n) -\u003e Result\u003c(), cairo::Error\u003e {\n    ctx.save()?;\n\n    // Draw a dashed border to indicate editing mode\n    ctx.set_source_rgb(0.2, 0.6, 1.0); // Light blue\n    ctx.set_line_width(2.0);\n    ctx.set_dash(\u0026[5.0, 3.0], 0.0);\n    ctx.rectangle(\n        bounds.origin.x as f64,\n        bounds.origin.y as f64,\n        bounds.size.width as f64,\n        bounds.size.height as f64,\n    );\n    ctx.stroke()?;\n\n    ctx.restore()?;\n    Ok(())\n}\n\n/// Draw a placeholder for image elements\npub fn draw_image_placeholder(\n    ctx: \u0026Context,\n    bounds: \u0026Rect,\n) -\u003e Result\u003c(), cairo::Error\u003e {\n    ctx.save()?;\n\n    // Draw background with subtle gradient effect\n    ctx.set_source_rgb(0.96, 0.96, 0.98);\n    ctx.rectangle(\n        bounds.origin.x as f64,\n        bounds.origin.y as f64,\n        bounds.size.width as f64,\n        bounds.size.height as f64,\n    );\n    ctx.fill()?;\n\n    // Draw border with rounded corners effect\n    ctx.set_source_rgb(0.65, 0.71, 0.82);\n    ctx.set_line_width(1.5);\n    ctx.rectangle(\n        bounds.origin.x as f64,\n        bounds.origin.y as f64,\n        bounds.size.width as f64,\n        bounds.size.height as f64,\n    );\n    ctx.stroke()?;\n\n    // Draw image icon (simple mountain/photo symbol)\n    let cx = bounds.origin.x as f64 + bounds.size.width as f64 / 2.0;\n    let cy = bounds.origin.y as f64 + bounds.size.height as f64 / 2.0;\n    let icon_size = 30.0;\n\n    ctx.set_source_rgb(0.55, 0.63, 0.75);\n    ctx.set_line_width(2.0);\n\n    // Draw mountain peaks\n    ctx.move_to(cx - icon_size, cy + icon_size * 0.3);\n    ctx.line_to(cx - icon_size * 0.3, cy - icon_size * 0.3);\n    ctx.line_to(cx + icon_size * 0.3, cy + icon_size * 0.2);\n    ctx.line_to(cx + icon_size, cy - icon_size * 0.3);\n    ctx.stroke()?;\n\n    // Draw circle (representing sun)\n    ctx.arc(cx - icon_size * 0.5, cy - icon_size * 0.5, icon_size * 0.2, 0.0, std::f64::consts::PI * 2.0);\n    ctx.stroke()?;\n\n    // Draw \"Image\" text with better styling\n    ctx.set_source_rgb(0.4, 0.4, 0.5);\n    ctx.move_to(cx - icon_size * 0.4, cy + icon_size * 0.8);\n    let layout = pangocairo::functions::create_layout(ctx);\n    layout.set_text(\"Image Placeholder\");\n    let mut font_desc = pango::FontDescription::new();\n    font_desc.set_family(\"Sans\");\n    font_desc.set_size((11 * pango::SCALE as i32) as i32);\n    layout.set_font_description(Some(\u0026font_desc));\n    pangocairo::functions::show_layout(ctx, \u0026layout);\n\n    // Draw helpful hint text\n    if bounds.size.height \u003e 80.0 \u0026\u0026 bounds.size.width \u003e 100.0 {\n        ctx.set_source_rgb(0.6, 0.6, 0.6);\n        ctx.move_to(\n            bounds.origin.x as f64 + 5.0,\n            bounds.origin.y as f64 + bounds.size.height as f64 - 15.0,\n        );\n        let hint_layout = pangocairo::functions::create_layout(ctx);\n        hint_layout.set_text(\"(Actual image will display here)\");\n        let mut hint_font = pango::FontDescription::new();\n        hint_font.set_family(\"Sans\");\n        hint_font.set_size((9 * pango::SCALE as i32) as i32);\n        hint_layout.set_font_description(Some(\u0026hint_font));\n        pangocairo::functions::show_layout(ctx, \u0026hint_layout);\n    }\n\n    ctx.restore()?;\n    Ok(())\n}\n\n/// Draw a rectangle shape\npub fn draw_rectangle(\n    ctx: \u0026Context,\n    bounds: \u0026Rect,\n    stroke: \u0026Option\u003cColor\u003e,\n    fill: \u0026Option\u003cColor\u003e,\n) -\u003e Result\u003c(), cairo::Error\u003e {\n    if let Some(fill_color) = fill {\n        ctx.set_source_rgb(fill_color.r as f64, fill_color.g as f64, fill_color.b as f64);\n        ctx.rectangle(\n            bounds.origin.x as f64,\n            bounds.origin.y as f64,\n            bounds.size.width as f64,\n            bounds.size.height as f64\n        );\n        ctx.fill()?;\n    }\n\n    if let Some(stroke_color) = stroke {\n        ctx.set_source_rgb(stroke_color.r as f64, stroke_color.g as f64, stroke_color.b as f64);\n        ctx.set_line_width(2.0);\n        ctx.rectangle(\n            bounds.origin.x as f64,\n            bounds.origin.y as f64,\n            bounds.size.width as f64,\n            bounds.size.height as f64\n        );\n        ctx.stroke()?;\n    }\n\n    Ok(())\n}\n\n/// Draw a circle/ellipse shape\npub fn draw_ellipse(\n    ctx: \u0026Context,\n    bounds: \u0026Rect,\n    stroke: \u0026Option\u003cColor\u003e,\n    fill: \u0026Option\u003cColor\u003e,\n) -\u003e Result\u003c(), cairo::Error\u003e {\n    let cx = bounds.origin.x as f64 + bounds.size.width as f64 / 2.0;\n    let cy = bounds.origin.y as f64 + bounds.size.height as f64 / 2.0;\n    let rx = bounds.size.width as f64 / 2.0;\n    let ry = bounds.size.height as f64 / 2.0;\n\n    // Draw ellipse path using arc approximation\n    ctx.save()?;\n    ctx.translate(cx, cy);\n    ctx.scale(rx, ry);\n    ctx.arc(0.0, 0.0, 1.0, 0.0, 2.0 * std::f64::consts::PI);\n    ctx.restore()?;\n\n    if let Some(fill_color) = fill {\n        ctx.set_source_rgb(fill_color.r as f64, fill_color.g as f64, fill_color.b as f64);\n        ctx.fill_preserve()?;\n    }\n\n    if let Some(stroke_color) = stroke {\n        ctx.set_source_rgb(stroke_color.r as f64, stroke_color.g as f64, stroke_color.b as f64);\n        ctx.set_line_width(2.0);\n        ctx.stroke()?;\n    }\n\n    Ok(())\n}\n\n/// Draw a line shape\npub fn draw_line(\n    ctx: \u0026Context,\n    bounds: \u0026Rect,\n    stroke: \u0026Option\u003cColor\u003e,\n) -\u003e Result\u003c(), cairo::Error\u003e {\n    if let Some(stroke_color) = stroke {\n        ctx.set_source_rgb(stroke_color.r as f64, stroke_color.g as f64, stroke_color.b as f64);\n        ctx.set_line_width(2.0);\n        ctx.move_to(bounds.origin.x as f64, bounds.origin.y as f64);\n        ctx.line_to(\n            bounds.origin.x as f64 + bounds.size.width as f64,\n            bounds.origin.y as f64 + bounds.size.height as f64\n        );\n        ctx.stroke()?;\n    }\n\n    Ok(())\n}\n\n/// Draw an arrow shape\npub fn draw_arrow(\n    ctx: \u0026Context,\n    bounds: \u0026Rect,\n    stroke: \u0026Option\u003cColor\u003e,\n) -\u003e Result\u003c(), cairo::Error\u003e {\n    let stroke_color = stroke.unwrap_or(Color { r: 0.0, g: 0.0, b: 0.0, a: 1.0 });\n\n    let x1 = bounds.origin.x as f64;\n    let y1 = bounds.origin.y as f64;\n    let x2 = bounds.origin.x as f64 + bounds.size.width as f64;\n    let y2 = bounds.origin.y as f64 + bounds.size.height as f64;\n\n    // Draw the line\n    ctx.set_source_rgb(stroke_color.r as f64, stroke_color.g as f64, stroke_color.b as f64);\n    ctx.set_line_width(2.0);\n    ctx.move_to(x1, y1);\n    ctx.line_to(x2, y2);\n    ctx.stroke()?;\n\n    // Draw the arrowhead\n    let arrow_size = 12.0;\n    let angle = (y2 - y1).atan2(x2 - x1);\n\n    // Calculate arrowhead points\n    let point1_x = x2 - arrow_size * angle.cos();\n    let point1_y = y2 - arrow_size * angle.sin();\n\n    let arrow_angle = std::f64::consts::PI / 6.0; // 30 degrees\n    let p1x = point1_x - arrow_size * (angle - arrow_angle).cos();\n    let p1y = point1_y - arrow_size * (angle - arrow_angle).sin();\n    let p2x = point1_x - arrow_size * (angle + arrow_angle).cos();\n    let p2y = point1_y - arrow_size * (angle + arrow_angle).sin();\n\n    // Draw arrowhead triangle\n    ctx.move_to(x2, y2);\n    ctx.line_to(p1x, p1y);\n    ctx.line_to(p2x, p2y);\n    ctx.close_path();\n    ctx.set_source_rgb(stroke_color.r as f64, stroke_color.g as f64, stroke_color.b as f64);\n    ctx.fill()?;\n\n    Ok(())\n}\n\n/// Draw a polygon shape (pentagon by default)\npub fn draw_polygon(\n    ctx: \u0026Context,\n    bounds: \u0026Rect,\n    stroke: \u0026Option\u003cColor\u003e,\n) -\u003e Result\u003c(), cairo::Error\u003e {\n    let stroke_color = stroke.unwrap_or(Color { r: 0.0, g: 0.0, b: 0.0, a: 1.0 });\n\n    let center_x = bounds.origin.x as f64 + bounds.size.width as f64 / 2.0;\n    let center_y = bounds.origin.y as f64 + bounds.size.height as f64 / 2.0;\n    let radius = (bounds.size.width as f64 / 2.0).min(bounds.size.height as f64 / 2.0);\n\n    // Draw a pentagon (5-sided polygon)\n    const SIDES: usize = 5;\n    let mut first = true;\n\n    for i in 0..SIDES {\n        let angle = (2.0 * std::f64::consts::PI * i as f64 / SIDES as f64) - std::f64::consts::PI / 2.0;\n        let x = center_x + radius * angle.cos();\n        let y = center_y + radius * angle.sin();\n\n        if first {\n            ctx.move_to(x, y);\n            first = false;\n        } else {\n            ctx.line_to(x, y);\n        }\n    }\n\n    ctx.close_path();\n    ctx.set_source_rgb(stroke_color.r as f64, stroke_color.g as f64, stroke_color.b as f64);\n    ctx.set_line_width(2.0);\n    ctx.stroke()?;\n\n    Ok(())\n}\n\n/// Draw guide lines on the canvas\npub fn draw_guides(\n    ctx: \u0026Context,\n    guides: \u0026[Guide],\n    page_size: \u0026Size,\n) -\u003e Result\u003c(), cairo::Error\u003e {\n    for guide in guides {\n        ctx.set_source_rgba(\n            guide.color.r as f64,\n            guide.color.g as f64,\n            guide.color.b as f64,\n            guide.color.a as f64,\n        );\n        ctx.set_line_width(1.0);\n\n        match guide.orientation {\n            GuideOrientation::Vertical =\u003e {\n                // Vertical guide line\n                let x = guide.position as f64;\n                ctx.move_to(x, 0.0);\n                ctx.line_to(x, page_size.height as f64);\n            }\n            GuideOrientation::Horizontal =\u003e {\n                // Horizontal guide line\n                let y = guide.position as f64;\n                ctx.move_to(0.0, y);\n                ctx.line_to(page_size.width as f64, y);\n            }\n        }\n        ctx.stroke()?;\n    }\n    Ok(())\n}\n\n/// Find the closest guide to a position\npub fn snap_to_guide(\n    value: f32,\n    guides: \u0026[Guide],\n    orientation: GuideOrientation,\n    snap_distance: f32,\n) -\u003e Option\u003cf32\u003e {\n    for guide in guides {\n        if guide.orientation == orientation {\n            let distance = (value - guide.position).abs();\n            if distance \u003c= snap_distance {\n                return Some(guide.position);\n            }\n        }\n    }\n    None\n}\n\n/// Grid snapping configuration\npub struct GridSnapConfig {\n    pub enabled: bool,\n    pub spacing: f32,\n}\n\nimpl Default for GridSnapConfig {\n    fn default() -\u003e Self {\n        Self {\n            enabled: true,\n            spacing: 10.0,\n        }\n    }\n}\n\n/// Snap a coordinate value to the grid\npub fn snap_to_grid(value: f32, spacing: f32) -\u003e f32 {\n    if spacing \u003e 0.0 {\n        (value / spacing).round() * spacing\n    } else {\n        value\n    }\n}\n\n/// Snap a point to the grid\npub fn snap_point_to_grid(point: \u0026Point, spacing: f32) -\u003e Point {\n    Point::new(\n        snap_to_grid(point.x, spacing),\n        snap_to_grid(point.y, spacing),\n    )\n}\n\n/// Snap a rectangle's origin to the grid\npub fn snap_rect_to_grid(rect: \u0026Rect, spacing: f32) -\u003e Rect {\n    Rect::new(\n        snap_point_to_grid(\u0026rect.origin, spacing),\n        rect.size.clone(),\n    )\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n\n    #[test]\n    fn test_resize_handle_positions() {\n        let bounds = Rect::new(\n            Point::new(10.0, 20.0),\n            testruct_core::layout::Size::new(100.0, 80.0)\n        );\n\n        let tl = ResizeHandle::TopLeft.position(\u0026bounds);\n        assert_eq!(tl.x, 10.0);\n        assert_eq!(tl.y, 20.0);\n\n        let br = ResizeHandle::BottomRight.position(\u0026bounds);\n        assert_eq!(br.x, 110.0);\n        assert_eq!(br.y, 100.0);\n\n        let center = ResizeHandle::Top.position(\u0026bounds);\n        assert_eq!(center.x, 60.0);\n        assert_eq!(center.y, 20.0);\n    }\n\n    #[test]\n    fn test_ruler_config_default() {\n        let config = RulerConfig::default();\n        assert_eq!(config.size, 20.0);\n        assert!(config.bg_color.r \u003e 0.9);\n    }\n\n    #[test]\n    fn test_render_config_default() {\n        let config = RenderConfig::default();\n        assert_eq!(config.zoom, 1.0);\n        assert_eq!(config.pan_x, 0.0);\n        assert_eq!(config.pan_y, 0.0);\n        assert!(config.show_grid);\n        assert!(config.show_rulers);\n    }\n}\n","traces":[{"line":21,"address":[],"length":0,"stats":{"Line":1}},{"line":24,"address":[],"length":0,"stats":{"Line":2}},{"line":30,"address":[],"length":0,"stats":{"Line":1}},{"line":36,"address":[],"length":0,"stats":{"Line":1}},{"line":62,"address":[],"length":0,"stats":{"Line":0}},{"line":66,"address":[],"length":0,"stats":{"Line":0}},{"line":93,"address":[],"length":0,"stats":{"Line":1}},{"line":103,"address":[],"length":0,"stats":{"Line":1}},{"line":125,"address":[],"length":0,"stats":{"Line":3}},{"line":126,"address":[],"length":0,"stats":{"Line":3}},{"line":127,"address":[],"length":0,"stats":{"Line":3}},{"line":128,"address":[],"length":0,"stats":{"Line":3}},{"line":129,"address":[],"length":0,"stats":{"Line":0}},{"line":130,"address":[],"length":0,"stats":{"Line":0}},{"line":131,"address":[],"length":0,"stats":{"Line":3}},{"line":132,"address":[],"length":0,"stats":{"Line":0}},{"line":133,"address":[],"length":0,"stats":{"Line":0}},{"line":134,"address":[],"length":0,"stats":{"Line":0}},{"line":141,"address":[],"length":0,"stats":{"Line":0}},{"line":143,"address":[],"length":0,"stats":{"Line":0}},{"line":144,"address":[],"length":0,"stats":{"Line":0}},{"line":145,"address":[],"length":0,"stats":{"Line":0}},{"line":146,"address":[],"length":0,"stats":{"Line":0}},{"line":147,"address":[],"length":0,"stats":{"Line":0}},{"line":148,"address":[],"length":0,"stats":{"Line":0}},{"line":149,"address":[],"length":0,"stats":{"Line":0}},{"line":150,"address":[],"length":0,"stats":{"Line":0}},{"line":156,"address":[],"length":0,"stats":{"Line":0}},{"line":163,"address":[],"length":0,"stats":{"Line":0}},{"line":164,"address":[],"length":0,"stats":{"Line":0}},{"line":167,"address":[],"length":0,"stats":{"Line":0}},{"line":168,"address":[],"length":0,"stats":{"Line":0}},{"line":171,"address":[],"length":0,"stats":{"Line":0}},{"line":175,"address":[],"length":0,"stats":{"Line":0}},{"line":181,"address":[],"length":0,"stats":{"Line":0}},{"line":184,"address":[],"length":0,"stats":{"Line":0}},{"line":185,"address":[],"length":0,"stats":{"Line":0}},{"line":186,"address":[],"length":0,"stats":{"Line":0}},{"line":187,"address":[],"length":0,"stats":{"Line":0}},{"line":189,"address":[],"length":0,"stats":{"Line":0}},{"line":190,"address":[],"length":0,"stats":{"Line":0}},{"line":193,"address":[],"length":0,"stats":{"Line":0}},{"line":194,"address":[],"length":0,"stats":{"Line":0}},{"line":197,"address":[],"length":0,"stats":{"Line":0}},{"line":198,"address":[],"length":0,"stats":{"Line":0}},{"line":199,"address":[],"length":0,"stats":{"Line":0}},{"line":200,"address":[],"length":0,"stats":{"Line":0}},{"line":202,"address":[],"length":0,"stats":{"Line":0}},{"line":203,"address":[],"length":0,"stats":{"Line":0}},{"line":206,"address":[],"length":0,"stats":{"Line":0}},{"line":207,"address":[],"length":0,"stats":{"Line":0}},{"line":208,"address":[],"length":0,"stats":{"Line":0}},{"line":209,"address":[],"length":0,"stats":{"Line":0}},{"line":210,"address":[],"length":0,"stats":{"Line":0}},{"line":211,"address":[],"length":0,"stats":{"Line":0}},{"line":212,"address":[],"length":0,"stats":{"Line":0}},{"line":213,"address":[],"length":0,"stats":{"Line":0}},{"line":214,"address":[],"length":0,"stats":{"Line":0}},{"line":216,"address":[],"length":0,"stats":{"Line":0}},{"line":219,"address":[],"length":0,"stats":{"Line":0}},{"line":220,"address":[],"length":0,"stats":{"Line":0}},{"line":221,"address":[],"length":0,"stats":{"Line":0}},{"line":222,"address":[],"length":0,"stats":{"Line":0}},{"line":225,"address":[],"length":0,"stats":{"Line":0}},{"line":226,"address":[],"length":0,"stats":{"Line":0}},{"line":227,"address":[],"length":0,"stats":{"Line":0}},{"line":228,"address":[],"length":0,"stats":{"Line":0}},{"line":229,"address":[],"length":0,"stats":{"Line":0}},{"line":231,"address":[],"length":0,"stats":{"Line":0}},{"line":232,"address":[],"length":0,"stats":{"Line":0}},{"line":233,"address":[],"length":0,"stats":{"Line":0}},{"line":234,"address":[],"length":0,"stats":{"Line":0}},{"line":236,"address":[],"length":0,"stats":{"Line":0}},{"line":237,"address":[],"length":0,"stats":{"Line":0}},{"line":238,"address":[],"length":0,"stats":{"Line":0}},{"line":239,"address":[],"length":0,"stats":{"Line":0}},{"line":243,"address":[],"length":0,"stats":{"Line":0}},{"line":247,"address":[],"length":0,"stats":{"Line":0}},{"line":248,"address":[],"length":0,"stats":{"Line":0}},{"line":249,"address":[],"length":0,"stats":{"Line":0}},{"line":250,"address":[],"length":0,"stats":{"Line":0}},{"line":251,"address":[],"length":0,"stats":{"Line":0}},{"line":252,"address":[],"length":0,"stats":{"Line":0}},{"line":253,"address":[],"length":0,"stats":{"Line":0}},{"line":254,"address":[],"length":0,"stats":{"Line":0}},{"line":255,"address":[],"length":0,"stats":{"Line":0}},{"line":257,"address":[],"length":0,"stats":{"Line":0}},{"line":260,"address":[],"length":0,"stats":{"Line":0}},{"line":261,"address":[],"length":0,"stats":{"Line":0}},{"line":262,"address":[],"length":0,"stats":{"Line":0}},{"line":263,"address":[],"length":0,"stats":{"Line":0}},{"line":266,"address":[],"length":0,"stats":{"Line":0}},{"line":267,"address":[],"length":0,"stats":{"Line":0}},{"line":268,"address":[],"length":0,"stats":{"Line":0}},{"line":269,"address":[],"length":0,"stats":{"Line":0}},{"line":270,"address":[],"length":0,"stats":{"Line":0}},{"line":272,"address":[],"length":0,"stats":{"Line":0}},{"line":273,"address":[],"length":0,"stats":{"Line":0}},{"line":274,"address":[],"length":0,"stats":{"Line":0}},{"line":275,"address":[],"length":0,"stats":{"Line":0}},{"line":276,"address":[],"length":0,"stats":{"Line":0}},{"line":277,"address":[],"length":0,"stats":{"Line":0}},{"line":278,"address":[],"length":0,"stats":{"Line":0}},{"line":279,"address":[],"length":0,"stats":{"Line":0}},{"line":280,"address":[],"length":0,"stats":{"Line":0}},{"line":284,"address":[],"length":0,"stats":{"Line":0}},{"line":288,"address":[],"length":0,"stats":{"Line":0}},{"line":290,"address":[],"length":0,"stats":{"Line":0}},{"line":294,"address":[],"length":0,"stats":{"Line":0}},{"line":298,"address":[],"length":0,"stats":{"Line":0}},{"line":299,"address":[],"length":0,"stats":{"Line":0}},{"line":301,"address":[],"length":0,"stats":{"Line":0}},{"line":304,"address":[],"length":0,"stats":{"Line":0}},{"line":305,"address":[],"length":0,"stats":{"Line":0}},{"line":306,"address":[],"length":0,"stats":{"Line":0}},{"line":307,"address":[],"length":0,"stats":{"Line":0}},{"line":308,"address":[],"length":0,"stats":{"Line":0}},{"line":312,"address":[],"length":0,"stats":{"Line":0}},{"line":313,"address":[],"length":0,"stats":{"Line":0}},{"line":314,"address":[],"length":0,"stats":{"Line":0}},{"line":315,"address":[],"length":0,"stats":{"Line":0}},{"line":316,"address":[],"length":0,"stats":{"Line":0}},{"line":319,"address":[],"length":0,"stats":{"Line":0}},{"line":320,"address":[],"length":0,"stats":{"Line":0}},{"line":324,"address":[],"length":0,"stats":{"Line":0}},{"line":328,"address":[],"length":0,"stats":{"Line":0}},{"line":329,"address":[],"length":0,"stats":{"Line":0}},{"line":330,"address":[],"length":0,"stats":{"Line":0}},{"line":331,"address":[],"length":0,"stats":{"Line":0}},{"line":332,"address":[],"length":0,"stats":{"Line":0}},{"line":336,"address":[],"length":0,"stats":{"Line":0}},{"line":341,"address":[],"length":0,"stats":{"Line":0}},{"line":342,"address":[],"length":0,"stats":{"Line":0}},{"line":343,"address":[],"length":0,"stats":{"Line":0}},{"line":344,"address":[],"length":0,"stats":{"Line":0}},{"line":345,"address":[],"length":0,"stats":{"Line":0}},{"line":346,"address":[],"length":0,"stats":{"Line":0}},{"line":347,"address":[],"length":0,"stats":{"Line":0}},{"line":349,"address":[],"length":0,"stats":{"Line":0}},{"line":352,"address":[],"length":0,"stats":{"Line":0}},{"line":353,"address":[],"length":0,"stats":{"Line":0}},{"line":354,"address":[],"length":0,"stats":{"Line":0}},{"line":355,"address":[],"length":0,"stats":{"Line":0}},{"line":356,"address":[],"length":0,"stats":{"Line":0}},{"line":357,"address":[],"length":0,"stats":{"Line":0}},{"line":359,"address":[],"length":0,"stats":{"Line":0}},{"line":361,"address":[],"length":0,"stats":{"Line":0}},{"line":365,"address":[],"length":0,"stats":{"Line":0}},{"line":370,"address":[],"length":0,"stats":{"Line":0}},{"line":371,"address":[],"length":0,"stats":{"Line":0}},{"line":372,"address":[],"length":0,"stats":{"Line":0}},{"line":374,"address":[],"length":0,"stats":{"Line":0}},{"line":375,"address":[],"length":0,"stats":{"Line":0}},{"line":376,"address":[],"length":0,"stats":{"Line":0}},{"line":377,"address":[],"length":0,"stats":{"Line":0}},{"line":381,"address":[],"length":0,"stats":{"Line":0}},{"line":384,"address":[],"length":0,"stats":{"Line":0}},{"line":385,"address":[],"length":0,"stats":{"Line":0}},{"line":386,"address":[],"length":0,"stats":{"Line":0}},{"line":387,"address":[],"length":0,"stats":{"Line":0}},{"line":388,"address":[],"length":0,"stats":{"Line":0}},{"line":392,"address":[],"length":0,"stats":{"Line":0}},{"line":395,"address":[],"length":0,"stats":{"Line":0}},{"line":402,"address":[],"length":0,"stats":{"Line":0}},{"line":408,"address":[],"length":0,"stats":{"Line":0}},{"line":411,"address":[],"length":0,"stats":{"Line":0}},{"line":412,"address":[],"length":0,"stats":{"Line":0}},{"line":413,"address":[],"length":0,"stats":{"Line":0}},{"line":414,"address":[],"length":0,"stats":{"Line":0}},{"line":415,"address":[],"length":0,"stats":{"Line":0}},{"line":416,"address":[],"length":0,"stats":{"Line":0}},{"line":417,"address":[],"length":0,"stats":{"Line":0}},{"line":419,"address":[],"length":0,"stats":{"Line":0}},{"line":423,"address":[],"length":0,"stats":{"Line":0}},{"line":424,"address":[],"length":0,"stats":{"Line":0}},{"line":425,"address":[],"length":0,"stats":{"Line":0}},{"line":426,"address":[],"length":0,"stats":{"Line":0}},{"line":427,"address":[],"length":0,"stats":{"Line":0}},{"line":429,"address":[],"length":0,"stats":{"Line":0}},{"line":432,"address":[],"length":0,"stats":{"Line":0}},{"line":433,"address":[],"length":0,"stats":{"Line":0}},{"line":436,"address":[],"length":0,"stats":{"Line":0}},{"line":437,"address":[],"length":0,"stats":{"Line":0}},{"line":438,"address":[],"length":0,"stats":{"Line":0}},{"line":441,"address":[],"length":0,"stats":{"Line":0}},{"line":442,"address":[],"length":0,"stats":{"Line":0}},{"line":443,"address":[],"length":0,"stats":{"Line":0}},{"line":444,"address":[],"length":0,"stats":{"Line":0}},{"line":445,"address":[],"length":0,"stats":{"Line":0}},{"line":446,"address":[],"length":0,"stats":{"Line":0}},{"line":447,"address":[],"length":0,"stats":{"Line":0}},{"line":449,"address":[],"length":0,"stats":{"Line":0}},{"line":452,"address":[],"length":0,"stats":{"Line":0}},{"line":453,"address":[],"length":0,"stats":{"Line":0}},{"line":456,"address":[],"length":0,"stats":{"Line":0}},{"line":459,"address":[],"length":0,"stats":{"Line":0}},{"line":460,"address":[],"length":0,"stats":{"Line":0}},{"line":461,"address":[],"length":0,"stats":{"Line":0}},{"line":462,"address":[],"length":0,"stats":{"Line":0}},{"line":463,"address":[],"length":0,"stats":{"Line":0}},{"line":465,"address":[],"length":0,"stats":{"Line":0}},{"line":469,"address":[],"length":0,"stats":{"Line":0}},{"line":470,"address":[],"length":0,"stats":{"Line":0}},{"line":473,"address":[],"length":0,"stats":{"Line":0}},{"line":474,"address":[],"length":0,"stats":{"Line":0}},{"line":475,"address":[],"length":0,"stats":{"Line":0}},{"line":476,"address":[],"length":0,"stats":{"Line":0}},{"line":478,"address":[],"length":0,"stats":{"Line":0}},{"line":479,"address":[],"length":0,"stats":{"Line":0}},{"line":480,"address":[],"length":0,"stats":{"Line":0}},{"line":482,"address":[],"length":0,"stats":{"Line":0}},{"line":485,"address":[],"length":0,"stats":{"Line":0}},{"line":486,"address":[],"length":0,"stats":{"Line":0}},{"line":489,"address":[],"length":0,"stats":{"Line":0}},{"line":491,"address":[],"length":0,"stats":{"Line":0}},{"line":492,"address":[],"length":0,"stats":{"Line":0}},{"line":496,"address":[],"length":0,"stats":{"Line":0}},{"line":503,"address":[],"length":0,"stats":{"Line":0}},{"line":505,"address":[],"length":0,"stats":{"Line":0}},{"line":506,"address":[],"length":0,"stats":{"Line":0}},{"line":511,"address":[],"length":0,"stats":{"Line":0}},{"line":512,"address":[],"length":0,"stats":{"Line":0}},{"line":515,"address":[],"length":0,"stats":{"Line":0}},{"line":516,"address":[],"length":0,"stats":{"Line":0}},{"line":517,"address":[],"length":0,"stats":{"Line":0}},{"line":518,"address":[],"length":0,"stats":{"Line":0}},{"line":519,"address":[],"length":0,"stats":{"Line":0}},{"line":521,"address":[],"length":0,"stats":{"Line":0}},{"line":522,"address":[],"length":0,"stats":{"Line":0}},{"line":526,"address":[],"length":0,"stats":{"Line":0}},{"line":530,"address":[],"length":0,"stats":{"Line":0}},{"line":533,"address":[],"length":0,"stats":{"Line":0}},{"line":534,"address":[],"length":0,"stats":{"Line":0}},{"line":535,"address":[],"length":0,"stats":{"Line":0}},{"line":536,"address":[],"length":0,"stats":{"Line":0}},{"line":537,"address":[],"length":0,"stats":{"Line":0}},{"line":538,"address":[],"length":0,"stats":{"Line":0}},{"line":539,"address":[],"length":0,"stats":{"Line":0}},{"line":540,"address":[],"length":0,"stats":{"Line":0}},{"line":542,"address":[],"length":0,"stats":{"Line":0}},{"line":544,"address":[],"length":0,"stats":{"Line":0}},{"line":545,"address":[],"length":0,"stats":{"Line":0}},{"line":549,"address":[],"length":0,"stats":{"Line":0}},{"line":553,"address":[],"length":0,"stats":{"Line":0}},{"line":556,"address":[],"length":0,"stats":{"Line":0}},{"line":557,"address":[],"length":0,"stats":{"Line":0}},{"line":558,"address":[],"length":0,"stats":{"Line":0}},{"line":559,"address":[],"length":0,"stats":{"Line":0}},{"line":560,"address":[],"length":0,"stats":{"Line":0}},{"line":561,"address":[],"length":0,"stats":{"Line":0}},{"line":563,"address":[],"length":0,"stats":{"Line":0}},{"line":566,"address":[],"length":0,"stats":{"Line":0}},{"line":567,"address":[],"length":0,"stats":{"Line":0}},{"line":568,"address":[],"length":0,"stats":{"Line":0}},{"line":569,"address":[],"length":0,"stats":{"Line":0}},{"line":570,"address":[],"length":0,"stats":{"Line":0}},{"line":571,"address":[],"length":0,"stats":{"Line":0}},{"line":572,"address":[],"length":0,"stats":{"Line":0}},{"line":574,"address":[],"length":0,"stats":{"Line":0}},{"line":577,"address":[],"length":0,"stats":{"Line":0}},{"line":578,"address":[],"length":0,"stats":{"Line":0}},{"line":579,"address":[],"length":0,"stats":{"Line":0}},{"line":581,"address":[],"length":0,"stats":{"Line":0}},{"line":582,"address":[],"length":0,"stats":{"Line":0}},{"line":585,"address":[],"length":0,"stats":{"Line":0}},{"line":586,"address":[],"length":0,"stats":{"Line":0}},{"line":587,"address":[],"length":0,"stats":{"Line":0}},{"line":588,"address":[],"length":0,"stats":{"Line":0}},{"line":589,"address":[],"length":0,"stats":{"Line":0}},{"line":592,"address":[],"length":0,"stats":{"Line":0}},{"line":593,"address":[],"length":0,"stats":{"Line":0}},{"line":596,"address":[],"length":0,"stats":{"Line":0}},{"line":597,"address":[],"length":0,"stats":{"Line":0}},{"line":598,"address":[],"length":0,"stats":{"Line":0}},{"line":599,"address":[],"length":0,"stats":{"Line":0}},{"line":600,"address":[],"length":0,"stats":{"Line":0}},{"line":601,"address":[],"length":0,"stats":{"Line":0}},{"line":602,"address":[],"length":0,"stats":{"Line":0}},{"line":603,"address":[],"length":0,"stats":{"Line":0}},{"line":604,"address":[],"length":0,"stats":{"Line":0}},{"line":607,"address":[],"length":0,"stats":{"Line":0}},{"line":608,"address":[],"length":0,"stats":{"Line":0}},{"line":609,"address":[],"length":0,"stats":{"Line":0}},{"line":610,"address":[],"length":0,"stats":{"Line":0}},{"line":611,"address":[],"length":0,"stats":{"Line":0}},{"line":613,"address":[],"length":0,"stats":{"Line":0}},{"line":614,"address":[],"length":0,"stats":{"Line":0}},{"line":615,"address":[],"length":0,"stats":{"Line":0}},{"line":616,"address":[],"length":0,"stats":{"Line":0}},{"line":617,"address":[],"length":0,"stats":{"Line":0}},{"line":618,"address":[],"length":0,"stats":{"Line":0}},{"line":619,"address":[],"length":0,"stats":{"Line":0}},{"line":622,"address":[],"length":0,"stats":{"Line":0}},{"line":623,"address":[],"length":0,"stats":{"Line":0}},{"line":627,"address":[],"length":0,"stats":{"Line":0}},{"line":633,"address":[],"length":0,"stats":{"Line":0}},{"line":634,"address":[],"length":0,"stats":{"Line":0}},{"line":635,"address":[],"length":0,"stats":{"Line":0}},{"line":636,"address":[],"length":0,"stats":{"Line":0}},{"line":637,"address":[],"length":0,"stats":{"Line":0}},{"line":638,"address":[],"length":0,"stats":{"Line":0}},{"line":639,"address":[],"length":0,"stats":{"Line":0}},{"line":641,"address":[],"length":0,"stats":{"Line":0}},{"line":644,"address":[],"length":0,"stats":{"Line":0}},{"line":645,"address":[],"length":0,"stats":{"Line":0}},{"line":646,"address":[],"length":0,"stats":{"Line":0}},{"line":647,"address":[],"length":0,"stats":{"Line":0}},{"line":648,"address":[],"length":0,"stats":{"Line":0}},{"line":649,"address":[],"length":0,"stats":{"Line":0}},{"line":650,"address":[],"length":0,"stats":{"Line":0}},{"line":651,"address":[],"length":0,"stats":{"Line":0}},{"line":653,"address":[],"length":0,"stats":{"Line":0}},{"line":656,"address":[],"length":0,"stats":{"Line":0}},{"line":660,"address":[],"length":0,"stats":{"Line":0}},{"line":666,"address":[],"length":0,"stats":{"Line":0}},{"line":667,"address":[],"length":0,"stats":{"Line":0}},{"line":668,"address":[],"length":0,"stats":{"Line":0}},{"line":669,"address":[],"length":0,"stats":{"Line":0}},{"line":672,"address":[],"length":0,"stats":{"Line":0}},{"line":673,"address":[],"length":0,"stats":{"Line":0}},{"line":674,"address":[],"length":0,"stats":{"Line":0}},{"line":675,"address":[],"length":0,"stats":{"Line":0}},{"line":676,"address":[],"length":0,"stats":{"Line":0}},{"line":678,"address":[],"length":0,"stats":{"Line":0}},{"line":679,"address":[],"length":0,"stats":{"Line":0}},{"line":680,"address":[],"length":0,"stats":{"Line":0}},{"line":683,"address":[],"length":0,"stats":{"Line":0}},{"line":684,"address":[],"length":0,"stats":{"Line":0}},{"line":685,"address":[],"length":0,"stats":{"Line":0}},{"line":686,"address":[],"length":0,"stats":{"Line":0}},{"line":689,"address":[],"length":0,"stats":{"Line":0}},{"line":693,"address":[],"length":0,"stats":{"Line":0}},{"line":698,"address":[],"length":0,"stats":{"Line":0}},{"line":699,"address":[],"length":0,"stats":{"Line":0}},{"line":700,"address":[],"length":0,"stats":{"Line":0}},{"line":701,"address":[],"length":0,"stats":{"Line":0}},{"line":702,"address":[],"length":0,"stats":{"Line":0}},{"line":703,"address":[],"length":0,"stats":{"Line":0}},{"line":704,"address":[],"length":0,"stats":{"Line":0}},{"line":706,"address":[],"length":0,"stats":{"Line":0}},{"line":709,"address":[],"length":0,"stats":{"Line":0}},{"line":713,"address":[],"length":0,"stats":{"Line":0}},{"line":718,"address":[],"length":0,"stats":{"Line":0}},{"line":720,"address":[],"length":0,"stats":{"Line":0}},{"line":721,"address":[],"length":0,"stats":{"Line":0}},{"line":722,"address":[],"length":0,"stats":{"Line":0}},{"line":723,"address":[],"length":0,"stats":{"Line":0}},{"line":726,"address":[],"length":0,"stats":{"Line":0}},{"line":727,"address":[],"length":0,"stats":{"Line":0}},{"line":728,"address":[],"length":0,"stats":{"Line":0}},{"line":729,"address":[],"length":0,"stats":{"Line":0}},{"line":730,"address":[],"length":0,"stats":{"Line":0}},{"line":733,"address":[],"length":0,"stats":{"Line":0}},{"line":734,"address":[],"length":0,"stats":{"Line":0}},{"line":737,"address":[],"length":0,"stats":{"Line":0}},{"line":738,"address":[],"length":0,"stats":{"Line":0}},{"line":740,"address":[],"length":0,"stats":{"Line":0}},{"line":741,"address":[],"length":0,"stats":{"Line":0}},{"line":742,"address":[],"length":0,"stats":{"Line":0}},{"line":743,"address":[],"length":0,"stats":{"Line":0}},{"line":744,"address":[],"length":0,"stats":{"Line":0}},{"line":747,"address":[],"length":0,"stats":{"Line":0}},{"line":748,"address":[],"length":0,"stats":{"Line":0}},{"line":749,"address":[],"length":0,"stats":{"Line":0}},{"line":750,"address":[],"length":0,"stats":{"Line":0}},{"line":751,"address":[],"length":0,"stats":{"Line":0}},{"line":752,"address":[],"length":0,"stats":{"Line":0}},{"line":754,"address":[],"length":0,"stats":{"Line":0}},{"line":758,"address":[],"length":0,"stats":{"Line":0}},{"line":763,"address":[],"length":0,"stats":{"Line":0}},{"line":765,"address":[],"length":0,"stats":{"Line":0}},{"line":766,"address":[],"length":0,"stats":{"Line":0}},{"line":767,"address":[],"length":0,"stats":{"Line":0}},{"line":771,"address":[],"length":0,"stats":{"Line":0}},{"line":773,"address":[],"length":0,"stats":{"Line":0}},{"line":774,"address":[],"length":0,"stats":{"Line":0}},{"line":775,"address":[],"length":0,"stats":{"Line":0}},{"line":776,"address":[],"length":0,"stats":{"Line":0}},{"line":778,"address":[],"length":0,"stats":{"Line":0}},{"line":779,"address":[],"length":0,"stats":{"Line":0}},{"line":780,"address":[],"length":0,"stats":{"Line":0}},{"line":782,"address":[],"length":0,"stats":{"Line":0}},{"line":786,"address":[],"length":0,"stats":{"Line":0}},{"line":787,"address":[],"length":0,"stats":{"Line":0}},{"line":788,"address":[],"length":0,"stats":{"Line":0}},{"line":789,"address":[],"length":0,"stats":{"Line":0}},{"line":791,"address":[],"length":0,"stats":{"Line":0}},{"line":795,"address":[],"length":0,"stats":{"Line":0}},{"line":800,"address":[],"length":0,"stats":{"Line":0}},{"line":801,"address":[],"length":0,"stats":{"Line":0}},{"line":802,"address":[],"length":0,"stats":{"Line":0}},{"line":803,"address":[],"length":0,"stats":{"Line":0}},{"line":804,"address":[],"length":0,"stats":{"Line":0}},{"line":805,"address":[],"length":0,"stats":{"Line":0}},{"line":807,"address":[],"length":0,"stats":{"Line":0}},{"line":809,"address":[],"length":0,"stats":{"Line":0}},{"line":810,"address":[],"length":0,"stats":{"Line":0}},{"line":812,"address":[],"length":0,"stats":{"Line":0}},{"line":813,"address":[],"length":0,"stats":{"Line":0}},{"line":814,"address":[],"length":0,"stats":{"Line":0}},{"line":816,"address":[],"length":0,"stats":{"Line":0}},{"line":818,"address":[],"length":0,"stats":{"Line":0}},{"line":819,"address":[],"length":0,"stats":{"Line":0}},{"line":820,"address":[],"length":0,"stats":{"Line":0}},{"line":823,"address":[],"length":0,"stats":{"Line":0}},{"line":825,"address":[],"length":0,"stats":{"Line":0}},{"line":829,"address":[],"length":0,"stats":{"Line":0}},{"line":835,"address":[],"length":0,"stats":{"Line":0}},{"line":836,"address":[],"length":0,"stats":{"Line":0}},{"line":837,"address":[],"length":0,"stats":{"Line":0}},{"line":838,"address":[],"length":0,"stats":{"Line":0}},{"line":839,"address":[],"length":0,"stats":{"Line":0}},{"line":843,"address":[],"length":0,"stats":{"Line":0}},{"line":853,"address":[],"length":0,"stats":{"Line":0}},{"line":862,"address":[],"length":0,"stats":{"Line":0}},{"line":863,"address":[],"length":0,"stats":{"Line":0}},{"line":864,"address":[],"length":0,"stats":{"Line":0}},{"line":866,"address":[],"length":0,"stats":{"Line":0}},{"line":871,"address":[],"length":0,"stats":{"Line":0}},{"line":873,"address":[],"length":0,"stats":{"Line":0}},{"line":874,"address":[],"length":0,"stats":{"Line":0}},{"line":879,"address":[],"length":0,"stats":{"Line":0}},{"line":881,"address":[],"length":0,"stats":{"Line":0}},{"line":882,"address":[],"length":0,"stats":{"Line":0}}],"covered":11,"coverable":424},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","ui","src","canvas","selection.rs"],"content":"//! Canvas object selection management\n//!\n//! Handles selection state, selection modes, and selection queries.\n\nuse std::cell::RefCell;\nuse std::rc::Rc;\nuse testruct_core::layout::Rect;\n\n/// Selection mode\n#[derive(Clone, Copy, Debug, PartialEq, Eq)]\npub enum SelectionMode {\n    /// Single object selection (default)\n    Single,\n    /// Multiple object selection\n    Multiple,\n}\n\n/// Selection state manager\n#[derive(Clone)]\npub struct SelectionState {\n    selected: Rc\u003cRefCell\u003cVec\u003cuuid::Uuid\u003e\u003e\u003e,\n    mode: Rc\u003cRefCell\u003cSelectionMode\u003e\u003e,\n}\n\nimpl SelectionState {\n    /// Create a new selection state\n    pub fn new() -\u003e Self {\n        Self {\n            selected: Rc::new(RefCell::new(Vec::new())),\n            mode: Rc::new(RefCell::new(SelectionMode::Single)),\n        }\n    }\n\n    /// Select a single object\n    pub fn select(\u0026self, object_id: uuid::Uuid) {\n        let mode = *self.mode.borrow();\n        if mode == SelectionMode::Single {\n            self.clear();\n        }\n        let mut selected = self.selected.borrow_mut();\n        if !selected.contains(\u0026object_id) {\n            selected.push(object_id);\n        }\n    }\n\n    /// Add object to selection\n    pub fn add(\u0026self, object_id: uuid::Uuid) {\n        let mut selected = self.selected.borrow_mut();\n        if !selected.contains(\u0026object_id) {\n            selected.push(object_id);\n        }\n    }\n\n    /// Remove object from selection\n    pub fn remove(\u0026self, object_id: uuid::Uuid) {\n        let mut selected = self.selected.borrow_mut();\n        selected.retain(|id| *id != object_id);\n    }\n\n    /// Toggle object selection\n    pub fn toggle(\u0026self, object_id: uuid::Uuid) {\n        let mut selected = self.selected.borrow_mut();\n        if let Some(pos) = selected.iter().position(|id| *id == object_id) {\n            selected.remove(pos);\n        } else {\n            selected.push(object_id);\n        }\n    }\n\n    /// Clear all selections\n    pub fn clear(\u0026self) {\n        self.selected.borrow_mut().clear();\n    }\n\n    /// Check if object is selected\n    pub fn is_selected(\u0026self, object_id: uuid::Uuid) -\u003e bool {\n        self.selected.borrow().contains(\u0026object_id)\n    }\n\n    /// Get all selected object IDs\n    pub fn selected(\u0026self) -\u003e Vec\u003cuuid::Uuid\u003e {\n        self.selected.borrow().clone()\n    }\n\n    /// Get count of selected objects\n    pub fn count(\u0026self) -\u003e usize {\n        self.selected.borrow().len()\n    }\n\n    /// Check if any objects are selected\n    pub fn has_selection(\u0026self) -\u003e bool {\n        !self.selected.borrow().is_empty()\n    }\n\n    /// Set selection mode\n    pub fn set_mode(\u0026self, mode: SelectionMode) {\n        *self.mode.borrow_mut() = mode;\n    }\n\n    /// Get current selection mode\n    pub fn mode(\u0026self) -\u003e SelectionMode {\n        *self.mode.borrow()\n    }\n}\n\nimpl Default for SelectionState {\n    fn default() -\u003e Self {\n        Self::new()\n    }\n}\n\n/// Selection bounds calculation\npub struct SelectionBounds;\n\nimpl SelectionBounds {\n    /// Calculate bounding box for all selected objects\n    pub fn calculate(objects: \u0026[(uuid::Uuid, \u0026Rect)], selected_ids: \u0026[uuid::Uuid]) -\u003e Option\u003cRect\u003e {\n        let selected_bounds: Vec\u003c_\u003e = objects\n            .iter()\n            .filter(|(id, _)| selected_ids.contains(id))\n            .map(|(_, bounds)| bounds)\n            .collect();\n\n        if selected_bounds.is_empty() {\n            return None;\n        }\n\n        let mut min_x = f32::MAX;\n        let mut min_y = f32::MAX;\n        let mut max_x = f32::MIN;\n        let mut max_y = f32::MIN;\n\n        for bounds in selected_bounds {\n            min_x = min_x.min(bounds.origin.x);\n            min_y = min_y.min(bounds.origin.y);\n            max_x = max_x.max(bounds.origin.x + bounds.size.width);\n            max_y = max_y.max(bounds.origin.y + bounds.size.height);\n        }\n\n        Some(Rect::new(\n            testruct_core::layout::Point::new(min_x, min_y),\n            testruct_core::layout::Size::new(max_x - min_x, max_y - min_y),\n        ))\n    }\n}\n\n/// Hit testing for object selection\npub struct HitTest;\n\nimpl HitTest {\n    /// Find object at position\n    pub fn hit_test(\n        objects: \u0026[(uuid::Uuid, \u0026Rect)],\n        pos_x: f64,\n        pos_y: f64,\n    ) -\u003e Option\u003cuuid::Uuid\u003e {\n        // Test in reverse order (top-to-bottom) for proper layering\n        for (id, bounds) in objects.iter().rev() {\n            if pos_x \u003e= bounds.origin.x as f64\n                \u0026\u0026 pos_x \u003c= bounds.origin.x as f64 + bounds.size.width as f64\n                \u0026\u0026 pos_y \u003e= bounds.origin.y as f64\n                \u0026\u0026 pos_y \u003c= bounds.origin.y as f64 + bounds.size.height as f64\n            {\n                return Some(*id);\n            }\n        }\n        None\n    }\n\n    /// Find objects in selection rectangle\n    pub fn hit_test_rect(\n        objects: \u0026[(uuid::Uuid, \u0026Rect)],\n        select_x1: f64,\n        select_y1: f64,\n        select_x2: f64,\n        select_y2: f64,\n    ) -\u003e Vec\u003cuuid::Uuid\u003e {\n        let min_x = select_x1.min(select_x2);\n        let max_x = select_x1.max(select_x2);\n        let min_y = select_y1.min(select_y2);\n        let max_y = select_y1.max(select_y2);\n\n        objects\n            .iter()\n            .filter(|(_, bounds)| {\n                let obj_left = bounds.origin.x as f64;\n                let obj_right = obj_left + bounds.size.width as f64;\n                let obj_top = bounds.origin.y as f64;\n                let obj_bottom = obj_top + bounds.size.height as f64;\n\n                // Check if object intersects with selection rectangle\n                obj_right \u003e= min_x \u0026\u0026 obj_left \u003c= max_x \u0026\u0026 obj_bottom \u003e= min_y \u0026\u0026 obj_top \u003c= max_y\n            })\n            .map(|(id, _)| *id)\n            .collect()\n    }\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n\n    #[test]\n    fn test_selection_state() {\n        let state = SelectionState::new();\n        let id = uuid::Uuid::new_v4();\n\n        assert!(!state.is_selected(id));\n        assert_eq!(state.count(), 0);\n\n        state.select(id);\n        assert!(state.is_selected(id));\n        assert_eq!(state.count(), 1);\n\n        state.clear();\n        assert!(!state.is_selected(id));\n        assert_eq!(state.count(), 0);\n    }\n\n    #[test]\n    fn test_multiple_selection() {\n        let state = SelectionState::new();\n        state.set_mode(SelectionMode::Multiple);\n\n        let id1 = uuid::Uuid::new_v4();\n        let id2 = uuid::Uuid::new_v4();\n\n        state.add(id1);\n        state.add(id2);\n\n        assert_eq!(state.count(), 2);\n        assert!(state.is_selected(id1));\n        assert!(state.is_selected(id2));\n    }\n\n    #[test]\n    fn test_selection_toggle() {\n        let state = SelectionState::new();\n        state.set_mode(SelectionMode::Multiple);\n\n        let id = uuid::Uuid::new_v4();\n\n        state.toggle(id);\n        assert!(state.is_selected(id));\n\n        state.toggle(id);\n        assert!(!state.is_selected(id));\n    }\n}\n","traces":[{"line":27,"address":[],"length":0,"stats":{"Line":3}},{"line":29,"address":[],"length":0,"stats":{"Line":12}},{"line":30,"address":[],"length":0,"stats":{"Line":6}},{"line":35,"address":[],"length":0,"stats":{"Line":1}},{"line":36,"address":[],"length":0,"stats":{"Line":2}},{"line":37,"address":[],"length":0,"stats":{"Line":2}},{"line":38,"address":[],"length":0,"stats":{"Line":1}},{"line":40,"address":[],"length":0,"stats":{"Line":2}},{"line":41,"address":[],"length":0,"stats":{"Line":3}},{"line":42,"address":[],"length":0,"stats":{"Line":2}},{"line":47,"address":[],"length":0,"stats":{"Line":2}},{"line":48,"address":[],"length":0,"stats":{"Line":4}},{"line":49,"address":[],"length":0,"stats":{"Line":6}},{"line":50,"address":[],"length":0,"stats":{"Line":4}},{"line":55,"address":[],"length":0,"stats":{"Line":0}},{"line":56,"address":[],"length":0,"stats":{"Line":0}},{"line":57,"address":[],"length":0,"stats":{"Line":0}},{"line":61,"address":[],"length":0,"stats":{"Line":2}},{"line":62,"address":[],"length":0,"stats":{"Line":4}},{"line":63,"address":[],"length":0,"stats":{"Line":8}},{"line":64,"address":[],"length":0,"stats":{"Line":2}},{"line":66,"address":[],"length":0,"stats":{"Line":2}},{"line":71,"address":[],"length":0,"stats":{"Line":2}},{"line":72,"address":[],"length":0,"stats":{"Line":2}},{"line":76,"address":[],"length":0,"stats":{"Line":7}},{"line":77,"address":[],"length":0,"stats":{"Line":14}},{"line":81,"address":[],"length":0,"stats":{"Line":0}},{"line":82,"address":[],"length":0,"stats":{"Line":0}},{"line":86,"address":[],"length":0,"stats":{"Line":4}},{"line":87,"address":[],"length":0,"stats":{"Line":4}},{"line":91,"address":[],"length":0,"stats":{"Line":0}},{"line":92,"address":[],"length":0,"stats":{"Line":0}},{"line":96,"address":[],"length":0,"stats":{"Line":2}},{"line":97,"address":[],"length":0,"stats":{"Line":2}},{"line":101,"address":[],"length":0,"stats":{"Line":0}},{"line":102,"address":[],"length":0,"stats":{"Line":0}},{"line":107,"address":[],"length":0,"stats":{"Line":0}},{"line":108,"address":[],"length":0,"stats":{"Line":0}},{"line":117,"address":[],"length":0,"stats":{"Line":0}},{"line":118,"address":[],"length":0,"stats":{"Line":0}},{"line":120,"address":[],"length":0,"stats":{"Line":0}},{"line":121,"address":[],"length":0,"stats":{"Line":0}},{"line":124,"address":[],"length":0,"stats":{"Line":0}},{"line":125,"address":[],"length":0,"stats":{"Line":0}},{"line":128,"address":[],"length":0,"stats":{"Line":0}},{"line":129,"address":[],"length":0,"stats":{"Line":0}},{"line":130,"address":[],"length":0,"stats":{"Line":0}},{"line":131,"address":[],"length":0,"stats":{"Line":0}},{"line":133,"address":[],"length":0,"stats":{"Line":0}},{"line":134,"address":[],"length":0,"stats":{"Line":0}},{"line":135,"address":[],"length":0,"stats":{"Line":0}},{"line":136,"address":[],"length":0,"stats":{"Line":0}},{"line":137,"address":[],"length":0,"stats":{"Line":0}},{"line":140,"address":[],"length":0,"stats":{"Line":0}},{"line":141,"address":[],"length":0,"stats":{"Line":0}},{"line":142,"address":[],"length":0,"stats":{"Line":0}},{"line":152,"address":[],"length":0,"stats":{"Line":0}},{"line":158,"address":[],"length":0,"stats":{"Line":0}},{"line":159,"address":[],"length":0,"stats":{"Line":0}},{"line":160,"address":[],"length":0,"stats":{"Line":0}},{"line":161,"address":[],"length":0,"stats":{"Line":0}},{"line":162,"address":[],"length":0,"stats":{"Line":0}},{"line":164,"address":[],"length":0,"stats":{"Line":0}},{"line":167,"address":[],"length":0,"stats":{"Line":0}},{"line":171,"address":[],"length":0,"stats":{"Line":0}},{"line":178,"address":[],"length":0,"stats":{"Line":0}},{"line":179,"address":[],"length":0,"stats":{"Line":0}},{"line":180,"address":[],"length":0,"stats":{"Line":0}},{"line":181,"address":[],"length":0,"stats":{"Line":0}},{"line":183,"address":[],"length":0,"stats":{"Line":0}},{"line":185,"address":[],"length":0,"stats":{"Line":0}},{"line":186,"address":[],"length":0,"stats":{"Line":0}},{"line":187,"address":[],"length":0,"stats":{"Line":0}},{"line":188,"address":[],"length":0,"stats":{"Line":0}},{"line":189,"address":[],"length":0,"stats":{"Line":0}},{"line":192,"address":[],"length":0,"stats":{"Line":0}},{"line":194,"address":[],"length":0,"stats":{"Line":0}}],"covered":27,"coverable":77},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","ui","src","canvas","snapping.rs"],"content":"//! Grid and guide snapping functionality for canvas objects\n//!\n//! Provides snapping to grid lines and user-defined guides for precise positioning.\n\nuse testruct_core::layout::{Point, Rect};\n\n/// Configuration for snap behavior\n#[derive(Debug, Clone)]\npub struct SnapConfig {\n    pub snap_to_grid: bool,\n    pub snap_to_guides: bool,\n    pub snap_threshold: f32, // pixels\n    pub grid_size: f32,      // pixels\n}\n\nimpl Default for SnapConfig {\n    fn default() -\u003e Self {\n        Self {\n            snap_to_grid: true,\n            snap_to_guides: true,\n            snap_threshold: 8.0,\n            grid_size: 20.0,\n        }\n    }\n}\n\n/// Result of a snap operation\n#[derive(Debug, Clone)]\npub struct SnapResult {\n    pub position: Point,\n    pub snapped_x: bool,\n    pub snapped_y: bool,\n    pub snap_lines: Vec\u003cSnapLine\u003e,\n}\n\n/// A visual snap line to show snapping alignment\n#[derive(Debug, Clone)]\npub struct SnapLine {\n    pub line_type: SnapLineType,\n    pub position: f32,       // x or y coordinate\n    pub is_horizontal: bool, // true for horizontal, false for vertical\n    pub bounds: (f32, f32),  // start and end of the line\n}\n\n/// Type of snap line\n#[derive(Debug, Clone, Copy, PartialEq, Eq)]\npub enum SnapLineType {\n    Grid,\n    Guide,\n    ObjectEdge,\n}\n\n/// Snap engine for handling snapping calculations\npub struct SnapEngine {\n    config: SnapConfig,\n}\n\nimpl SnapEngine {\n    /// Create a new snap engine with default configuration\n    pub fn new(config: SnapConfig) -\u003e Self {\n        Self { config }\n    }\n\n    /// Snap a position to grid and guides\n    pub fn snap_position(\u0026self, pos: Point) -\u003e SnapResult {\n        let mut snapped_pos = pos;\n        let mut snap_lines = Vec::new();\n        let mut snapped_x = false;\n        let mut snapped_y = false;\n\n        // Snap X coordinate to grid\n        if self.config.snap_to_grid {\n            if let Some((snapped_x_pos, snap_line)) = self.snap_to_grid_x(pos.x) {\n                snapped_pos.x = snapped_x_pos;\n                snap_lines.push(snap_line);\n                snapped_x = true;\n            }\n        }\n\n        // Snap Y coordinate to grid\n        if self.config.snap_to_grid {\n            if let Some((snapped_y_pos, snap_line)) = self.snap_to_grid_y(pos.y) {\n                snapped_pos.y = snapped_y_pos;\n                snap_lines.push(snap_line);\n                snapped_y = true;\n            }\n        }\n\n        SnapResult {\n            position: snapped_pos,\n            snapped_x,\n            snapped_y,\n            snap_lines,\n        }\n    }\n\n    /// Snap a rectangle (for object positioning)\n    pub fn snap_rect(\u0026self, bounds: \u0026Rect) -\u003e SnapResult {\n        let snapped = self.snap_position(bounds.origin);\n\n        let snapped_bounds = Rect {\n            origin: snapped.position,\n            size: bounds.size,\n        };\n\n        SnapResult {\n            position: snapped.position,\n            snapped_x: snapped.snapped_x,\n            snapped_y: snapped.snapped_y,\n            snap_lines: snapped.snap_lines,\n        }\n    }\n\n    /// Snap X coordinate to grid\n    fn snap_to_grid_x(\u0026self, x: f32) -\u003e Option\u003c(f32, SnapLine)\u003e {\n        let grid_size = self.config.grid_size;\n        let nearest_grid = ((x + grid_size / 2.0) / grid_size).floor() * grid_size;\n        let distance = (x - nearest_grid).abs();\n\n        if distance \u003c= self.config.snap_threshold {\n            let snap_line = SnapLine {\n                line_type: SnapLineType::Grid,\n                position: nearest_grid,\n                is_horizontal: false, // vertical line at x position\n                bounds: (0.0, 10000.0), // full canvas height\n            };\n            Some((nearest_grid, snap_line))\n        } else {\n            None\n        }\n    }\n\n    /// Snap Y coordinate to grid\n    fn snap_to_grid_y(\u0026self, y: f32) -\u003e Option\u003c(f32, SnapLine)\u003e {\n        let grid_size = self.config.grid_size;\n        let nearest_grid = ((y + grid_size / 2.0) / grid_size).floor() * grid_size;\n        let distance = (y - nearest_grid).abs();\n\n        if distance \u003c= self.config.snap_threshold {\n            let snap_line = SnapLine {\n                line_type: SnapLineType::Grid,\n                position: nearest_grid,\n                is_horizontal: true, // horizontal line at y position\n                bounds: (0.0, 10000.0), // full canvas width\n            };\n            Some((nearest_grid, snap_line))\n        } else {\n            None\n        }\n    }\n\n    /// Snap to guides (simplified - actual implementation would take guide list)\n    pub fn snap_to_guides(\u0026self, pos: Point, guides: \u0026[GuideInfo]) -\u003e SnapResult {\n        let mut snapped_pos = pos;\n        let mut snap_lines = Vec::new();\n        let mut snapped_x = false;\n        let mut snapped_y = false;\n\n        // Check vertical guides (for X snapping)\n        for guide in guides {\n            if guide.is_vertical {\n                let distance = (pos.x - guide.position).abs();\n                if distance \u003c= self.config.snap_threshold {\n                    snapped_pos.x = guide.position;\n                    snap_lines.push(SnapLine {\n                        line_type: SnapLineType::Guide,\n                        position: guide.position,\n                        is_horizontal: false,\n                        bounds: (0.0, 10000.0),\n                    });\n                    snapped_x = true;\n                    break;\n                }\n            }\n        }\n\n        // Check horizontal guides (for Y snapping)\n        for guide in guides {\n            if !guide.is_vertical {\n                let distance = (pos.y - guide.position).abs();\n                if distance \u003c= self.config.snap_threshold {\n                    snapped_pos.y = guide.position;\n                    snap_lines.push(SnapLine {\n                        line_type: SnapLineType::Guide,\n                        position: guide.position,\n                        is_horizontal: true,\n                        bounds: (0.0, 10000.0),\n                    });\n                    snapped_y = true;\n                    break;\n                }\n            }\n        }\n\n        SnapResult {\n            position: snapped_pos,\n            snapped_x,\n            snapped_y,\n            snap_lines,\n        }\n    }\n\n    /// Update configuration\n    pub fn set_config(\u0026mut self, config: SnapConfig) {\n        self.config = config;\n    }\n\n    /// Get current configuration\n    pub fn config(\u0026self) -\u003e \u0026SnapConfig {\n        \u0026self.config\n    }\n}\n\n/// Information about a guide for snapping\n#[derive(Debug, Clone)]\npub struct GuideInfo {\n    pub position: f32,\n    pub is_vertical: bool, // true = vertical (x), false = horizontal (y)\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n\n    #[test]\n    fn test_snap_to_grid_x() {\n        let config = SnapConfig {\n            snap_to_grid: true,\n            snap_to_guides: false,\n            snap_threshold: 8.0,\n            grid_size: 20.0,\n        };\n        let engine = SnapEngine::new(config);\n\n        // Test snapping to 0\n        let result = engine.snap_to_grid_x(2.0);\n        assert!(result.is_some());\n        assert_eq!(result.unwrap().0, 0.0);\n\n        // Test snapping to 20\n        let result = engine.snap_to_grid_x(22.0);\n        assert!(result.is_some());\n        assert_eq!(result.unwrap().0, 20.0);\n\n        // Test no snap (too far)\n        let result = engine.snap_to_grid_x(50.0);\n        assert!(result.is_none());\n    }\n\n    #[test]\n    fn test_snap_to_grid_y() {\n        let config = SnapConfig {\n            snap_to_grid: true,\n            snap_to_guides: false,\n            snap_threshold: 8.0,\n            grid_size: 20.0,\n        };\n        let engine = SnapEngine::new(config);\n\n        let result = engine.snap_to_grid_y(5.0);\n        assert!(result.is_some());\n        assert_eq!(result.unwrap().0, 0.0);\n    }\n\n    #[test]\n    fn test_snap_position() {\n        let config = SnapConfig::default();\n        let engine = SnapEngine::new(config);\n\n        let pos = Point { x: 2.0, y: 3.0 };\n        let result = engine.snap_position(pos);\n\n        assert!(result.snapped_x || result.snapped_y);\n    }\n\n    #[test]\n    fn test_snap_to_guides() {\n        let config = SnapConfig {\n            snap_to_grid: false,\n            snap_to_guides: true,\n            snap_threshold: 8.0,\n            grid_size: 20.0,\n        };\n        let engine = SnapEngine::new(config);\n\n        let guides = vec![\n            GuideInfo {\n                position: 100.0,\n                is_vertical: true,\n            },\n            GuideInfo {\n                position: 200.0,\n                is_vertical: false,\n            },\n        ];\n\n        let pos = Point { x: 105.0, y: 150.0 };\n        let result = engine.snap_to_guides(pos, \u0026guides);\n\n        assert_eq!(result.position.x, 100.0);\n    }\n}\n","traces":[{"line":17,"address":[],"length":0,"stats":{"Line":1}},{"line":60,"address":[],"length":0,"stats":{"Line":4}},{"line":65,"address":[],"length":0,"stats":{"Line":1}},{"line":66,"address":[],"length":0,"stats":{"Line":2}},{"line":67,"address":[],"length":0,"stats":{"Line":2}},{"line":68,"address":[],"length":0,"stats":{"Line":2}},{"line":69,"address":[],"length":0,"stats":{"Line":2}},{"line":72,"address":[],"length":0,"stats":{"Line":1}},{"line":73,"address":[],"length":0,"stats":{"Line":5}},{"line":74,"address":[],"length":0,"stats":{"Line":2}},{"line":75,"address":[],"length":0,"stats":{"Line":3}},{"line":76,"address":[],"length":0,"stats":{"Line":1}},{"line":81,"address":[],"length":0,"stats":{"Line":1}},{"line":82,"address":[],"length":0,"stats":{"Line":5}},{"line":83,"address":[],"length":0,"stats":{"Line":2}},{"line":84,"address":[],"length":0,"stats":{"Line":3}},{"line":85,"address":[],"length":0,"stats":{"Line":1}},{"line":98,"address":[],"length":0,"stats":{"Line":0}},{"line":99,"address":[],"length":0,"stats":{"Line":0}},{"line":102,"address":[],"length":0,"stats":{"Line":0}},{"line":103,"address":[],"length":0,"stats":{"Line":0}},{"line":107,"address":[],"length":0,"stats":{"Line":0}},{"line":108,"address":[],"length":0,"stats":{"Line":0}},{"line":109,"address":[],"length":0,"stats":{"Line":0}},{"line":110,"address":[],"length":0,"stats":{"Line":0}},{"line":115,"address":[],"length":0,"stats":{"Line":4}},{"line":116,"address":[],"length":0,"stats":{"Line":8}},{"line":117,"address":[],"length":0,"stats":{"Line":12}},{"line":118,"address":[],"length":0,"stats":{"Line":12}},{"line":120,"address":[],"length":0,"stats":{"Line":4}},{"line":125,"address":[],"length":0,"stats":{"Line":3}},{"line":127,"address":[],"length":0,"stats":{"Line":3}},{"line":129,"address":[],"length":0,"stats":{"Line":1}},{"line":134,"address":[],"length":0,"stats":{"Line":2}},{"line":135,"address":[],"length":0,"stats":{"Line":4}},{"line":136,"address":[],"length":0,"stats":{"Line":6}},{"line":137,"address":[],"length":0,"stats":{"Line":6}},{"line":139,"address":[],"length":0,"stats":{"Line":2}},{"line":144,"address":[],"length":0,"stats":{"Line":2}},{"line":146,"address":[],"length":0,"stats":{"Line":2}},{"line":148,"address":[],"length":0,"stats":{"Line":0}},{"line":153,"address":[],"length":0,"stats":{"Line":1}},{"line":154,"address":[],"length":0,"stats":{"Line":2}},{"line":155,"address":[],"length":0,"stats":{"Line":2}},{"line":156,"address":[],"length":0,"stats":{"Line":2}},{"line":157,"address":[],"length":0,"stats":{"Line":2}},{"line":160,"address":[],"length":0,"stats":{"Line":2}},{"line":161,"address":[],"length":0,"stats":{"Line":1}},{"line":162,"address":[],"length":0,"stats":{"Line":3}},{"line":163,"address":[],"length":0,"stats":{"Line":1}},{"line":164,"address":[],"length":0,"stats":{"Line":1}},{"line":165,"address":[],"length":0,"stats":{"Line":3}},{"line":166,"address":[],"length":0,"stats":{"Line":2}},{"line":167,"address":[],"length":0,"stats":{"Line":1}},{"line":168,"address":[],"length":0,"stats":{"Line":1}},{"line":169,"address":[],"length":0,"stats":{"Line":1}},{"line":171,"address":[],"length":0,"stats":{"Line":1}},{"line":172,"address":[],"length":0,"stats":{"Line":1}},{"line":178,"address":[],"length":0,"stats":{"Line":5}},{"line":179,"address":[],"length":0,"stats":{"Line":2}},{"line":180,"address":[],"length":0,"stats":{"Line":3}},{"line":181,"address":[],"length":0,"stats":{"Line":1}},{"line":182,"address":[],"length":0,"stats":{"Line":0}},{"line":183,"address":[],"length":0,"stats":{"Line":0}},{"line":184,"address":[],"length":0,"stats":{"Line":0}},{"line":185,"address":[],"length":0,"stats":{"Line":0}},{"line":186,"address":[],"length":0,"stats":{"Line":0}},{"line":187,"address":[],"length":0,"stats":{"Line":0}},{"line":189,"address":[],"length":0,"stats":{"Line":0}},{"line":190,"address":[],"length":0,"stats":{"Line":0}},{"line":204,"address":[],"length":0,"stats":{"Line":0}},{"line":205,"address":[],"length":0,"stats":{"Line":0}},{"line":209,"address":[],"length":0,"stats":{"Line":0}},{"line":210,"address":[],"length":0,"stats":{"Line":0}}],"covered":53,"coverable":74},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","ui","src","canvas","text_editor.rs"],"content":"//! Text editing functionality for canvas text elements\n//!\n//! Provides in-app text editing with cursor, selection, and text manipulation.\n\nuse testruct_core::layout::Rect;\nuse testruct_core::typography::TextStyle;\nuse uuid::Uuid;\n\n/// Represents an active text editing session\n#[derive(Clone, Debug)]\npub struct TextEditor {\n    pub text_id: Uuid,\n    pub content: String,\n    pub cursor_pos: usize,\n    pub selection_start: Option\u003cusize\u003e,\n    pub selection_end: Option\u003cusize\u003e,\n    pub bounds: Rect,\n    pub style: TextStyle,\n}\n\nimpl TextEditor {\n    /// Create a new text editor for the given text element\n    pub fn new(\n        text_id: Uuid,\n        content: String,\n        bounds: Rect,\n        style: TextStyle,\n    ) -\u003e Self {\n        Self {\n            text_id,\n            content,\n            cursor_pos: 0,\n            selection_start: None,\n            selection_end: None,\n            bounds,\n            style,\n        }\n    }\n\n    /// Handle text input (character insertion)\n    pub fn insert_text(\u0026mut self, text: \u0026str) {\n        // Delete selection if any\n        if let (Some(start), Some(end)) = (self.selection_start, self.selection_end) {\n            let (min, max) = if start \u003c end { (start, end) } else { (end, start) };\n            self.content.drain(min..max);\n            self.cursor_pos = min;\n            self.selection_start = None;\n            self.selection_end = None;\n        }\n\n        // Insert new text at cursor position\n        if self.cursor_pos \u003c= self.content.len() {\n            self.content.insert_str(self.cursor_pos, text);\n            self.cursor_pos += text.len();\n        }\n    }\n\n    /// Handle backspace (delete character before cursor)\n    pub fn handle_backspace(\u0026mut self) {\n        // Delete selection if any\n        if let (Some(start), Some(end)) = (self.selection_start, self.selection_end) {\n            let (min, max) = if start \u003c end { (start, end) } else { (end, start) };\n            self.content.drain(min..max);\n            self.cursor_pos = min;\n            self.selection_start = None;\n            self.selection_end = None;\n            return;\n        }\n\n        if self.cursor_pos \u003e 0 {\n            let prev_char_pos = self.cursor_pos - 1;\n            self.content.remove(prev_char_pos);\n            self.cursor_pos = prev_char_pos;\n        }\n    }\n\n    /// Handle delete key (delete character after cursor)\n    pub fn handle_delete(\u0026mut self) {\n        // Delete selection if any\n        if let (Some(start), Some(end)) = (self.selection_start, self.selection_end) {\n            let (min, max) = if start \u003c end { (start, end) } else { (end, start) };\n            self.content.drain(min..max);\n            self.cursor_pos = min;\n            self.selection_start = None;\n            self.selection_end = None;\n            return;\n        }\n\n        if self.cursor_pos \u003c self.content.len() {\n            self.content.remove(self.cursor_pos);\n        }\n    }\n\n    /// Move cursor left (by character)\n    pub fn move_cursor_left(\u0026mut self, select: bool) {\n        if !select {\n            self.selection_start = None;\n            self.selection_end = None;\n        } else if self.selection_start.is_none() {\n            self.selection_start = Some(self.cursor_pos);\n        }\n\n        if self.cursor_pos \u003e 0 {\n            self.cursor_pos -= 1;\n            if select {\n                self.selection_end = Some(self.cursor_pos);\n            }\n        }\n    }\n\n    /// Move cursor right (by character)\n    pub fn move_cursor_right(\u0026mut self, select: bool) {\n        if !select {\n            self.selection_start = None;\n            self.selection_end = None;\n        } else if self.selection_start.is_none() {\n            self.selection_start = Some(self.cursor_pos);\n        }\n\n        if self.cursor_pos \u003c self.content.len() {\n            self.cursor_pos += 1;\n            if select {\n                self.selection_end = Some(self.cursor_pos);\n            }\n        }\n    }\n\n    /// Move cursor to beginning of text\n    pub fn move_cursor_home(\u0026mut self, select: bool) {\n        if !select {\n            self.selection_start = None;\n            self.selection_end = None;\n        } else if self.selection_start.is_none() {\n            self.selection_start = Some(self.cursor_pos);\n        }\n\n        self.cursor_pos = 0;\n        if select {\n            self.selection_end = Some(self.cursor_pos);\n        }\n    }\n\n    /// Move cursor to end of text\n    pub fn move_cursor_end(\u0026mut self, select: bool) {\n        if !select {\n            self.selection_start = None;\n            self.selection_end = None;\n        } else if self.selection_start.is_none() {\n            self.selection_start = Some(self.cursor_pos);\n        }\n\n        self.cursor_pos = self.content.len();\n        if select {\n            self.selection_end = Some(self.cursor_pos);\n        }\n    }\n\n    /// Select all text\n    pub fn select_all(\u0026mut self) {\n        self.selection_start = Some(0);\n        self.selection_end = Some(self.content.len());\n        self.cursor_pos = self.content.len();\n    }\n\n    /// Get the current selection as a string\n    pub fn get_selection(\u0026self) -\u003e Option\u003cString\u003e {\n        if let (Some(start), Some(end)) = (self.selection_start, self.selection_end) {\n            let (min, max) = if start \u003c end { (start, end) } else { (end, start) };\n            if min \u003c max \u0026\u0026 max \u003c= self.content.len() {\n                return Some(self.content[min..max].to_string());\n            }\n        }\n        None\n    }\n\n    /// Delete the current selection\n    pub fn delete_selection(\u0026mut self) {\n        if let (Some(start), Some(end)) = (self.selection_start, self.selection_end) {\n            let (min, max) = if start \u003c end { (start, end) } else { (end, start) };\n            if min \u003c max {\n                self.content.drain(min..max);\n                self.cursor_pos = min;\n                self.selection_start = None;\n                self.selection_end = None;\n            }\n        }\n    }\n\n    /// Clear all selection\n    pub fn clear_selection(\u0026mut self) {\n        self.selection_start = None;\n        self.selection_end = None;\n    }\n\n    /// Get the cursor position in pixels (for cursor line drawing)\n    /// This is a simplified version - actual implementation would need Pango metrics\n    pub fn get_cursor_x(\u0026self) -\u003e f32 {\n        let char_width = self.style.font_size * 0.5; // Approximate\n        let x_offset = self.cursor_pos as f32 * char_width;\n        self.bounds.origin.x + x_offset\n    }\n\n    /// Check if cursor is at valid position\n    pub fn is_cursor_valid(\u0026self) -\u003e bool {\n        self.cursor_pos \u003c= self.content.len()\n    }\n\n    /// Get the edited content\n    pub fn get_content(\u0026self) -\u003e \u0026str {\n        \u0026self.content\n    }\n\n    /// Get the edited content as owned String\n    pub fn into_content(self) -\u003e String {\n        self.content\n    }\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n    use testruct_core::layout::Point;\n    use testruct_core::layout::Size;\n\n    fn create_test_editor() -\u003e TextEditor {\n        TextEditor::new(\n            uuid::Uuid::new_v4(),\n            \"Hello World\".to_string(),\n            Rect {\n                origin: Point { x: 0.0, y: 0.0 },\n                size: Size { width: 100.0, height: 20.0 },\n            },\n            TextStyle::default(),\n        )\n    }\n\n    #[test]\n    fn test_insert_text() {\n        let mut editor = create_test_editor();\n        editor.cursor_pos = 0;\n        editor.insert_text(\"Hi \");\n        assert_eq!(editor.content, \"Hi Hello World\");\n        assert_eq!(editor.cursor_pos, 3);\n    }\n\n    #[test]\n    fn test_backspace() {\n        let mut editor = create_test_editor();\n        editor.cursor_pos = 5; // After \"Hello\"\n        editor.handle_backspace();\n        assert_eq!(editor.content, \"Hell World\");\n        assert_eq!(editor.cursor_pos, 4);\n    }\n\n    #[test]\n    fn test_delete() {\n        let mut editor = create_test_editor();\n        editor.cursor_pos = 5; // After \"Hello\"\n        editor.handle_delete();\n        assert_eq!(editor.content, \"HelloWorld\");\n        assert_eq!(editor.cursor_pos, 5);\n    }\n\n    #[test]\n    fn test_move_cursor_left() {\n        let mut editor = create_test_editor();\n        editor.cursor_pos = 5;\n        editor.move_cursor_left(false);\n        assert_eq!(editor.cursor_pos, 4);\n    }\n\n    #[test]\n    fn test_move_cursor_right() {\n        let mut editor = create_test_editor();\n        editor.cursor_pos = 5;\n        editor.move_cursor_right(false);\n        assert_eq!(editor.cursor_pos, 6);\n    }\n\n    #[test]\n    fn test_select_all() {\n        let mut editor = create_test_editor();\n        editor.select_all();\n        assert_eq!(editor.selection_start, Some(0));\n        assert_eq!(editor.selection_end, Some(11));\n        assert_eq!(editor.cursor_pos, 11);\n    }\n\n    #[test]\n    fn test_delete_selection() {\n        let mut editor = create_test_editor();\n        editor.selection_start = Some(0);\n        editor.selection_end = Some(5);\n        editor.delete_selection();\n        assert_eq!(editor.content, \" World\");\n        assert_eq!(editor.cursor_pos, 0);\n    }\n}\n","traces":[{"line":23,"address":[],"length":0,"stats":{"Line":7}},{"line":41,"address":[],"length":0,"stats":{"Line":1}},{"line":43,"address":[],"length":0,"stats":{"Line":2}},{"line":44,"address":[],"length":0,"stats":{"Line":0}},{"line":45,"address":[],"length":0,"stats":{"Line":0}},{"line":46,"address":[],"length":0,"stats":{"Line":0}},{"line":47,"address":[],"length":0,"stats":{"Line":0}},{"line":48,"address":[],"length":0,"stats":{"Line":0}},{"line":52,"address":[],"length":0,"stats":{"Line":3}},{"line":53,"address":[],"length":0,"stats":{"Line":5}},{"line":54,"address":[],"length":0,"stats":{"Line":1}},{"line":59,"address":[],"length":0,"stats":{"Line":1}},{"line":61,"address":[],"length":0,"stats":{"Line":2}},{"line":62,"address":[],"length":0,"stats":{"Line":0}},{"line":63,"address":[],"length":0,"stats":{"Line":0}},{"line":64,"address":[],"length":0,"stats":{"Line":0}},{"line":65,"address":[],"length":0,"stats":{"Line":0}},{"line":66,"address":[],"length":0,"stats":{"Line":0}},{"line":67,"address":[],"length":0,"stats":{"Line":0}},{"line":70,"address":[],"length":0,"stats":{"Line":2}},{"line":71,"address":[],"length":0,"stats":{"Line":3}},{"line":72,"address":[],"length":0,"stats":{"Line":3}},{"line":73,"address":[],"length":0,"stats":{"Line":1}},{"line":78,"address":[],"length":0,"stats":{"Line":1}},{"line":80,"address":[],"length":0,"stats":{"Line":2}},{"line":81,"address":[],"length":0,"stats":{"Line":0}},{"line":82,"address":[],"length":0,"stats":{"Line":0}},{"line":83,"address":[],"length":0,"stats":{"Line":0}},{"line":84,"address":[],"length":0,"stats":{"Line":0}},{"line":85,"address":[],"length":0,"stats":{"Line":0}},{"line":86,"address":[],"length":0,"stats":{"Line":0}},{"line":89,"address":[],"length":0,"stats":{"Line":3}},{"line":90,"address":[],"length":0,"stats":{"Line":2}},{"line":95,"address":[],"length":0,"stats":{"Line":1}},{"line":96,"address":[],"length":0,"stats":{"Line":2}},{"line":97,"address":[],"length":0,"stats":{"Line":1}},{"line":98,"address":[],"length":0,"stats":{"Line":1}},{"line":99,"address":[],"length":0,"stats":{"Line":1}},{"line":100,"address":[],"length":0,"stats":{"Line":0}},{"line":103,"address":[],"length":0,"stats":{"Line":1}},{"line":104,"address":[],"length":0,"stats":{"Line":1}},{"line":105,"address":[],"length":0,"stats":{"Line":1}},{"line":106,"address":[],"length":0,"stats":{"Line":0}},{"line":112,"address":[],"length":0,"stats":{"Line":1}},{"line":113,"address":[],"length":0,"stats":{"Line":2}},{"line":114,"address":[],"length":0,"stats":{"Line":1}},{"line":115,"address":[],"length":0,"stats":{"Line":1}},{"line":116,"address":[],"length":0,"stats":{"Line":1}},{"line":117,"address":[],"length":0,"stats":{"Line":0}},{"line":120,"address":[],"length":0,"stats":{"Line":2}},{"line":121,"address":[],"length":0,"stats":{"Line":1}},{"line":122,"address":[],"length":0,"stats":{"Line":1}},{"line":123,"address":[],"length":0,"stats":{"Line":0}},{"line":129,"address":[],"length":0,"stats":{"Line":0}},{"line":130,"address":[],"length":0,"stats":{"Line":0}},{"line":131,"address":[],"length":0,"stats":{"Line":0}},{"line":132,"address":[],"length":0,"stats":{"Line":0}},{"line":133,"address":[],"length":0,"stats":{"Line":0}},{"line":134,"address":[],"length":0,"stats":{"Line":0}},{"line":137,"address":[],"length":0,"stats":{"Line":0}},{"line":138,"address":[],"length":0,"stats":{"Line":0}},{"line":139,"address":[],"length":0,"stats":{"Line":0}},{"line":144,"address":[],"length":0,"stats":{"Line":0}},{"line":145,"address":[],"length":0,"stats":{"Line":0}},{"line":146,"address":[],"length":0,"stats":{"Line":0}},{"line":147,"address":[],"length":0,"stats":{"Line":0}},{"line":148,"address":[],"length":0,"stats":{"Line":0}},{"line":149,"address":[],"length":0,"stats":{"Line":0}},{"line":152,"address":[],"length":0,"stats":{"Line":0}},{"line":153,"address":[],"length":0,"stats":{"Line":0}},{"line":154,"address":[],"length":0,"stats":{"Line":0}},{"line":159,"address":[],"length":0,"stats":{"Line":1}},{"line":160,"address":[],"length":0,"stats":{"Line":1}},{"line":161,"address":[],"length":0,"stats":{"Line":1}},{"line":162,"address":[],"length":0,"stats":{"Line":1}},{"line":166,"address":[],"length":0,"stats":{"Line":0}},{"line":167,"address":[],"length":0,"stats":{"Line":0}},{"line":168,"address":[],"length":0,"stats":{"Line":0}},{"line":169,"address":[],"length":0,"stats":{"Line":0}},{"line":170,"address":[],"length":0,"stats":{"Line":0}},{"line":173,"address":[],"length":0,"stats":{"Line":0}},{"line":177,"address":[],"length":0,"stats":{"Line":1}},{"line":178,"address":[],"length":0,"stats":{"Line":4}},{"line":179,"address":[],"length":0,"stats":{"Line":4}},{"line":180,"address":[],"length":0,"stats":{"Line":2}},{"line":181,"address":[],"length":0,"stats":{"Line":4}},{"line":182,"address":[],"length":0,"stats":{"Line":2}},{"line":183,"address":[],"length":0,"stats":{"Line":1}},{"line":184,"address":[],"length":0,"stats":{"Line":1}},{"line":190,"address":[],"length":0,"stats":{"Line":0}},{"line":191,"address":[],"length":0,"stats":{"Line":0}},{"line":192,"address":[],"length":0,"stats":{"Line":0}},{"line":197,"address":[],"length":0,"stats":{"Line":0}},{"line":198,"address":[],"length":0,"stats":{"Line":0}},{"line":199,"address":[],"length":0,"stats":{"Line":0}},{"line":200,"address":[],"length":0,"stats":{"Line":0}},{"line":204,"address":[],"length":0,"stats":{"Line":0}},{"line":205,"address":[],"length":0,"stats":{"Line":0}},{"line":209,"address":[],"length":0,"stats":{"Line":0}},{"line":210,"address":[],"length":0,"stats":{"Line":0}},{"line":214,"address":[],"length":0,"stats":{"Line":0}},{"line":215,"address":[],"length":0,"stats":{"Line":0}}],"covered":44,"coverable":102},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","ui","src","canvas","tools.rs"],"content":"//! Canvas tool modes and creation operations\n//!\n//! Provides tool modes (Select, Rectangle, Circle, Text) and shape creation functionality.\n\nuse testruct_core::document::{DocumentElement, ShapeElement, ShapeKind, TextElement, ImageElement};\nuse testruct_core::layout::{Rect, Point, Size};\nuse testruct_core::workspace::assets::AssetRef;\nuse uuid::Uuid;\n\n/// Available tool modes for canvas operations\n#[derive(Debug, Clone, Copy, PartialEq, Eq)]\npub enum ToolMode {\n    /// Selection and modification of existing objects\n    Select,\n    /// Create rectangle shapes\n    Rectangle,\n    /// Create circle/ellipse shapes\n    Circle,\n    /// Create line shapes\n    Line,\n    /// Create arrow shapes\n    Arrow,\n    /// Insert image objects\n    Image,\n    /// Create text objects\n    Text,\n    /// Pan the canvas (space+drag or middle mouse)\n    Pan,\n}\n\nimpl Default for ToolMode {\n    fn default() -\u003e Self {\n        Self::Select\n    }\n}\n\nimpl ToolMode {\n    pub fn name(\u0026self) -\u003e \u0026'static str {\n        match self {\n            Self::Select =\u003e \"Select\",\n            Self::Rectangle =\u003e \"Rectangle\",\n            Self::Circle =\u003e \"Circle\",\n            Self::Line =\u003e \"Line\",\n            Self::Arrow =\u003e \"Arrow\",\n            Self::Image =\u003e \"Image\",\n            Self::Text =\u003e \"Text\",\n            Self::Pan =\u003e \"Pan\",\n        }\n    }\n\n    pub fn cursor_name(\u0026self) -\u003e \u0026'static str {\n        match self {\n            Self::Select =\u003e \"default\",\n            Self::Rectangle =\u003e \"crosshair\",\n            Self::Circle =\u003e \"crosshair\",\n            Self::Line =\u003e \"crosshair\",\n            Self::Arrow =\u003e \"crosshair\",\n            Self::Image =\u003e \"crosshair\",\n            Self::Text =\u003e \"text\",\n            Self::Pan =\u003e \"grab\",\n        }\n    }\n}\n\n/// Factory for creating shape elements\npub struct ShapeFactory;\n\nimpl ShapeFactory {\n    /// Create a rectangle element\n    pub fn create_rectangle(x: f64, y: f64, width: f64, height: f64) -\u003e DocumentElement {\n        DocumentElement::Shape(ShapeElement {\n            id: Uuid::new_v4(),\n            kind: ShapeKind::Rectangle,\n            bounds: Rect {\n                origin: Point {\n                    x: x as f32,\n                    y: y as f32,\n                },\n                size: Size {\n                    width: width as f32,\n                    height: height as f32,\n                },\n            },\n            stroke: None,\n            fill: None,\n        })\n    }\n\n    /// Create a circle/ellipse element\n    pub fn create_circle(x: f64, y: f64, width: f64, height: f64) -\u003e DocumentElement {\n        DocumentElement::Shape(ShapeElement {\n            id: Uuid::new_v4(),\n            kind: ShapeKind::Ellipse,\n            bounds: Rect {\n                origin: Point {\n                    x: x as f32,\n                    y: y as f32,\n                },\n                size: Size {\n                    width: width as f32,\n                    height: height as f32,\n                },\n            },\n            stroke: None,\n            fill: None,\n        })\n    }\n\n    /// Create a text element\n    pub fn create_text(x: f64, y: f64, width: f64, height: f64, text: String) -\u003e DocumentElement {\n        DocumentElement::Text(TextElement {\n            id: Uuid::new_v4(),\n            content: text,\n            style: Default::default(),\n            bounds: Rect {\n                origin: Point {\n                    x: x as f32,\n                    y: y as f32,\n                },\n                size: Size {\n                    width: width as f32,\n                    height: height as f32,\n                },\n            },\n        })\n    }\n\n    /// Create a line element\n    pub fn create_line(x1: f64, y1: f64, x2: f64, y2: f64) -\u003e DocumentElement {\n        let (x, y) = (x1.min(x2), y1.min(y2));\n        let (width, height) = ((x1 - x2).abs(), (y1 - y2).abs());\n\n        DocumentElement::Shape(ShapeElement {\n            id: Uuid::new_v4(),\n            kind: ShapeKind::Line,\n            bounds: Rect {\n                origin: Point {\n                    x: x as f32,\n                    y: y as f32,\n                },\n                size: Size {\n                    width: width as f32,\n                    height: height as f32,\n                },\n            },\n            stroke: None,\n            fill: None,\n        })\n    }\n\n    /// Create an arrow element\n    pub fn create_arrow(x1: f64, y1: f64, x2: f64, y2: f64) -\u003e DocumentElement {\n        let (x, y) = (x1.min(x2), y1.min(y2));\n        let (width, height) = ((x1 - x2).abs(), (y1 - y2).abs());\n\n        DocumentElement::Shape(ShapeElement {\n            id: Uuid::new_v4(),\n            kind: ShapeKind::Arrow,\n            bounds: Rect {\n                origin: Point {\n                    x: x as f32,\n                    y: y as f32,\n                },\n                size: Size {\n                    width: width as f32,\n                    height: height as f32,\n                },\n            },\n            stroke: None,\n            fill: None,\n        })\n    }\n\n    /// Create an image element\n    pub fn create_image(x: f64, y: f64, width: f64, height: f64) -\u003e DocumentElement {\n        DocumentElement::Image(ImageElement {\n            id: Uuid::new_v4(),\n            source: AssetRef::new(),\n            bounds: Rect {\n                origin: Point {\n                    x: x as f32,\n                    y: y as f32,\n                },\n                size: Size {\n                    width: width as f32,\n                    height: height as f32,\n                },\n            },\n        })\n    }\n}\n\n/// Tool state for shape creation\n#[derive(Debug, Clone)]\npub struct ToolState {\n    pub current_tool: ToolMode,\n    pub is_creating: bool,\n    pub create_start_x: f32,\n    pub create_start_y: f32,\n    /// Drag start position (x, y) for shape creation or movement\n    pub drag_start: Option\u003c(f64, f64)\u003e,\n    /// Currently resizing object ID\n    pub resizing_object_id: Option\u003cuuid::Uuid\u003e,\n    /// Resize handle being used\n    pub resize_handle: Option\u003ccrate::canvas::mouse::ResizeHandle\u003e,\n    /// Original bounds before resize started\n    pub resize_original_bounds: Option\u003ccrate::canvas::mouse::CanvasMousePos\u003e,\n    /// ID of text element currently being edited\n    pub editing_text_id: Option\u003cuuid::Uuid\u003e,\n    /// Cursor position in the edited text\n    pub editing_cursor_pos: usize,\n    /// Text selection start position (for future multi-click selection)\n    pub editing_selection_start: Option\u003cusize\u003e,\n}\n\nimpl Default for ToolState {\n    fn default() -\u003e Self {\n        Self {\n            current_tool: ToolMode::Select,\n            is_creating: false,\n            create_start_x: 0.0,\n            create_start_y: 0.0,\n            drag_start: None,\n            resizing_object_id: None,\n            resize_handle: None,\n            resize_original_bounds: None,\n            editing_text_id: None,\n            editing_cursor_pos: 0,\n            editing_selection_start: None,\n        }\n    }\n}\n","traces":[{"line":32,"address":[],"length":0,"stats":{"Line":0}},{"line":33,"address":[],"length":0,"stats":{"Line":0}},{"line":38,"address":[],"length":0,"stats":{"Line":0}},{"line":39,"address":[],"length":0,"stats":{"Line":0}},{"line":40,"address":[],"length":0,"stats":{"Line":0}},{"line":41,"address":[],"length":0,"stats":{"Line":0}},{"line":42,"address":[],"length":0,"stats":{"Line":0}},{"line":43,"address":[],"length":0,"stats":{"Line":0}},{"line":44,"address":[],"length":0,"stats":{"Line":0}},{"line":45,"address":[],"length":0,"stats":{"Line":0}},{"line":46,"address":[],"length":0,"stats":{"Line":0}},{"line":47,"address":[],"length":0,"stats":{"Line":0}},{"line":51,"address":[],"length":0,"stats":{"Line":0}},{"line":52,"address":[],"length":0,"stats":{"Line":0}},{"line":53,"address":[],"length":0,"stats":{"Line":0}},{"line":54,"address":[],"length":0,"stats":{"Line":0}},{"line":55,"address":[],"length":0,"stats":{"Line":0}},{"line":56,"address":[],"length":0,"stats":{"Line":0}},{"line":57,"address":[],"length":0,"stats":{"Line":0}},{"line":58,"address":[],"length":0,"stats":{"Line":0}},{"line":59,"address":[],"length":0,"stats":{"Line":0}},{"line":60,"address":[],"length":0,"stats":{"Line":0}},{"line":70,"address":[],"length":0,"stats":{"Line":0}},{"line":71,"address":[],"length":0,"stats":{"Line":0}},{"line":72,"address":[],"length":0,"stats":{"Line":0}},{"line":73,"address":[],"length":0,"stats":{"Line":0}},{"line":74,"address":[],"length":0,"stats":{"Line":0}},{"line":75,"address":[],"length":0,"stats":{"Line":0}},{"line":76,"address":[],"length":0,"stats":{"Line":0}},{"line":77,"address":[],"length":0,"stats":{"Line":0}},{"line":79,"address":[],"length":0,"stats":{"Line":0}},{"line":80,"address":[],"length":0,"stats":{"Line":0}},{"line":81,"address":[],"length":0,"stats":{"Line":0}},{"line":84,"address":[],"length":0,"stats":{"Line":0}},{"line":85,"address":[],"length":0,"stats":{"Line":0}},{"line":90,"address":[],"length":0,"stats":{"Line":0}},{"line":91,"address":[],"length":0,"stats":{"Line":0}},{"line":92,"address":[],"length":0,"stats":{"Line":0}},{"line":93,"address":[],"length":0,"stats":{"Line":0}},{"line":94,"address":[],"length":0,"stats":{"Line":0}},{"line":95,"address":[],"length":0,"stats":{"Line":0}},{"line":96,"address":[],"length":0,"stats":{"Line":0}},{"line":97,"address":[],"length":0,"stats":{"Line":0}},{"line":99,"address":[],"length":0,"stats":{"Line":0}},{"line":100,"address":[],"length":0,"stats":{"Line":0}},{"line":101,"address":[],"length":0,"stats":{"Line":0}},{"line":104,"address":[],"length":0,"stats":{"Line":0}},{"line":105,"address":[],"length":0,"stats":{"Line":0}},{"line":110,"address":[],"length":0,"stats":{"Line":0}},{"line":111,"address":[],"length":0,"stats":{"Line":0}},{"line":112,"address":[],"length":0,"stats":{"Line":0}},{"line":113,"address":[],"length":0,"stats":{"Line":0}},{"line":114,"address":[],"length":0,"stats":{"Line":0}},{"line":115,"address":[],"length":0,"stats":{"Line":0}},{"line":116,"address":[],"length":0,"stats":{"Line":0}},{"line":117,"address":[],"length":0,"stats":{"Line":0}},{"line":118,"address":[],"length":0,"stats":{"Line":0}},{"line":120,"address":[],"length":0,"stats":{"Line":0}},{"line":121,"address":[],"length":0,"stats":{"Line":0}},{"line":122,"address":[],"length":0,"stats":{"Line":0}},{"line":129,"address":[],"length":0,"stats":{"Line":0}},{"line":130,"address":[],"length":0,"stats":{"Line":0}},{"line":131,"address":[],"length":0,"stats":{"Line":0}},{"line":133,"address":[],"length":0,"stats":{"Line":0}},{"line":134,"address":[],"length":0,"stats":{"Line":0}},{"line":135,"address":[],"length":0,"stats":{"Line":0}},{"line":136,"address":[],"length":0,"stats":{"Line":0}},{"line":137,"address":[],"length":0,"stats":{"Line":0}},{"line":138,"address":[],"length":0,"stats":{"Line":0}},{"line":139,"address":[],"length":0,"stats":{"Line":0}},{"line":141,"address":[],"length":0,"stats":{"Line":0}},{"line":142,"address":[],"length":0,"stats":{"Line":0}},{"line":143,"address":[],"length":0,"stats":{"Line":0}},{"line":146,"address":[],"length":0,"stats":{"Line":0}},{"line":147,"address":[],"length":0,"stats":{"Line":0}},{"line":152,"address":[],"length":0,"stats":{"Line":0}},{"line":153,"address":[],"length":0,"stats":{"Line":0}},{"line":154,"address":[],"length":0,"stats":{"Line":0}},{"line":156,"address":[],"length":0,"stats":{"Line":0}},{"line":157,"address":[],"length":0,"stats":{"Line":0}},{"line":158,"address":[],"length":0,"stats":{"Line":0}},{"line":159,"address":[],"length":0,"stats":{"Line":0}},{"line":160,"address":[],"length":0,"stats":{"Line":0}},{"line":161,"address":[],"length":0,"stats":{"Line":0}},{"line":162,"address":[],"length":0,"stats":{"Line":0}},{"line":164,"address":[],"length":0,"stats":{"Line":0}},{"line":165,"address":[],"length":0,"stats":{"Line":0}},{"line":166,"address":[],"length":0,"stats":{"Line":0}},{"line":169,"address":[],"length":0,"stats":{"Line":0}},{"line":170,"address":[],"length":0,"stats":{"Line":0}},{"line":175,"address":[],"length":0,"stats":{"Line":0}},{"line":176,"address":[],"length":0,"stats":{"Line":0}},{"line":177,"address":[],"length":0,"stats":{"Line":0}},{"line":178,"address":[],"length":0,"stats":{"Line":0}},{"line":179,"address":[],"length":0,"stats":{"Line":0}},{"line":180,"address":[],"length":0,"stats":{"Line":0}},{"line":181,"address":[],"length":0,"stats":{"Line":0}},{"line":182,"address":[],"length":0,"stats":{"Line":0}},{"line":184,"address":[],"length":0,"stats":{"Line":0}},{"line":185,"address":[],"length":0,"stats":{"Line":0}},{"line":186,"address":[],"length":0,"stats":{"Line":0}},{"line":217,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":102},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","ui","src","dialogs","about_dialog.rs"],"content":"//! About dialog for the application\n\nuse gtk4::prelude::*;\nuse gtk4::{AboutDialog, Window};\n\n/// Show the About dialog\npub fn show_about_dialog(parent: \u0026Window) {\n    let dialog = AboutDialog::new();\n\n    dialog.set_transient_for(Some(parent));\n    dialog.set_modal(true);\n\n    // Application info\n    dialog.set_program_name(Some(\"Testruct Studio\"));\n    dialog.set_version(Some(\"0.1.0\"));\n    dialog.set_copyright(Some(\" 2025 Testruct Team\"));\n    dialog.set_license_type(gtk4::License::MitX11);\n\n    // Description\n    dialog.set_comments(Some(\n        \"A powerful design and test creation tool for creating professional documents and test items.\"\n    ));\n\n    // Website\n    dialog.set_website(Some(\"https://testruct.example.com\"));\n    dialog.set_website_label(\"Visit Website\");\n\n    // Authors\n    let authors = [\"Testruct Team\"];\n    dialog.set_authors(\u0026authors);\n\n    // Show the dialog\n    dialog.show();\n}\n","traces":[{"line":7,"address":[],"length":0,"stats":{"Line":0}},{"line":8,"address":[],"length":0,"stats":{"Line":0}},{"line":10,"address":[],"length":0,"stats":{"Line":0}},{"line":11,"address":[],"length":0,"stats":{"Line":0}},{"line":14,"address":[],"length":0,"stats":{"Line":0}},{"line":15,"address":[],"length":0,"stats":{"Line":0}},{"line":16,"address":[],"length":0,"stats":{"Line":0}},{"line":17,"address":[],"length":0,"stats":{"Line":0}},{"line":20,"address":[],"length":0,"stats":{"Line":0}},{"line":21,"address":[],"length":0,"stats":{"Line":0}},{"line":25,"address":[],"length":0,"stats":{"Line":0}},{"line":26,"address":[],"length":0,"stats":{"Line":0}},{"line":29,"address":[],"length":0,"stats":{"Line":0}},{"line":30,"address":[],"length":0,"stats":{"Line":0}},{"line":33,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":15},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","ui","src","dialogs","image_dialog.rs"],"content":"//! Image file selection dialog\n\nuse gtk4::prelude::*;\nuse gtk4::{FileChooserAction, FileChooserNative, Window};\nuse std::path::PathBuf;\nuse tracing::info;\n\n/// Show an image file selection dialog (async)\n///\n/// Returns the selected file path if a file was chosen, None if canceled\npub fn show_image_chooser(parent: \u0026Window) -\u003e Option\u003cPathBuf\u003e {\n    let dialog = FileChooserNative::new(\n        Some(\"\"),\n        Some(parent),\n        FileChooserAction::Open,\n        Some(\"\"),\n        Some(\"\"),\n    );\n\n    // Add file filters for image formats\n    let all_filter = gtk4::FileFilter::new();\n    all_filter.add_mime_type(\"image/png\");\n    all_filter.add_mime_type(\"image/jpeg\");\n    all_filter.add_mime_type(\"image/gif\");\n    all_filter.add_mime_type(\"image/webp\");\n    all_filter.set_name(Some(\"\"));\n    dialog.add_filter(\u0026all_filter);\n\n    let png_filter = gtk4::FileFilter::new();\n    png_filter.add_mime_type(\"image/png\");\n    png_filter.add_pattern(\"*.png\");\n    png_filter.set_name(Some(\"PNG \"));\n    dialog.add_filter(\u0026png_filter);\n\n    let jpeg_filter = gtk4::FileFilter::new();\n    jpeg_filter.add_mime_type(\"image/jpeg\");\n    jpeg_filter.add_pattern(\"*.jpg\");\n    jpeg_filter.add_pattern(\"*.jpeg\");\n    jpeg_filter.set_name(Some(\"JPEG \"));\n    dialog.add_filter(\u0026jpeg_filter);\n\n    let gif_filter = gtk4::FileFilter::new();\n    gif_filter.add_mime_type(\"image/gif\");\n    gif_filter.add_pattern(\"*.gif\");\n    gif_filter.set_name(Some(\"GIF \"));\n    dialog.add_filter(\u0026gif_filter);\n\n    let webp_filter = gtk4::FileFilter::new();\n    webp_filter.add_mime_type(\"image/webp\");\n    webp_filter.add_pattern(\"*.webp\");\n    webp_filter.set_name(Some(\"WebP \"));\n    dialog.add_filter(\u0026webp_filter);\n\n    // Set the first filter as default\n    dialog.set_filter(\u0026all_filter);\n\n    info!(\"Showing image file chooser dialog\");\n\n    // This would need to be async in a real implementation\n    // For now, return None as a placeholder\n    None\n}\n\n/// Show image selection dialog with callback\n///\n/// Handles asynchronous file selection\npub fn show_image_chooser_async(\n    parent: \u0026Window,\n    on_selected: Box\u003cdyn Fn(PathBuf)\u003e,\n) {\n    let dialog = FileChooserNative::new(\n        Some(\"\"),\n        Some(parent),\n        FileChooserAction::Open,\n        Some(\"\"),\n        Some(\"\"),\n    );\n\n    // Add file filters for image formats\n    let all_filter = gtk4::FileFilter::new();\n    all_filter.add_mime_type(\"image/png\");\n    all_filter.add_mime_type(\"image/jpeg\");\n    all_filter.add_mime_type(\"image/gif\");\n    all_filter.add_mime_type(\"image/webp\");\n    all_filter.set_name(Some(\"\"));\n    dialog.add_filter(\u0026all_filter);\n\n    let png_filter = gtk4::FileFilter::new();\n    png_filter.add_mime_type(\"image/png\");\n    png_filter.add_pattern(\"*.png\");\n    png_filter.set_name(Some(\"PNG \"));\n    dialog.add_filter(\u0026png_filter);\n\n    let jpeg_filter = gtk4::FileFilter::new();\n    jpeg_filter.add_mime_type(\"image/jpeg\");\n    jpeg_filter.add_pattern(\"*.jpg\");\n    jpeg_filter.add_pattern(\"*.jpeg\");\n    jpeg_filter.set_name(Some(\"JPEG \"));\n    dialog.add_filter(\u0026jpeg_filter);\n\n    let gif_filter = gtk4::FileFilter::new();\n    gif_filter.add_mime_type(\"image/gif\");\n    gif_filter.add_pattern(\"*.gif\");\n    gif_filter.set_name(Some(\"GIF \"));\n    dialog.add_filter(\u0026gif_filter);\n\n    let webp_filter = gtk4::FileFilter::new();\n    webp_filter.add_mime_type(\"image/webp\");\n    webp_filter.add_pattern(\"*.webp\");\n    webp_filter.set_name(Some(\"WebP \"));\n    dialog.add_filter(\u0026webp_filter);\n\n    // Set the first filter as default\n    dialog.set_filter(\u0026all_filter);\n\n    dialog.connect_response(move |native_dialog, response_id| {\n        if response_id == gtk4::ResponseType::Accept {\n            if let Some(file) = native_dialog.file() {\n                if let Some(path) = file.path() {\n                    info!(\"Selected image: {}\", path.display());\n                    on_selected(path);\n                }\n            }\n        } else {\n            info!(\"Image selection canceled\");\n        }\n    });\n\n    dialog.show();\n}\n","traces":[{"line":11,"address":[],"length":0,"stats":{"Line":0}},{"line":13,"address":[],"length":0,"stats":{"Line":0}},{"line":14,"address":[],"length":0,"stats":{"Line":0}},{"line":15,"address":[],"length":0,"stats":{"Line":0}},{"line":16,"address":[],"length":0,"stats":{"Line":0}},{"line":17,"address":[],"length":0,"stats":{"Line":0}},{"line":21,"address":[],"length":0,"stats":{"Line":0}},{"line":22,"address":[],"length":0,"stats":{"Line":0}},{"line":23,"address":[],"length":0,"stats":{"Line":0}},{"line":24,"address":[],"length":0,"stats":{"Line":0}},{"line":25,"address":[],"length":0,"stats":{"Line":0}},{"line":26,"address":[],"length":0,"stats":{"Line":0}},{"line":27,"address":[],"length":0,"stats":{"Line":0}},{"line":29,"address":[],"length":0,"stats":{"Line":0}},{"line":30,"address":[],"length":0,"stats":{"Line":0}},{"line":31,"address":[],"length":0,"stats":{"Line":0}},{"line":32,"address":[],"length":0,"stats":{"Line":0}},{"line":33,"address":[],"length":0,"stats":{"Line":0}},{"line":35,"address":[],"length":0,"stats":{"Line":0}},{"line":36,"address":[],"length":0,"stats":{"Line":0}},{"line":37,"address":[],"length":0,"stats":{"Line":0}},{"line":38,"address":[],"length":0,"stats":{"Line":0}},{"line":39,"address":[],"length":0,"stats":{"Line":0}},{"line":40,"address":[],"length":0,"stats":{"Line":0}},{"line":42,"address":[],"length":0,"stats":{"Line":0}},{"line":43,"address":[],"length":0,"stats":{"Line":0}},{"line":44,"address":[],"length":0,"stats":{"Line":0}},{"line":45,"address":[],"length":0,"stats":{"Line":0}},{"line":46,"address":[],"length":0,"stats":{"Line":0}},{"line":48,"address":[],"length":0,"stats":{"Line":0}},{"line":49,"address":[],"length":0,"stats":{"Line":0}},{"line":50,"address":[],"length":0,"stats":{"Line":0}},{"line":51,"address":[],"length":0,"stats":{"Line":0}},{"line":52,"address":[],"length":0,"stats":{"Line":0}},{"line":55,"address":[],"length":0,"stats":{"Line":0}},{"line":57,"address":[],"length":0,"stats":{"Line":0}},{"line":61,"address":[],"length":0,"stats":{"Line":0}},{"line":67,"address":[],"length":0,"stats":{"Line":0}},{"line":72,"address":[],"length":0,"stats":{"Line":0}},{"line":73,"address":[],"length":0,"stats":{"Line":0}},{"line":74,"address":[],"length":0,"stats":{"Line":0}},{"line":75,"address":[],"length":0,"stats":{"Line":0}},{"line":76,"address":[],"length":0,"stats":{"Line":0}},{"line":80,"address":[],"length":0,"stats":{"Line":0}},{"line":81,"address":[],"length":0,"stats":{"Line":0}},{"line":82,"address":[],"length":0,"stats":{"Line":0}},{"line":83,"address":[],"length":0,"stats":{"Line":0}},{"line":84,"address":[],"length":0,"stats":{"Line":0}},{"line":85,"address":[],"length":0,"stats":{"Line":0}},{"line":86,"address":[],"length":0,"stats":{"Line":0}},{"line":88,"address":[],"length":0,"stats":{"Line":0}},{"line":89,"address":[],"length":0,"stats":{"Line":0}},{"line":90,"address":[],"length":0,"stats":{"Line":0}},{"line":91,"address":[],"length":0,"stats":{"Line":0}},{"line":92,"address":[],"length":0,"stats":{"Line":0}},{"line":94,"address":[],"length":0,"stats":{"Line":0}},{"line":95,"address":[],"length":0,"stats":{"Line":0}},{"line":96,"address":[],"length":0,"stats":{"Line":0}},{"line":97,"address":[],"length":0,"stats":{"Line":0}},{"line":98,"address":[],"length":0,"stats":{"Line":0}},{"line":99,"address":[],"length":0,"stats":{"Line":0}},{"line":101,"address":[],"length":0,"stats":{"Line":0}},{"line":102,"address":[],"length":0,"stats":{"Line":0}},{"line":103,"address":[],"length":0,"stats":{"Line":0}},{"line":104,"address":[],"length":0,"stats":{"Line":0}},{"line":105,"address":[],"length":0,"stats":{"Line":0}},{"line":107,"address":[],"length":0,"stats":{"Line":0}},{"line":108,"address":[],"length":0,"stats":{"Line":0}},{"line":109,"address":[],"length":0,"stats":{"Line":0}},{"line":110,"address":[],"length":0,"stats":{"Line":0}},{"line":111,"address":[],"length":0,"stats":{"Line":0}},{"line":114,"address":[],"length":0,"stats":{"Line":0}},{"line":116,"address":[],"length":0,"stats":{"Line":0}},{"line":117,"address":[],"length":0,"stats":{"Line":0}},{"line":118,"address":[],"length":0,"stats":{"Line":0}},{"line":119,"address":[],"length":0,"stats":{"Line":0}},{"line":120,"address":[],"length":0,"stats":{"Line":0}},{"line":121,"address":[],"length":0,"stats":{"Line":0}},{"line":125,"address":[],"length":0,"stats":{"Line":0}},{"line":129,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":80},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","ui","src","dialogs","item_dialog.rs"],"content":"//! Functions for creating and managing test items\n\nuse std::sync::{Arc, Mutex};\nuse testruct_db::{ItemBank, Item, models::{ItemType, Difficulty}};\nuse uuid::Uuid;\nuse chrono::Utc;\n\n/// Create a new sample item and save to database\npub fn create_new_item(item_bank: Arc\u003cMutex\u003cItemBank\u003e\u003e, title: String, content: String, description: Option\u003cString\u003e) -\u003e Option\u003cItem\u003e {\n    // Create new item\n    let item = Item {\n        id: Uuid::new_v4(),\n        title,\n        description,\n        content,\n        item_type: ItemType::MultipleChoice,\n        difficulty: Difficulty::Medium,\n        skill_ids: Vec::new(),\n        passage_id: None,\n        created_at: Utc::now(),\n        updated_at: Utc::now(),\n    };\n\n    // Save to database\n    match item_bank.lock() {\n        Ok(bank) =\u003e {\n            match bank.insert_item(\u0026item) {\n                Ok(_) =\u003e {\n                    tracing::info!(\" Item created and saved: {}\", item.title);\n                    Some(item)\n                }\n                Err(e) =\u003e {\n                    tracing::error!(\" Failed to save item: {}\", e);\n                    None\n                }\n            }\n        }\n        Err(e) =\u003e {\n            tracing::error!(\" Failed to lock item bank: {}\", e);\n            None\n        }\n    }\n}\n\n/// Delete an item from the database\npub fn delete_item(item_bank: Arc\u003cMutex\u003cItemBank\u003e\u003e, item_id: Uuid) -\u003e Result\u003c(), String\u003e {\n    match item_bank.lock() {\n        Ok(bank) =\u003e {\n            bank.delete_item(\u0026item_id).map_err(|e| e.to_string())\n        }\n        Err(e) =\u003e {\n            Err(format!(\"Failed to lock item bank: {}\", e))\n        }\n    }\n}\n","traces":[{"line":9,"address":[],"length":0,"stats":{"Line":0}},{"line":12,"address":[],"length":0,"stats":{"Line":0}},{"line":18,"address":[],"length":0,"stats":{"Line":0}},{"line":20,"address":[],"length":0,"stats":{"Line":0}},{"line":21,"address":[],"length":0,"stats":{"Line":0}},{"line":25,"address":[],"length":0,"stats":{"Line":0}},{"line":26,"address":[],"length":0,"stats":{"Line":0}},{"line":27,"address":[],"length":0,"stats":{"Line":0}},{"line":29,"address":[],"length":0,"stats":{"Line":0}},{"line":30,"address":[],"length":0,"stats":{"Line":0}},{"line":32,"address":[],"length":0,"stats":{"Line":0}},{"line":33,"address":[],"length":0,"stats":{"Line":0}},{"line":34,"address":[],"length":0,"stats":{"Line":0}},{"line":38,"address":[],"length":0,"stats":{"Line":0}},{"line":39,"address":[],"length":0,"stats":{"Line":0}},{"line":40,"address":[],"length":0,"stats":{"Line":0}},{"line":46,"address":[],"length":0,"stats":{"Line":0}},{"line":47,"address":[],"length":0,"stats":{"Line":0}},{"line":48,"address":[],"length":0,"stats":{"Line":0}},{"line":49,"address":[],"length":0,"stats":{"Line":0}},{"line":51,"address":[],"length":0,"stats":{"Line":0}},{"line":52,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":22},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","ui","src","dialogs","json_editor.rs"],"content":"//! JSON editor dialog for viewing and editing documents as JSON\n//!\n//! Allows users to view the current document structure in JSON format\n//! and make direct edits to the JSON representation.\n\nuse gtk4::prelude::*;\nuse gtk4::{Box as GtkBox, Button, Dialog, Label, Orientation, ScrolledWindow, TextView, Window};\nuse crate::app::AppState;\n\n/// Show the JSON editor dialog for the active document\npub fn show_json_editor(parent: \u0026Window, app_state: AppState) {\n    // Create dialog\n    let dialog = Dialog::builder()\n        .transient_for(parent)\n        .modal(true)\n        .title(\"JSON \")\n        .default_width(800)\n        .default_height(600)\n        .destroy_with_parent(true)\n        .build();\n\n    // Main container\n    let content_area = dialog.content_area();\n    let main_box = GtkBox::new(Orientation::Vertical, 12);\n    main_box.set_margin_start(12);\n    main_box.set_margin_end(12);\n    main_box.set_margin_top(12);\n    main_box.set_margin_bottom(12);\n\n    // Title\n    let title = Label::new(Some(\" JSON\"));\n    title.add_css_class(\"title-2\");\n    title.set_halign(gtk4::Align::Start);\n    main_box.append(\u0026title);\n\n    // Subtitle\n    let subtitle = Label::new(Some(\"JSON\"));\n    subtitle.add_css_class(\"dim-label\");\n    subtitle.set_halign(gtk4::Align::Start);\n    main_box.append(\u0026subtitle);\n\n    // Text view with scrolling\n    let scrolled = ScrolledWindow::new();\n    scrolled.set_vexpand(true);\n    scrolled.set_hexpand(true);\n\n    let text_view = TextView::new();\n    text_view.set_monospace(true);\n    text_view.set_wrap_mode(gtk4::WrapMode::Word);\n    scrolled.set_child(Some(\u0026text_view));\n    main_box.append(\u0026scrolled);\n\n    // Load current document as JSON\n    if let Some(doc) = app_state.active_document() {\n        if let Ok(json_string) = serde_json::to_string_pretty(\u0026doc) {\n            let buffer = text_view.buffer();\n            buffer.set_text(\u0026json_string);\n            tracing::debug!(\" Loaded document as JSON ({} bytes)\", json_string.len());\n        } else {\n            let buffer = text_view.buffer();\n            buffer.set_text(\"Error: Could not serialize document to JSON\");\n            tracing::warn!(\" Failed to serialize document to JSON\");\n        }\n    } else {\n        let buffer = text_view.buffer();\n        buffer.set_text(\"No active document\");\n    }\n\n    // Button box\n    let button_box = GtkBox::new(Orientation::Horizontal, 6);\n    button_box.set_halign(gtk4::Align::End);\n    button_box.set_spacing(6);\n\n    // Save button\n    let save_btn = Button::with_label(\"\");\n    let app_state_save = app_state.clone();\n    let dialog_save = dialog.clone();\n    let text_view_save = text_view.clone();\n\n    save_btn.connect_clicked(move |_| {\n        let buffer = text_view_save.buffer();\n        let start_iter = buffer.start_iter();\n        let end_iter = buffer.end_iter();\n        let json_text = buffer.text(\u0026start_iter, \u0026end_iter, false).to_string();\n\n        // Try to parse JSON and update document\n        match serde_json::from_str::\u003ctestruct_core::document::Document\u003e(\u0026json_text) {\n            Ok(new_doc) =\u003e {\n                // Update the active document\n                app_state_save.with_active_document(|current_doc| {\n                    *current_doc = new_doc;\n                });\n                tracing::info!(\" Document updated from JSON\");\n                dialog_save.close();\n            }\n            Err(e) =\u003e {\n                tracing::error!(\" JSON parse error: {}\", e);\n                // Show error in a dialog or status message\n                let error_dialog = gtk4::MessageDialog::new(\n                    Some(\u0026dialog_save),\n                    gtk4::DialogFlags::MODAL,\n                    gtk4::MessageType::Error,\n                    gtk4::ButtonsType::Ok,\n                    \"JSON \",\n                );\n                error_dialog.set_secondary_text(Some(\u0026format!(\" : {}\", e)));\n                error_dialog.run_async(|dialog, _| {\n                    dialog.close();\n                });\n            }\n        }\n    });\n    button_box.append(\u0026save_btn);\n\n    // Cancel button\n    let cancel_btn = Button::with_label(\"\");\n    let dialog_cancel = dialog.clone();\n    cancel_btn.connect_clicked(move |_| {\n        dialog_cancel.close();\n    });\n    button_box.append(\u0026cancel_btn);\n\n    // Copy button (for convenience)\n    let copy_btn = Button::with_label(\" \");\n    let text_view_copy = text_view.clone();\n    copy_btn.connect_clicked(move |_| {\n        let buffer = text_view_copy.buffer();\n        let start_iter = buffer.start_iter();\n        let end_iter = buffer.end_iter();\n        let json_text = buffer.text(\u0026start_iter, \u0026end_iter, false).to_string();\n\n        // Use GTK4's built-in clipboard\n        let clipboard = text_view_copy.clipboard();\n        clipboard.set_text(\u0026json_text);\n        tracing::debug!(\" JSON copied to clipboard\");\n    });\n    button_box.append(\u0026copy_btn);\n\n    main_box.append(\u0026button_box);\n    content_area.append(\u0026main_box);\n\n    dialog.present();\n}\n","traces":[{"line":11,"address":[],"length":0,"stats":{"Line":0}},{"line":13,"address":[],"length":0,"stats":{"Line":0}},{"line":14,"address":[],"length":0,"stats":{"Line":0}},{"line":23,"address":[],"length":0,"stats":{"Line":0}},{"line":24,"address":[],"length":0,"stats":{"Line":0}},{"line":25,"address":[],"length":0,"stats":{"Line":0}},{"line":26,"address":[],"length":0,"stats":{"Line":0}},{"line":27,"address":[],"length":0,"stats":{"Line":0}},{"line":28,"address":[],"length":0,"stats":{"Line":0}},{"line":31,"address":[],"length":0,"stats":{"Line":0}},{"line":32,"address":[],"length":0,"stats":{"Line":0}},{"line":33,"address":[],"length":0,"stats":{"Line":0}},{"line":34,"address":[],"length":0,"stats":{"Line":0}},{"line":37,"address":[],"length":0,"stats":{"Line":0}},{"line":38,"address":[],"length":0,"stats":{"Line":0}},{"line":39,"address":[],"length":0,"stats":{"Line":0}},{"line":40,"address":[],"length":0,"stats":{"Line":0}},{"line":43,"address":[],"length":0,"stats":{"Line":0}},{"line":44,"address":[],"length":0,"stats":{"Line":0}},{"line":45,"address":[],"length":0,"stats":{"Line":0}},{"line":47,"address":[],"length":0,"stats":{"Line":0}},{"line":48,"address":[],"length":0,"stats":{"Line":0}},{"line":49,"address":[],"length":0,"stats":{"Line":0}},{"line":50,"address":[],"length":0,"stats":{"Line":0}},{"line":51,"address":[],"length":0,"stats":{"Line":0}},{"line":54,"address":[],"length":0,"stats":{"Line":0}},{"line":55,"address":[],"length":0,"stats":{"Line":0}},{"line":56,"address":[],"length":0,"stats":{"Line":0}},{"line":57,"address":[],"length":0,"stats":{"Line":0}},{"line":58,"address":[],"length":0,"stats":{"Line":0}},{"line":60,"address":[],"length":0,"stats":{"Line":0}},{"line":61,"address":[],"length":0,"stats":{"Line":0}},{"line":62,"address":[],"length":0,"stats":{"Line":0}},{"line":65,"address":[],"length":0,"stats":{"Line":0}},{"line":66,"address":[],"length":0,"stats":{"Line":0}},{"line":70,"address":[],"length":0,"stats":{"Line":0}},{"line":71,"address":[],"length":0,"stats":{"Line":0}},{"line":72,"address":[],"length":0,"stats":{"Line":0}},{"line":75,"address":[],"length":0,"stats":{"Line":0}},{"line":76,"address":[],"length":0,"stats":{"Line":0}},{"line":77,"address":[],"length":0,"stats":{"Line":0}},{"line":78,"address":[],"length":0,"stats":{"Line":0}},{"line":80,"address":[],"length":0,"stats":{"Line":0}},{"line":81,"address":[],"length":0,"stats":{"Line":0}},{"line":82,"address":[],"length":0,"stats":{"Line":0}},{"line":83,"address":[],"length":0,"stats":{"Line":0}},{"line":84,"address":[],"length":0,"stats":{"Line":0}},{"line":87,"address":[],"length":0,"stats":{"Line":0}},{"line":88,"address":[],"length":0,"stats":{"Line":0}},{"line":90,"address":[],"length":0,"stats":{"Line":0}},{"line":91,"address":[],"length":0,"stats":{"Line":0}},{"line":93,"address":[],"length":0,"stats":{"Line":0}},{"line":94,"address":[],"length":0,"stats":{"Line":0}},{"line":96,"address":[],"length":0,"stats":{"Line":0}},{"line":97,"address":[],"length":0,"stats":{"Line":0}},{"line":99,"address":[],"length":0,"stats":{"Line":0}},{"line":100,"address":[],"length":0,"stats":{"Line":0}},{"line":102,"address":[],"length":0,"stats":{"Line":0}},{"line":103,"address":[],"length":0,"stats":{"Line":0}},{"line":106,"address":[],"length":0,"stats":{"Line":0}},{"line":107,"address":[],"length":0,"stats":{"Line":0}},{"line":108,"address":[],"length":0,"stats":{"Line":0}},{"line":113,"address":[],"length":0,"stats":{"Line":0}},{"line":116,"address":[],"length":0,"stats":{"Line":0}},{"line":117,"address":[],"length":0,"stats":{"Line":0}},{"line":118,"address":[],"length":0,"stats":{"Line":0}},{"line":119,"address":[],"length":0,"stats":{"Line":0}},{"line":121,"address":[],"length":0,"stats":{"Line":0}},{"line":124,"address":[],"length":0,"stats":{"Line":0}},{"line":125,"address":[],"length":0,"stats":{"Line":0}},{"line":126,"address":[],"length":0,"stats":{"Line":0}},{"line":127,"address":[],"length":0,"stats":{"Line":0}},{"line":128,"address":[],"length":0,"stats":{"Line":0}},{"line":129,"address":[],"length":0,"stats":{"Line":0}},{"line":130,"address":[],"length":0,"stats":{"Line":0}},{"line":133,"address":[],"length":0,"stats":{"Line":0}},{"line":134,"address":[],"length":0,"stats":{"Line":0}},{"line":135,"address":[],"length":0,"stats":{"Line":0}},{"line":137,"address":[],"length":0,"stats":{"Line":0}},{"line":139,"address":[],"length":0,"stats":{"Line":0}},{"line":140,"address":[],"length":0,"stats":{"Line":0}},{"line":142,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":82},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","ui","src","dialogs","mod.rs"],"content":"mod project_settings;\npub mod template_browser;\npub mod item_dialog;\npub mod image_dialog;\npub mod about_dialog;\npub mod user_manual_dialog;\npub mod json_editor;\n\npub use project_settings::show_project_settings;\npub use template_browser::show_template_browser_async;\npub use item_dialog::{create_new_item, delete_item};\npub use image_dialog::{show_image_chooser, show_image_chooser_async};\npub use about_dialog::show_about_dialog;\npub use user_manual_dialog::show_user_manual_dialog;\npub use json_editor::show_json_editor;\n","traces":[],"covered":0,"coverable":0},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","ui","src","dialogs","project_settings.rs"],"content":"use gtk4::{prelude::*, Box as GtkBox, Button, Label, Orientation, Window, SpinButton, CheckButton, Adjustment};\nuse gtk4::Align;\nuse crate::app::AppState;\n\npub fn show_project_settings(parent: \u0026Window, app_state: AppState) {\n    // Create dialog window for project settings\n    let dialog = gtk4::ApplicationWindow::builder()\n        .transient_for(parent)\n        .modal(true)\n        .title(\"\")\n        .default_width(500)\n        .default_height(600)\n        .build();\n\n    let main_box = GtkBox::new(Orientation::Vertical, 12);\n    main_box.set_margin_start(16);\n    main_box.set_margin_end(16);\n    main_box.set_margin_top(16);\n    main_box.set_margin_bottom(16);\n\n    // Title\n    let title = Label::new(Some(\"\"));\n    title.add_css_class(\"title-2\");\n    main_box.append(\u0026title);\n\n    // Canvas Settings Section\n    let canvas_label = Label::new(Some(\"\"));\n    canvas_label.add_css_class(\"title-3\");\n    canvas_label.set_halign(Align::Start);\n    canvas_label.set_margin_top(12);\n    main_box.append(\u0026canvas_label);\n\n    // Canvas width setting\n    let width_box = GtkBox::new(Orientation::Horizontal, 8);\n    width_box.set_homogeneous(false);\n    let width_label = Label::new(Some(\" (pt):\"));\n    width_label.set_size_request(150, -1);\n    width_box.append(\u0026width_label);\n    let current_width = app_state.project().settings.default_canvas_width as f64;\n    let width_adj = Adjustment::new(current_width, 100.0, 2000.0, 10.0, 50.0, 0.0);\n    let width_spin = SpinButton::new(Some(\u0026width_adj), 1.0, 0);\n    width_box.append(\u0026width_spin);\n    main_box.append(\u0026width_box);\n\n    // Canvas height setting\n    let height_box = GtkBox::new(Orientation::Horizontal, 8);\n    height_box.set_homogeneous(false);\n    let height_label = Label::new(Some(\" (pt):\"));\n    height_label.set_size_request(150, -1);\n    height_box.append(\u0026height_label);\n    let current_height = app_state.project().settings.default_canvas_height as f64;\n    let height_adj = Adjustment::new(current_height, 100.0, 3000.0, 10.0, 50.0, 0.0);\n    let height_spin = SpinButton::new(Some(\u0026height_adj), 1.0, 0);\n    height_box.append(\u0026height_spin);\n    main_box.append(\u0026height_box);\n\n    // Grid Settings Section\n    let grid_label = Label::new(Some(\"\"));\n    grid_label.add_css_class(\"title-3\");\n    grid_label.set_halign(Align::Start);\n    grid_label.set_margin_top(12);\n    main_box.append(\u0026grid_label);\n\n    // Grid size setting\n    let grid_box = GtkBox::new(Orientation::Horizontal, 8);\n    grid_box.set_homogeneous(false);\n    let grid_size_label = Label::new(Some(\" (pt):\"));\n    grid_size_label.set_size_request(150, -1);\n    grid_box.append(\u0026grid_size_label);\n    let current_grid_size = app_state.project().settings.grid_size as f64;\n    let grid_adj = Adjustment::new(current_grid_size, 1.0, 100.0, 1.0, 5.0, 0.0);\n    let grid_spin = SpinButton::new(Some(\u0026grid_adj), 1.0, 0);\n    grid_box.append(\u0026grid_spin);\n    main_box.append(\u0026grid_box);\n\n    // Snap to grid checkbox\n    let snap_grid_check = CheckButton::with_label(\"\");\n    snap_grid_check.set_active(app_state.project().settings.snap_to_grid);\n    main_box.append(\u0026snap_grid_check);\n\n    // Guide Settings Section\n    let guide_label = Label::new(Some(\"\"));\n    guide_label.add_css_class(\"title-3\");\n    guide_label.set_halign(Align::Start);\n    guide_label.set_margin_top(12);\n    main_box.append(\u0026guide_label);\n\n    // Snap to guides checkbox\n    let snap_guides_check = CheckButton::with_label(\"\");\n    snap_guides_check.set_active(app_state.project().settings.snap_to_guides);\n    main_box.append(\u0026snap_guides_check);\n\n    // Guide snap distance setting\n    let snap_dist_box = GtkBox::new(Orientation::Horizontal, 8);\n    snap_dist_box.set_homogeneous(false);\n    let snap_dist_label = Label::new(Some(\" (pt):\"));\n    snap_dist_label.set_size_request(150, -1);\n    snap_dist_box.append(\u0026snap_dist_label);\n    let current_snap_dist = app_state.project().settings.snap_distance as f64;\n    let snap_adj = Adjustment::new(current_snap_dist, 1.0, 50.0, 1.0, 5.0, 0.0);\n    let snap_spin = SpinButton::new(Some(\u0026snap_adj), 1.0, 0);\n    snap_dist_box.append(\u0026snap_spin);\n    main_box.append(\u0026snap_dist_box);\n\n    // Autosave Settings Section\n    let autosave_label = Label::new(Some(\"\"));\n    autosave_label.add_css_class(\"title-3\");\n    autosave_label.set_halign(Align::Start);\n    autosave_label.set_margin_top(12);\n    main_box.append(\u0026autosave_label);\n\n    // Autosave checkbox\n    let autosave_check = CheckButton::with_label(\"\");\n    autosave_check.set_active(app_state.project().settings.autosave_enabled);\n    main_box.append(\u0026autosave_check);\n\n    // Autosave interval setting\n    let autosave_box = GtkBox::new(Orientation::Horizontal, 8);\n    autosave_box.set_homogeneous(false);\n    let autosave_label = Label::new(Some(\" ():\"));\n    autosave_label.set_size_request(150, -1);\n    autosave_box.append(\u0026autosave_label);\n    let current_autosave = app_state.project().settings.autosave_minutes as f64;\n    let autosave_adj = Adjustment::new(current_autosave, 1.0, 60.0, 1.0, 5.0, 0.0);\n    let autosave_spin = SpinButton::new(Some(\u0026autosave_adj), 1.0, 0);\n    autosave_box.append(\u0026autosave_spin);\n    main_box.append(\u0026autosave_box);\n\n    // Add scrolled window for better layout with many settings\n    let scrolled = gtk4::ScrolledWindow::new();\n    scrolled.set_child(Some(\u0026main_box));\n    scrolled.set_vexpand(true);\n\n    // Button box\n    let button_box = GtkBox::new(Orientation::Horizontal, 6);\n    button_box.set_halign(Align::End);\n    button_box.set_homogeneous(true);\n    button_box.set_margin_top(12);\n\n    let save_btn = Button::with_label(\"\");\n    let dialog_ref = dialog.clone();\n    let app_state_save = app_state.clone();\n    save_btn.connect_clicked(move |_| {\n        // Read values from UI controls\n        let new_width = width_spin.value() as f32;\n        let new_height = height_spin.value() as f32;\n        let new_grid_size = grid_spin.value() as f32;\n        let new_snap_grid = snap_grid_check.is_active();\n        let new_snap_guides = snap_guides_check.is_active();\n        let new_snap_dist = snap_spin.value() as f32;\n        let new_autosave_enabled = autosave_check.is_active();\n        let new_autosave_minutes = autosave_spin.value() as u32;\n\n        // Update project settings\n        if let Some(_) = app_state_save.with_active_document(|_doc| {\n            let mut project = app_state_save.project();\n            project.settings.default_canvas_width = new_width;\n            project.settings.default_canvas_height = new_height;\n            project.settings.grid_size = new_grid_size;\n            project.settings.snap_to_grid = new_snap_grid;\n            project.settings.snap_to_guides = new_snap_guides;\n            project.settings.snap_distance = new_snap_dist;\n            project.settings.autosave_enabled = new_autosave_enabled;\n            project.settings.autosave_minutes = new_autosave_minutes;\n        }) {\n            tracing::info!(\" Project settings saved successfully\");\n        }\n\n        dialog_ref.close();\n    });\n    button_box.append(\u0026save_btn);\n\n    let close_btn = Button::with_label(\"\");\n    let dialog_ref = dialog.clone();\n    close_btn.connect_clicked(move |_| {\n        dialog_ref.close();\n    });\n    button_box.append(\u0026close_btn);\n\n    let main_container = GtkBox::new(Orientation::Vertical, 0);\n    main_container.append(\u0026scrolled);\n    main_container.append(\u0026button_box);\n\n    dialog.set_child(Some(\u0026main_container));\n    dialog.present();\n}\n","traces":[{"line":5,"address":[],"length":0,"stats":{"Line":0}},{"line":7,"address":[],"length":0,"stats":{"Line":0}},{"line":8,"address":[],"length":0,"stats":{"Line":0}},{"line":15,"address":[],"length":0,"stats":{"Line":0}},{"line":16,"address":[],"length":0,"stats":{"Line":0}},{"line":17,"address":[],"length":0,"stats":{"Line":0}},{"line":18,"address":[],"length":0,"stats":{"Line":0}},{"line":19,"address":[],"length":0,"stats":{"Line":0}},{"line":22,"address":[],"length":0,"stats":{"Line":0}},{"line":23,"address":[],"length":0,"stats":{"Line":0}},{"line":24,"address":[],"length":0,"stats":{"Line":0}},{"line":27,"address":[],"length":0,"stats":{"Line":0}},{"line":28,"address":[],"length":0,"stats":{"Line":0}},{"line":29,"address":[],"length":0,"stats":{"Line":0}},{"line":30,"address":[],"length":0,"stats":{"Line":0}},{"line":31,"address":[],"length":0,"stats":{"Line":0}},{"line":34,"address":[],"length":0,"stats":{"Line":0}},{"line":35,"address":[],"length":0,"stats":{"Line":0}},{"line":36,"address":[],"length":0,"stats":{"Line":0}},{"line":37,"address":[],"length":0,"stats":{"Line":0}},{"line":38,"address":[],"length":0,"stats":{"Line":0}},{"line":39,"address":[],"length":0,"stats":{"Line":0}},{"line":40,"address":[],"length":0,"stats":{"Line":0}},{"line":41,"address":[],"length":0,"stats":{"Line":0}},{"line":42,"address":[],"length":0,"stats":{"Line":0}},{"line":43,"address":[],"length":0,"stats":{"Line":0}},{"line":46,"address":[],"length":0,"stats":{"Line":0}},{"line":47,"address":[],"length":0,"stats":{"Line":0}},{"line":48,"address":[],"length":0,"stats":{"Line":0}},{"line":49,"address":[],"length":0,"stats":{"Line":0}},{"line":50,"address":[],"length":0,"stats":{"Line":0}},{"line":51,"address":[],"length":0,"stats":{"Line":0}},{"line":52,"address":[],"length":0,"stats":{"Line":0}},{"line":53,"address":[],"length":0,"stats":{"Line":0}},{"line":54,"address":[],"length":0,"stats":{"Line":0}},{"line":55,"address":[],"length":0,"stats":{"Line":0}},{"line":58,"address":[],"length":0,"stats":{"Line":0}},{"line":59,"address":[],"length":0,"stats":{"Line":0}},{"line":60,"address":[],"length":0,"stats":{"Line":0}},{"line":61,"address":[],"length":0,"stats":{"Line":0}},{"line":62,"address":[],"length":0,"stats":{"Line":0}},{"line":65,"address":[],"length":0,"stats":{"Line":0}},{"line":66,"address":[],"length":0,"stats":{"Line":0}},{"line":67,"address":[],"length":0,"stats":{"Line":0}},{"line":68,"address":[],"length":0,"stats":{"Line":0}},{"line":69,"address":[],"length":0,"stats":{"Line":0}},{"line":70,"address":[],"length":0,"stats":{"Line":0}},{"line":71,"address":[],"length":0,"stats":{"Line":0}},{"line":72,"address":[],"length":0,"stats":{"Line":0}},{"line":73,"address":[],"length":0,"stats":{"Line":0}},{"line":74,"address":[],"length":0,"stats":{"Line":0}},{"line":77,"address":[],"length":0,"stats":{"Line":0}},{"line":78,"address":[],"length":0,"stats":{"Line":0}},{"line":79,"address":[],"length":0,"stats":{"Line":0}},{"line":82,"address":[],"length":0,"stats":{"Line":0}},{"line":83,"address":[],"length":0,"stats":{"Line":0}},{"line":84,"address":[],"length":0,"stats":{"Line":0}},{"line":85,"address":[],"length":0,"stats":{"Line":0}},{"line":86,"address":[],"length":0,"stats":{"Line":0}},{"line":89,"address":[],"length":0,"stats":{"Line":0}},{"line":90,"address":[],"length":0,"stats":{"Line":0}},{"line":91,"address":[],"length":0,"stats":{"Line":0}},{"line":94,"address":[],"length":0,"stats":{"Line":0}},{"line":95,"address":[],"length":0,"stats":{"Line":0}},{"line":96,"address":[],"length":0,"stats":{"Line":0}},{"line":97,"address":[],"length":0,"stats":{"Line":0}},{"line":98,"address":[],"length":0,"stats":{"Line":0}},{"line":99,"address":[],"length":0,"stats":{"Line":0}},{"line":100,"address":[],"length":0,"stats":{"Line":0}},{"line":101,"address":[],"length":0,"stats":{"Line":0}},{"line":102,"address":[],"length":0,"stats":{"Line":0}},{"line":103,"address":[],"length":0,"stats":{"Line":0}},{"line":106,"address":[],"length":0,"stats":{"Line":0}},{"line":107,"address":[],"length":0,"stats":{"Line":0}},{"line":108,"address":[],"length":0,"stats":{"Line":0}},{"line":109,"address":[],"length":0,"stats":{"Line":0}},{"line":110,"address":[],"length":0,"stats":{"Line":0}},{"line":113,"address":[],"length":0,"stats":{"Line":0}},{"line":114,"address":[],"length":0,"stats":{"Line":0}},{"line":115,"address":[],"length":0,"stats":{"Line":0}},{"line":118,"address":[],"length":0,"stats":{"Line":0}},{"line":119,"address":[],"length":0,"stats":{"Line":0}},{"line":120,"address":[],"length":0,"stats":{"Line":0}},{"line":121,"address":[],"length":0,"stats":{"Line":0}},{"line":122,"address":[],"length":0,"stats":{"Line":0}},{"line":123,"address":[],"length":0,"stats":{"Line":0}},{"line":124,"address":[],"length":0,"stats":{"Line":0}},{"line":125,"address":[],"length":0,"stats":{"Line":0}},{"line":126,"address":[],"length":0,"stats":{"Line":0}},{"line":127,"address":[],"length":0,"stats":{"Line":0}},{"line":130,"address":[],"length":0,"stats":{"Line":0}},{"line":131,"address":[],"length":0,"stats":{"Line":0}},{"line":132,"address":[],"length":0,"stats":{"Line":0}},{"line":135,"address":[],"length":0,"stats":{"Line":0}},{"line":136,"address":[],"length":0,"stats":{"Line":0}},{"line":137,"address":[],"length":0,"stats":{"Line":0}},{"line":138,"address":[],"length":0,"stats":{"Line":0}},{"line":140,"address":[],"length":0,"stats":{"Line":0}},{"line":141,"address":[],"length":0,"stats":{"Line":0}},{"line":142,"address":[],"length":0,"stats":{"Line":0}},{"line":143,"address":[],"length":0,"stats":{"Line":0}},{"line":145,"address":[],"length":0,"stats":{"Line":0}},{"line":146,"address":[],"length":0,"stats":{"Line":0}},{"line":147,"address":[],"length":0,"stats":{"Line":0}},{"line":148,"address":[],"length":0,"stats":{"Line":0}},{"line":149,"address":[],"length":0,"stats":{"Line":0}},{"line":150,"address":[],"length":0,"stats":{"Line":0}},{"line":151,"address":[],"length":0,"stats":{"Line":0}},{"line":152,"address":[],"length":0,"stats":{"Line":0}},{"line":155,"address":[],"length":0,"stats":{"Line":0}},{"line":156,"address":[],"length":0,"stats":{"Line":0}},{"line":157,"address":[],"length":0,"stats":{"Line":0}},{"line":158,"address":[],"length":0,"stats":{"Line":0}},{"line":159,"address":[],"length":0,"stats":{"Line":0}},{"line":160,"address":[],"length":0,"stats":{"Line":0}},{"line":161,"address":[],"length":0,"stats":{"Line":0}},{"line":162,"address":[],"length":0,"stats":{"Line":0}},{"line":163,"address":[],"length":0,"stats":{"Line":0}},{"line":164,"address":[],"length":0,"stats":{"Line":0}},{"line":166,"address":[],"length":0,"stats":{"Line":0}},{"line":169,"address":[],"length":0,"stats":{"Line":0}},{"line":171,"address":[],"length":0,"stats":{"Line":0}},{"line":173,"address":[],"length":0,"stats":{"Line":0}},{"line":174,"address":[],"length":0,"stats":{"Line":0}},{"line":175,"address":[],"length":0,"stats":{"Line":0}},{"line":176,"address":[],"length":0,"stats":{"Line":0}},{"line":178,"address":[],"length":0,"stats":{"Line":0}},{"line":180,"address":[],"length":0,"stats":{"Line":0}},{"line":181,"address":[],"length":0,"stats":{"Line":0}},{"line":182,"address":[],"length":0,"stats":{"Line":0}},{"line":184,"address":[],"length":0,"stats":{"Line":0}},{"line":185,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":132},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","ui","src","dialogs","template_browser.rs"],"content":"use gtk4::prelude::*;\nuse gtk4::{Box as GtkBox, Button, Label, Orientation, Window, SearchEntry, ListBox, ListBoxRow, ScrolledWindow, Align};\nuse testruct_core::template::Template;\nuse std::cell::RefCell;\nuse std::rc::Rc;\n\n/// Show the Template Manager dialog with callback\npub fn show_template_browser_async(\n    parent: \u0026Window,\n    templates: Vec\u003cTemplate\u003e,\n    on_selected: Box\u003cdyn Fn(Option\u003cTemplate\u003e)\u003e,\n) {\n    let selected_template: Rc\u003cRefCell\u003cOption\u003cTemplate\u003e\u003e\u003e = Rc::new(RefCell::new(None));\n\n    // Create dialog window for template browser\n    let dialog = gtk4::ApplicationWindow::builder()\n        .transient_for(parent)\n        .modal(true)\n        .title(\"\")\n        .default_width(600)\n        .default_height(500)\n        .build();\n\n    let main_box = GtkBox::new(Orientation::Vertical, 12);\n    main_box.set_margin_start(16);\n    main_box.set_margin_end(16);\n    main_box.set_margin_top(16);\n    main_box.set_margin_bottom(16);\n\n    // Title\n    let title = Label::new(Some(\"\"));\n    title.add_css_class(\"title-2\");\n    main_box.append(\u0026title);\n\n    // Search box\n    let search_entry = SearchEntry::new();\n    search_entry.set_placeholder_text(Some(\"...\"));\n    main_box.append(\u0026search_entry);\n\n    // Template list\n    let list_box = ListBox::new();\n    list_box.set_vexpand(true);\n    list_box.set_hexpand(true);\n    list_box.add_css_class(\"boxed-list\");\n\n    // Store template data for selection\n    let template_data: Rc\u003cRefCell\u003cVec\u003cTemplate\u003e\u003e\u003e = Rc::new(RefCell::new(templates.clone()));\n\n    // Populate list\n    for template in templates.iter() {\n        let row = ListBoxRow::new();\n        let item_box = GtkBox::new(Orientation::Vertical, 6);\n        item_box.set_margin_start(12);\n        item_box.set_margin_end(12);\n        item_box.set_margin_top(8);\n        item_box.set_margin_bottom(8);\n\n        // Template name\n        let name_label = Label::new(Some(\u0026template.name));\n        name_label.add_css_class(\"title-3\");\n        name_label.set_halign(Align::Start);\n        item_box.append(\u0026name_label);\n\n        // Template description (if available)\n        if let Some(desc) = \u0026template.description {\n            let desc_label = Label::new(Some(desc));\n            desc_label.add_css_class(\"dim-label\");\n            desc_label.set_halign(Align::Start);\n            desc_label.set_wrap(true);\n            item_box.append(\u0026desc_label);\n        }\n\n        // Page count info\n        let info_label = Label::new(Some(\u0026format!(\": {}\", template.pages.len())));\n        info_label.add_css_class(\"dim-label\");\n        info_label.set_halign(Align::Start);\n        info_label.set_size_request(200, -1);\n        item_box.append(\u0026info_label);\n\n        row.set_child(Some(\u0026item_box));\n        list_box.append(\u0026row);\n    }\n\n    // Handle template selection\n    let selected_ref = selected_template.clone();\n    let template_data_clone = template_data.clone();\n    list_box.connect_row_selected(move |_list_box, row| {\n        if let Some(row) = row {\n            let index = row.index() as usize;\n            if let Some(template) = template_data_clone.borrow().get(index).cloned() {\n                *selected_ref.borrow_mut() = Some(template);\n                tracing::info!(\" Template selected: {}\", row.index());\n            }\n        }\n    });\n\n    // Scrolled window for list\n    let scrolled = ScrolledWindow::new();\n    scrolled.set_child(Some(\u0026list_box));\n    scrolled.set_hexpand(true);\n    scrolled.set_vexpand(true);\n    main_box.append(\u0026scrolled);\n\n    // Template preview area (if selected)\n    let preview_box = GtkBox::new(Orientation::Vertical, 6);\n    preview_box.set_halign(Align::Start);\n    let preview_label = Label::new(Some(\":\"));\n    preview_label.add_css_class(\"dim-label\");\n    preview_box.append(\u0026preview_label);\n\n    let selected_name_label = Label::new(Some(\"\"));\n    selected_name_label.add_css_class(\"title-4\");\n    preview_box.append(\u0026selected_name_label);\n\n    // Update preview when selection changes\n    let selected_ref_preview = selected_template.clone();\n    let selected_name_clone = selected_name_label.clone();\n    list_box.connect_row_selected(move |_, _| {\n        if let Some(template) = selected_ref_preview.borrow().as_ref() {\n            selected_name_clone.set_text(\u0026template.name);\n        }\n    });\n\n    main_box.append(\u0026preview_box);\n\n    // Button box\n    let button_box = GtkBox::new(Orientation::Horizontal, 6);\n    button_box.set_halign(Align::End);\n    button_box.set_homogeneous(true);\n\n    let create_btn = Button::with_label(\"\");\n    let dialog_ref = dialog.clone();\n    let selected_for_create = selected_template.clone();\n    create_btn.connect_clicked(move |_| {\n        if selected_for_create.borrow().is_some() {\n            tracing::info!(\" Template accepted, closing dialog\");\n            dialog_ref.close();\n        } else {\n            tracing::warn!(\"  No template selected\");\n        }\n    });\n    button_box.append(\u0026create_btn);\n\n    let close_btn = Button::with_label(\"\");\n    let dialog_ref = dialog.clone();\n    let selected_for_cancel = selected_template.clone();\n    close_btn.connect_clicked(move |_| {\n        *selected_for_cancel.borrow_mut() = None;\n        dialog_ref.close();\n    });\n    button_box.append(\u0026close_btn);\n\n    main_box.append(\u0026button_box);\n\n    dialog.set_child(Some(\u0026main_box));\n\n    // Connect close event to call callback with selected template\n    let selected_final = selected_template.clone();\n    let on_selected_arc = std::sync::Arc::new(std::sync::Mutex::new(Some(on_selected)));\n    let on_selected_clone = on_selected_arc.clone();\n\n    dialog.connect_close_request(move |_| {\n        let selected = selected_final.borrow().clone();\n        if let Ok(mut callback) = on_selected_clone.try_lock() {\n            if let Some(cb) = callback.take() {\n                cb(selected);\n            }\n        }\n        false.into()\n    });\n\n    dialog.present();\n}\n","traces":[{"line":8,"address":[],"length":0,"stats":{"Line":0}},{"line":13,"address":[],"length":0,"stats":{"Line":0}},{"line":16,"address":[],"length":0,"stats":{"Line":0}},{"line":17,"address":[],"length":0,"stats":{"Line":0}},{"line":24,"address":[],"length":0,"stats":{"Line":0}},{"line":25,"address":[],"length":0,"stats":{"Line":0}},{"line":26,"address":[],"length":0,"stats":{"Line":0}},{"line":27,"address":[],"length":0,"stats":{"Line":0}},{"line":28,"address":[],"length":0,"stats":{"Line":0}},{"line":31,"address":[],"length":0,"stats":{"Line":0}},{"line":32,"address":[],"length":0,"stats":{"Line":0}},{"line":33,"address":[],"length":0,"stats":{"Line":0}},{"line":36,"address":[],"length":0,"stats":{"Line":0}},{"line":37,"address":[],"length":0,"stats":{"Line":0}},{"line":38,"address":[],"length":0,"stats":{"Line":0}},{"line":41,"address":[],"length":0,"stats":{"Line":0}},{"line":42,"address":[],"length":0,"stats":{"Line":0}},{"line":43,"address":[],"length":0,"stats":{"Line":0}},{"line":44,"address":[],"length":0,"stats":{"Line":0}},{"line":47,"address":[],"length":0,"stats":{"Line":0}},{"line":50,"address":[],"length":0,"stats":{"Line":0}},{"line":51,"address":[],"length":0,"stats":{"Line":0}},{"line":52,"address":[],"length":0,"stats":{"Line":0}},{"line":53,"address":[],"length":0,"stats":{"Line":0}},{"line":54,"address":[],"length":0,"stats":{"Line":0}},{"line":55,"address":[],"length":0,"stats":{"Line":0}},{"line":56,"address":[],"length":0,"stats":{"Line":0}},{"line":59,"address":[],"length":0,"stats":{"Line":0}},{"line":60,"address":[],"length":0,"stats":{"Line":0}},{"line":61,"address":[],"length":0,"stats":{"Line":0}},{"line":62,"address":[],"length":0,"stats":{"Line":0}},{"line":65,"address":[],"length":0,"stats":{"Line":0}},{"line":66,"address":[],"length":0,"stats":{"Line":0}},{"line":67,"address":[],"length":0,"stats":{"Line":0}},{"line":68,"address":[],"length":0,"stats":{"Line":0}},{"line":69,"address":[],"length":0,"stats":{"Line":0}},{"line":70,"address":[],"length":0,"stats":{"Line":0}},{"line":74,"address":[],"length":0,"stats":{"Line":0}},{"line":75,"address":[],"length":0,"stats":{"Line":0}},{"line":76,"address":[],"length":0,"stats":{"Line":0}},{"line":77,"address":[],"length":0,"stats":{"Line":0}},{"line":78,"address":[],"length":0,"stats":{"Line":0}},{"line":80,"address":[],"length":0,"stats":{"Line":0}},{"line":81,"address":[],"length":0,"stats":{"Line":0}},{"line":85,"address":[],"length":0,"stats":{"Line":0}},{"line":86,"address":[],"length":0,"stats":{"Line":0}},{"line":87,"address":[],"length":0,"stats":{"Line":0}},{"line":88,"address":[],"length":0,"stats":{"Line":0}},{"line":89,"address":[],"length":0,"stats":{"Line":0}},{"line":90,"address":[],"length":0,"stats":{"Line":0}},{"line":91,"address":[],"length":0,"stats":{"Line":0}},{"line":92,"address":[],"length":0,"stats":{"Line":0}},{"line":98,"address":[],"length":0,"stats":{"Line":0}},{"line":99,"address":[],"length":0,"stats":{"Line":0}},{"line":100,"address":[],"length":0,"stats":{"Line":0}},{"line":101,"address":[],"length":0,"stats":{"Line":0}},{"line":102,"address":[],"length":0,"stats":{"Line":0}},{"line":105,"address":[],"length":0,"stats":{"Line":0}},{"line":106,"address":[],"length":0,"stats":{"Line":0}},{"line":107,"address":[],"length":0,"stats":{"Line":0}},{"line":108,"address":[],"length":0,"stats":{"Line":0}},{"line":109,"address":[],"length":0,"stats":{"Line":0}},{"line":111,"address":[],"length":0,"stats":{"Line":0}},{"line":112,"address":[],"length":0,"stats":{"Line":0}},{"line":113,"address":[],"length":0,"stats":{"Line":0}},{"line":116,"address":[],"length":0,"stats":{"Line":0}},{"line":117,"address":[],"length":0,"stats":{"Line":0}},{"line":118,"address":[],"length":0,"stats":{"Line":0}},{"line":119,"address":[],"length":0,"stats":{"Line":0}},{"line":120,"address":[],"length":0,"stats":{"Line":0}},{"line":124,"address":[],"length":0,"stats":{"Line":0}},{"line":127,"address":[],"length":0,"stats":{"Line":0}},{"line":128,"address":[],"length":0,"stats":{"Line":0}},{"line":129,"address":[],"length":0,"stats":{"Line":0}},{"line":131,"address":[],"length":0,"stats":{"Line":0}},{"line":132,"address":[],"length":0,"stats":{"Line":0}},{"line":133,"address":[],"length":0,"stats":{"Line":0}},{"line":134,"address":[],"length":0,"stats":{"Line":0}},{"line":135,"address":[],"length":0,"stats":{"Line":0}},{"line":136,"address":[],"length":0,"stats":{"Line":0}},{"line":137,"address":[],"length":0,"stats":{"Line":0}},{"line":139,"address":[],"length":0,"stats":{"Line":0}},{"line":142,"address":[],"length":0,"stats":{"Line":0}},{"line":144,"address":[],"length":0,"stats":{"Line":0}},{"line":145,"address":[],"length":0,"stats":{"Line":0}},{"line":146,"address":[],"length":0,"stats":{"Line":0}},{"line":147,"address":[],"length":0,"stats":{"Line":0}},{"line":148,"address":[],"length":0,"stats":{"Line":0}},{"line":149,"address":[],"length":0,"stats":{"Line":0}},{"line":151,"address":[],"length":0,"stats":{"Line":0}},{"line":153,"address":[],"length":0,"stats":{"Line":0}},{"line":155,"address":[],"length":0,"stats":{"Line":0}},{"line":158,"address":[],"length":0,"stats":{"Line":0}},{"line":159,"address":[],"length":0,"stats":{"Line":0}},{"line":160,"address":[],"length":0,"stats":{"Line":0}},{"line":162,"address":[],"length":0,"stats":{"Line":0}},{"line":163,"address":[],"length":0,"stats":{"Line":0}},{"line":164,"address":[],"length":0,"stats":{"Line":0}},{"line":165,"address":[],"length":0,"stats":{"Line":0}},{"line":166,"address":[],"length":0,"stats":{"Line":0}},{"line":169,"address":[],"length":0,"stats":{"Line":0}},{"line":172,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":102},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","ui","src","dialogs","user_manual_dialog.rs"],"content":"//! User manual dialog for the application\n\nuse gtk4::prelude::*;\nuse gtk4::{Dialog, Label, ScrolledWindow, Window, Orientation, Box as GtkBox};\n\n/// Show the User Manual dialog\npub fn show_user_manual_dialog(parent: \u0026Window) {\n    let dialog = Dialog::builder()\n        .title(\" - Testruct Studio\")\n        .transient_for(parent)\n        .modal(true)\n        .default_width(800)\n        .default_height(600)\n        .build();\n\n    let content_box = GtkBox::new(Orientation::Vertical, 12);\n    content_box.set_margin_start(16);\n    content_box.set_margin_end(16);\n    content_box.set_margin_top(16);\n    content_box.set_margin_bottom(16);\n\n    // Manual content\n    let manual_text = r#\"Testruct Studio \n\n\n\n1. \n   - \n   - \n   - \n\n2. \n   - : \n   - : \n   - : \n   - : \n   - : \n   - : \n\n3. \n   - : \n   - : \n   - : \n   - Shift + : \n   - Ctrl + A: \n\n4. \n   - F8: /\n   - F7: /\n   - F6: /\n\n5. \n   - Ctrl + N: \n   - Ctrl + O: \n   - Ctrl + S: \n   - Ctrl + Shift + S: \n\n6. \n   - Ctrl + Z: \n   - Ctrl + Shift + Z: \n   - Ctrl + I: \n\n\"#;\n\n    let label = Label::new(Some(manual_text));\n    label.set_wrap(true);\n    label.set_selectable(true);\n    label.set_halign(gtk4::Align::Start);\n    label.set_valign(gtk4::Align::Start);\n\n    let scrolled = ScrolledWindow::new();\n    scrolled.set_child(Some(\u0026label));\n    scrolled.set_hexpand(true);\n    scrolled.set_vexpand(true);\n\n    content_box.append(\u0026scrolled);\n\n    let content_area = dialog.content_area();\n    content_area.append(\u0026content_box);\n\n    // Add close button\n    dialog.add_button(\"\", gtk4::ResponseType::Ok);\n    dialog.connect_response(|dialog, _response_id| {\n        dialog.close();\n    });\n\n    // Show the dialog\n    dialog.show();\n}\n","traces":[{"line":7,"address":[],"length":0,"stats":{"Line":0}},{"line":8,"address":[],"length":0,"stats":{"Line":0}},{"line":10,"address":[],"length":0,"stats":{"Line":0}},{"line":16,"address":[],"length":0,"stats":{"Line":0}},{"line":17,"address":[],"length":0,"stats":{"Line":0}},{"line":18,"address":[],"length":0,"stats":{"Line":0}},{"line":19,"address":[],"length":0,"stats":{"Line":0}},{"line":20,"address":[],"length":0,"stats":{"Line":0}},{"line":23,"address":[],"length":0,"stats":{"Line":0}},{"line":25,"address":[],"length":0,"stats":{"Line":0}},{"line":27,"address":[],"length":0,"stats":{"Line":0}},{"line":28,"address":[],"length":0,"stats":{"Line":0}},{"line":29,"address":[],"length":0,"stats":{"Line":0}},{"line":30,"address":[],"length":0,"stats":{"Line":0}},{"line":32,"address":[],"length":0,"stats":{"Line":0}},{"line":33,"address":[],"length":0,"stats":{"Line":0}},{"line":34,"address":[],"length":0,"stats":{"Line":0}},{"line":35,"address":[],"length":0,"stats":{"Line":0}},{"line":36,"address":[],"length":0,"stats":{"Line":0}},{"line":37,"address":[],"length":0,"stats":{"Line":0}},{"line":38,"address":[],"length":0,"stats":{"Line":0}},{"line":40,"address":[],"length":0,"stats":{"Line":0}},{"line":41,"address":[],"length":0,"stats":{"Line":0}},{"line":42,"address":[],"length":0,"stats":{"Line":0}},{"line":43,"address":[],"length":0,"stats":{"Line":0}},{"line":44,"address":[],"length":0,"stats":{"Line":0}},{"line":45,"address":[],"length":0,"stats":{"Line":0}},{"line":47,"address":[],"length":0,"stats":{"Line":0}},{"line":48,"address":[],"length":0,"stats":{"Line":0}},{"line":49,"address":[],"length":0,"stats":{"Line":0}},{"line":50,"address":[],"length":0,"stats":{"Line":0}},{"line":52,"address":[],"length":0,"stats":{"Line":0}},{"line":53,"address":[],"length":0,"stats":{"Line":0}},{"line":54,"address":[],"length":0,"stats":{"Line":0}},{"line":55,"address":[],"length":0,"stats":{"Line":0}},{"line":56,"address":[],"length":0,"stats":{"Line":0}},{"line":58,"address":[],"length":0,"stats":{"Line":0}},{"line":59,"address":[],"length":0,"stats":{"Line":0}},{"line":60,"address":[],"length":0,"stats":{"Line":0}},{"line":61,"address":[],"length":0,"stats":{"Line":0}},{"line":63,"address":[],"length":0,"stats":{"Line":0}},{"line":65,"address":[],"length":0,"stats":{"Line":0}},{"line":66,"address":[],"length":0,"stats":{"Line":0}},{"line":67,"address":[],"length":0,"stats":{"Line":0}},{"line":68,"address":[],"length":0,"stats":{"Line":0}},{"line":69,"address":[],"length":0,"stats":{"Line":0}},{"line":71,"address":[],"length":0,"stats":{"Line":0}},{"line":72,"address":[],"length":0,"stats":{"Line":0}},{"line":73,"address":[],"length":0,"stats":{"Line":0}},{"line":74,"address":[],"length":0,"stats":{"Line":0}},{"line":76,"address":[],"length":0,"stats":{"Line":0}},{"line":78,"address":[],"length":0,"stats":{"Line":0}},{"line":79,"address":[],"length":0,"stats":{"Line":0}},{"line":82,"address":[],"length":0,"stats":{"Line":0}},{"line":83,"address":[],"length":0,"stats":{"Line":0}},{"line":84,"address":[],"length":0,"stats":{"Line":0}},{"line":88,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":57},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","ui","src","error.rs"],"content":"//! Error handling and user-friendly error messages\n//!\n//! Provides comprehensive error types with friendly messages for educators.\n//! Messages are localized to Japanese for the educational context.\n\nuse std::fmt;\n\n/// Error severity level\n#[derive(Clone, Copy, Debug, PartialEq, Eq)]\npub enum ErrorSeverity {\n    /// Non-blocking warning\n    Warning,\n    /// Standard error\n    Error,\n    /// Critical issue\n    Critical,\n}\n\n/// Application error types with user-friendly messages\n#[derive(Debug)]\npub enum AppError {\n    /// Document operation errors\n    DocumentError(String),\n    /// File I/O errors\n    FileError(String),\n    /// JSON serialization errors\n    JsonError(String),\n    /// Database operation errors\n    DatabaseError(String),\n    /// Canvas rendering errors\n    RenderError(String),\n    /// Invalid state or operation\n    InvalidOperation(String),\n    /// Element not found\n    ElementNotFound(String),\n    /// Page not found\n    PageNotFound(String),\n    /// Selection error\n    SelectionError(String),\n}\n\nimpl AppError {\n    /// Get the severity level of this error\n    pub fn severity(\u0026self) -\u003e ErrorSeverity {\n        match self {\n            AppError::DocumentError(_) =\u003e ErrorSeverity::Error,\n            AppError::FileError(_) =\u003e ErrorSeverity::Critical,\n            AppError::JsonError(_) =\u003e ErrorSeverity::Error,\n            AppError::DatabaseError(_) =\u003e ErrorSeverity::Critical,\n            AppError::RenderError(_) =\u003e ErrorSeverity::Warning,\n            AppError::InvalidOperation(_) =\u003e ErrorSeverity::Error,\n            AppError::ElementNotFound(_) =\u003e ErrorSeverity::Warning,\n            AppError::PageNotFound(_) =\u003e ErrorSeverity::Error,\n            AppError::SelectionError(_) =\u003e ErrorSeverity::Warning,\n        }\n    }\n\n    /// Get the user-friendly message\n    pub fn user_message(\u0026self) -\u003e String {\n        match self {\n            AppError::DocumentError(msg) =\u003e format!(\"{}\", msg),\n            AppError::FileError(msg) =\u003e format!(\"{}\", msg),\n            AppError::JsonError(msg) =\u003e format!(\"{}\", msg),\n            AppError::DatabaseError(msg) =\u003e format!(\"{}\", msg),\n            AppError::RenderError(msg) =\u003e format!(\"{}\", msg),\n            AppError::InvalidOperation(msg) =\u003e format!(\"{}\", msg),\n            AppError::ElementNotFound(id) =\u003e {\n                format!(\"{}\", id)\n            }\n            AppError::PageNotFound(idx) =\u003e {\n                format!(\" {} \", idx)\n            }\n            AppError::SelectionError(msg) =\u003e format!(\"{}\", msg),\n        }\n    }\n}\n\nimpl fmt::Display for AppError {\n    fn fmt(\u0026self, f: \u0026mut fmt::Formatter) -\u003e fmt::Result {\n        write!(f, \"{}\", self.user_message())\n    }\n}\n\nimpl std::error::Error for AppError {}\n\n/// Result type for application errors\npub type AppResult\u003cT\u003e = Result\u003cT, AppError\u003e;\n\n/// Validation error with suggestion for user guidance\npub struct ValidationError {\n    pub field: String,\n    pub message: String,\n    pub suggestion: Option\u003cString\u003e,\n}\n\nimpl ValidationError {\n    /// Create a new validation error\n    pub fn new(field: \u0026str, message: \u0026str) -\u003e Self {\n        Self {\n            field: field.to_string(),\n            message: message.to_string(),\n            suggestion: None,\n        }\n    }\n\n    /// Add a helpful suggestion\n    pub fn with_suggestion(mut self, suggestion: \u0026str) -\u003e Self {\n        self.suggestion = Some(suggestion.to_string());\n        self\n    }\n\n    /// Get the full formatted message with suggestion\n    pub fn full_message(\u0026self) -\u003e String {\n        let mut msg = format!(\"{}{}\", self.field, self.message);\n        if let Some(suggestion) = \u0026self.suggestion {\n            msg.push_str(\u0026format!(\"\\n\\n {}\", suggestion));\n        }\n        msg\n    }\n}\n\nimpl fmt::Display for ValidationError {\n    fn fmt(\u0026self, f: \u0026mut fmt::Formatter) -\u003e fmt::Result {\n        write!(f, \"{}\", self.full_message())\n    }\n}\n\n/// Validation result type\npub type ValidationResult\u003cT\u003e = Result\u003cT, ValidationError\u003e;\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n\n    #[test]\n    fn test_error_display() {\n        let err = AppError::ElementNotFound(\"abc123\".to_string());\n        assert_eq!(err.to_string(), \"abc123\");\n    }\n\n    #[test]\n    fn test_error_severity() {\n        assert_eq!(AppError::FileError(\"test\".to_string()).severity(), ErrorSeverity::Critical);\n        assert_eq!(AppError::ElementNotFound(\"id\".to_string()).severity(), ErrorSeverity::Warning);\n    }\n\n    #[test]\n    fn test_validation_error_with_suggestion() {\n        let err = ValidationError::new(\"font_size\", \"\")\n            .with_suggestion(\"672\");\n\n        assert!(err.full_message().contains(\" \"));\n        assert!(err.full_message().contains(\"672\"));\n        assert!(err.full_message().contains(\"font_size\"));\n    }\n}\n","traces":[{"line":44,"address":[],"length":0,"stats":{"Line":2}},{"line":45,"address":[],"length":0,"stats":{"Line":2}},{"line":46,"address":[],"length":0,"stats":{"Line":0}},{"line":47,"address":[],"length":0,"stats":{"Line":1}},{"line":48,"address":[],"length":0,"stats":{"Line":0}},{"line":49,"address":[],"length":0,"stats":{"Line":0}},{"line":50,"address":[],"length":0,"stats":{"Line":0}},{"line":51,"address":[],"length":0,"stats":{"Line":0}},{"line":52,"address":[],"length":0,"stats":{"Line":1}},{"line":53,"address":[],"length":0,"stats":{"Line":0}},{"line":54,"address":[],"length":0,"stats":{"Line":0}},{"line":59,"address":[],"length":0,"stats":{"Line":1}},{"line":60,"address":[],"length":0,"stats":{"Line":1}},{"line":61,"address":[],"length":0,"stats":{"Line":0}},{"line":62,"address":[],"length":0,"stats":{"Line":0}},{"line":63,"address":[],"length":0,"stats":{"Line":0}},{"line":64,"address":[],"length":0,"stats":{"Line":0}},{"line":65,"address":[],"length":0,"stats":{"Line":0}},{"line":66,"address":[],"length":0,"stats":{"Line":0}},{"line":67,"address":[],"length":0,"stats":{"Line":1}},{"line":68,"address":[],"length":0,"stats":{"Line":2}},{"line":70,"address":[],"length":0,"stats":{"Line":0}},{"line":71,"address":[],"length":0,"stats":{"Line":0}},{"line":73,"address":[],"length":0,"stats":{"Line":0}},{"line":79,"address":[],"length":0,"stats":{"Line":1}},{"line":80,"address":[],"length":0,"stats":{"Line":5}},{"line":98,"address":[],"length":0,"stats":{"Line":1}},{"line":100,"address":[],"length":0,"stats":{"Line":3}},{"line":101,"address":[],"length":0,"stats":{"Line":2}},{"line":107,"address":[],"length":0,"stats":{"Line":1}},{"line":108,"address":[],"length":0,"stats":{"Line":2}},{"line":109,"address":[],"length":0,"stats":{"Line":1}},{"line":113,"address":[],"length":0,"stats":{"Line":3}},{"line":114,"address":[],"length":0,"stats":{"Line":9}},{"line":115,"address":[],"length":0,"stats":{"Line":9}},{"line":116,"address":[],"length":0,"stats":{"Line":9}},{"line":118,"address":[],"length":0,"stats":{"Line":3}},{"line":123,"address":[],"length":0,"stats":{"Line":0}},{"line":124,"address":[],"length":0,"stats":{"Line":0}}],"covered":21,"coverable":39},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","ui","src","export","image.rs"],"content":"//! Image export functionality (PNG, JPEG) using Cairo\n//!\n//! Renders a document to raster image formats with configurable DPI.\n\nuse anyhow::{anyhow, Result};\nuse cairo::{Context, Format, ImageSurface};\nuse std::path::Path;\nuse testruct_core::Document;\nuse testruct_core::workspace::assets::AssetCatalog;\nuse tracing::{debug, info};\n\n/// Default DPI for image export\nconst DEFAULT_DPI: f64 = 96.0;\n\n/// Render a document to PNG format (one file per page)\npub fn render_to_png(document: \u0026Document, output_path: \u0026Path, dpi: f64, catalog: \u0026AssetCatalog) -\u003e Result\u003c()\u003e {\n    info!(\"Exporting to PNG: {}\", output_path.display());\n\n    if document.pages.is_empty() {\n        return Err(anyhow!(\"Document has no pages to export\"));\n    }\n\n    let dpi = if dpi \u003c= 0.0 { DEFAULT_DPI } else { dpi };\n    debug!(\"PNG export DPI: {}\", dpi);\n\n    // If multi-page, save each as separate file\n    if document.pages.len() \u003e 1 {\n        export_multi_page_png(document, output_path, dpi, catalog)\n    } else {\n        export_single_page_png(document, output_path, dpi, catalog)\n    }\n}\n\n/// Render a document to JPEG format (one file per page)\npub fn render_to_jpeg(document: \u0026Document, output_path: \u0026Path, dpi: f64, quality: i32, catalog: \u0026AssetCatalog) -\u003e Result\u003c()\u003e {\n    info!(\"Exporting to JPEG: {}\", output_path.display());\n\n    if document.pages.is_empty() {\n        return Err(anyhow!(\"Document has no pages to export\"));\n    }\n\n    let dpi = if dpi \u003c= 0.0 { DEFAULT_DPI } else { dpi };\n    let quality = if quality \u003c 0 || quality \u003e 100 { 95 } else { quality };\n\n    debug!(\"JPEG export DPI: {}, Quality: {}\", dpi, quality);\n\n    // Convert to PNG first, then to JPEG using image crate\n    // For now, we'll just export as PNG (JPEG would require additional dependencies)\n    info!(\"JPEG export currently uses PNG format. Full JPEG support requires additional setup.\");\n    render_to_png(document, output_path, dpi, catalog)\n}\n\n/// Export single-page document to PNG\nfn export_single_page_png(document: \u0026Document, output_path: \u0026Path, dpi: f64, catalog: \u0026AssetCatalog) -\u003e Result\u003c()\u003e {\n    let page = \u0026document.pages[0];\n    render_page_to_png(page, output_path, dpi, catalog)\n}\n\n/// Export multi-page document to multiple PNG files\nfn export_multi_page_png(document: \u0026Document, output_path: \u0026Path, dpi: f64, catalog: \u0026AssetCatalog) -\u003e Result\u003c()\u003e {\n    for (index, page) in document.pages.iter().enumerate() {\n        let page_num = index + 1;\n\n        // Create output filename with page number\n        let output_filename = if let Some(extension) = output_path.extension() {\n            let stem = output_path.file_stem().unwrap();\n            let stem_str = stem.to_string_lossy();\n            let ext_str = extension.to_string_lossy();\n            format!(\"{}_page_{}.{}\", stem_str, page_num, ext_str)\n        } else {\n            format!(\"{}_page_{}.png\", output_path.display(), page_num)\n        };\n\n        let page_path = output_path.parent()\n            .unwrap_or_else(|| Path::new(\".\"))\n            .join(\u0026output_filename);\n\n        debug!(\"Rendering page {} to: {}\", page_num, page_path.display());\n        render_page_to_png(page, \u0026page_path, dpi, catalog)?;\n    }\n\n    info!(\"PNG export completed: {} pages exported to {}\", document.pages.len(), output_path.display());\n    Ok(())\n}\n\n/// Render a single page to PNG file\nfn render_page_to_png(_page: \u0026testruct_core::document::Page, output_path: \u0026Path, dpi: f64, catalog: \u0026AssetCatalog) -\u003e Result\u003c()\u003e {\n    // Use default page dimensions (A4: 595.28 x 841.89 points)\n    let width_points = 595.28;\n    let height_points = 841.89;\n    let width_inches = width_points / 72.0; // Assume 72 points per inch\n    let height_inches = height_points / 72.0;\n\n    let pixel_width = (width_inches * dpi) as i32;\n    let pixel_height = (height_inches * dpi) as i32;\n\n    debug!(\"PNG size: {}x{} pixels at {} DPI\", pixel_width, pixel_height, dpi);\n\n    // Clamp to minimum size\n    let pixel_width = pixel_width.max(100);\n    let pixel_height = pixel_height.max(100);\n\n    // Create image surface\n    let surface = ImageSurface::create(Format::ARgb32, pixel_width, pixel_height)\n        .map_err(|e| anyhow!(\"Failed to create image surface: {}\", e))?;\n\n    let ctx = Context::new(\u0026surface)\n        .map_err(|e| anyhow!(\"Failed to create Cairo context: {}\", e))?;\n\n    // Scale context for DPI\n    let scale = dpi / 72.0;\n    ctx.scale(scale, scale);\n\n    // Render page\n    render_page_to_context(\u0026ctx, _page, catalog)?;\n\n    // Write to file\n    let mut file = std::fs::File::create(output_path)\n        .map_err(|e| anyhow!(\"Failed to create output file: {}\", e))?;\n\n    surface.write_to_png(\u0026mut file)\n        .map_err(|e| anyhow!(\"Failed to write PNG: {}\", e))?;\n\n    info!(\"PNG exported: {}\", output_path.display());\n    Ok(())\n}\n\n/// Render a single page to Cairo context\nfn render_page_to_context(ctx: \u0026Context, page: \u0026testruct_core::document::Page, catalog: \u0026AssetCatalog) -\u003e Result\u003c()\u003e {\n    // Set white background\n    ctx.set_source_rgb(1.0, 1.0, 1.0);\n    ctx.paint()\n        .map_err(|e| anyhow!(\"Failed to paint background: {}\", e))?;\n\n    // Use default page dimensions (A4)\n    let width = 595.28;\n    let height = 841.89;\n\n    // Draw page border\n    ctx.set_source_rgb(0.0, 0.0, 0.0);\n    ctx.set_line_width(0.5);\n    ctx.rectangle(0.0, 0.0, width, height);\n    ctx.stroke()\n        .map_err(|e| anyhow!(\"Failed to draw page border: {}\", e))?;\n\n    // Render all elements\n    for element in \u0026page.elements {\n        render_element_to_context(ctx, element, catalog)?;\n    }\n\n    Ok(())\n}\n\n/// Render a single element to Cairo context\nfn render_element_to_context(ctx: \u0026Context, element: \u0026testruct_core::document::DocumentElement, catalog: \u0026AssetCatalog) -\u003e Result\u003c()\u003e {\n    use testruct_core::document::DocumentElement;\n\n    match element {\n        DocumentElement::Shape(shape) =\u003e {\n            render_shape_to_context(ctx, shape)?;\n        }\n        DocumentElement::Text(text) =\u003e {\n            render_text_to_context(ctx, text)?;\n        }\n        DocumentElement::Image(image) =\u003e {\n            // Try to load image from catalog, fallback to placeholder if not found\n            match crate::export::image_utils::render_image_from_asset(ctx, image.source, catalog, \u0026image.bounds) {\n                Ok(_) =\u003e {\n                    debug!(\"Image rendered from asset catalog: {}\", image.id);\n                }\n                Err(e) =\u003e {\n                    // If loading fails, draw placeholder and log warning\n                    debug!(\"Failed to render image {}: {}, using placeholder\", image.id, e);\n                    let _ = crate::export::image_utils::draw_image_placeholder(ctx, \u0026image.bounds);\n                }\n            }\n        }\n        DocumentElement::Frame(frame) =\u003e {\n            render_frame_to_context(ctx, frame, catalog)?;\n        }\n    }\n\n    Ok(())\n}\n\n/// Render a shape element\nfn render_shape_to_context(ctx: \u0026Context, shape: \u0026testruct_core::document::ShapeElement) -\u003e Result\u003c()\u003e {\n    use testruct_core::document::ShapeKind;\n\n    let x = shape.bounds.origin.x as f64;\n    let y = shape.bounds.origin.y as f64;\n    let width = shape.bounds.size.width as f64;\n    let height = shape.bounds.size.height as f64;\n\n    // Render based on shape kind\n    match shape.kind {\n        ShapeKind::Rectangle =\u003e {\n            // Draw fill color if present\n            if let Some(fill) = \u0026shape.fill {\n                ctx.set_source_rgb(fill.r as f64, fill.g as f64, fill.b as f64);\n                ctx.rectangle(x, y, width, height);\n                ctx.fill()\n                    .map_err(|e| anyhow!(\"Failed to fill rectangle: {}\", e))?;\n            }\n            // Draw stroke if present\n            if let Some(stroke) = \u0026shape.stroke {\n                ctx.set_source_rgb(stroke.r as f64, stroke.g as f64, stroke.b as f64);\n                ctx.set_line_width(1.0);\n                ctx.rectangle(x, y, width, height);\n                ctx.stroke()\n                    .map_err(|e| anyhow!(\"Failed to stroke rectangle: {}\", e))?;\n            }\n        }\n        ShapeKind::Ellipse =\u003e {\n            ctx.save().map_err(|e| anyhow!(\"Failed to save context: {}\", e))?;\n            ctx.translate(x + width / 2.0, y + height / 2.0);\n            ctx.scale(width / 2.0, height / 2.0);\n            ctx.arc(0.0, 0.0, 1.0, 0.0, std::f64::consts::PI * 2.0);\n\n            // Draw fill if present\n            if let Some(fill) = \u0026shape.fill {\n                ctx.set_source_rgb(fill.r as f64, fill.g as f64, fill.b as f64);\n                ctx.fill_preserve()\n                    .map_err(|e| anyhow!(\"Failed to fill ellipse: {}\", e))?;\n            }\n            // Draw stroke if present\n            if let Some(stroke) = \u0026shape.stroke {\n                ctx.set_source_rgb(stroke.r as f64, stroke.g as f64, stroke.b as f64);\n                ctx.set_line_width(1.0);\n                ctx.stroke()\n                    .map_err(|e| anyhow!(\"Failed to stroke ellipse: {}\", e))?;\n            }\n            ctx.restore().map_err(|e| anyhow!(\"Failed to restore context: {}\", e))?;\n        }\n        ShapeKind::Line =\u003e {\n            // Lines use stroke color\n            if let Some(stroke) = \u0026shape.stroke {\n                ctx.set_source_rgb(stroke.r as f64, stroke.g as f64, stroke.b as f64);\n                ctx.set_line_width(1.0);\n                ctx.move_to(x, y);\n                ctx.line_to(x + width, y + height);\n                ctx.stroke()\n                    .map_err(|e| anyhow!(\"Failed to stroke line: {}\", e))?;\n            }\n        }\n        ShapeKind::Arrow =\u003e {\n            // Arrows use stroke color for the line\n            if let Some(stroke) = \u0026shape.stroke {\n                ctx.set_source_rgb(stroke.r as f64, stroke.g as f64, stroke.b as f64);\n                ctx.set_line_width(1.0);\n                ctx.move_to(x, y);\n                ctx.line_to(x + width, y + height);\n                ctx.stroke()\n                    .map_err(|e| anyhow!(\"Failed to stroke arrow: {}\", e))?;\n            }\n        }\n        ShapeKind::Polygon =\u003e {\n            // Placeholder for polygon (same as rectangle)\n            if let Some(fill) = \u0026shape.fill {\n                ctx.set_source_rgb(fill.r as f64, fill.g as f64, fill.b as f64);\n                ctx.rectangle(x, y, width, height);\n                ctx.fill()\n                    .map_err(|e| anyhow!(\"Failed to fill polygon: {}\", e))?;\n            }\n            if let Some(stroke) = \u0026shape.stroke {\n                ctx.set_source_rgb(stroke.r as f64, stroke.g as f64, stroke.b as f64);\n                ctx.set_line_width(1.0);\n                ctx.rectangle(x, y, width, height);\n                ctx.stroke()\n                    .map_err(|e| anyhow!(\"Failed to stroke polygon: {}\", e))?;\n            }\n        }\n    }\n\n    Ok(())\n}\n\n/// Render a frame element (with recursive children)\nfn render_frame_to_context(ctx: \u0026Context, frame: \u0026testruct_core::document::FrameElement, catalog: \u0026AssetCatalog) -\u003e Result\u003c()\u003e {\n    let x = frame.bounds.origin.x as f64;\n    let y = frame.bounds.origin.y as f64;\n    let width = frame.bounds.size.width as f64;\n    let height = frame.bounds.size.height as f64;\n\n    // Draw frame border\n    ctx.set_source_rgb(0.9, 0.9, 0.9);\n    ctx.set_line_width(1.0);\n    ctx.rectangle(x, y, width, height);\n    ctx.stroke()\n        .map_err(|e| anyhow!(\"Failed to stroke frame: {}\", e))?;\n\n    // Render frame children recursively\n    for child in \u0026frame.children {\n        render_element_to_context(ctx, child, catalog)?;\n    }\n\n    debug!(\"Frame rendered with {} children\", frame.children.len());\n    Ok(())\n}\n\n/// Render a text element with Pango layout\nfn render_text_to_context(ctx: \u0026Context, text: \u0026testruct_core::document::TextElement) -\u003e Result\u003c()\u003e {\n    use pango::prelude::*;\n\n    ctx.save()\n        .map_err(|e| anyhow!(\"Failed to save context: {}\", e))?;\n\n    let bounds = \u0026text.bounds;\n    let style = \u0026text.style;\n\n    // Draw background color if specified\n    if let Some(bg_color) = style.background_color {\n        ctx.set_source_rgb(bg_color.r as f64, bg_color.g as f64, bg_color.b as f64);\n        ctx.rectangle(\n            bounds.origin.x as f64,\n            bounds.origin.y as f64,\n            bounds.size.width as f64,\n            bounds.size.height as f64,\n        );\n        ctx.fill()\n            .map_err(|e| anyhow!(\"Failed to fill text background: {}\", e))?;\n    }\n\n    // Translate to text origin\n    ctx.translate(bounds.origin.x as f64, bounds.origin.y as f64);\n\n    // Create clipping rectangle\n    ctx.rectangle(0.0, 0.0, bounds.size.width as f64, bounds.size.height as f64);\n    ctx.clip();\n\n    // Create Pango layout\n    let layout = pangocairo::functions::create_layout(ctx);\n    layout.set_text(\u0026text.content);\n\n    // Set font with styling\n    let mut font_desc = pango::FontDescription::new();\n    font_desc.set_family(\u0026style.font_family);\n    font_desc.set_size((style.font_size * pango::SCALE as f32) as i32);\n\n    // Apply font weight\n    let pango_weight = match style.weight {\n        testruct_core::typography::FontWeight::Thin =\u003e pango::Weight::Thin,\n        testruct_core::typography::FontWeight::Light =\u003e pango::Weight::Light,\n        testruct_core::typography::FontWeight::Regular =\u003e pango::Weight::Normal,\n        testruct_core::typography::FontWeight::Medium =\u003e pango::Weight::Medium,\n        testruct_core::typography::FontWeight::Bold =\u003e pango::Weight::Bold,\n        testruct_core::typography::FontWeight::Black =\u003e pango::Weight::Ultrabold,\n    };\n    font_desc.set_weight(pango_weight);\n\n    // Apply italic style\n    if style.italic {\n        font_desc.set_style(pango::Style::Italic);\n    }\n\n    layout.set_font_description(Some(\u0026font_desc));\n\n    // Apply text alignment\n    let pango_alignment = match style.alignment {\n        testruct_core::typography::TextAlignment::Start =\u003e pango::Alignment::Left,\n        testruct_core::typography::TextAlignment::Center =\u003e pango::Alignment::Center,\n        testruct_core::typography::TextAlignment::End =\u003e pango::Alignment::Right,\n        testruct_core::typography::TextAlignment::Justified =\u003e pango::Alignment::Center,\n    };\n    layout.set_alignment(pango_alignment);\n    layout.set_width((bounds.size.width as f64 * pango::SCALE as f64) as i32);\n\n    // Apply underline and strikethrough decorations\n    if style.underline || style.strikethrough {\n        let attrs = pango::AttrList::new();\n        if style.underline {\n            let underline_attr = pango::AttrInt::new_underline(pango::Underline::Single);\n            attrs.insert(underline_attr);\n        }\n        if style.strikethrough {\n            let strikethrough_attr = pango::AttrInt::new_strikethrough(true);\n            attrs.insert(strikethrough_attr);\n        }\n        layout.set_attributes(Some(\u0026attrs));\n    }\n\n    // Set text color\n    ctx.set_source_rgb(\n        style.color.r as f64,\n        style.color.g as f64,\n        style.color.b as f64,\n    );\n\n    // Render the text using pangocairo\n    pangocairo::functions::show_layout(ctx, \u0026layout);\n\n    ctx.restore()\n        .map_err(|e| anyhow!(\"Failed to restore context: {}\", e))?;\n\n    debug!(\"Text rendered: '{}' in PNG\", text.content);\n    Ok(())\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n\n    #[test]\n    fn test_image_export_module_loads() {\n        assert!(true);\n    }\n\n    #[test]\n    fn test_default_dpi() {\n        assert_eq!(DEFAULT_DPI, 96.0);\n    }\n}\n","traces":[{"line":16,"address":[],"length":0,"stats":{"Line":0}},{"line":17,"address":[],"length":0,"stats":{"Line":0}},{"line":19,"address":[],"length":0,"stats":{"Line":0}},{"line":20,"address":[],"length":0,"stats":{"Line":0}},{"line":23,"address":[],"length":0,"stats":{"Line":0}},{"line":24,"address":[],"length":0,"stats":{"Line":0}},{"line":27,"address":[],"length":0,"stats":{"Line":0}},{"line":28,"address":[],"length":0,"stats":{"Line":0}},{"line":30,"address":[],"length":0,"stats":{"Line":0}},{"line":35,"address":[],"length":0,"stats":{"Line":0}},{"line":36,"address":[],"length":0,"stats":{"Line":0}},{"line":38,"address":[],"length":0,"stats":{"Line":0}},{"line":39,"address":[],"length":0,"stats":{"Line":0}},{"line":42,"address":[],"length":0,"stats":{"Line":0}},{"line":43,"address":[],"length":0,"stats":{"Line":0}},{"line":45,"address":[],"length":0,"stats":{"Line":0}},{"line":49,"address":[],"length":0,"stats":{"Line":0}},{"line":50,"address":[],"length":0,"stats":{"Line":0}},{"line":54,"address":[],"length":0,"stats":{"Line":0}},{"line":55,"address":[],"length":0,"stats":{"Line":0}},{"line":56,"address":[],"length":0,"stats":{"Line":0}},{"line":60,"address":[],"length":0,"stats":{"Line":0}},{"line":61,"address":[],"length":0,"stats":{"Line":0}},{"line":62,"address":[],"length":0,"stats":{"Line":0}},{"line":65,"address":[],"length":0,"stats":{"Line":0}},{"line":66,"address":[],"length":0,"stats":{"Line":0}},{"line":67,"address":[],"length":0,"stats":{"Line":0}},{"line":68,"address":[],"length":0,"stats":{"Line":0}},{"line":69,"address":[],"length":0,"stats":{"Line":0}},{"line":71,"address":[],"length":0,"stats":{"Line":0}},{"line":74,"address":[],"length":0,"stats":{"Line":0}},{"line":75,"address":[],"length":0,"stats":{"Line":0}},{"line":76,"address":[],"length":0,"stats":{"Line":0}},{"line":78,"address":[],"length":0,"stats":{"Line":0}},{"line":79,"address":[],"length":0,"stats":{"Line":0}},{"line":82,"address":[],"length":0,"stats":{"Line":0}},{"line":83,"address":[],"length":0,"stats":{"Line":0}},{"line":87,"address":[],"length":0,"stats":{"Line":0}},{"line":89,"address":[],"length":0,"stats":{"Line":0}},{"line":90,"address":[],"length":0,"stats":{"Line":0}},{"line":91,"address":[],"length":0,"stats":{"Line":0}},{"line":92,"address":[],"length":0,"stats":{"Line":0}},{"line":94,"address":[],"length":0,"stats":{"Line":0}},{"line":95,"address":[],"length":0,"stats":{"Line":0}},{"line":97,"address":[],"length":0,"stats":{"Line":0}},{"line":100,"address":[],"length":0,"stats":{"Line":0}},{"line":101,"address":[],"length":0,"stats":{"Line":0}},{"line":104,"address":[],"length":0,"stats":{"Line":0}},{"line":105,"address":[],"length":0,"stats":{"Line":0}},{"line":107,"address":[],"length":0,"stats":{"Line":0}},{"line":108,"address":[],"length":0,"stats":{"Line":0}},{"line":111,"address":[],"length":0,"stats":{"Line":0}},{"line":112,"address":[],"length":0,"stats":{"Line":0}},{"line":115,"address":[],"length":0,"stats":{"Line":0}},{"line":118,"address":[],"length":0,"stats":{"Line":0}},{"line":119,"address":[],"length":0,"stats":{"Line":0}},{"line":121,"address":[],"length":0,"stats":{"Line":0}},{"line":122,"address":[],"length":0,"stats":{"Line":0}},{"line":124,"address":[],"length":0,"stats":{"Line":0}},{"line":125,"address":[],"length":0,"stats":{"Line":0}},{"line":129,"address":[],"length":0,"stats":{"Line":0}},{"line":131,"address":[],"length":0,"stats":{"Line":0}},{"line":132,"address":[],"length":0,"stats":{"Line":0}},{"line":133,"address":[],"length":0,"stats":{"Line":0}},{"line":136,"address":[],"length":0,"stats":{"Line":0}},{"line":137,"address":[],"length":0,"stats":{"Line":0}},{"line":140,"address":[],"length":0,"stats":{"Line":0}},{"line":141,"address":[],"length":0,"stats":{"Line":0}},{"line":142,"address":[],"length":0,"stats":{"Line":0}},{"line":143,"address":[],"length":0,"stats":{"Line":0}},{"line":144,"address":[],"length":0,"stats":{"Line":0}},{"line":147,"address":[],"length":0,"stats":{"Line":0}},{"line":148,"address":[],"length":0,"stats":{"Line":0}},{"line":151,"address":[],"length":0,"stats":{"Line":0}},{"line":155,"address":[],"length":0,"stats":{"Line":0}},{"line":158,"address":[],"length":0,"stats":{"Line":0}},{"line":159,"address":[],"length":0,"stats":{"Line":0}},{"line":160,"address":[],"length":0,"stats":{"Line":0}},{"line":162,"address":[],"length":0,"stats":{"Line":0}},{"line":163,"address":[],"length":0,"stats":{"Line":0}},{"line":165,"address":[],"length":0,"stats":{"Line":0}},{"line":167,"address":[],"length":0,"stats":{"Line":0}},{"line":169,"address":[],"length":0,"stats":{"Line":0}},{"line":171,"address":[],"length":0,"stats":{"Line":0}},{"line":173,"address":[],"length":0,"stats":{"Line":0}},{"line":174,"address":[],"length":0,"stats":{"Line":0}},{"line":178,"address":[],"length":0,"stats":{"Line":0}},{"line":179,"address":[],"length":0,"stats":{"Line":0}},{"line":183,"address":[],"length":0,"stats":{"Line":0}},{"line":187,"address":[],"length":0,"stats":{"Line":0}},{"line":190,"address":[],"length":0,"stats":{"Line":0}},{"line":191,"address":[],"length":0,"stats":{"Line":0}},{"line":192,"address":[],"length":0,"stats":{"Line":0}},{"line":193,"address":[],"length":0,"stats":{"Line":0}},{"line":196,"address":[],"length":0,"stats":{"Line":0}},{"line":199,"address":[],"length":0,"stats":{"Line":0}},{"line":200,"address":[],"length":0,"stats":{"Line":0}},{"line":201,"address":[],"length":0,"stats":{"Line":0}},{"line":202,"address":[],"length":0,"stats":{"Line":0}},{"line":203,"address":[],"length":0,"stats":{"Line":0}},{"line":206,"address":[],"length":0,"stats":{"Line":0}},{"line":207,"address":[],"length":0,"stats":{"Line":0}},{"line":208,"address":[],"length":0,"stats":{"Line":0}},{"line":209,"address":[],"length":0,"stats":{"Line":0}},{"line":210,"address":[],"length":0,"stats":{"Line":0}},{"line":211,"address":[],"length":0,"stats":{"Line":0}},{"line":215,"address":[],"length":0,"stats":{"Line":0}},{"line":216,"address":[],"length":0,"stats":{"Line":0}},{"line":217,"address":[],"length":0,"stats":{"Line":0}},{"line":218,"address":[],"length":0,"stats":{"Line":0}},{"line":221,"address":[],"length":0,"stats":{"Line":0}},{"line":222,"address":[],"length":0,"stats":{"Line":0}},{"line":223,"address":[],"length":0,"stats":{"Line":0}},{"line":224,"address":[],"length":0,"stats":{"Line":0}},{"line":227,"address":[],"length":0,"stats":{"Line":0}},{"line":228,"address":[],"length":0,"stats":{"Line":0}},{"line":229,"address":[],"length":0,"stats":{"Line":0}},{"line":230,"address":[],"length":0,"stats":{"Line":0}},{"line":231,"address":[],"length":0,"stats":{"Line":0}},{"line":233,"address":[],"length":0,"stats":{"Line":0}},{"line":237,"address":[],"length":0,"stats":{"Line":0}},{"line":238,"address":[],"length":0,"stats":{"Line":0}},{"line":239,"address":[],"length":0,"stats":{"Line":0}},{"line":240,"address":[],"length":0,"stats":{"Line":0}},{"line":241,"address":[],"length":0,"stats":{"Line":0}},{"line":242,"address":[],"length":0,"stats":{"Line":0}},{"line":243,"address":[],"length":0,"stats":{"Line":0}},{"line":248,"address":[],"length":0,"stats":{"Line":0}},{"line":249,"address":[],"length":0,"stats":{"Line":0}},{"line":250,"address":[],"length":0,"stats":{"Line":0}},{"line":251,"address":[],"length":0,"stats":{"Line":0}},{"line":252,"address":[],"length":0,"stats":{"Line":0}},{"line":253,"address":[],"length":0,"stats":{"Line":0}},{"line":254,"address":[],"length":0,"stats":{"Line":0}},{"line":259,"address":[],"length":0,"stats":{"Line":0}},{"line":260,"address":[],"length":0,"stats":{"Line":0}},{"line":261,"address":[],"length":0,"stats":{"Line":0}},{"line":262,"address":[],"length":0,"stats":{"Line":0}},{"line":263,"address":[],"length":0,"stats":{"Line":0}},{"line":265,"address":[],"length":0,"stats":{"Line":0}},{"line":266,"address":[],"length":0,"stats":{"Line":0}},{"line":267,"address":[],"length":0,"stats":{"Line":0}},{"line":268,"address":[],"length":0,"stats":{"Line":0}},{"line":269,"address":[],"length":0,"stats":{"Line":0}},{"line":270,"address":[],"length":0,"stats":{"Line":0}},{"line":275,"address":[],"length":0,"stats":{"Line":0}},{"line":279,"address":[],"length":0,"stats":{"Line":0}},{"line":280,"address":[],"length":0,"stats":{"Line":0}},{"line":281,"address":[],"length":0,"stats":{"Line":0}},{"line":282,"address":[],"length":0,"stats":{"Line":0}},{"line":283,"address":[],"length":0,"stats":{"Line":0}},{"line":286,"address":[],"length":0,"stats":{"Line":0}},{"line":287,"address":[],"length":0,"stats":{"Line":0}},{"line":288,"address":[],"length":0,"stats":{"Line":0}},{"line":289,"address":[],"length":0,"stats":{"Line":0}},{"line":290,"address":[],"length":0,"stats":{"Line":0}},{"line":293,"address":[],"length":0,"stats":{"Line":0}},{"line":294,"address":[],"length":0,"stats":{"Line":0}},{"line":297,"address":[],"length":0,"stats":{"Line":0}},{"line":298,"address":[],"length":0,"stats":{"Line":0}},{"line":302,"address":[],"length":0,"stats":{"Line":0}},{"line":305,"address":[],"length":0,"stats":{"Line":0}},{"line":306,"address":[],"length":0,"stats":{"Line":0}},{"line":308,"address":[],"length":0,"stats":{"Line":0}},{"line":309,"address":[],"length":0,"stats":{"Line":0}},{"line":312,"address":[],"length":0,"stats":{"Line":0}},{"line":313,"address":[],"length":0,"stats":{"Line":0}},{"line":314,"address":[],"length":0,"stats":{"Line":0}},{"line":315,"address":[],"length":0,"stats":{"Line":0}},{"line":316,"address":[],"length":0,"stats":{"Line":0}},{"line":317,"address":[],"length":0,"stats":{"Line":0}},{"line":318,"address":[],"length":0,"stats":{"Line":0}},{"line":320,"address":[],"length":0,"stats":{"Line":0}},{"line":321,"address":[],"length":0,"stats":{"Line":0}},{"line":325,"address":[],"length":0,"stats":{"Line":0}},{"line":328,"address":[],"length":0,"stats":{"Line":0}},{"line":329,"address":[],"length":0,"stats":{"Line":0}},{"line":332,"address":[],"length":0,"stats":{"Line":0}},{"line":333,"address":[],"length":0,"stats":{"Line":0}},{"line":336,"address":[],"length":0,"stats":{"Line":0}},{"line":337,"address":[],"length":0,"stats":{"Line":0}},{"line":338,"address":[],"length":0,"stats":{"Line":0}},{"line":341,"address":[],"length":0,"stats":{"Line":0}},{"line":342,"address":[],"length":0,"stats":{"Line":0}},{"line":343,"address":[],"length":0,"stats":{"Line":0}},{"line":344,"address":[],"length":0,"stats":{"Line":0}},{"line":345,"address":[],"length":0,"stats":{"Line":0}},{"line":346,"address":[],"length":0,"stats":{"Line":0}},{"line":347,"address":[],"length":0,"stats":{"Line":0}},{"line":349,"address":[],"length":0,"stats":{"Line":0}},{"line":352,"address":[],"length":0,"stats":{"Line":0}},{"line":353,"address":[],"length":0,"stats":{"Line":0}},{"line":356,"address":[],"length":0,"stats":{"Line":0}},{"line":359,"address":[],"length":0,"stats":{"Line":0}},{"line":360,"address":[],"length":0,"stats":{"Line":0}},{"line":361,"address":[],"length":0,"stats":{"Line":0}},{"line":362,"address":[],"length":0,"stats":{"Line":0}},{"line":363,"address":[],"length":0,"stats":{"Line":0}},{"line":365,"address":[],"length":0,"stats":{"Line":0}},{"line":366,"address":[],"length":0,"stats":{"Line":0}},{"line":369,"address":[],"length":0,"stats":{"Line":0}},{"line":370,"address":[],"length":0,"stats":{"Line":0}},{"line":371,"address":[],"length":0,"stats":{"Line":0}},{"line":372,"address":[],"length":0,"stats":{"Line":0}},{"line":373,"address":[],"length":0,"stats":{"Line":0}},{"line":375,"address":[],"length":0,"stats":{"Line":0}},{"line":376,"address":[],"length":0,"stats":{"Line":0}},{"line":377,"address":[],"length":0,"stats":{"Line":0}},{"line":379,"address":[],"length":0,"stats":{"Line":0}},{"line":383,"address":[],"length":0,"stats":{"Line":0}},{"line":384,"address":[],"length":0,"stats":{"Line":0}},{"line":385,"address":[],"length":0,"stats":{"Line":0}},{"line":386,"address":[],"length":0,"stats":{"Line":0}},{"line":390,"address":[],"length":0,"stats":{"Line":0}},{"line":392,"address":[],"length":0,"stats":{"Line":0}},{"line":393,"address":[],"length":0,"stats":{"Line":0}},{"line":395,"address":[],"length":0,"stats":{"Line":0}},{"line":396,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":218},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","ui","src","export","image_utils.rs"],"content":"//! Image loading and rendering utilities for export\n\nuse cairo::Context;\nuse std::path::Path;\nuse testruct_core::layout::Rect;\nuse testruct_core::workspace::assets::{AssetRef, AssetCatalog};\n\n/// Render an image from AssetCatalog to a Cairo context\n///\n/// Resolves the asset reference to a file path and renders the image\npub fn render_image_from_asset(\n    ctx: \u0026Context,\n    asset_ref: AssetRef,\n    catalog: \u0026AssetCatalog,\n    bounds: \u0026Rect,\n) -\u003e Result\u003c(), Box\u003cdyn std::error::Error\u003e\u003e {\n    // Get image metadata from catalog\n    if let Some(metadata) = catalog.get(asset_ref) {\n        render_image_to_context(ctx, \u0026metadata.path, bounds)\n    } else {\n        // Asset not found in catalog - draw placeholder\n        draw_image_placeholder(ctx, bounds).map_err(|e| Box::new(e) as Box\u003cdyn std::error::Error\u003e)\n    }\n}\n\n/// Load an image file and render it to a Cairo context\n///\n/// Supports: JPEG, PNG, GIF, WebP\npub fn render_image_to_context(\n    ctx: \u0026Context,\n    image_path: \u0026Path,\n    bounds: \u0026Rect,\n) -\u003e Result\u003c(), Box\u003cdyn std::error::Error\u003e\u003e {\n    // Load the image file\n    let img = image::open(image_path)?;\n\n    // Resize image to match bounds while maintaining aspect ratio\n    let width = bounds.size.width as u32;\n    let height = bounds.size.height as u32;\n\n    let resized = if width \u003e 0 \u0026\u0026 height \u003e 0 {\n        img.resize_to_fill(width, height, image::imageops::FilterType::Lanczos3)\n    } else {\n        img\n    };\n\n    // Convert to RGBA8 for Cairo compatibility\n    let rgba = resized.to_rgba8();\n\n    // Create Cairo image surface from pixel data\n    // For ARGB32 format, stride is 4 bytes per pixel, rounded to 4-byte alignment\n    let stride = (width as i32 * 4 + 3) \u0026 !3; // Align to 4 bytes\n    let mut data = vec![0u8; (stride * height as i32) as usize];\n\n    // Convert RGBA to BGRA (Cairo uses BGRA format)\n    for y in 0..height {\n        for x in 0..width {\n            let pixel = rgba.get_pixel(x, y);\n            let dst_idx = ((y as i32) * stride + (x as i32) * 4) as usize;\n\n            let r = pixel[0];\n            let g = pixel[1];\n            let b = pixel[2];\n            let a = pixel[3];\n\n            // Cairo uses BGRA in little-endian\n            data[dst_idx] = b;\n            data[dst_idx + 1] = g;\n            data[dst_idx + 2] = r;\n            data[dst_idx + 3] = a;\n        }\n    }\n\n    // Create Cairo surface from the converted data\n    let surface = cairo::ImageSurface::create_for_data(\n        data,\n        cairo::Format::ARgb32,\n        width as i32,\n        height as i32,\n        stride,\n    )?;\n\n    // Render the image surface to the context\n    ctx.save()?;\n    ctx.translate(bounds.origin.x as f64, bounds.origin.y as f64);\n    ctx.scale(\n        bounds.size.width as f64 / width as f64,\n        bounds.size.height as f64 / height as f64,\n    );\n\n    ctx.set_source_surface(\u0026surface, 0.0, 0.0)?;\n    ctx.paint()?;\n    ctx.restore()?;\n\n    tracing::info!(\n        \" Image rendered: {} ({}x{})\",\n        image_path.display(),\n        width,\n        height\n    );\n\n    Ok(())\n}\n\n/// Check if an image file exists and is readable\npub fn is_image_available(image_path: \u0026Path) -\u003e bool {\n    if !image_path.exists() {\n        tracing::warn!(\"  Image file not found: {}\", image_path.display());\n        return false;\n    }\n\n    if !image_path.is_file() {\n        tracing::warn!(\"  Image path is not a file: {}\", image_path.display());\n        return false;\n    }\n\n    true\n}\n\n/// Draw a placeholder when image is not available\npub fn draw_image_placeholder(\n    ctx: \u0026Context,\n    bounds: \u0026Rect,\n) -\u003e Result\u003c(), cairo::Error\u003e {\n    ctx.save()?;\n\n    // Draw gray background\n    ctx.set_source_rgb(0.9, 0.9, 0.9);\n    ctx.rectangle(\n        bounds.origin.x as f64,\n        bounds.origin.y as f64,\n        bounds.size.width as f64,\n        bounds.size.height as f64,\n    );\n    ctx.fill()?;\n\n    // Draw border\n    ctx.set_source_rgb(0.7, 0.7, 0.7);\n    ctx.set_line_width(1.0);\n    ctx.rectangle(\n        bounds.origin.x as f64,\n        bounds.origin.y as f64,\n        bounds.size.width as f64,\n        bounds.size.height as f64,\n    );\n    ctx.stroke()?;\n\n    // Draw X symbol to indicate missing image\n    ctx.set_source_rgb(0.5, 0.5, 0.5);\n    ctx.set_line_width(2.0);\n\n    let x1 = bounds.origin.x as f64;\n    let y1 = bounds.origin.y as f64;\n    let x2 = bounds.origin.x as f64 + bounds.size.width as f64;\n    let y2 = bounds.origin.y as f64 + bounds.size.height as f64;\n\n    // Draw X\n    ctx.move_to(x1 + 5.0, y1 + 5.0);\n    ctx.line_to(x2 - 5.0, y2 - 5.0);\n    ctx.stroke()?;\n\n    ctx.move_to(x2 - 5.0, y1 + 5.0);\n    ctx.line_to(x1 + 5.0, y2 - 5.0);\n    ctx.stroke()?;\n\n    ctx.restore()?;\n    Ok(())\n}\n","traces":[{"line":11,"address":[],"length":0,"stats":{"Line":0}},{"line":18,"address":[],"length":0,"stats":{"Line":0}},{"line":19,"address":[],"length":0,"stats":{"Line":0}},{"line":22,"address":[],"length":0,"stats":{"Line":0}},{"line":29,"address":[],"length":0,"stats":{"Line":0}},{"line":35,"address":[],"length":0,"stats":{"Line":0}},{"line":38,"address":[],"length":0,"stats":{"Line":0}},{"line":39,"address":[],"length":0,"stats":{"Line":0}},{"line":41,"address":[],"length":0,"stats":{"Line":0}},{"line":42,"address":[],"length":0,"stats":{"Line":0}},{"line":44,"address":[],"length":0,"stats":{"Line":0}},{"line":48,"address":[],"length":0,"stats":{"Line":0}},{"line":52,"address":[],"length":0,"stats":{"Line":0}},{"line":53,"address":[],"length":0,"stats":{"Line":0}},{"line":56,"address":[],"length":0,"stats":{"Line":0}},{"line":57,"address":[],"length":0,"stats":{"Line":0}},{"line":58,"address":[],"length":0,"stats":{"Line":0}},{"line":59,"address":[],"length":0,"stats":{"Line":0}},{"line":61,"address":[],"length":0,"stats":{"Line":0}},{"line":62,"address":[],"length":0,"stats":{"Line":0}},{"line":63,"address":[],"length":0,"stats":{"Line":0}},{"line":64,"address":[],"length":0,"stats":{"Line":0}},{"line":67,"address":[],"length":0,"stats":{"Line":0}},{"line":68,"address":[],"length":0,"stats":{"Line":0}},{"line":69,"address":[],"length":0,"stats":{"Line":0}},{"line":70,"address":[],"length":0,"stats":{"Line":0}},{"line":76,"address":[],"length":0,"stats":{"Line":0}},{"line":77,"address":[],"length":0,"stats":{"Line":0}},{"line":78,"address":[],"length":0,"stats":{"Line":0}},{"line":79,"address":[],"length":0,"stats":{"Line":0}},{"line":80,"address":[],"length":0,"stats":{"Line":0}},{"line":84,"address":[],"length":0,"stats":{"Line":0}},{"line":85,"address":[],"length":0,"stats":{"Line":0}},{"line":86,"address":[],"length":0,"stats":{"Line":0}},{"line":87,"address":[],"length":0,"stats":{"Line":0}},{"line":88,"address":[],"length":0,"stats":{"Line":0}},{"line":91,"address":[],"length":0,"stats":{"Line":0}},{"line":92,"address":[],"length":0,"stats":{"Line":0}},{"line":93,"address":[],"length":0,"stats":{"Line":0}},{"line":95,"address":[],"length":0,"stats":{"Line":0}},{"line":96,"address":[],"length":0,"stats":{"Line":0}},{"line":97,"address":[],"length":0,"stats":{"Line":0}},{"line":102,"address":[],"length":0,"stats":{"Line":0}},{"line":106,"address":[],"length":0,"stats":{"Line":0}},{"line":107,"address":[],"length":0,"stats":{"Line":0}},{"line":108,"address":[],"length":0,"stats":{"Line":0}},{"line":109,"address":[],"length":0,"stats":{"Line":0}},{"line":112,"address":[],"length":0,"stats":{"Line":0}},{"line":113,"address":[],"length":0,"stats":{"Line":0}},{"line":114,"address":[],"length":0,"stats":{"Line":0}},{"line":117,"address":[],"length":0,"stats":{"Line":0}},{"line":121,"address":[],"length":0,"stats":{"Line":0}},{"line":125,"address":[],"length":0,"stats":{"Line":0}},{"line":128,"address":[],"length":0,"stats":{"Line":0}},{"line":129,"address":[],"length":0,"stats":{"Line":0}},{"line":130,"address":[],"length":0,"stats":{"Line":0}},{"line":131,"address":[],"length":0,"stats":{"Line":0}},{"line":132,"address":[],"length":0,"stats":{"Line":0}},{"line":133,"address":[],"length":0,"stats":{"Line":0}},{"line":135,"address":[],"length":0,"stats":{"Line":0}},{"line":138,"address":[],"length":0,"stats":{"Line":0}},{"line":139,"address":[],"length":0,"stats":{"Line":0}},{"line":140,"address":[],"length":0,"stats":{"Line":0}},{"line":141,"address":[],"length":0,"stats":{"Line":0}},{"line":142,"address":[],"length":0,"stats":{"Line":0}},{"line":143,"address":[],"length":0,"stats":{"Line":0}},{"line":144,"address":[],"length":0,"stats":{"Line":0}},{"line":146,"address":[],"length":0,"stats":{"Line":0}},{"line":149,"address":[],"length":0,"stats":{"Line":0}},{"line":150,"address":[],"length":0,"stats":{"Line":0}},{"line":152,"address":[],"length":0,"stats":{"Line":0}},{"line":153,"address":[],"length":0,"stats":{"Line":0}},{"line":154,"address":[],"length":0,"stats":{"Line":0}},{"line":155,"address":[],"length":0,"stats":{"Line":0}},{"line":158,"address":[],"length":0,"stats":{"Line":0}},{"line":159,"address":[],"length":0,"stats":{"Line":0}},{"line":160,"address":[],"length":0,"stats":{"Line":0}},{"line":162,"address":[],"length":0,"stats":{"Line":0}},{"line":163,"address":[],"length":0,"stats":{"Line":0}},{"line":164,"address":[],"length":0,"stats":{"Line":0}},{"line":166,"address":[],"length":0,"stats":{"Line":0}},{"line":167,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":82},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","ui","src","export","mod.rs"],"content":"//! Document export functionality\n//!\n//! Provides PDF, PNG, SVG, and other format export capabilities using Cairo rendering.\n\npub mod pdf;\npub mod image;\npub mod svg;\npub mod image_utils;\n\nuse std::path::Path;\nuse anyhow::Result;\nuse testruct_core::Document;\nuse testruct_core::workspace::assets::AssetCatalog;\n\n/// Export a document to PDF format\npub fn export_pdf(document: \u0026Document, output_path: \u0026Path, catalog: \u0026AssetCatalog) -\u003e Result\u003c()\u003e {\n    pdf::render_to_pdf(document, output_path, catalog)\n}\n\n/// Export a document to PNG format\npub fn export_png(document: \u0026Document, output_path: \u0026Path, dpi: f64, catalog: \u0026AssetCatalog) -\u003e Result\u003c()\u003e {\n    image::render_to_png(document, output_path, dpi, catalog)\n}\n\n/// Export a document to JPEG format\npub fn export_jpeg(document: \u0026Document, output_path: \u0026Path, dpi: f64, quality: i32, catalog: \u0026AssetCatalog) -\u003e Result\u003c()\u003e {\n    image::render_to_jpeg(document, output_path, dpi, quality, catalog)\n}\n\n/// Export a document to SVG format\npub fn export_svg(document: \u0026Document, output_path: \u0026Path, catalog: \u0026AssetCatalog) -\u003e Result\u003c()\u003e {\n    svg::render_to_svg(document, output_path, catalog)\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n\n    #[test]\n    fn test_module_loads() {\n        // Basic module loading test\n        assert!(true);\n    }\n}\n","traces":[{"line":16,"address":[],"length":0,"stats":{"Line":0}},{"line":17,"address":[],"length":0,"stats":{"Line":0}},{"line":21,"address":[],"length":0,"stats":{"Line":0}},{"line":22,"address":[],"length":0,"stats":{"Line":0}},{"line":26,"address":[],"length":0,"stats":{"Line":0}},{"line":27,"address":[],"length":0,"stats":{"Line":0}},{"line":31,"address":[],"length":0,"stats":{"Line":0}},{"line":32,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":8},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","ui","src","export","pdf.rs"],"content":"//! PDF export functionality using Cairo\n//!\n//! Renders a document to PDF format with support for multi-page output.\n\nuse anyhow::{anyhow, Result};\nuse cairo::{Context, PdfSurface};\nuse std::path::Path;\nuse testruct_core::Document;\nuse testruct_core::workspace::assets::AssetCatalog;\nuse tracing::{debug, info};\n\n/// Default page size (A4: 595.28 x 841.89 points)\nconst DEFAULT_PAGE_WIDTH: f64 = 595.28;\nconst DEFAULT_PAGE_HEIGHT: f64 = 841.89;\n\n/// Render a document to PDF\npub fn render_to_pdf(document: \u0026Document, output_path: \u0026Path, catalog: \u0026AssetCatalog) -\u003e Result\u003c()\u003e {\n    info!(\"Exporting to PDF: {}\", output_path.display());\n\n    if document.pages.is_empty() {\n        return Err(anyhow!(\"Document has no pages to export\"));\n    }\n\n    // Use default page dimensions (A4) for now\n    let width = DEFAULT_PAGE_WIDTH;\n    let height = DEFAULT_PAGE_HEIGHT;\n\n    debug!(\"PDF page size: {} x {}\", width, height);\n\n    // Create PDF surface\n    let surface = PdfSurface::new(width, height, output_path)\n        .map_err(|e| anyhow!(\"Failed to create PDF surface: {}\", e))?;\n\n    let ctx = Context::new(\u0026surface)\n        .map_err(|e| anyhow!(\"Failed to create Cairo context: {}\", e))?;\n\n    // Render each page\n    for (page_index, page) in document.pages.iter().enumerate() {\n        debug!(\"Rendering page {}\", page_index + 1);\n        render_page_to_context(\u0026ctx, page, catalog)?;\n\n        // Move to next page (except for last page)\n        if page_index \u003c document.pages.len() - 1 {\n            ctx.show_page()\n                .map_err(|e| anyhow!(\"Failed to show page: {}\", e))?;\n        }\n    }\n\n    // Finish PDF\n    surface.finish();\n    info!(\"PDF export completed: {}\", output_path.display());\n\n    Ok(())\n}\n\n/// Render a single page to Cairo context\nfn render_page_to_context(ctx: \u0026Context, page: \u0026testruct_core::document::Page, catalog: \u0026AssetCatalog) -\u003e Result\u003c()\u003e {\n    // Set white background\n    ctx.set_source_rgb(1.0, 1.0, 1.0);\n    ctx.paint()\n        .map_err(|e| anyhow!(\"Failed to paint background: {}\", e))?;\n\n    // Use default page size\n    let width = DEFAULT_PAGE_WIDTH;\n    let height = DEFAULT_PAGE_HEIGHT;\n\n    // Draw page border for visual reference\n    ctx.set_source_rgb(0.0, 0.0, 0.0);\n    ctx.set_line_width(0.5);\n    ctx.rectangle(0.0, 0.0, width, height);\n    ctx.stroke()\n        .map_err(|e| anyhow!(\"Failed to draw page border: {}\", e))?;\n\n    // Render all elements\n    for element in \u0026page.elements {\n        render_element_to_context(ctx, element, catalog)?;\n    }\n\n    Ok(())\n}\n\n/// Render a single element to Cairo context\nfn render_element_to_context(ctx: \u0026Context, element: \u0026testruct_core::document::DocumentElement, catalog: \u0026AssetCatalog) -\u003e Result\u003c()\u003e {\n    use testruct_core::document::DocumentElement;\n\n    match element {\n        DocumentElement::Shape(shape) =\u003e {\n            render_shape_to_context(ctx, shape)?;\n        }\n        DocumentElement::Text(text) =\u003e {\n            render_text_to_context(ctx, text)?;\n        }\n        DocumentElement::Image(image) =\u003e {\n            // Try to load image from catalog, fallback to placeholder if not found\n            match crate::export::image_utils::render_image_from_asset(ctx, image.source, catalog, \u0026image.bounds) {\n                Ok(_) =\u003e {\n                    debug!(\"Image rendered from asset catalog: {}\", image.id);\n                }\n                Err(e) =\u003e {\n                    // If loading fails, draw placeholder and log warning\n                    debug!(\"Failed to render image {}: {}, using placeholder\", image.id, e);\n                    let _ = crate::export::image_utils::draw_image_placeholder(ctx, \u0026image.bounds);\n                }\n            }\n        }\n        DocumentElement::Frame(frame) =\u003e {\n            render_frame_to_context(ctx, frame, catalog)?;\n        }\n    }\n\n    Ok(())\n}\n\n/// Render a shape element\nfn render_shape_to_context(ctx: \u0026Context, shape: \u0026testruct_core::document::ShapeElement) -\u003e Result\u003c()\u003e {\n    use testruct_core::document::ShapeKind;\n\n    let x = shape.bounds.origin.x as f64;\n    let y = shape.bounds.origin.y as f64;\n    let width = shape.bounds.size.width as f64;\n    let height = shape.bounds.size.height as f64;\n\n    // Render based on shape kind\n    match shape.kind {\n        ShapeKind::Rectangle =\u003e {\n            // Draw fill color if present\n            if let Some(fill) = \u0026shape.fill {\n                ctx.set_source_rgb(fill.r as f64, fill.g as f64, fill.b as f64);\n                ctx.rectangle(x, y, width, height);\n                ctx.fill()\n                    .map_err(|e| anyhow!(\"Failed to fill rectangle: {}\", e))?;\n            }\n            // Draw stroke if present\n            if let Some(stroke) = \u0026shape.stroke {\n                ctx.set_source_rgb(stroke.r as f64, stroke.g as f64, stroke.b as f64);\n                ctx.set_line_width(1.0);\n                ctx.rectangle(x, y, width, height);\n                ctx.stroke()\n                    .map_err(|e| anyhow!(\"Failed to stroke rectangle: {}\", e))?;\n            }\n        }\n        ShapeKind::Ellipse =\u003e {\n            ctx.save().map_err(|e| anyhow!(\"Failed to save context: {}\", e))?;\n            ctx.translate(x + width / 2.0, y + height / 2.0);\n            ctx.scale(width / 2.0, height / 2.0);\n            ctx.arc(0.0, 0.0, 1.0, 0.0, std::f64::consts::PI * 2.0);\n\n            // Draw fill if present\n            if let Some(fill) = \u0026shape.fill {\n                ctx.set_source_rgb(fill.r as f64, fill.g as f64, fill.b as f64);\n                ctx.fill_preserve()\n                    .map_err(|e| anyhow!(\"Failed to fill ellipse: {}\", e))?;\n            }\n            // Draw stroke if present\n            if let Some(stroke) = \u0026shape.stroke {\n                ctx.set_source_rgb(stroke.r as f64, stroke.g as f64, stroke.b as f64);\n                ctx.set_line_width(1.0);\n                ctx.stroke()\n                    .map_err(|e| anyhow!(\"Failed to stroke ellipse: {}\", e))?;\n            }\n            ctx.restore().map_err(|e| anyhow!(\"Failed to restore context: {}\", e))?;\n        }\n        ShapeKind::Line =\u003e {\n            // Lines use stroke color\n            if let Some(stroke) = \u0026shape.stroke {\n                ctx.set_source_rgb(stroke.r as f64, stroke.g as f64, stroke.b as f64);\n                ctx.set_line_width(1.0);\n                ctx.move_to(x, y);\n                ctx.line_to(x + width, y + height);\n                ctx.stroke()\n                    .map_err(|e| anyhow!(\"Failed to stroke line: {}\", e))?;\n            }\n        }\n        ShapeKind::Arrow =\u003e {\n            // Arrows use stroke color for the line\n            if let Some(stroke) = \u0026shape.stroke {\n                ctx.set_source_rgb(stroke.r as f64, stroke.g as f64, stroke.b as f64);\n                ctx.set_line_width(1.0);\n                ctx.move_to(x, y);\n                ctx.line_to(x + width, y + height);\n                ctx.stroke()\n                    .map_err(|e| anyhow!(\"Failed to stroke arrow: {}\", e))?;\n            }\n        }\n        ShapeKind::Polygon =\u003e {\n            // Placeholder for polygon (same as rectangle)\n            if let Some(fill) = \u0026shape.fill {\n                ctx.set_source_rgb(fill.r as f64, fill.g as f64, fill.b as f64);\n                ctx.rectangle(x, y, width, height);\n                ctx.fill()\n                    .map_err(|e| anyhow!(\"Failed to fill polygon: {}\", e))?;\n            }\n            if let Some(stroke) = \u0026shape.stroke {\n                ctx.set_source_rgb(stroke.r as f64, stroke.g as f64, stroke.b as f64);\n                ctx.set_line_width(1.0);\n                ctx.rectangle(x, y, width, height);\n                ctx.stroke()\n                    .map_err(|e| anyhow!(\"Failed to stroke polygon: {}\", e))?;\n            }\n        }\n    }\n\n    Ok(())\n}\n\n/// Render a frame element (with recursive children)\nfn render_frame_to_context(ctx: \u0026Context, frame: \u0026testruct_core::document::FrameElement, catalog: \u0026AssetCatalog) -\u003e Result\u003c()\u003e {\n    let x = frame.bounds.origin.x as f64;\n    let y = frame.bounds.origin.y as f64;\n    let width = frame.bounds.size.width as f64;\n    let height = frame.bounds.size.height as f64;\n\n    // Draw frame border\n    ctx.set_source_rgb(0.9, 0.9, 0.9);\n    ctx.set_line_width(1.0);\n    ctx.rectangle(x, y, width, height);\n    ctx.stroke()\n        .map_err(|e| anyhow!(\"Failed to stroke frame: {}\", e))?;\n\n    // Render frame children recursively\n    for child in \u0026frame.children {\n        render_element_to_context(ctx, child, catalog)?;\n    }\n\n    debug!(\"Frame rendered with {} children\", frame.children.len());\n    Ok(())\n}\n\n/// Render a text element with Pango layout\nfn render_text_to_context(ctx: \u0026Context, text: \u0026testruct_core::document::TextElement) -\u003e Result\u003c()\u003e {\n    use pango::prelude::*;\n\n    ctx.save()\n        .map_err(|e| anyhow!(\"Failed to save context: {}\", e))?;\n\n    let bounds = \u0026text.bounds;\n    let style = \u0026text.style;\n\n    // Draw background color if specified\n    if let Some(bg_color) = style.background_color {\n        ctx.set_source_rgb(bg_color.r as f64, bg_color.g as f64, bg_color.b as f64);\n        ctx.rectangle(\n            bounds.origin.x as f64,\n            bounds.origin.y as f64,\n            bounds.size.width as f64,\n            bounds.size.height as f64,\n        );\n        ctx.fill()\n            .map_err(|e| anyhow!(\"Failed to fill text background: {}\", e))?;\n    }\n\n    // Translate to text origin\n    ctx.translate(bounds.origin.x as f64, bounds.origin.y as f64);\n\n    // Create clipping rectangle\n    ctx.rectangle(0.0, 0.0, bounds.size.width as f64, bounds.size.height as f64);\n    ctx.clip();\n\n    // Create Pango layout\n    let layout = pangocairo::functions::create_layout(ctx);\n    layout.set_text(\u0026text.content);\n\n    // Set font with styling\n    let mut font_desc = pango::FontDescription::new();\n    font_desc.set_family(\u0026style.font_family);\n    font_desc.set_size((style.font_size * pango::SCALE as f32) as i32);\n\n    // Apply font weight\n    let pango_weight = match style.weight {\n        testruct_core::typography::FontWeight::Thin =\u003e pango::Weight::Thin,\n        testruct_core::typography::FontWeight::Light =\u003e pango::Weight::Light,\n        testruct_core::typography::FontWeight::Regular =\u003e pango::Weight::Normal,\n        testruct_core::typography::FontWeight::Medium =\u003e pango::Weight::Medium,\n        testruct_core::typography::FontWeight::Bold =\u003e pango::Weight::Bold,\n        testruct_core::typography::FontWeight::Black =\u003e pango::Weight::Ultrabold,\n    };\n    font_desc.set_weight(pango_weight);\n\n    // Apply italic style\n    if style.italic {\n        font_desc.set_style(pango::Style::Italic);\n    }\n\n    layout.set_font_description(Some(\u0026font_desc));\n\n    // Apply text alignment\n    let pango_alignment = match style.alignment {\n        testruct_core::typography::TextAlignment::Start =\u003e pango::Alignment::Left,\n        testruct_core::typography::TextAlignment::Center =\u003e pango::Alignment::Center,\n        testruct_core::typography::TextAlignment::End =\u003e pango::Alignment::Right,\n        testruct_core::typography::TextAlignment::Justified =\u003e pango::Alignment::Center,\n    };\n    layout.set_alignment(pango_alignment);\n    layout.set_width((bounds.size.width as f64 * pango::SCALE as f64) as i32);\n\n    // Apply underline and strikethrough decorations\n    if style.underline || style.strikethrough {\n        let mut attrs = pango::AttrList::new();\n        if style.underline {\n            let underline_attr = pango::AttrInt::new_underline(pango::Underline::Single);\n            attrs.insert(underline_attr);\n        }\n        if style.strikethrough {\n            let strikethrough_attr = pango::AttrInt::new_strikethrough(true);\n            attrs.insert(strikethrough_attr);\n        }\n        layout.set_attributes(Some(\u0026attrs));\n    }\n\n    // Set text color\n    ctx.set_source_rgb(\n        style.color.r as f64,\n        style.color.g as f64,\n        style.color.b as f64,\n    );\n\n    // Render the text using pangocairo\n    pangocairo::functions::show_layout(ctx, \u0026layout);\n\n    ctx.restore()\n        .map_err(|e| anyhow!(\"Failed to restore context: {}\", e))?;\n\n    debug!(\"Text rendered: '{}' in PDF\", text.content);\n    Ok(())\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n\n    #[test]\n    fn test_pdf_export_module_loads() {\n        assert!(true);\n    }\n}\n","traces":[{"line":17,"address":[],"length":0,"stats":{"Line":0}},{"line":18,"address":[],"length":0,"stats":{"Line":0}},{"line":20,"address":[],"length":0,"stats":{"Line":0}},{"line":21,"address":[],"length":0,"stats":{"Line":0}},{"line":25,"address":[],"length":0,"stats":{"Line":0}},{"line":26,"address":[],"length":0,"stats":{"Line":0}},{"line":28,"address":[],"length":0,"stats":{"Line":0}},{"line":31,"address":[],"length":0,"stats":{"Line":0}},{"line":32,"address":[],"length":0,"stats":{"Line":0}},{"line":34,"address":[],"length":0,"stats":{"Line":0}},{"line":35,"address":[],"length":0,"stats":{"Line":0}},{"line":38,"address":[],"length":0,"stats":{"Line":0}},{"line":39,"address":[],"length":0,"stats":{"Line":0}},{"line":40,"address":[],"length":0,"stats":{"Line":0}},{"line":43,"address":[],"length":0,"stats":{"Line":0}},{"line":44,"address":[],"length":0,"stats":{"Line":0}},{"line":45,"address":[],"length":0,"stats":{"Line":0}},{"line":50,"address":[],"length":0,"stats":{"Line":0}},{"line":51,"address":[],"length":0,"stats":{"Line":0}},{"line":53,"address":[],"length":0,"stats":{"Line":0}},{"line":57,"address":[],"length":0,"stats":{"Line":0}},{"line":59,"address":[],"length":0,"stats":{"Line":0}},{"line":60,"address":[],"length":0,"stats":{"Line":0}},{"line":61,"address":[],"length":0,"stats":{"Line":0}},{"line":64,"address":[],"length":0,"stats":{"Line":0}},{"line":65,"address":[],"length":0,"stats":{"Line":0}},{"line":68,"address":[],"length":0,"stats":{"Line":0}},{"line":69,"address":[],"length":0,"stats":{"Line":0}},{"line":70,"address":[],"length":0,"stats":{"Line":0}},{"line":71,"address":[],"length":0,"stats":{"Line":0}},{"line":72,"address":[],"length":0,"stats":{"Line":0}},{"line":75,"address":[],"length":0,"stats":{"Line":0}},{"line":76,"address":[],"length":0,"stats":{"Line":0}},{"line":79,"address":[],"length":0,"stats":{"Line":0}},{"line":83,"address":[],"length":0,"stats":{"Line":0}},{"line":86,"address":[],"length":0,"stats":{"Line":0}},{"line":87,"address":[],"length":0,"stats":{"Line":0}},{"line":88,"address":[],"length":0,"stats":{"Line":0}},{"line":90,"address":[],"length":0,"stats":{"Line":0}},{"line":91,"address":[],"length":0,"stats":{"Line":0}},{"line":93,"address":[],"length":0,"stats":{"Line":0}},{"line":95,"address":[],"length":0,"stats":{"Line":0}},{"line":97,"address":[],"length":0,"stats":{"Line":0}},{"line":99,"address":[],"length":0,"stats":{"Line":0}},{"line":101,"address":[],"length":0,"stats":{"Line":0}},{"line":102,"address":[],"length":0,"stats":{"Line":0}},{"line":106,"address":[],"length":0,"stats":{"Line":0}},{"line":107,"address":[],"length":0,"stats":{"Line":0}},{"line":111,"address":[],"length":0,"stats":{"Line":0}},{"line":115,"address":[],"length":0,"stats":{"Line":0}},{"line":118,"address":[],"length":0,"stats":{"Line":0}},{"line":119,"address":[],"length":0,"stats":{"Line":0}},{"line":120,"address":[],"length":0,"stats":{"Line":0}},{"line":121,"address":[],"length":0,"stats":{"Line":0}},{"line":124,"address":[],"length":0,"stats":{"Line":0}},{"line":127,"address":[],"length":0,"stats":{"Line":0}},{"line":128,"address":[],"length":0,"stats":{"Line":0}},{"line":129,"address":[],"length":0,"stats":{"Line":0}},{"line":130,"address":[],"length":0,"stats":{"Line":0}},{"line":131,"address":[],"length":0,"stats":{"Line":0}},{"line":134,"address":[],"length":0,"stats":{"Line":0}},{"line":135,"address":[],"length":0,"stats":{"Line":0}},{"line":136,"address":[],"length":0,"stats":{"Line":0}},{"line":137,"address":[],"length":0,"stats":{"Line":0}},{"line":138,"address":[],"length":0,"stats":{"Line":0}},{"line":139,"address":[],"length":0,"stats":{"Line":0}},{"line":143,"address":[],"length":0,"stats":{"Line":0}},{"line":144,"address":[],"length":0,"stats":{"Line":0}},{"line":145,"address":[],"length":0,"stats":{"Line":0}},{"line":146,"address":[],"length":0,"stats":{"Line":0}},{"line":149,"address":[],"length":0,"stats":{"Line":0}},{"line":150,"address":[],"length":0,"stats":{"Line":0}},{"line":151,"address":[],"length":0,"stats":{"Line":0}},{"line":152,"address":[],"length":0,"stats":{"Line":0}},{"line":155,"address":[],"length":0,"stats":{"Line":0}},{"line":156,"address":[],"length":0,"stats":{"Line":0}},{"line":157,"address":[],"length":0,"stats":{"Line":0}},{"line":158,"address":[],"length":0,"stats":{"Line":0}},{"line":159,"address":[],"length":0,"stats":{"Line":0}},{"line":161,"address":[],"length":0,"stats":{"Line":0}},{"line":165,"address":[],"length":0,"stats":{"Line":0}},{"line":166,"address":[],"length":0,"stats":{"Line":0}},{"line":167,"address":[],"length":0,"stats":{"Line":0}},{"line":168,"address":[],"length":0,"stats":{"Line":0}},{"line":169,"address":[],"length":0,"stats":{"Line":0}},{"line":170,"address":[],"length":0,"stats":{"Line":0}},{"line":171,"address":[],"length":0,"stats":{"Line":0}},{"line":176,"address":[],"length":0,"stats":{"Line":0}},{"line":177,"address":[],"length":0,"stats":{"Line":0}},{"line":178,"address":[],"length":0,"stats":{"Line":0}},{"line":179,"address":[],"length":0,"stats":{"Line":0}},{"line":180,"address":[],"length":0,"stats":{"Line":0}},{"line":181,"address":[],"length":0,"stats":{"Line":0}},{"line":182,"address":[],"length":0,"stats":{"Line":0}},{"line":187,"address":[],"length":0,"stats":{"Line":0}},{"line":188,"address":[],"length":0,"stats":{"Line":0}},{"line":189,"address":[],"length":0,"stats":{"Line":0}},{"line":190,"address":[],"length":0,"stats":{"Line":0}},{"line":191,"address":[],"length":0,"stats":{"Line":0}},{"line":193,"address":[],"length":0,"stats":{"Line":0}},{"line":194,"address":[],"length":0,"stats":{"Line":0}},{"line":195,"address":[],"length":0,"stats":{"Line":0}},{"line":196,"address":[],"length":0,"stats":{"Line":0}},{"line":197,"address":[],"length":0,"stats":{"Line":0}},{"line":198,"address":[],"length":0,"stats":{"Line":0}},{"line":203,"address":[],"length":0,"stats":{"Line":0}},{"line":207,"address":[],"length":0,"stats":{"Line":0}},{"line":208,"address":[],"length":0,"stats":{"Line":0}},{"line":209,"address":[],"length":0,"stats":{"Line":0}},{"line":210,"address":[],"length":0,"stats":{"Line":0}},{"line":211,"address":[],"length":0,"stats":{"Line":0}},{"line":214,"address":[],"length":0,"stats":{"Line":0}},{"line":215,"address":[],"length":0,"stats":{"Line":0}},{"line":216,"address":[],"length":0,"stats":{"Line":0}},{"line":217,"address":[],"length":0,"stats":{"Line":0}},{"line":218,"address":[],"length":0,"stats":{"Line":0}},{"line":221,"address":[],"length":0,"stats":{"Line":0}},{"line":222,"address":[],"length":0,"stats":{"Line":0}},{"line":225,"address":[],"length":0,"stats":{"Line":0}},{"line":226,"address":[],"length":0,"stats":{"Line":0}},{"line":230,"address":[],"length":0,"stats":{"Line":0}},{"line":233,"address":[],"length":0,"stats":{"Line":0}},{"line":234,"address":[],"length":0,"stats":{"Line":0}},{"line":236,"address":[],"length":0,"stats":{"Line":0}},{"line":237,"address":[],"length":0,"stats":{"Line":0}},{"line":240,"address":[],"length":0,"stats":{"Line":0}},{"line":241,"address":[],"length":0,"stats":{"Line":0}},{"line":242,"address":[],"length":0,"stats":{"Line":0}},{"line":243,"address":[],"length":0,"stats":{"Line":0}},{"line":244,"address":[],"length":0,"stats":{"Line":0}},{"line":245,"address":[],"length":0,"stats":{"Line":0}},{"line":246,"address":[],"length":0,"stats":{"Line":0}},{"line":248,"address":[],"length":0,"stats":{"Line":0}},{"line":249,"address":[],"length":0,"stats":{"Line":0}},{"line":253,"address":[],"length":0,"stats":{"Line":0}},{"line":256,"address":[],"length":0,"stats":{"Line":0}},{"line":257,"address":[],"length":0,"stats":{"Line":0}},{"line":260,"address":[],"length":0,"stats":{"Line":0}},{"line":261,"address":[],"length":0,"stats":{"Line":0}},{"line":264,"address":[],"length":0,"stats":{"Line":0}},{"line":265,"address":[],"length":0,"stats":{"Line":0}},{"line":266,"address":[],"length":0,"stats":{"Line":0}},{"line":269,"address":[],"length":0,"stats":{"Line":0}},{"line":270,"address":[],"length":0,"stats":{"Line":0}},{"line":271,"address":[],"length":0,"stats":{"Line":0}},{"line":272,"address":[],"length":0,"stats":{"Line":0}},{"line":273,"address":[],"length":0,"stats":{"Line":0}},{"line":274,"address":[],"length":0,"stats":{"Line":0}},{"line":275,"address":[],"length":0,"stats":{"Line":0}},{"line":277,"address":[],"length":0,"stats":{"Line":0}},{"line":280,"address":[],"length":0,"stats":{"Line":0}},{"line":281,"address":[],"length":0,"stats":{"Line":0}},{"line":284,"address":[],"length":0,"stats":{"Line":0}},{"line":287,"address":[],"length":0,"stats":{"Line":0}},{"line":288,"address":[],"length":0,"stats":{"Line":0}},{"line":289,"address":[],"length":0,"stats":{"Line":0}},{"line":290,"address":[],"length":0,"stats":{"Line":0}},{"line":291,"address":[],"length":0,"stats":{"Line":0}},{"line":293,"address":[],"length":0,"stats":{"Line":0}},{"line":294,"address":[],"length":0,"stats":{"Line":0}},{"line":297,"address":[],"length":0,"stats":{"Line":0}},{"line":298,"address":[],"length":0,"stats":{"Line":0}},{"line":299,"address":[],"length":0,"stats":{"Line":0}},{"line":300,"address":[],"length":0,"stats":{"Line":0}},{"line":301,"address":[],"length":0,"stats":{"Line":0}},{"line":303,"address":[],"length":0,"stats":{"Line":0}},{"line":304,"address":[],"length":0,"stats":{"Line":0}},{"line":305,"address":[],"length":0,"stats":{"Line":0}},{"line":307,"address":[],"length":0,"stats":{"Line":0}},{"line":311,"address":[],"length":0,"stats":{"Line":0}},{"line":312,"address":[],"length":0,"stats":{"Line":0}},{"line":313,"address":[],"length":0,"stats":{"Line":0}},{"line":314,"address":[],"length":0,"stats":{"Line":0}},{"line":318,"address":[],"length":0,"stats":{"Line":0}},{"line":320,"address":[],"length":0,"stats":{"Line":0}},{"line":321,"address":[],"length":0,"stats":{"Line":0}},{"line":323,"address":[],"length":0,"stats":{"Line":0}},{"line":324,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":178},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","ui","src","export","svg.rs"],"content":"//! SVG export functionality using Cairo\n//!\n//! Renders a document to SVG format with support for multi-page output.\n\nuse anyhow::{anyhow, Result};\nuse cairo::{Context, SvgSurface};\nuse std::path::Path;\nuse testruct_core::Document;\nuse testruct_core::workspace::assets::AssetCatalog;\nuse tracing::{debug, info};\n\n/// Default page size (A4: 595.28 x 841.89 points)\nconst DEFAULT_PAGE_WIDTH: f64 = 595.28;\nconst DEFAULT_PAGE_HEIGHT: f64 = 841.89;\n\n/// Render a document to SVG\npub fn render_to_svg(document: \u0026Document, output_path: \u0026Path, catalog: \u0026AssetCatalog) -\u003e Result\u003c()\u003e {\n    info!(\"Exporting to SVG: {}\", output_path.display());\n\n    if document.pages.is_empty() {\n        return Err(anyhow!(\"Document has no pages to export\"));\n    }\n\n    // Use default page dimensions (A4) for now\n    let width = DEFAULT_PAGE_WIDTH;\n    let height = DEFAULT_PAGE_HEIGHT;\n\n    debug!(\"SVG page size: {} x {}\", width, height);\n\n    // Create SVG surface\n    let surface = SvgSurface::new(width, height, Some(output_path))\n        .map_err(|e| anyhow!(\"Failed to create SVG surface: {}\", e))?;\n\n    let ctx = Context::new(\u0026surface)\n        .map_err(|e| anyhow!(\"Failed to create Cairo context: {}\", e))?;\n\n    // Render each page\n    for (page_index, page) in document.pages.iter().enumerate() {\n        debug!(\"Rendering page {}\", page_index + 1);\n        render_page_to_context(\u0026ctx, page, catalog)?;\n\n        // Move to next page (except for last page)\n        if page_index \u003c document.pages.len() - 1 {\n            ctx.show_page()\n                .map_err(|e| anyhow!(\"Failed to show page: {}\", e))?;\n        }\n    }\n\n    // Finish SVG\n    surface.finish();\n    info!(\"SVG export completed: {}\", output_path.display());\n\n    Ok(())\n}\n\n/// Render a single page to Cairo context\nfn render_page_to_context(ctx: \u0026Context, page: \u0026testruct_core::document::Page, catalog: \u0026AssetCatalog) -\u003e Result\u003c()\u003e {\n    // Set white background\n    ctx.set_source_rgb(1.0, 1.0, 1.0);\n    ctx.paint()\n        .map_err(|e| anyhow!(\"Failed to paint background: {}\", e))?;\n\n    // Use default page size\n    let width = DEFAULT_PAGE_WIDTH;\n    let height = DEFAULT_PAGE_HEIGHT;\n\n    // Draw page border for visual reference\n    ctx.set_source_rgb(0.0, 0.0, 0.0);\n    ctx.set_line_width(0.5);\n    ctx.rectangle(0.0, 0.0, width, height);\n    ctx.stroke()\n        .map_err(|e| anyhow!(\"Failed to draw page border: {}\", e))?;\n\n    // Render all elements\n    for element in \u0026page.elements {\n        render_element_to_context(ctx, element, catalog)?;\n    }\n\n    Ok(())\n}\n\n/// Render a single element to Cairo context\nfn render_element_to_context(ctx: \u0026Context, element: \u0026testruct_core::document::DocumentElement, catalog: \u0026AssetCatalog) -\u003e Result\u003c()\u003e {\n    use testruct_core::document::DocumentElement;\n\n    match element {\n        DocumentElement::Shape(shape) =\u003e {\n            render_shape_to_context(ctx, shape)?;\n        }\n        DocumentElement::Text(text) =\u003e {\n            render_text_to_context(ctx, text)?;\n        }\n        DocumentElement::Image(image) =\u003e {\n            // Try to load image from catalog, fallback to placeholder if not found\n            match crate::export::image_utils::render_image_from_asset(ctx, image.source, catalog, \u0026image.bounds) {\n                Ok(_) =\u003e {\n                    debug!(\"Image rendered from asset catalog: {}\", image.id);\n                }\n                Err(e) =\u003e {\n                    // If loading fails, draw placeholder and log warning\n                    debug!(\"Failed to render image {}: {}, using placeholder\", image.id, e);\n                    let _ = crate::export::image_utils::draw_image_placeholder(ctx, \u0026image.bounds);\n                }\n            }\n        }\n        DocumentElement::Frame(frame) =\u003e {\n            render_frame_to_context(ctx, frame, catalog)?;\n        }\n    }\n\n    Ok(())\n}\n\n/// Render a shape element\nfn render_shape_to_context(ctx: \u0026Context, shape: \u0026testruct_core::document::ShapeElement) -\u003e Result\u003c()\u003e {\n    use testruct_core::document::ShapeKind;\n\n    let x = shape.bounds.origin.x as f64;\n    let y = shape.bounds.origin.y as f64;\n    let width = shape.bounds.size.width as f64;\n    let height = shape.bounds.size.height as f64;\n\n    // Render based on shape kind\n    match shape.kind {\n        ShapeKind::Rectangle =\u003e {\n            // Draw fill color if present\n            if let Some(fill) = \u0026shape.fill {\n                ctx.set_source_rgb(fill.r as f64, fill.g as f64, fill.b as f64);\n                ctx.rectangle(x, y, width, height);\n                ctx.fill()\n                    .map_err(|e| anyhow!(\"Failed to fill rectangle: {}\", e))?;\n            }\n            // Draw stroke if present\n            if let Some(stroke) = \u0026shape.stroke {\n                ctx.set_source_rgb(stroke.r as f64, stroke.g as f64, stroke.b as f64);\n                ctx.set_line_width(1.0);\n                ctx.rectangle(x, y, width, height);\n                ctx.stroke()\n                    .map_err(|e| anyhow!(\"Failed to stroke rectangle: {}\", e))?;\n            }\n        }\n        ShapeKind::Ellipse =\u003e {\n            ctx.save().map_err(|e| anyhow!(\"Failed to save context: {}\", e))?;\n            ctx.translate(x + width / 2.0, y + height / 2.0);\n            ctx.scale(width / 2.0, height / 2.0);\n            ctx.arc(0.0, 0.0, 1.0, 0.0, std::f64::consts::PI * 2.0);\n\n            // Draw fill if present\n            if let Some(fill) = \u0026shape.fill {\n                ctx.set_source_rgb(fill.r as f64, fill.g as f64, fill.b as f64);\n                ctx.fill_preserve()\n                    .map_err(|e| anyhow!(\"Failed to fill ellipse: {}\", e))?;\n            }\n            // Draw stroke if present\n            if let Some(stroke) = \u0026shape.stroke {\n                ctx.set_source_rgb(stroke.r as f64, stroke.g as f64, stroke.b as f64);\n                ctx.set_line_width(1.0);\n                ctx.stroke()\n                    .map_err(|e| anyhow!(\"Failed to stroke ellipse: {}\", e))?;\n            }\n            ctx.restore().map_err(|e| anyhow!(\"Failed to restore context: {}\", e))?;\n        }\n        ShapeKind::Line =\u003e {\n            // Lines use stroke color\n            if let Some(stroke) = \u0026shape.stroke {\n                ctx.set_source_rgb(stroke.r as f64, stroke.g as f64, stroke.b as f64);\n                ctx.set_line_width(1.0);\n                ctx.move_to(x, y);\n                ctx.line_to(x + width, y + height);\n                ctx.stroke()\n                    .map_err(|e| anyhow!(\"Failed to stroke line: {}\", e))?;\n            }\n        }\n        ShapeKind::Arrow =\u003e {\n            // Arrows use stroke color for the line\n            if let Some(stroke) = \u0026shape.stroke {\n                ctx.set_source_rgb(stroke.r as f64, stroke.g as f64, stroke.b as f64);\n                ctx.set_line_width(1.0);\n                ctx.move_to(x, y);\n                ctx.line_to(x + width, y + height);\n                ctx.stroke()\n                    .map_err(|e| anyhow!(\"Failed to stroke arrow: {}\", e))?;\n            }\n        }\n        ShapeKind::Polygon =\u003e {\n            // Placeholder for polygon (same as rectangle)\n            if let Some(fill) = \u0026shape.fill {\n                ctx.set_source_rgb(fill.r as f64, fill.g as f64, fill.b as f64);\n                ctx.rectangle(x, y, width, height);\n                ctx.fill()\n                    .map_err(|e| anyhow!(\"Failed to fill polygon: {}\", e))?;\n            }\n            if let Some(stroke) = \u0026shape.stroke {\n                ctx.set_source_rgb(stroke.r as f64, stroke.g as f64, stroke.b as f64);\n                ctx.set_line_width(1.0);\n                ctx.rectangle(x, y, width, height);\n                ctx.stroke()\n                    .map_err(|e| anyhow!(\"Failed to stroke polygon: {}\", e))?;\n            }\n        }\n    }\n\n    Ok(())\n}\n\n/// Render a frame element (with recursive children)\nfn render_frame_to_context(ctx: \u0026Context, frame: \u0026testruct_core::document::FrameElement, catalog: \u0026AssetCatalog) -\u003e Result\u003c()\u003e {\n    let x = frame.bounds.origin.x as f64;\n    let y = frame.bounds.origin.y as f64;\n    let width = frame.bounds.size.width as f64;\n    let height = frame.bounds.size.height as f64;\n\n    // Draw frame border\n    ctx.set_source_rgb(0.9, 0.9, 0.9);\n    ctx.set_line_width(1.0);\n    ctx.rectangle(x, y, width, height);\n    ctx.stroke()\n        .map_err(|e| anyhow!(\"Failed to stroke frame: {}\", e))?;\n\n    // Render frame children recursively\n    for child in \u0026frame.children {\n        render_element_to_context(ctx, child, catalog)?;\n    }\n\n    debug!(\"Frame rendered with {} children\", frame.children.len());\n    Ok(())\n}\n\n/// Render a text element with Pango layout\nfn render_text_to_context(ctx: \u0026Context, text: \u0026testruct_core::document::TextElement) -\u003e Result\u003c()\u003e {\n    use pango::prelude::*;\n\n    ctx.save()\n        .map_err(|e| anyhow!(\"Failed to save context: {}\", e))?;\n\n    let bounds = \u0026text.bounds;\n    let style = \u0026text.style;\n\n    // Draw background color if specified\n    if let Some(bg_color) = style.background_color {\n        ctx.set_source_rgb(bg_color.r as f64, bg_color.g as f64, bg_color.b as f64);\n        ctx.rectangle(\n            bounds.origin.x as f64,\n            bounds.origin.y as f64,\n            bounds.size.width as f64,\n            bounds.size.height as f64,\n        );\n        ctx.fill()\n            .map_err(|e| anyhow!(\"Failed to fill text background: {}\", e))?;\n    }\n\n    // Translate to text origin\n    ctx.translate(bounds.origin.x as f64, bounds.origin.y as f64);\n\n    // Create clipping rectangle\n    ctx.rectangle(0.0, 0.0, bounds.size.width as f64, bounds.size.height as f64);\n    ctx.clip();\n\n    // Create Pango layout\n    let layout = pangocairo::functions::create_layout(ctx);\n    layout.set_text(\u0026text.content);\n\n    // Set font with styling\n    let mut font_desc = pango::FontDescription::new();\n    font_desc.set_family(\u0026style.font_family);\n    font_desc.set_size((style.font_size * pango::SCALE as f32) as i32);\n\n    // Apply font weight\n    let pango_weight = match style.weight {\n        testruct_core::typography::FontWeight::Thin =\u003e pango::Weight::Thin,\n        testruct_core::typography::FontWeight::Light =\u003e pango::Weight::Light,\n        testruct_core::typography::FontWeight::Regular =\u003e pango::Weight::Normal,\n        testruct_core::typography::FontWeight::Medium =\u003e pango::Weight::Medium,\n        testruct_core::typography::FontWeight::Bold =\u003e pango::Weight::Bold,\n        testruct_core::typography::FontWeight::Black =\u003e pango::Weight::Ultrabold,\n    };\n    font_desc.set_weight(pango_weight);\n\n    // Apply italic style\n    if style.italic {\n        font_desc.set_style(pango::Style::Italic);\n    }\n\n    layout.set_font_description(Some(\u0026font_desc));\n\n    // Apply text alignment\n    let pango_alignment = match style.alignment {\n        testruct_core::typography::TextAlignment::Start =\u003e pango::Alignment::Left,\n        testruct_core::typography::TextAlignment::Center =\u003e pango::Alignment::Center,\n        testruct_core::typography::TextAlignment::End =\u003e pango::Alignment::Right,\n        testruct_core::typography::TextAlignment::Justified =\u003e pango::Alignment::Center,\n    };\n    layout.set_alignment(pango_alignment);\n    layout.set_width((bounds.size.width as f64 * pango::SCALE as f64) as i32);\n\n    // Apply underline and strikethrough decorations\n    if style.underline || style.strikethrough {\n        let attrs = pango::AttrList::new();\n        if style.underline {\n            let underline_attr = pango::AttrInt::new_underline(pango::Underline::Single);\n            attrs.insert(underline_attr);\n        }\n        if style.strikethrough {\n            let strikethrough_attr = pango::AttrInt::new_strikethrough(true);\n            attrs.insert(strikethrough_attr);\n        }\n        layout.set_attributes(Some(\u0026attrs));\n    }\n\n    // Set text color\n    ctx.set_source_rgb(\n        style.color.r as f64,\n        style.color.g as f64,\n        style.color.b as f64,\n    );\n\n    // Render the text using pangocairo\n    pangocairo::functions::show_layout(ctx, \u0026layout);\n\n    ctx.restore()\n        .map_err(|e| anyhow!(\"Failed to restore context: {}\", e))?;\n\n    debug!(\"Text rendered: '{}' in SVG\", text.content);\n    Ok(())\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n\n    #[test]\n    fn test_svg_export_module_loads() {\n        assert!(true);\n    }\n}\n","traces":[{"line":17,"address":[],"length":0,"stats":{"Line":0}},{"line":18,"address":[],"length":0,"stats":{"Line":0}},{"line":20,"address":[],"length":0,"stats":{"Line":0}},{"line":21,"address":[],"length":0,"stats":{"Line":0}},{"line":25,"address":[],"length":0,"stats":{"Line":0}},{"line":26,"address":[],"length":0,"stats":{"Line":0}},{"line":28,"address":[],"length":0,"stats":{"Line":0}},{"line":31,"address":[],"length":0,"stats":{"Line":0}},{"line":32,"address":[],"length":0,"stats":{"Line":0}},{"line":34,"address":[],"length":0,"stats":{"Line":0}},{"line":35,"address":[],"length":0,"stats":{"Line":0}},{"line":38,"address":[],"length":0,"stats":{"Line":0}},{"line":39,"address":[],"length":0,"stats":{"Line":0}},{"line":40,"address":[],"length":0,"stats":{"Line":0}},{"line":43,"address":[],"length":0,"stats":{"Line":0}},{"line":44,"address":[],"length":0,"stats":{"Line":0}},{"line":45,"address":[],"length":0,"stats":{"Line":0}},{"line":50,"address":[],"length":0,"stats":{"Line":0}},{"line":51,"address":[],"length":0,"stats":{"Line":0}},{"line":53,"address":[],"length":0,"stats":{"Line":0}},{"line":57,"address":[],"length":0,"stats":{"Line":0}},{"line":59,"address":[],"length":0,"stats":{"Line":0}},{"line":60,"address":[],"length":0,"stats":{"Line":0}},{"line":61,"address":[],"length":0,"stats":{"Line":0}},{"line":64,"address":[],"length":0,"stats":{"Line":0}},{"line":65,"address":[],"length":0,"stats":{"Line":0}},{"line":68,"address":[],"length":0,"stats":{"Line":0}},{"line":69,"address":[],"length":0,"stats":{"Line":0}},{"line":70,"address":[],"length":0,"stats":{"Line":0}},{"line":71,"address":[],"length":0,"stats":{"Line":0}},{"line":72,"address":[],"length":0,"stats":{"Line":0}},{"line":75,"address":[],"length":0,"stats":{"Line":0}},{"line":76,"address":[],"length":0,"stats":{"Line":0}},{"line":79,"address":[],"length":0,"stats":{"Line":0}},{"line":83,"address":[],"length":0,"stats":{"Line":0}},{"line":86,"address":[],"length":0,"stats":{"Line":0}},{"line":87,"address":[],"length":0,"stats":{"Line":0}},{"line":88,"address":[],"length":0,"stats":{"Line":0}},{"line":90,"address":[],"length":0,"stats":{"Line":0}},{"line":91,"address":[],"length":0,"stats":{"Line":0}},{"line":93,"address":[],"length":0,"stats":{"Line":0}},{"line":95,"address":[],"length":0,"stats":{"Line":0}},{"line":97,"address":[],"length":0,"stats":{"Line":0}},{"line":99,"address":[],"length":0,"stats":{"Line":0}},{"line":101,"address":[],"length":0,"stats":{"Line":0}},{"line":102,"address":[],"length":0,"stats":{"Line":0}},{"line":106,"address":[],"length":0,"stats":{"Line":0}},{"line":107,"address":[],"length":0,"stats":{"Line":0}},{"line":111,"address":[],"length":0,"stats":{"Line":0}},{"line":115,"address":[],"length":0,"stats":{"Line":0}},{"line":118,"address":[],"length":0,"stats":{"Line":0}},{"line":119,"address":[],"length":0,"stats":{"Line":0}},{"line":120,"address":[],"length":0,"stats":{"Line":0}},{"line":121,"address":[],"length":0,"stats":{"Line":0}},{"line":124,"address":[],"length":0,"stats":{"Line":0}},{"line":127,"address":[],"length":0,"stats":{"Line":0}},{"line":128,"address":[],"length":0,"stats":{"Line":0}},{"line":129,"address":[],"length":0,"stats":{"Line":0}},{"line":130,"address":[],"length":0,"stats":{"Line":0}},{"line":131,"address":[],"length":0,"stats":{"Line":0}},{"line":134,"address":[],"length":0,"stats":{"Line":0}},{"line":135,"address":[],"length":0,"stats":{"Line":0}},{"line":136,"address":[],"length":0,"stats":{"Line":0}},{"line":137,"address":[],"length":0,"stats":{"Line":0}},{"line":138,"address":[],"length":0,"stats":{"Line":0}},{"line":139,"address":[],"length":0,"stats":{"Line":0}},{"line":143,"address":[],"length":0,"stats":{"Line":0}},{"line":144,"address":[],"length":0,"stats":{"Line":0}},{"line":145,"address":[],"length":0,"stats":{"Line":0}},{"line":146,"address":[],"length":0,"stats":{"Line":0}},{"line":149,"address":[],"length":0,"stats":{"Line":0}},{"line":150,"address":[],"length":0,"stats":{"Line":0}},{"line":151,"address":[],"length":0,"stats":{"Line":0}},{"line":152,"address":[],"length":0,"stats":{"Line":0}},{"line":155,"address":[],"length":0,"stats":{"Line":0}},{"line":156,"address":[],"length":0,"stats":{"Line":0}},{"line":157,"address":[],"length":0,"stats":{"Line":0}},{"line":158,"address":[],"length":0,"stats":{"Line":0}},{"line":159,"address":[],"length":0,"stats":{"Line":0}},{"line":161,"address":[],"length":0,"stats":{"Line":0}},{"line":165,"address":[],"length":0,"stats":{"Line":0}},{"line":166,"address":[],"length":0,"stats":{"Line":0}},{"line":167,"address":[],"length":0,"stats":{"Line":0}},{"line":168,"address":[],"length":0,"stats":{"Line":0}},{"line":169,"address":[],"length":0,"stats":{"Line":0}},{"line":170,"address":[],"length":0,"stats":{"Line":0}},{"line":171,"address":[],"length":0,"stats":{"Line":0}},{"line":176,"address":[],"length":0,"stats":{"Line":0}},{"line":177,"address":[],"length":0,"stats":{"Line":0}},{"line":178,"address":[],"length":0,"stats":{"Line":0}},{"line":179,"address":[],"length":0,"stats":{"Line":0}},{"line":180,"address":[],"length":0,"stats":{"Line":0}},{"line":181,"address":[],"length":0,"stats":{"Line":0}},{"line":182,"address":[],"length":0,"stats":{"Line":0}},{"line":187,"address":[],"length":0,"stats":{"Line":0}},{"line":188,"address":[],"length":0,"stats":{"Line":0}},{"line":189,"address":[],"length":0,"stats":{"Line":0}},{"line":190,"address":[],"length":0,"stats":{"Line":0}},{"line":191,"address":[],"length":0,"stats":{"Line":0}},{"line":193,"address":[],"length":0,"stats":{"Line":0}},{"line":194,"address":[],"length":0,"stats":{"Line":0}},{"line":195,"address":[],"length":0,"stats":{"Line":0}},{"line":196,"address":[],"length":0,"stats":{"Line":0}},{"line":197,"address":[],"length":0,"stats":{"Line":0}},{"line":198,"address":[],"length":0,"stats":{"Line":0}},{"line":203,"address":[],"length":0,"stats":{"Line":0}},{"line":207,"address":[],"length":0,"stats":{"Line":0}},{"line":208,"address":[],"length":0,"stats":{"Line":0}},{"line":209,"address":[],"length":0,"stats":{"Line":0}},{"line":210,"address":[],"length":0,"stats":{"Line":0}},{"line":211,"address":[],"length":0,"stats":{"Line":0}},{"line":214,"address":[],"length":0,"stats":{"Line":0}},{"line":215,"address":[],"length":0,"stats":{"Line":0}},{"line":216,"address":[],"length":0,"stats":{"Line":0}},{"line":217,"address":[],"length":0,"stats":{"Line":0}},{"line":218,"address":[],"length":0,"stats":{"Line":0}},{"line":221,"address":[],"length":0,"stats":{"Line":0}},{"line":222,"address":[],"length":0,"stats":{"Line":0}},{"line":225,"address":[],"length":0,"stats":{"Line":0}},{"line":226,"address":[],"length":0,"stats":{"Line":0}},{"line":230,"address":[],"length":0,"stats":{"Line":0}},{"line":233,"address":[],"length":0,"stats":{"Line":0}},{"line":234,"address":[],"length":0,"stats":{"Line":0}},{"line":236,"address":[],"length":0,"stats":{"Line":0}},{"line":237,"address":[],"length":0,"stats":{"Line":0}},{"line":240,"address":[],"length":0,"stats":{"Line":0}},{"line":241,"address":[],"length":0,"stats":{"Line":0}},{"line":242,"address":[],"length":0,"stats":{"Line":0}},{"line":243,"address":[],"length":0,"stats":{"Line":0}},{"line":244,"address":[],"length":0,"stats":{"Line":0}},{"line":245,"address":[],"length":0,"stats":{"Line":0}},{"line":246,"address":[],"length":0,"stats":{"Line":0}},{"line":248,"address":[],"length":0,"stats":{"Line":0}},{"line":249,"address":[],"length":0,"stats":{"Line":0}},{"line":253,"address":[],"length":0,"stats":{"Line":0}},{"line":256,"address":[],"length":0,"stats":{"Line":0}},{"line":257,"address":[],"length":0,"stats":{"Line":0}},{"line":260,"address":[],"length":0,"stats":{"Line":0}},{"line":261,"address":[],"length":0,"stats":{"Line":0}},{"line":264,"address":[],"length":0,"stats":{"Line":0}},{"line":265,"address":[],"length":0,"stats":{"Line":0}},{"line":266,"address":[],"length":0,"stats":{"Line":0}},{"line":269,"address":[],"length":0,"stats":{"Line":0}},{"line":270,"address":[],"length":0,"stats":{"Line":0}},{"line":271,"address":[],"length":0,"stats":{"Line":0}},{"line":272,"address":[],"length":0,"stats":{"Line":0}},{"line":273,"address":[],"length":0,"stats":{"Line":0}},{"line":274,"address":[],"length":0,"stats":{"Line":0}},{"line":275,"address":[],"length":0,"stats":{"Line":0}},{"line":277,"address":[],"length":0,"stats":{"Line":0}},{"line":280,"address":[],"length":0,"stats":{"Line":0}},{"line":281,"address":[],"length":0,"stats":{"Line":0}},{"line":284,"address":[],"length":0,"stats":{"Line":0}},{"line":287,"address":[],"length":0,"stats":{"Line":0}},{"line":288,"address":[],"length":0,"stats":{"Line":0}},{"line":289,"address":[],"length":0,"stats":{"Line":0}},{"line":290,"address":[],"length":0,"stats":{"Line":0}},{"line":291,"address":[],"length":0,"stats":{"Line":0}},{"line":293,"address":[],"length":0,"stats":{"Line":0}},{"line":294,"address":[],"length":0,"stats":{"Line":0}},{"line":297,"address":[],"length":0,"stats":{"Line":0}},{"line":298,"address":[],"length":0,"stats":{"Line":0}},{"line":299,"address":[],"length":0,"stats":{"Line":0}},{"line":300,"address":[],"length":0,"stats":{"Line":0}},{"line":301,"address":[],"length":0,"stats":{"Line":0}},{"line":303,"address":[],"length":0,"stats":{"Line":0}},{"line":304,"address":[],"length":0,"stats":{"Line":0}},{"line":305,"address":[],"length":0,"stats":{"Line":0}},{"line":307,"address":[],"length":0,"stats":{"Line":0}},{"line":311,"address":[],"length":0,"stats":{"Line":0}},{"line":312,"address":[],"length":0,"stats":{"Line":0}},{"line":313,"address":[],"length":0,"stats":{"Line":0}},{"line":314,"address":[],"length":0,"stats":{"Line":0}},{"line":318,"address":[],"length":0,"stats":{"Line":0}},{"line":320,"address":[],"length":0,"stats":{"Line":0}},{"line":321,"address":[],"length":0,"stats":{"Line":0}},{"line":323,"address":[],"length":0,"stats":{"Line":0}},{"line":324,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":178},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","ui","src","io","file_dialog.rs"],"content":"//! File dialog operations for document I/O\n//!\n//! Provides GTK4 file chooser dialogs for opening and saving documents.\n\nuse gtk4::{prelude::*, FileDialog};\nuse std::path::PathBuf;\n\n/// Show an open file dialog and return the selected path\npub async fn show_open_dialog(parent: \u0026gtk4::ApplicationWindow) -\u003e Option\u003cPathBuf\u003e {\n    let dialog = FileDialog::new();\n    dialog.set_title(\"Open Document\");\n\n    // Set initial folder\n    if let Some(docs_dir) = crate::io::file_io::default_documents_dir() {\n        let file = gtk4::gio::File::for_path(\u0026docs_dir);\n        dialog.set_initial_folder(Some(\u0026file));\n    }\n\n    match dialog.open_future(Some(parent)).await {\n        Ok(file) =\u003e file.path(),\n        Err(_) =\u003e None,\n    }\n}\n\n/// Show a save file dialog and return the selected path\npub async fn show_save_dialog(parent: \u0026gtk4::ApplicationWindow) -\u003e Option\u003cPathBuf\u003e {\n    let dialog = FileDialog::new();\n    dialog.set_title(\"Save Document\");\n\n    // Set initial folder and name\n    if let Some(docs_dir) = crate::io::file_io::default_documents_dir() {\n        let file = gtk4::gio::File::for_path(\u0026docs_dir);\n        dialog.set_initial_folder(Some(\u0026file));\n    }\n\n    dialog.set_initial_name(Some(\u0026crate::io::file_io::default_filename()));\n\n    match dialog.save_future(Some(parent)).await {\n        Ok(file) =\u003e file.path(),\n        Err(_) =\u003e None,\n    }\n}\n\n/// Show an export dialog for selecting an export location and format\npub async fn show_export_dialog(\n    parent: \u0026gtk4::ApplicationWindow,\n    format: \u0026str,\n) -\u003e Option\u003cPathBuf\u003e {\n    let dialog = FileDialog::new();\n    dialog.set_title(\u0026format!(\"Export Document as {}\", format.to_uppercase()));\n\n    // Set initial folder and name\n    if let Some(docs_dir) = crate::io::file_io::default_documents_dir() {\n        let file = gtk4::gio::File::for_path(\u0026docs_dir);\n        dialog.set_initial_folder(Some(\u0026file));\n    }\n\n    let extension = match format {\n        \"pdf\" =\u003e \"pdf\",\n        \"png\" =\u003e \"png\",\n        \"jpeg\" =\u003e \"jpg\",\n        \"svg\" =\u003e \"svg\",\n        _ =\u003e \"bin\",\n    };\n\n    let filename = format!(\"document.{}\", extension);\n    dialog.set_initial_name(Some(\u0026filename));\n\n    match dialog.save_future(Some(parent)).await {\n        Ok(file) =\u003e file.path(),\n        Err(_) =\u003e None,\n    }\n}\n","traces":[{"line":9,"address":[],"length":0,"stats":{"Line":0}},{"line":10,"address":[],"length":0,"stats":{"Line":0}},{"line":11,"address":[],"length":0,"stats":{"Line":0}},{"line":14,"address":[],"length":0,"stats":{"Line":0}},{"line":15,"address":[],"length":0,"stats":{"Line":0}},{"line":16,"address":[],"length":0,"stats":{"Line":0}},{"line":19,"address":[],"length":0,"stats":{"Line":0}},{"line":20,"address":[],"length":0,"stats":{"Line":0}},{"line":21,"address":[],"length":0,"stats":{"Line":0}},{"line":26,"address":[],"length":0,"stats":{"Line":0}},{"line":27,"address":[],"length":0,"stats":{"Line":0}},{"line":28,"address":[],"length":0,"stats":{"Line":0}},{"line":31,"address":[],"length":0,"stats":{"Line":0}},{"line":32,"address":[],"length":0,"stats":{"Line":0}},{"line":33,"address":[],"length":0,"stats":{"Line":0}},{"line":36,"address":[],"length":0,"stats":{"Line":0}},{"line":38,"address":[],"length":0,"stats":{"Line":0}},{"line":39,"address":[],"length":0,"stats":{"Line":0}},{"line":40,"address":[],"length":0,"stats":{"Line":0}},{"line":45,"address":[],"length":0,"stats":{"Line":0}},{"line":49,"address":[],"length":0,"stats":{"Line":0}},{"line":50,"address":[],"length":0,"stats":{"Line":0}},{"line":53,"address":[],"length":0,"stats":{"Line":0}},{"line":54,"address":[],"length":0,"stats":{"Line":0}},{"line":55,"address":[],"length":0,"stats":{"Line":0}},{"line":58,"address":[],"length":0,"stats":{"Line":0}},{"line":59,"address":[],"length":0,"stats":{"Line":0}},{"line":60,"address":[],"length":0,"stats":{"Line":0}},{"line":61,"address":[],"length":0,"stats":{"Line":0}},{"line":62,"address":[],"length":0,"stats":{"Line":0}},{"line":63,"address":[],"length":0,"stats":{"Line":0}},{"line":66,"address":[],"length":0,"stats":{"Line":0}},{"line":67,"address":[],"length":0,"stats":{"Line":0}},{"line":69,"address":[],"length":0,"stats":{"Line":0}},{"line":70,"address":[],"length":0,"stats":{"Line":0}},{"line":71,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":36},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","ui","src","io","file_io.rs"],"content":"//! Document file I/O operations\n//!\n//! Handles saving and loading Testruct documents in JSON format.\n\nuse std::path::Path;\nuse testruct_core::Document;\nuse anyhow::{Result, Context};\n\n/// Save a document to a JSON file\npub fn save_document(document: \u0026Document, path: \u0026Path) -\u003e Result\u003c()\u003e {\n    let json = serde_json::to_string_pretty(document)\n        .context(\"Failed to serialize document to JSON\")?;\n\n    std::fs::write(path, json)\n        .context(\"Failed to write document file\")?;\n\n    tracing::info!(\"Document saved to: {}\", path.display());\n    Ok(())\n}\n\n/// Load a document from a JSON file\npub fn load_document(path: \u0026Path) -\u003e Result\u003cDocument\u003e {\n    let json = std::fs::read_to_string(path)\n        .context(\"Failed to read document file\")?;\n\n    let document: Document = serde_json::from_str(\u0026json)\n        .context(\"Failed to deserialize document from JSON\")?;\n\n    tracing::info!(\"Document loaded from: {}\", path.display());\n    Ok(document)\n}\n\n/// Get the default documents directory\npub fn default_documents_dir() -\u003e Option\u003cstd::path::PathBuf\u003e {\n    dirs::document_dir()\n}\n\n/// Get a default filename for a new document\npub fn default_filename() -\u003e String {\n    chrono::Local::now().format(\"document_%Y%m%d_%H%M%S.json\").to_string()\n}\n","traces":[{"line":10,"address":[],"length":0,"stats":{"Line":0}},{"line":11,"address":[],"length":0,"stats":{"Line":0}},{"line":14,"address":[],"length":0,"stats":{"Line":0}},{"line":17,"address":[],"length":0,"stats":{"Line":0}},{"line":18,"address":[],"length":0,"stats":{"Line":0}},{"line":22,"address":[],"length":0,"stats":{"Line":0}},{"line":23,"address":[],"length":0,"stats":{"Line":0}},{"line":26,"address":[],"length":0,"stats":{"Line":0}},{"line":29,"address":[],"length":0,"stats":{"Line":0}},{"line":30,"address":[],"length":0,"stats":{"Line":0}},{"line":34,"address":[],"length":0,"stats":{"Line":0}},{"line":35,"address":[],"length":0,"stats":{"Line":0}},{"line":39,"address":[],"length":0,"stats":{"Line":0}},{"line":40,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":14},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","ui","src","io","mod.rs"],"content":"//! File I/O operations for document persistence\n//!\n//! Provides functionality for saving and loading documents in JSON format,\n//! along with GTK4 file dialog integration.\n\npub mod file_io;\npub mod file_dialog;\n\npub use file_io::{save_document, load_document, default_documents_dir, default_filename};\npub use file_dialog::{show_open_dialog, show_save_dialog, show_export_dialog};\n","traces":[],"covered":0,"coverable":0},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","ui","src","lib.rs"],"content":"//! GTK UI for the Testruct desktop rewrite.\n\npub mod app;\npub mod canvas;\npub mod dialogs;\npub mod error;\npub mod export;\npub mod io;\npub mod menu;\npub mod panels;\npub mod template_manager;\npub mod templates;\npub mod theme;\npub mod toolbar;\npub mod undo_redo;\npub mod window;\n\npub use app::{AppConfig, TestructApplication};\npub use error::{AppError, AppResult, ValidationError, ValidationResult};\n\npub fn launch(config: AppConfig) -\u003e glib::ExitCode {\n    TestructApplication::new(config).run()\n}\n","traces":[{"line":21,"address":[],"length":0,"stats":{"Line":0}},{"line":22,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":2},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","ui","src","menu","mod.rs"],"content":"//! Menu model construction for the application window\n//!\n//! This module provides a builder for constructing the application menu\n//! structure with all file, edit, view, tools, and help menus.\n\nuse glib::Cast;\nuse gtk4::{gio, glib, PopoverMenuBar};\n\n/// Builder for constructing the application menu model\npub struct MenuBuilder;\n\nimpl MenuBuilder {\n    /// Build the complete menu model with all submenus\n    pub fn build_menu_model() -\u003e gio::MenuModel {\n        let menu = gio::Menu::new();\n\n        menu.append_submenu(Some(\"_File\"), \u0026Self::build_file_menu());\n        menu.append_submenu(Some(\"_Edit\"), \u0026Self::build_edit_menu());\n        menu.append_submenu(Some(\"_View\"), \u0026Self::build_view_menu());\n        menu.append_submenu(Some(\"_Tools\"), \u0026Self::build_tools_menu());\n        menu.append_submenu(Some(\"_Help\"), \u0026Self::build_help_menu());\n\n        menu.upcast()\n    }\n\n    /// Build the File menu with document operations\n    fn build_file_menu() -\u003e gio::Menu {\n        let file_menu = gio::Menu::new();\n        file_menu.append(Some(\"_New\"), Some(\"win.new\"));\n        file_menu.append(Some(\"_Open...\"), Some(\"win.open\"));\n        file_menu.append(Some(\"_Save\"), Some(\"win.save\"));\n        file_menu.append(Some(\"Save _As...\"), Some(\"win.save-as\"));\n\n        let export_section = gio::Menu::new();\n        export_section.append(Some(\"Export as PDF\"), Some(\"win.export-pdf\"));\n        export_section.append(Some(\"Export as PNG\"), Some(\"win.export-png\"));\n        export_section.append(Some(\"Export as JPEG\"), Some(\"win.export-jpeg\"));\n        export_section.append(Some(\"Export as SVG\"), Some(\"win.export-svg\"));\n        file_menu.append_section(None, \u0026export_section);\n\n        file_menu\n    }\n\n    /// Build the Edit menu with undo/redo and selection\n    fn build_edit_menu() -\u003e gio::Menu {\n        let edit_menu = gio::Menu::new();\n        edit_menu.append(Some(\"_Undo\"), Some(\"win.undo\"));\n        edit_menu.append(Some(\"_Redo\"), Some(\"win.redo\"));\n\n        let edit_section = gio::Menu::new();\n        edit_section.append(Some(\"Select _All\"), Some(\"win.select-all\"));\n        edit_menu.append_section(None, \u0026edit_section);\n\n        edit_menu\n    }\n\n    /// Build the View menu with grid, guides, and panel toggles\n    fn build_view_menu() -\u003e gio::Menu {\n        let view_menu = gio::Menu::new();\n        view_menu.append(Some(\"Show _Grid\"), Some(\"win.toggle-grid\"));\n        view_menu.append(Some(\"Show G_uides\"), Some(\"win.toggle-guides\"));\n        view_menu.append(Some(\"Show _Rulers\"), Some(\"win.toggle-rulers\"));\n\n        let panels_section = gio::Menu::new();\n        panels_section.append(Some(\"_Layers Panel\"), Some(\"win.toggle-layers\"));\n        panels_section.append(Some(\"_Properties Panel\"), Some(\"win.toggle-properties\"));\n        panels_section.append(Some(\"_JSON Editor\"), Some(\"win.open-json-editor\"));\n        view_menu.append_section(None, \u0026panels_section);\n\n        view_menu\n    }\n\n    /// Build the Tools menu with templates and utilities\n    fn build_tools_menu() -\u003e gio::Menu {\n        let tools_menu = gio::Menu::new();\n        tools_menu.append(Some(\"_Templates\"), Some(\"win.templates\"));\n        tools_menu.append(Some(\"_Item Library\"), Some(\"win.toggle-item-library\"));\n        tools_menu.append(Some(\"_Block Tools\"), Some(\"win.toggle-block-tools\"));\n\n        let insert_section = gio::Menu::new();\n        insert_section.append(Some(\"Insert _Image...\"), Some(\"win.insert-image\"));\n        tools_menu.append_section(None, \u0026insert_section);\n\n        let tools_section = gio::Menu::new();\n        tools_section.append(Some(\"_Settings\"), Some(\"win.settings\"));\n        tools_menu.append_section(None, \u0026tools_section);\n\n        tools_menu\n    }\n\n    /// Build the Help menu with documentation and about\n    fn build_help_menu() -\u003e gio::Menu {\n        let help_menu = gio::Menu::new();\n        help_menu.append(Some(\"_User Manual\"), Some(\"win.user-manual\"));\n        help_menu.append(Some(\"_About\"), Some(\"win.about\"));\n\n        help_menu\n    }\n}\n\npub fn build_menu_bar() -\u003e PopoverMenuBar {\n    let model = MenuBuilder::build_menu_model();\n    let menu_bar = PopoverMenuBar::from_model(Some(\u0026model));\n    glib::set_application_name(\"Testruct Studio\");\n    menu_bar\n}\n","traces":[{"line":14,"address":[],"length":0,"stats":{"Line":0}},{"line":15,"address":[],"length":0,"stats":{"Line":0}},{"line":17,"address":[],"length":0,"stats":{"Line":0}},{"line":18,"address":[],"length":0,"stats":{"Line":0}},{"line":19,"address":[],"length":0,"stats":{"Line":0}},{"line":20,"address":[],"length":0,"stats":{"Line":0}},{"line":21,"address":[],"length":0,"stats":{"Line":0}},{"line":23,"address":[],"length":0,"stats":{"Line":0}},{"line":27,"address":[],"length":0,"stats":{"Line":0}},{"line":28,"address":[],"length":0,"stats":{"Line":0}},{"line":29,"address":[],"length":0,"stats":{"Line":0}},{"line":30,"address":[],"length":0,"stats":{"Line":0}},{"line":31,"address":[],"length":0,"stats":{"Line":0}},{"line":32,"address":[],"length":0,"stats":{"Line":0}},{"line":34,"address":[],"length":0,"stats":{"Line":0}},{"line":35,"address":[],"length":0,"stats":{"Line":0}},{"line":36,"address":[],"length":0,"stats":{"Line":0}},{"line":37,"address":[],"length":0,"stats":{"Line":0}},{"line":38,"address":[],"length":0,"stats":{"Line":0}},{"line":39,"address":[],"length":0,"stats":{"Line":0}},{"line":41,"address":[],"length":0,"stats":{"Line":0}},{"line":45,"address":[],"length":0,"stats":{"Line":0}},{"line":46,"address":[],"length":0,"stats":{"Line":0}},{"line":47,"address":[],"length":0,"stats":{"Line":0}},{"line":48,"address":[],"length":0,"stats":{"Line":0}},{"line":50,"address":[],"length":0,"stats":{"Line":0}},{"line":51,"address":[],"length":0,"stats":{"Line":0}},{"line":52,"address":[],"length":0,"stats":{"Line":0}},{"line":54,"address":[],"length":0,"stats":{"Line":0}},{"line":58,"address":[],"length":0,"stats":{"Line":0}},{"line":59,"address":[],"length":0,"stats":{"Line":0}},{"line":60,"address":[],"length":0,"stats":{"Line":0}},{"line":61,"address":[],"length":0,"stats":{"Line":0}},{"line":62,"address":[],"length":0,"stats":{"Line":0}},{"line":64,"address":[],"length":0,"stats":{"Line":0}},{"line":65,"address":[],"length":0,"stats":{"Line":0}},{"line":66,"address":[],"length":0,"stats":{"Line":0}},{"line":67,"address":[],"length":0,"stats":{"Line":0}},{"line":68,"address":[],"length":0,"stats":{"Line":0}},{"line":70,"address":[],"length":0,"stats":{"Line":0}},{"line":74,"address":[],"length":0,"stats":{"Line":0}},{"line":75,"address":[],"length":0,"stats":{"Line":0}},{"line":76,"address":[],"length":0,"stats":{"Line":0}},{"line":77,"address":[],"length":0,"stats":{"Line":0}},{"line":78,"address":[],"length":0,"stats":{"Line":0}},{"line":80,"address":[],"length":0,"stats":{"Line":0}},{"line":81,"address":[],"length":0,"stats":{"Line":0}},{"line":82,"address":[],"length":0,"stats":{"Line":0}},{"line":84,"address":[],"length":0,"stats":{"Line":0}},{"line":85,"address":[],"length":0,"stats":{"Line":0}},{"line":86,"address":[],"length":0,"stats":{"Line":0}},{"line":88,"address":[],"length":0,"stats":{"Line":0}},{"line":92,"address":[],"length":0,"stats":{"Line":0}},{"line":93,"address":[],"length":0,"stats":{"Line":0}},{"line":94,"address":[],"length":0,"stats":{"Line":0}},{"line":95,"address":[],"length":0,"stats":{"Line":0}},{"line":97,"address":[],"length":0,"stats":{"Line":0}},{"line":101,"address":[],"length":0,"stats":{"Line":0}},{"line":102,"address":[],"length":0,"stats":{"Line":0}},{"line":103,"address":[],"length":0,"stats":{"Line":0}},{"line":104,"address":[],"length":0,"stats":{"Line":0}},{"line":105,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":62},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","ui","src","panels","item_library.rs"],"content":"//! Item library panel for viewing and managing items from the database\n\nuse gtk4::{prelude::*, ScrolledWindow, SearchEntry, Box as GtkBox, Label, ListBox, ListBoxRow, Orientation, Button};\nuse std::sync::{Arc, Mutex};\nuse testruct_db::ItemBank;\n\n/// Components for the item library panel\npub struct ItemLibraryComponents {\n    pub container: GtkBox,\n    pub search_entry: SearchEntry,\n    pub item_list: ListBox,\n    pub add_button: Button,\n}\n\n/// Build the item library panel\npub fn build_item_library_panel(\n    item_bank: Arc\u003cMutex\u003cItemBank\u003e\u003e,\n) -\u003e ItemLibraryComponents {\n    // Main container\n    let container = GtkBox::new(gtk4::Orientation::Vertical, 6);\n    container.set_margin_top(12);\n    container.set_margin_bottom(12);\n    container.set_margin_start(12);\n    container.set_margin_end(12);\n\n    // Title\n    let title = Label::new(Some(\"Item Library\"));\n    title.add_css_class(\"title-3\");\n    container.append(\u0026title);\n\n    // Search and action box\n    let search_action_box = GtkBox::new(Orientation::Horizontal, 6);\n    search_action_box.set_halign(gtk4::Align::Fill);\n\n    let search_entry = SearchEntry::new();\n    search_entry.set_placeholder_text(Some(\"Search items...\"));\n    search_entry.set_halign(gtk4::Align::Fill);\n    search_entry.set_hexpand(true);\n    search_action_box.append(\u0026search_entry);\n\n    let add_button = Button::with_label(\"+ \");\n    add_button.add_css_class(\"flat\");\n    add_button.set_tooltip_text(Some(\"\"));\n    search_action_box.append(\u0026add_button);\n\n    container.append(\u0026search_action_box);\n\n    // Item list\n    let item_list = ListBox::new();\n    item_list.set_selection_mode(gtk4::SelectionMode::Single);\n    item_list.set_hexpand(true);\n    item_list.set_vexpand(true);\n\n    // Scrolled window for item list\n    let scrolled = ScrolledWindow::new();\n    scrolled.set_child(Some(\u0026item_list));\n    scrolled.set_hexpand(true);\n    scrolled.set_vexpand(true);\n    container.append(\u0026scrolled);\n\n    // Load initial items\n    refresh_item_list(\u0026item_list, \u0026item_bank);\n\n    // Search functionality\n    let item_list_clone = item_list.clone();\n    let item_bank_clone = item_bank.clone();\n    search_entry.connect_search_changed(move |entry| {\n        let query = entry.text().to_string();\n        if query.is_empty() {\n            refresh_item_list(\u0026item_list_clone, \u0026item_bank_clone);\n        } else {\n            search_items(\u0026item_list_clone, \u0026item_bank_clone, \u0026query);\n        }\n    });\n\n    ItemLibraryComponents {\n        container,\n        search_entry,\n        item_list,\n        add_button,\n    }\n}\n\n/// Refresh the item list with all items from the database\nfn refresh_item_list(list: \u0026ListBox, item_bank: \u0026Arc\u003cMutex\u003cItemBank\u003e\u003e) {\n    // Clear existing items\n    while let Some(row) = list.first_child() {\n        list.remove(\u0026row);\n    }\n\n    // Load items from database\n    match item_bank.lock() {\n        Ok(bank) =\u003e {\n            match bank.get_all_items(Some(100)) {\n                Ok(items) =\u003e {\n                    for item in items {\n                        let row_label = format!(\n                            \"{}\\n{}\",\n                            item.title,\n                            item.difficulty.as_str()\n                        );\n                        let row = ListBoxRow::new();\n                        let label = Label::new(Some(\u0026row_label));\n                        label.set_wrap(true);\n                        label.set_margin_top(6);\n                        label.set_margin_bottom(6);\n                        label.set_margin_start(6);\n                        label.set_margin_end(6);\n                        label.set_halign(gtk4::Align::Start);\n                        row.set_child(Some(\u0026label));\n                        list.insert(\u0026row, -1);\n                    }\n                }\n                Err(e) =\u003e {\n                    tracing::warn!(\"Failed to load items: {}\", e);\n                }\n            }\n        }\n        Err(e) =\u003e {\n            tracing::warn!(\"Failed to lock item bank: {}\", e);\n        }\n    }\n}\n\n/// Search items in the database\nfn search_items(list: \u0026ListBox, item_bank: \u0026Arc\u003cMutex\u003cItemBank\u003e\u003e, query: \u0026str) {\n    // Clear existing items\n    while let Some(row) = list.first_child() {\n        list.remove(\u0026row);\n    }\n\n    // Search items\n    match item_bank.lock() {\n        Ok(bank) =\u003e {\n            match bank.search_items(query) {\n                Ok(items) =\u003e {\n                    for item in items {\n                        let row_label = format!(\n                            \"{}\\n{}\",\n                            item.title,\n                            item.difficulty.as_str()\n                        );\n                        let row = ListBoxRow::new();\n                        let label = Label::new(Some(\u0026row_label));\n                        label.set_wrap(true);\n                        label.set_margin_top(6);\n                        label.set_margin_bottom(6);\n                        label.set_margin_start(6);\n                        label.set_margin_end(6);\n                        label.set_halign(gtk4::Align::Start);\n                        row.set_child(Some(\u0026label));\n                        list.insert(\u0026row, -1);\n                    }\n                }\n                Err(e) =\u003e {\n                    tracing::warn!(\"Search failed: {}\", e);\n                }\n            }\n        }\n        Err(e) =\u003e {\n            tracing::warn!(\"Failed to lock item bank: {}\", e);\n        }\n    }\n}\n","traces":[{"line":16,"address":[],"length":0,"stats":{"Line":0}},{"line":20,"address":[],"length":0,"stats":{"Line":0}},{"line":21,"address":[],"length":0,"stats":{"Line":0}},{"line":22,"address":[],"length":0,"stats":{"Line":0}},{"line":23,"address":[],"length":0,"stats":{"Line":0}},{"line":24,"address":[],"length":0,"stats":{"Line":0}},{"line":27,"address":[],"length":0,"stats":{"Line":0}},{"line":28,"address":[],"length":0,"stats":{"Line":0}},{"line":29,"address":[],"length":0,"stats":{"Line":0}},{"line":32,"address":[],"length":0,"stats":{"Line":0}},{"line":33,"address":[],"length":0,"stats":{"Line":0}},{"line":35,"address":[],"length":0,"stats":{"Line":0}},{"line":36,"address":[],"length":0,"stats":{"Line":0}},{"line":37,"address":[],"length":0,"stats":{"Line":0}},{"line":38,"address":[],"length":0,"stats":{"Line":0}},{"line":39,"address":[],"length":0,"stats":{"Line":0}},{"line":41,"address":[],"length":0,"stats":{"Line":0}},{"line":42,"address":[],"length":0,"stats":{"Line":0}},{"line":43,"address":[],"length":0,"stats":{"Line":0}},{"line":44,"address":[],"length":0,"stats":{"Line":0}},{"line":46,"address":[],"length":0,"stats":{"Line":0}},{"line":49,"address":[],"length":0,"stats":{"Line":0}},{"line":50,"address":[],"length":0,"stats":{"Line":0}},{"line":51,"address":[],"length":0,"stats":{"Line":0}},{"line":52,"address":[],"length":0,"stats":{"Line":0}},{"line":55,"address":[],"length":0,"stats":{"Line":0}},{"line":56,"address":[],"length":0,"stats":{"Line":0}},{"line":57,"address":[],"length":0,"stats":{"Line":0}},{"line":58,"address":[],"length":0,"stats":{"Line":0}},{"line":59,"address":[],"length":0,"stats":{"Line":0}},{"line":62,"address":[],"length":0,"stats":{"Line":0}},{"line":65,"address":[],"length":0,"stats":{"Line":0}},{"line":66,"address":[],"length":0,"stats":{"Line":0}},{"line":67,"address":[],"length":0,"stats":{"Line":0}},{"line":68,"address":[],"length":0,"stats":{"Line":0}},{"line":69,"address":[],"length":0,"stats":{"Line":0}},{"line":70,"address":[],"length":0,"stats":{"Line":0}},{"line":72,"address":[],"length":0,"stats":{"Line":0}},{"line":85,"address":[],"length":0,"stats":{"Line":0}},{"line":87,"address":[],"length":0,"stats":{"Line":0}},{"line":88,"address":[],"length":0,"stats":{"Line":0}},{"line":92,"address":[],"length":0,"stats":{"Line":0}},{"line":93,"address":[],"length":0,"stats":{"Line":0}},{"line":94,"address":[],"length":0,"stats":{"Line":0}},{"line":95,"address":[],"length":0,"stats":{"Line":0}},{"line":96,"address":[],"length":0,"stats":{"Line":0}},{"line":97,"address":[],"length":0,"stats":{"Line":0}},{"line":99,"address":[],"length":0,"stats":{"Line":0}},{"line":100,"address":[],"length":0,"stats":{"Line":0}},{"line":102,"address":[],"length":0,"stats":{"Line":0}},{"line":103,"address":[],"length":0,"stats":{"Line":0}},{"line":104,"address":[],"length":0,"stats":{"Line":0}},{"line":105,"address":[],"length":0,"stats":{"Line":0}},{"line":106,"address":[],"length":0,"stats":{"Line":0}},{"line":107,"address":[],"length":0,"stats":{"Line":0}},{"line":108,"address":[],"length":0,"stats":{"Line":0}},{"line":109,"address":[],"length":0,"stats":{"Line":0}},{"line":110,"address":[],"length":0,"stats":{"Line":0}},{"line":111,"address":[],"length":0,"stats":{"Line":0}},{"line":114,"address":[],"length":0,"stats":{"Line":0}},{"line":115,"address":[],"length":0,"stats":{"Line":0}},{"line":119,"address":[],"length":0,"stats":{"Line":0}},{"line":120,"address":[],"length":0,"stats":{"Line":0}},{"line":126,"address":[],"length":0,"stats":{"Line":0}},{"line":128,"address":[],"length":0,"stats":{"Line":0}},{"line":129,"address":[],"length":0,"stats":{"Line":0}},{"line":133,"address":[],"length":0,"stats":{"Line":0}},{"line":134,"address":[],"length":0,"stats":{"Line":0}},{"line":135,"address":[],"length":0,"stats":{"Line":0}},{"line":136,"address":[],"length":0,"stats":{"Line":0}},{"line":137,"address":[],"length":0,"stats":{"Line":0}},{"line":138,"address":[],"length":0,"stats":{"Line":0}},{"line":140,"address":[],"length":0,"stats":{"Line":0}},{"line":141,"address":[],"length":0,"stats":{"Line":0}},{"line":143,"address":[],"length":0,"stats":{"Line":0}},{"line":144,"address":[],"length":0,"stats":{"Line":0}},{"line":145,"address":[],"length":0,"stats":{"Line":0}},{"line":146,"address":[],"length":0,"stats":{"Line":0}},{"line":147,"address":[],"length":0,"stats":{"Line":0}},{"line":148,"address":[],"length":0,"stats":{"Line":0}},{"line":149,"address":[],"length":0,"stats":{"Line":0}},{"line":150,"address":[],"length":0,"stats":{"Line":0}},{"line":151,"address":[],"length":0,"stats":{"Line":0}},{"line":152,"address":[],"length":0,"stats":{"Line":0}},{"line":155,"address":[],"length":0,"stats":{"Line":0}},{"line":156,"address":[],"length":0,"stats":{"Line":0}},{"line":160,"address":[],"length":0,"stats":{"Line":0}},{"line":161,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":88},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","ui","src","panels","layer_dnd.rs"],"content":"//! Layer panel drag-and-drop and layer management functionality\n//!\n//! Implements layer reordering through context menus and keyboard shortcuts\n\nuse gtk4::prelude::*;\nuse gtk4::{Box as GtkBox, CheckButton, Label, Orientation};\nuse uuid::Uuid;\n\nuse crate::app::AppState;\nuse crate::canvas::CanvasView;\n\n/// Layer item with reordering support\npub struct DraggableLayerItem {\n    pub container: GtkBox,\n    pub element_id: Uuid,\n}\n\nimpl DraggableLayerItem {\n    /// Create a layer item with selection and context menu support\n    pub fn new(\n        element_id: Uuid,\n        _name: \u0026str,\n        type_label: \u0026str,\n        index: usize,\n        _app_state: AppState,\n        _canvas_view: \u0026CanvasView,\n    ) -\u003e Self {\n        let container = GtkBox::new(Orientation::Horizontal, 8);\n        container.add_css_class(\"layer-item\");\n        container.add_css_class(\"draggable-layer\");\n        container.set_margin_start(8);\n        container.set_margin_end(8);\n        container.set_margin_top(4);\n        container.set_margin_bottom(4);\n        container.set_halign(gtk4::Align::Fill);\n        container.set_hexpand(true);\n\n        // Visibility toggle button\n        let visibility_btn = CheckButton::new();\n        visibility_btn.set_active(true);\n        visibility_btn.set_width_request(24);\n        visibility_btn.set_tooltip_text(Some(\"Toggle visibility\"));\n        container.append(\u0026visibility_btn);\n\n        // Layer info\n        let label_box = GtkBox::new(Orientation::Vertical, 2);\n        label_box.set_hexpand(true);\n\n        let type_label_widget = Label::new(Some(type_label));\n        type_label_widget.set_halign(gtk4::Align::Start);\n        type_label_widget.add_css_class(\"monospace\");\n        label_box.append(\u0026type_label_widget);\n\n        let index_label = Label::new(Some(\u0026format!(\"Layer {}\", index + 1)));\n        index_label.set_halign(gtk4::Align::Start);\n        index_label.add_css_class(\"dim-label\");\n        index_label.add_css_class(\"small-text\");\n        label_box.append(\u0026index_label);\n\n        container.append(\u0026label_box);\n\n        // Spacer\n        let spacer = GtkBox::new(Orientation::Horizontal, 0);\n        spacer.set_hexpand(true);\n        container.append(\u0026spacer);\n\n        DraggableLayerItem {\n            container,\n            element_id,\n        }\n    }\n}\n\n/// Build draggable layers list with context menu support\npub fn build_draggable_layers_list(\n    elements: \u0026[testruct_core::document::DocumentElement],\n    app_state: AppState,\n    canvas_view: \u0026CanvasView,\n) -\u003e GtkBox {\n    let container = GtkBox::new(Orientation::Vertical, 1);\n    container.set_vexpand(true);\n    container.set_hexpand(true);\n\n    // Iterate through elements in reverse order (bottom to top visually)\n    for (index, element) in elements.iter().enumerate().rev() {\n        let (type_label, _name) = get_element_info(element);\n\n        let layer_item = DraggableLayerItem::new(\n            element.id(),\n            \u0026_name,\n            \u0026type_label,\n            index,\n            app_state.clone(),\n            canvas_view,\n        );\n\n        container.append(\u0026layer_item.container);\n    }\n\n    container\n}\n\n/// Get element type and name\nfn get_element_info(element: \u0026testruct_core::document::DocumentElement) -\u003e (String, String) {\n    match element {\n        testruct_core::document::DocumentElement::Text(text) =\u003e {\n            let content = if text.content.len() \u003e 15 {\n                format!(\"{}...\", \u0026text.content[..15])\n            } else {\n                text.content.clone()\n            };\n            (format!(\"Text: {}\", content), format!(\"Text: {}\", content))\n        }\n        testruct_core::document::DocumentElement::Image(_) =\u003e {\n            (\"Image\".to_string(), \"Image\".to_string())\n        }\n        testruct_core::document::DocumentElement::Shape(shape) =\u003e {\n            let shape_type = match shape.kind {\n                testruct_core::document::ShapeKind::Rectangle =\u003e \"Rectangle\",\n                testruct_core::document::ShapeKind::Ellipse =\u003e \"Ellipse\",\n                testruct_core::document::ShapeKind::Line =\u003e \"Line\",\n                testruct_core::document::ShapeKind::Arrow =\u003e \"Arrow\",\n                testruct_core::document::ShapeKind::Polygon =\u003e \"Polygon\",\n            };\n            (shape_type.to_string(), shape_type.to_string())\n        }\n        testruct_core::document::DocumentElement::Frame(_) =\u003e {\n            (\"Frame\".to_string(), \"Frame\".to_string())\n        }\n    }\n}\n\n/// Reorder elements in a layer (move up or down)\npub fn reorder_layer(\n    app_state: \u0026AppState,\n    element_id: Uuid,\n    direction: LayerDirection,\n    drawing_area: gtk4::DrawingArea,\n) -\u003e bool {\n    let mut result = false;\n    app_state.with_active_document(|doc| {\n        if let Some(page) = doc.pages.first_mut() {\n            if let Some(idx) = page.elements.iter().position(|e| e.id() == element_id) {\n                match direction {\n                    LayerDirection::Up =\u003e {\n                        if idx \u003c page.elements.len() - 1 {\n                            page.elements.swap(idx, idx + 1);\n                            drawing_area.queue_draw();\n                            tracing::info!(\" Layer moved up\");\n                            result = true;\n                        }\n                    }\n                    LayerDirection::Down =\u003e {\n                        if idx \u003e 0 {\n                            page.elements.swap(idx, idx - 1);\n                            drawing_area.queue_draw();\n                            tracing::info!(\" Layer moved down\");\n                            result = true;\n                        }\n                    }\n                }\n            }\n        }\n    });\n    result\n}\n\n/// Layer reordering direction\n#[derive(Clone, Copy, Debug)]\npub enum LayerDirection {\n    Up,\n    Down,\n}\n","traces":[{"line":20,"address":[],"length":0,"stats":{"Line":0}},{"line":28,"address":[],"length":0,"stats":{"Line":0}},{"line":29,"address":[],"length":0,"stats":{"Line":0}},{"line":30,"address":[],"length":0,"stats":{"Line":0}},{"line":31,"address":[],"length":0,"stats":{"Line":0}},{"line":32,"address":[],"length":0,"stats":{"Line":0}},{"line":33,"address":[],"length":0,"stats":{"Line":0}},{"line":34,"address":[],"length":0,"stats":{"Line":0}},{"line":35,"address":[],"length":0,"stats":{"Line":0}},{"line":36,"address":[],"length":0,"stats":{"Line":0}},{"line":39,"address":[],"length":0,"stats":{"Line":0}},{"line":40,"address":[],"length":0,"stats":{"Line":0}},{"line":41,"address":[],"length":0,"stats":{"Line":0}},{"line":42,"address":[],"length":0,"stats":{"Line":0}},{"line":43,"address":[],"length":0,"stats":{"Line":0}},{"line":46,"address":[],"length":0,"stats":{"Line":0}},{"line":47,"address":[],"length":0,"stats":{"Line":0}},{"line":49,"address":[],"length":0,"stats":{"Line":0}},{"line":50,"address":[],"length":0,"stats":{"Line":0}},{"line":51,"address":[],"length":0,"stats":{"Line":0}},{"line":52,"address":[],"length":0,"stats":{"Line":0}},{"line":54,"address":[],"length":0,"stats":{"Line":0}},{"line":55,"address":[],"length":0,"stats":{"Line":0}},{"line":56,"address":[],"length":0,"stats":{"Line":0}},{"line":57,"address":[],"length":0,"stats":{"Line":0}},{"line":58,"address":[],"length":0,"stats":{"Line":0}},{"line":60,"address":[],"length":0,"stats":{"Line":0}},{"line":63,"address":[],"length":0,"stats":{"Line":0}},{"line":64,"address":[],"length":0,"stats":{"Line":0}},{"line":65,"address":[],"length":0,"stats":{"Line":0}},{"line":75,"address":[],"length":0,"stats":{"Line":0}},{"line":80,"address":[],"length":0,"stats":{"Line":0}},{"line":81,"address":[],"length":0,"stats":{"Line":0}},{"line":82,"address":[],"length":0,"stats":{"Line":0}},{"line":85,"address":[],"length":0,"stats":{"Line":0}},{"line":86,"address":[],"length":0,"stats":{"Line":0}},{"line":89,"address":[],"length":0,"stats":{"Line":0}},{"line":90,"address":[],"length":0,"stats":{"Line":0}},{"line":91,"address":[],"length":0,"stats":{"Line":0}},{"line":92,"address":[],"length":0,"stats":{"Line":0}},{"line":93,"address":[],"length":0,"stats":{"Line":0}},{"line":94,"address":[],"length":0,"stats":{"Line":0}},{"line":97,"address":[],"length":0,"stats":{"Line":0}},{"line":100,"address":[],"length":0,"stats":{"Line":0}},{"line":104,"address":[],"length":0,"stats":{"Line":0}},{"line":105,"address":[],"length":0,"stats":{"Line":0}},{"line":106,"address":[],"length":0,"stats":{"Line":0}},{"line":107,"address":[],"length":0,"stats":{"Line":0}},{"line":108,"address":[],"length":0,"stats":{"Line":0}},{"line":110,"address":[],"length":0,"stats":{"Line":0}},{"line":112,"address":[],"length":0,"stats":{"Line":0}},{"line":115,"address":[],"length":0,"stats":{"Line":0}},{"line":117,"address":[],"length":0,"stats":{"Line":0}},{"line":118,"address":[],"length":0,"stats":{"Line":0}},{"line":119,"address":[],"length":0,"stats":{"Line":0}},{"line":120,"address":[],"length":0,"stats":{"Line":0}},{"line":121,"address":[],"length":0,"stats":{"Line":0}},{"line":122,"address":[],"length":0,"stats":{"Line":0}},{"line":123,"address":[],"length":0,"stats":{"Line":0}},{"line":125,"address":[],"length":0,"stats":{"Line":0}},{"line":128,"address":[],"length":0,"stats":{"Line":0}},{"line":134,"address":[],"length":0,"stats":{"Line":0}},{"line":140,"address":[],"length":0,"stats":{"Line":0}},{"line":141,"address":[],"length":0,"stats":{"Line":0}},{"line":142,"address":[],"length":0,"stats":{"Line":0}},{"line":143,"address":[],"length":0,"stats":{"Line":0}},{"line":144,"address":[],"length":0,"stats":{"Line":0}},{"line":146,"address":[],"length":0,"stats":{"Line":0}},{"line":147,"address":[],"length":0,"stats":{"Line":0}},{"line":148,"address":[],"length":0,"stats":{"Line":0}},{"line":149,"address":[],"length":0,"stats":{"Line":0}},{"line":150,"address":[],"length":0,"stats":{"Line":0}},{"line":154,"address":[],"length":0,"stats":{"Line":0}},{"line":155,"address":[],"length":0,"stats":{"Line":0}},{"line":156,"address":[],"length":0,"stats":{"Line":0}},{"line":157,"address":[],"length":0,"stats":{"Line":0}},{"line":158,"address":[],"length":0,"stats":{"Line":0}},{"line":165,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":78},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","ui","src","panels","layers.rs"],"content":"use gtk4::{prelude::*, Box as GtkBox, Label, Orientation, ScrolledWindow, CheckButton};\n\n/// Represents a single layer item in the layers panel\n#[derive(Clone)]\npub struct LayerItem {\n    pub id: uuid::Uuid,\n    pub name: String,\n    pub visible: bool,\n    pub layer_type: String, // \"Text\", \"Image\", \"Shape\", \"Frame\"\n}\n\n/// Build the layer panel with scrolled content\npub fn build_layer_panel() -\u003e ScrolledWindow {\n    let scrolled = ScrolledWindow::new();\n    scrolled.set_vexpand(true);\n    scrolled.set_hexpand(false);\n    scrolled.set_width_request(240);\n\n    // Create a placeholder label\n    let placeholder = Label::new(Some(\"No layers\"));\n    placeholder.set_margin_top(20);\n    placeholder.set_margin_bottom(20);\n    placeholder.add_css_class(\"dim-label\");\n\n    scrolled.set_child(Some(\u0026placeholder));\n    scrolled\n}\n\n/// Build a layers list from document elements\npub fn build_layers_list(elements: \u0026[testruct_core::document::DocumentElement]) -\u003e GtkBox {\n    let container = GtkBox::new(Orientation::Vertical, 1);\n    container.set_vexpand(true);\n    container.set_hexpand(true);\n\n    // Iterate through elements in reverse order (bottom to top visually)\n    for (index, element) in elements.iter().enumerate().rev() {\n        let layer_item = create_layer_item(element, index);\n        container.append(\u0026layer_item);\n    }\n\n    container\n}\n\n/// Create a single layer item widget\nfn create_layer_item(element: \u0026testruct_core::document::DocumentElement, index: usize) -\u003e GtkBox {\n    let item_box = GtkBox::new(Orientation::Horizontal, 8);\n    item_box.add_css_class(\"layer-item\");\n    item_box.set_margin_start(8);\n    item_box.set_margin_end(8);\n    item_box.set_margin_top(4);\n    item_box.set_margin_bottom(4);\n    item_box.set_halign(gtk4::Align::Fill);\n    item_box.set_hexpand(true);\n\n    // Create visibility toggle\n    let visibility_btn = CheckButton::new();\n    visibility_btn.set_active(true);\n    visibility_btn.set_width_request(24);\n    visibility_btn.set_tooltip_text(Some(\"Toggle visibility\"));\n    item_box.append(\u0026visibility_btn);\n\n    // Get element type and name\n    let (_type_name, type_label) = match element {\n        testruct_core::document::DocumentElement::Text(text) =\u003e (\n            \"Text\",\n            format!(\"Text: {}\", if text.content.len() \u003e 15 {\n                format!(\"{}...\", \u0026text.content[..15])\n            } else {\n                text.content.clone()\n            }),\n        ),\n        testruct_core::document::DocumentElement::Image(_) =\u003e (\n            \"Image\",\n            \"Image\".to_string(),\n        ),\n        testruct_core::document::DocumentElement::Shape(shape) =\u003e {\n            let shape_type = match shape.kind {\n                testruct_core::document::ShapeKind::Rectangle =\u003e \"Rectangle\",\n                testruct_core::document::ShapeKind::Ellipse =\u003e \"Ellipse\",\n                testruct_core::document::ShapeKind::Line =\u003e \"Line\",\n                testruct_core::document::ShapeKind::Arrow =\u003e \"Arrow\",\n                testruct_core::document::ShapeKind::Polygon =\u003e \"Polygon\",\n            };\n            (\"Shape\", shape_type.to_string())\n        },\n        testruct_core::document::DocumentElement::Frame(_) =\u003e (\n            \"Frame\",\n            \"Frame\".to_string(),\n        ),\n    };\n\n    // Create element label\n    let label_box = GtkBox::new(Orientation::Vertical, 2);\n    label_box.set_hexpand(true);\n\n    let type_label_widget = Label::new(Some(\u0026type_label));\n    type_label_widget.set_halign(gtk4::Align::Start);\n    type_label_widget.add_css_class(\"monospace\");\n    label_box.append(\u0026type_label_widget);\n\n    let index_label = Label::new(Some(\u0026format!(\"Layer {}\", index + 1)));\n    index_label.set_halign(gtk4::Align::Start);\n    index_label.add_css_class(\"dim-label\");\n    index_label.add_css_class(\"small-text\");\n    label_box.append(\u0026index_label);\n\n    item_box.append(\u0026label_box);\n\n    // Add a spacer to push the visibility button to the right\n    let spacer = GtkBox::new(Orientation::Horizontal, 0);\n    spacer.set_hexpand(true);\n    item_box.append(\u0026spacer);\n\n    item_box\n}\n","traces":[{"line":13,"address":[],"length":0,"stats":{"Line":0}},{"line":14,"address":[],"length":0,"stats":{"Line":0}},{"line":15,"address":[],"length":0,"stats":{"Line":0}},{"line":16,"address":[],"length":0,"stats":{"Line":0}},{"line":17,"address":[],"length":0,"stats":{"Line":0}},{"line":20,"address":[],"length":0,"stats":{"Line":0}},{"line":21,"address":[],"length":0,"stats":{"Line":0}},{"line":22,"address":[],"length":0,"stats":{"Line":0}},{"line":23,"address":[],"length":0,"stats":{"Line":0}},{"line":25,"address":[],"length":0,"stats":{"Line":0}},{"line":26,"address":[],"length":0,"stats":{"Line":0}},{"line":30,"address":[],"length":0,"stats":{"Line":0}},{"line":31,"address":[],"length":0,"stats":{"Line":0}},{"line":32,"address":[],"length":0,"stats":{"Line":0}},{"line":33,"address":[],"length":0,"stats":{"Line":0}},{"line":36,"address":[],"length":0,"stats":{"Line":0}},{"line":37,"address":[],"length":0,"stats":{"Line":0}},{"line":38,"address":[],"length":0,"stats":{"Line":0}},{"line":41,"address":[],"length":0,"stats":{"Line":0}},{"line":45,"address":[],"length":0,"stats":{"Line":0}},{"line":46,"address":[],"length":0,"stats":{"Line":0}},{"line":47,"address":[],"length":0,"stats":{"Line":0}},{"line":48,"address":[],"length":0,"stats":{"Line":0}},{"line":49,"address":[],"length":0,"stats":{"Line":0}},{"line":50,"address":[],"length":0,"stats":{"Line":0}},{"line":51,"address":[],"length":0,"stats":{"Line":0}},{"line":52,"address":[],"length":0,"stats":{"Line":0}},{"line":53,"address":[],"length":0,"stats":{"Line":0}},{"line":56,"address":[],"length":0,"stats":{"Line":0}},{"line":57,"address":[],"length":0,"stats":{"Line":0}},{"line":58,"address":[],"length":0,"stats":{"Line":0}},{"line":59,"address":[],"length":0,"stats":{"Line":0}},{"line":60,"address":[],"length":0,"stats":{"Line":0}},{"line":63,"address":[],"length":0,"stats":{"Line":0}},{"line":64,"address":[],"length":0,"stats":{"Line":0}},{"line":66,"address":[],"length":0,"stats":{"Line":0}},{"line":67,"address":[],"length":0,"stats":{"Line":0}},{"line":69,"address":[],"length":0,"stats":{"Line":0}},{"line":72,"address":[],"length":0,"stats":{"Line":0}},{"line":73,"address":[],"length":0,"stats":{"Line":0}},{"line":74,"address":[],"length":0,"stats":{"Line":0}},{"line":76,"address":[],"length":0,"stats":{"Line":0}},{"line":77,"address":[],"length":0,"stats":{"Line":0}},{"line":78,"address":[],"length":0,"stats":{"Line":0}},{"line":79,"address":[],"length":0,"stats":{"Line":0}},{"line":80,"address":[],"length":0,"stats":{"Line":0}},{"line":81,"address":[],"length":0,"stats":{"Line":0}},{"line":82,"address":[],"length":0,"stats":{"Line":0}},{"line":84,"address":[],"length":0,"stats":{"Line":0}},{"line":86,"address":[],"length":0,"stats":{"Line":0}},{"line":87,"address":[],"length":0,"stats":{"Line":0}},{"line":88,"address":[],"length":0,"stats":{"Line":0}},{"line":93,"address":[],"length":0,"stats":{"Line":0}},{"line":94,"address":[],"length":0,"stats":{"Line":0}},{"line":96,"address":[],"length":0,"stats":{"Line":0}},{"line":97,"address":[],"length":0,"stats":{"Line":0}},{"line":98,"address":[],"length":0,"stats":{"Line":0}},{"line":99,"address":[],"length":0,"stats":{"Line":0}},{"line":101,"address":[],"length":0,"stats":{"Line":0}},{"line":102,"address":[],"length":0,"stats":{"Line":0}},{"line":103,"address":[],"length":0,"stats":{"Line":0}},{"line":104,"address":[],"length":0,"stats":{"Line":0}},{"line":105,"address":[],"length":0,"stats":{"Line":0}},{"line":107,"address":[],"length":0,"stats":{"Line":0}},{"line":110,"address":[],"length":0,"stats":{"Line":0}},{"line":111,"address":[],"length":0,"stats":{"Line":0}},{"line":112,"address":[],"length":0,"stats":{"Line":0}},{"line":114,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":68},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","ui","src","panels","mod.rs"],"content":"mod layers;\nmod properties;\nmod item_library;\npub mod property_handlers;\npub mod layer_dnd;\n\npub use layers::{build_layer_panel, build_layers_list, LayerItem};\npub use properties::{build_property_panel, build_property_panel_with_components, PropertyPanelComponents};\npub use item_library::{build_item_library_panel, ItemLibraryComponents};\npub use property_handlers::wire_property_signals;\npub use layer_dnd::{DraggableLayerItem, build_draggable_layers_list, LayerDirection, reorder_layer};\n","traces":[],"covered":0,"coverable":0},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","ui","src","panels","properties.rs"],"content":"//! Property panel UI for editing object properties\n//!\n//! Provides a comprehensive property panel with sections for typography,\n//! border styles, layer ordering, alignment, grouping, and shape styling.\n\nuse gtk4::prelude::*;\nuse gtk4::{\n    Adjustment, Box as GtkBox, Button, DropDown, Label, Orientation, Scale, ScrolledWindow,\n    SpinButton, Switch,\n};\n\n/// UI components created during property panel setup\npub struct PropertyPanelComponents {\n    pub scrolled_window: ScrolledWindow,\n    pub container: GtkBox,\n    pub font_family_combo: DropDown,\n    pub font_size_spin: SpinButton,\n    pub line_height_scale: Scale,\n    pub text_align_combo: DropDown,\n    pub border_style_combo: DropDown,\n    pub auto_resize_switch: Switch,\n    pub fill_color_button: Button,\n    pub stroke_color_button: Button,\n    pub stroke_width_spin: SpinButton,\n    pub group_status_label: Label,\n    pub group_name_entry: gtk4::Entry,\n    pub ungroup_btn: Button,\n    pub bring_to_front_btn: Button,\n    pub bring_forward_btn: Button,\n    pub send_to_back_btn: Button,\n    pub send_backward_btn: Button,\n    pub align_left_btn: Button,\n    pub align_center_h_btn: Button,\n    pub align_right_btn: Button,\n    pub align_top_btn: Button,\n    pub align_center_v_btn: Button,\n    pub align_bottom_btn: Button,\n}\n\n/// Build the property panel as a GtkBox for compatibility\npub fn build_property_panel() -\u003e GtkBox {\n    let components = build_property_panel_components();\n    components.container.upcast()\n}\n\n/// Build the property panel and return both the box and the button components\npub fn build_property_panel_with_components() -\u003e (GtkBox, PropertyPanelComponents) {\n    let components = build_property_panel_components();\n    (components.container.clone().upcast(), components)\n}\n\n/// Build the complete property panel with all components\nfn build_property_panel_components() -\u003e PropertyPanelComponents {\n    // Create scrolled window for the panel content\n    let scrolled_window = ScrolledWindow::new();\n    scrolled_window.set_vexpand(true);\n    scrolled_window.set_hexpand(false);\n\n    let container = GtkBox::new(Orientation::Vertical, 10);\n    container.set_margin_start(10);\n    container.set_margin_end(10);\n    container.set_margin_top(10);\n    container.set_margin_bottom(10);\n    container.set_width_request(320);\n\n    // Title section\n    build_title_section(\u0026container);\n\n    // Typography section\n    let (font_family_combo, font_size_spin, line_height_scale, text_align_combo) =\n        build_typography_section(\u0026container);\n\n    // Text options section\n    let auto_resize_switch = build_text_options_section(\u0026container);\n\n    // Border section\n    let border_style_combo = build_border_section(\u0026container);\n\n    // Layer section\n    let (bring_to_front_btn, bring_forward_btn, send_to_back_btn, send_backward_btn) =\n        build_layer_section(\u0026container);\n\n    // Alignment section\n    let (align_left_btn, align_center_h_btn, align_right_btn, align_top_btn, align_center_v_btn, align_bottom_btn) =\n        build_alignment_section(\u0026container);\n\n    // Group section\n    let (group_status_label, group_name_entry, ungroup_btn) = build_group_section(\u0026container);\n\n    // Shape styling section\n    let (fill_color_button, stroke_color_button, stroke_width_spin) =\n        build_shape_styling_section(\u0026container);\n\n    // Set the container as the child of scrolled window\n    scrolled_window.set_child(Some(\u0026container));\n\n    PropertyPanelComponents {\n        scrolled_window,\n        container,\n        font_family_combo,\n        font_size_spin,\n        line_height_scale,\n        text_align_combo,\n        border_style_combo,\n        auto_resize_switch,\n        fill_color_button,\n        stroke_color_button,\n        stroke_width_spin,\n        group_status_label,\n        group_name_entry,\n        ungroup_btn,\n        bring_to_front_btn,\n        bring_forward_btn,\n        send_to_back_btn,\n        send_backward_btn,\n        align_left_btn,\n        align_center_h_btn,\n        align_right_btn,\n        align_top_btn,\n        align_center_v_btn,\n        align_bottom_btn,\n    }\n}\n\n/// Build title section with separator\nfn build_title_section(container: \u0026GtkBox) {\n    let title_box = GtkBox::new(Orientation::Vertical, 0);\n    let title = Label::new(Some(\"\"));\n    title.add_css_class(\"title-3\");\n    title.set_halign(gtk4::Align::Start);\n    title.set_margin_start(12);\n    title.set_margin_top(12);\n    title.set_margin_bottom(8);\n    title_box.append(\u0026title);\n\n    let separator = gtk4::Separator::new(Orientation::Horizontal);\n    title_box.append(\u0026separator);\n\n    container.append(\u0026title_box);\n}\n\n/// Build typography section (font family, size, line height, text alignment)\nfn build_typography_section(\n    container: \u0026GtkBox,\n) -\u003e (DropDown, SpinButton, Scale, DropDown) {\n    // Header\n    let typo_header = GtkBox::new(Orientation::Horizontal, 8);\n    typo_header.set_margin_start(12);\n    typo_header.set_margin_top(12);\n\n    let typo_icon = Label::new(Some(\"\"));\n    typo_icon.add_css_class(\"section-icon\");\n\n    let typo_label = Label::new(Some(\"\"));\n    typo_label.add_css_class(\"section-heading\");\n    typo_label.set_halign(gtk4::Align::Start);\n\n    typo_header.append(\u0026typo_icon);\n    typo_header.append(\u0026typo_label);\n    container.append(\u0026typo_header);\n\n    // Font Family\n    let font_section = GtkBox::new(Orientation::Vertical, 5);\n    font_section.set_margin_start(12);\n    font_section.set_margin_end(12);\n\n    let font_label = Label::new(Some(\"\"));\n    font_label.set_xalign(0.0);\n    font_label.add_css_class(\"property-label\");\n    font_section.append(\u0026font_label);\n\n    let font_family_combo = DropDown::from_strings(\u0026[\n        \"Noto Sans JP\",\n        \"Noto Serif JP\",\n        \"Noto Sans\",\n        \"Noto Serif\",\n        \"Noto Sans Mono\",\n        \"Arial\",\n        \"Times New Roman\",\n        \"Courier New\",\n        \"Georgia\",\n        \"Verdana\",\n        \"Helvetica\",\n        \"Liberation Mono\",\n        \"DejaVu Sans Mono\",\n    ]);\n    font_family_combo.set_selected(0); // Default to Noto Sans JP\n    font_section.append(\u0026font_family_combo);\n    container.append(\u0026font_section);\n\n    // Font Size\n    let size_section = GtkBox::new(Orientation::Vertical, 5);\n    size_section.set_margin_start(12);\n    size_section.set_margin_end(12);\n\n    let size_label = Label::new(Some(\"\"));\n    size_label.set_xalign(0.0);\n    size_label.add_css_class(\"property-label\");\n    size_section.append(\u0026size_label);\n\n    let size_adj = Adjustment::new(11.0, 6.0, 72.0, 1.0, 5.0, 0.0);\n    let font_size_spin = SpinButton::new(Some(\u0026size_adj), 1.0, 1);\n    size_section.append(\u0026font_size_spin);\n    container.append(\u0026size_section);\n\n    // Line Height\n    let line_height_section = GtkBox::new(Orientation::Vertical, 5);\n    let line_height_label = Label::new(Some(\"\"));\n    line_height_label.set_xalign(0.0);\n    line_height_label.add_css_class(\"heading\");\n    line_height_section.append(\u0026line_height_label);\n\n    let line_height_adj = Adjustment::new(1.4, 1.0, 3.0, 0.1, 0.5, 0.0);\n    let line_height_scale = Scale::new(gtk4::Orientation::Horizontal, Some(\u0026line_height_adj));\n    line_height_scale.set_digits(1);\n    line_height_scale.set_value_pos(gtk4::PositionType::Right);\n    line_height_section.append(\u0026line_height_scale);\n    container.append(\u0026line_height_section);\n\n    // Text Alignment\n    let align_section = GtkBox::new(Orientation::Vertical, 5);\n    let align_label = Label::new(Some(\"\"));\n    align_label.set_xalign(0.0);\n    align_label.add_css_class(\"heading\");\n    align_section.append(\u0026align_label);\n\n    let text_align_combo = DropDown::from_strings(\u0026[\n        \"\",\n        \"\",\n        \"\",\n        \"\",\n    ]);\n    text_align_combo.set_selected(0); // Default to left alignment\n    align_section.append(\u0026text_align_combo);\n    container.append(\u0026align_section);\n\n    (font_family_combo, font_size_spin, line_height_scale, text_align_combo)\n}\n\n/// Build text options section (auto-resize)\nfn build_text_options_section(container: \u0026GtkBox) -\u003e Switch {\n    let text_options_header = GtkBox::new(Orientation::Horizontal, 8);\n    text_options_header.set_margin_start(12);\n    text_options_header.set_margin_top(12);\n\n    let text_options_icon = Label::new(Some(\"\"));\n    text_options_icon.add_css_class(\"section-icon\");\n\n    let text_options_label = Label::new(Some(\"\"));\n    text_options_label.add_css_class(\"section-heading\");\n    text_options_label.set_halign(gtk4::Align::Start);\n\n    text_options_header.append(\u0026text_options_icon);\n    text_options_header.append(\u0026text_options_label);\n    container.append(\u0026text_options_header);\n\n    let auto_resize_section = GtkBox::new(Orientation::Vertical, 5);\n    auto_resize_section.set_margin_start(12);\n    auto_resize_section.set_margin_end(12);\n\n    let auto_resize_box = GtkBox::new(Orientation::Horizontal, 8);\n    let auto_resize_label = Label::new(Some(\"\"));\n    auto_resize_label.set_xalign(0.0);\n    auto_resize_label.set_hexpand(true);\n    auto_resize_box.append(\u0026auto_resize_label);\n\n    let auto_resize_switch = Switch::new();\n    auto_resize_switch.set_active(false);\n    auto_resize_switch.set_halign(gtk4::Align::End);\n    auto_resize_box.append(\u0026auto_resize_switch);\n\n    auto_resize_section.append(\u0026auto_resize_box);\n    container.append(\u0026auto_resize_section);\n\n    auto_resize_switch\n}\n\n/// Build border section\nfn build_border_section(container: \u0026GtkBox) -\u003e DropDown {\n    let border_header = GtkBox::new(Orientation::Horizontal, 8);\n    border_header.set_margin_start(12);\n    border_header.set_margin_top(20);\n\n    let border_icon = Label::new(Some(\"\"));\n    border_icon.add_css_class(\"section-icon\");\n\n    let border_label = Label::new(Some(\"\"));\n    border_label.add_css_class(\"section-heading\");\n    border_label.set_halign(gtk4::Align::Start);\n\n    border_header.append(\u0026border_icon);\n    border_header.append(\u0026border_label);\n    container.append(\u0026border_header);\n\n    let border_section = GtkBox::new(Orientation::Vertical, 5);\n    border_section.set_margin_start(12);\n    border_section.set_margin_end(12);\n\n    let border_style_combo = DropDown::from_strings(\u0026[\n        \"\",\n        \"\",\n        \"\",\n    ]);\n    border_style_combo.set_selected(0); // Default to none\n    border_section.append(\u0026border_style_combo);\n    container.append(\u0026border_section);\n\n    border_style_combo\n}\n\n/// Build layer section with z-order buttons\nfn build_layer_section(container: \u0026GtkBox) -\u003e (Button, Button, Button, Button) {\n    let layer_header = GtkBox::new(Orientation::Horizontal, 8);\n    layer_header.set_margin_start(12);\n    layer_header.set_margin_top(20);\n\n    let layer_icon = Label::new(Some(\"\"));\n    layer_icon.add_css_class(\"section-icon\");\n\n    let layer_label = Label::new(Some(\"\"));\n    layer_label.add_css_class(\"section-heading\");\n    layer_label.set_halign(gtk4::Align::Start);\n\n    layer_header.append(\u0026layer_icon);\n    layer_header.append(\u0026layer_label);\n    container.append(\u0026layer_header);\n\n    let layer_buttons_box = GtkBox::new(Orientation::Vertical, 6);\n    layer_buttons_box.set_margin_start(12);\n    layer_buttons_box.set_margin_end(12);\n\n    let top_row = GtkBox::new(Orientation::Horizontal, 6);\n    top_row.set_homogeneous(true);\n\n    let bring_to_front_btn = Button::with_label(\"\");\n    bring_to_front_btn.set_tooltip_text(Some(\"Ctrl+Shift+]\"));\n    top_row.append(\u0026bring_to_front_btn);\n\n    let bring_forward_btn = Button::with_label(\"\");\n    bring_forward_btn.set_tooltip_text(Some(\"Ctrl+]\"));\n    top_row.append(\u0026bring_forward_btn);\n\n    layer_buttons_box.append(\u0026top_row);\n\n    let bottom_row = GtkBox::new(Orientation::Horizontal, 6);\n    bottom_row.set_homogeneous(true);\n\n    let send_to_back_btn = Button::with_label(\"\");\n    send_to_back_btn.set_tooltip_text(Some(\"Ctrl+Shift+[\"));\n    bottom_row.append(\u0026send_to_back_btn);\n\n    let send_backward_btn = Button::with_label(\"\");\n    send_backward_btn.set_tooltip_text(Some(\"Ctrl+[\"));\n    bottom_row.append(\u0026send_backward_btn);\n\n    layer_buttons_box.append(\u0026bottom_row);\n    container.append(\u0026layer_buttons_box);\n\n    (bring_to_front_btn, bring_forward_btn, send_to_back_btn, send_backward_btn)\n}\n\n/// Build alignment section with 6 alignment buttons\nfn build_alignment_section(\n    container: \u0026GtkBox,\n) -\u003e (Button, Button, Button, Button, Button, Button) {\n    let align_header = GtkBox::new(Orientation::Horizontal, 8);\n    align_header.set_margin_start(12);\n    align_header.set_margin_top(12);\n\n    let align_icon = Label::new(Some(\"\"));\n    align_icon.add_css_class(\"section-icon\");\n\n    let align_label = Label::new(Some(\"\"));\n    align_label.add_css_class(\"section-heading\");\n    align_label.set_halign(gtk4::Align::Start);\n\n    align_header.append(\u0026align_icon);\n    align_header.append(\u0026align_label);\n    container.append(\u0026align_header);\n\n    let align_buttons_box = GtkBox::new(Orientation::Vertical, 6);\n    align_buttons_box.set_margin_start(12);\n    align_buttons_box.set_margin_end(12);\n\n    let align_h_row = GtkBox::new(Orientation::Horizontal, 6);\n    align_h_row.set_homogeneous(true);\n\n    let align_left_btn = Button::with_label(\"\");\n    align_left_btn.set_tooltip_text(Some(\"\"));\n    align_h_row.append(\u0026align_left_btn);\n\n    let align_center_h_btn = Button::with_label(\"\\n()\");\n    align_center_h_btn.set_tooltip_text(Some(\"\"));\n    align_h_row.append(\u0026align_center_h_btn);\n\n    let align_right_btn = Button::with_label(\"\");\n    align_right_btn.set_tooltip_text(Some(\"\"));\n    align_h_row.append(\u0026align_right_btn);\n\n    align_buttons_box.append(\u0026align_h_row);\n\n    let align_v_row = GtkBox::new(Orientation::Horizontal, 6);\n    align_v_row.set_homogeneous(true);\n\n    let align_top_btn = Button::with_label(\"\");\n    align_top_btn.set_tooltip_text(Some(\"\"));\n    align_v_row.append(\u0026align_top_btn);\n\n    let align_center_v_btn = Button::with_label(\"\\n()\");\n    align_center_v_btn.set_tooltip_text(Some(\"\"));\n    align_v_row.append(\u0026align_center_v_btn);\n\n    let align_bottom_btn = Button::with_label(\"\");\n    align_bottom_btn.set_tooltip_text(Some(\"\"));\n    align_v_row.append(\u0026align_bottom_btn);\n\n    align_buttons_box.append(\u0026align_v_row);\n    container.append(\u0026align_buttons_box);\n\n    (align_left_btn, align_center_h_btn, align_right_btn, align_top_btn, align_center_v_btn, align_bottom_btn)\n}\n\n/// Build group section\nfn build_group_section(container: \u0026GtkBox) -\u003e (Label, gtk4::Entry, Button) {\n    let group_header = GtkBox::new(Orientation::Horizontal, 8);\n    group_header.set_margin_start(12);\n    group_header.set_margin_top(12);\n\n    let group_icon = Label::new(Some(\"\"));\n    group_icon.add_css_class(\"section-icon\");\n\n    let group_label = Label::new(Some(\"\"));\n    group_label.add_css_class(\"section-heading\");\n    group_label.set_halign(gtk4::Align::Start);\n\n    group_header.append(\u0026group_icon);\n    group_header.append(\u0026group_label);\n    container.append(\u0026group_header);\n\n    let group_info_section = GtkBox::new(Orientation::Vertical, 8);\n    group_info_section.set_margin_start(12);\n    group_info_section.set_margin_end(12);\n    group_info_section.set_margin_bottom(12);\n\n    let group_status_label = Label::new(Some(\"\"));\n    group_status_label.set_xalign(0.0);\n    group_status_label.add_css_class(\"dim-label\");\n    group_info_section.append(\u0026group_status_label);\n\n    let group_name_label = Label::new(Some(\"\"));\n    group_name_label.set_xalign(0.0);\n    group_name_label.add_css_class(\"property-label\");\n    group_info_section.append(\u0026group_name_label);\n\n    let group_name_entry = gtk4::Entry::new();\n    group_name_entry.set_placeholder_text(Some(\"...\"));\n    group_name_entry.set_sensitive(false);\n    group_info_section.append(\u0026group_name_entry);\n\n    let ungroup_btn = Button::with_label(\"\");\n    ungroup_btn.add_css_class(\"flat\");\n    ungroup_btn.set_sensitive(false);\n    group_info_section.append(\u0026ungroup_btn);\n\n    container.append(\u0026group_info_section);\n\n    (group_status_label, group_name_entry, ungroup_btn)\n}\n\n/// Build shape styling section (colors and stroke width)\nfn build_shape_styling_section(container: \u0026GtkBox) -\u003e (Button, Button, SpinButton) {\n    let shape_header = GtkBox::new(Orientation::Horizontal, 8);\n    shape_header.set_margin_start(12);\n    shape_header.set_margin_top(12);\n\n    let shape_icon = Label::new(Some(\"\"));\n    shape_icon.add_css_class(\"section-icon\");\n\n    let shape_label = Label::new(Some(\"\"));\n    shape_label.add_css_class(\"section-heading\");\n    shape_label.set_halign(gtk4::Align::Start);\n\n    shape_header.append(\u0026shape_icon);\n    shape_header.append(\u0026shape_label);\n    container.append(\u0026shape_header);\n\n    let shape_section = GtkBox::new(Orientation::Vertical, 8);\n    shape_section.set_margin_start(12);\n    shape_section.set_margin_end(12);\n\n    // Fill Color\n    let fill_color_box = GtkBox::new(Orientation::Horizontal, 8);\n    let fill_label = Label::new(Some(\"\"));\n    fill_label.set_hexpand(true);\n    fill_label.set_xalign(0.0);\n    fill_color_box.append(\u0026fill_label);\n\n    let fill_color_button = Button::with_label(\"\");\n    fill_color_button.set_halign(gtk4::Align::End);\n    fill_color_box.append(\u0026fill_color_button);\n    shape_section.append(\u0026fill_color_box);\n\n    // Stroke Color\n    let stroke_color_box = GtkBox::new(Orientation::Horizontal, 8);\n    let stroke_label = Label::new(Some(\"\"));\n    stroke_label.set_hexpand(true);\n    stroke_label.set_xalign(0.0);\n    stroke_color_box.append(\u0026stroke_label);\n\n    let stroke_color_button = Button::with_label(\"\");\n    stroke_color_button.set_halign(gtk4::Align::End);\n    stroke_color_box.append(\u0026stroke_color_button);\n    shape_section.append(\u0026stroke_color_box);\n\n    // Stroke Width\n    let stroke_width_box = GtkBox::new(Orientation::Horizontal, 8);\n    let stroke_width_label = Label::new(Some(\" (pt)\"));\n    stroke_width_label.set_xalign(0.0);\n    stroke_width_box.append(\u0026stroke_width_label);\n\n    let stroke_width_adj = Adjustment::new(2.0, 0.5, 10.0, 0.5, 1.0, 0.0);\n    let stroke_width_spin = SpinButton::new(Some(\u0026stroke_width_adj), 0.5, 1);\n    stroke_width_spin.set_halign(gtk4::Align::End);\n    stroke_width_box.append(\u0026stroke_width_spin);\n    shape_section.append(\u0026stroke_width_box);\n\n    container.append(\u0026shape_section);\n\n    (fill_color_button, stroke_color_button, stroke_width_spin)\n}\n","traces":[{"line":41,"address":[],"length":0,"stats":{"Line":0}},{"line":42,"address":[],"length":0,"stats":{"Line":0}},{"line":43,"address":[],"length":0,"stats":{"Line":0}},{"line":47,"address":[],"length":0,"stats":{"Line":0}},{"line":48,"address":[],"length":0,"stats":{"Line":0}},{"line":49,"address":[],"length":0,"stats":{"Line":0}},{"line":53,"address":[],"length":0,"stats":{"Line":0}},{"line":55,"address":[],"length":0,"stats":{"Line":0}},{"line":56,"address":[],"length":0,"stats":{"Line":0}},{"line":57,"address":[],"length":0,"stats":{"Line":0}},{"line":59,"address":[],"length":0,"stats":{"Line":0}},{"line":60,"address":[],"length":0,"stats":{"Line":0}},{"line":61,"address":[],"length":0,"stats":{"Line":0}},{"line":62,"address":[],"length":0,"stats":{"Line":0}},{"line":63,"address":[],"length":0,"stats":{"Line":0}},{"line":64,"address":[],"length":0,"stats":{"Line":0}},{"line":67,"address":[],"length":0,"stats":{"Line":0}},{"line":70,"address":[],"length":0,"stats":{"Line":0}},{"line":71,"address":[],"length":0,"stats":{"Line":0}},{"line":74,"address":[],"length":0,"stats":{"Line":0}},{"line":77,"address":[],"length":0,"stats":{"Line":0}},{"line":80,"address":[],"length":0,"stats":{"Line":0}},{"line":81,"address":[],"length":0,"stats":{"Line":0}},{"line":84,"address":[],"length":0,"stats":{"Line":0}},{"line":85,"address":[],"length":0,"stats":{"Line":0}},{"line":88,"address":[],"length":0,"stats":{"Line":0}},{"line":91,"address":[],"length":0,"stats":{"Line":0}},{"line":92,"address":[],"length":0,"stats":{"Line":0}},{"line":95,"address":[],"length":0,"stats":{"Line":0}},{"line":126,"address":[],"length":0,"stats":{"Line":0}},{"line":127,"address":[],"length":0,"stats":{"Line":0}},{"line":128,"address":[],"length":0,"stats":{"Line":0}},{"line":129,"address":[],"length":0,"stats":{"Line":0}},{"line":130,"address":[],"length":0,"stats":{"Line":0}},{"line":131,"address":[],"length":0,"stats":{"Line":0}},{"line":132,"address":[],"length":0,"stats":{"Line":0}},{"line":133,"address":[],"length":0,"stats":{"Line":0}},{"line":134,"address":[],"length":0,"stats":{"Line":0}},{"line":136,"address":[],"length":0,"stats":{"Line":0}},{"line":137,"address":[],"length":0,"stats":{"Line":0}},{"line":139,"address":[],"length":0,"stats":{"Line":0}},{"line":143,"address":[],"length":0,"stats":{"Line":0}},{"line":147,"address":[],"length":0,"stats":{"Line":0}},{"line":148,"address":[],"length":0,"stats":{"Line":0}},{"line":149,"address":[],"length":0,"stats":{"Line":0}},{"line":151,"address":[],"length":0,"stats":{"Line":0}},{"line":152,"address":[],"length":0,"stats":{"Line":0}},{"line":154,"address":[],"length":0,"stats":{"Line":0}},{"line":155,"address":[],"length":0,"stats":{"Line":0}},{"line":156,"address":[],"length":0,"stats":{"Line":0}},{"line":158,"address":[],"length":0,"stats":{"Line":0}},{"line":159,"address":[],"length":0,"stats":{"Line":0}},{"line":160,"address":[],"length":0,"stats":{"Line":0}},{"line":163,"address":[],"length":0,"stats":{"Line":0}},{"line":164,"address":[],"length":0,"stats":{"Line":0}},{"line":165,"address":[],"length":0,"stats":{"Line":0}},{"line":167,"address":[],"length":0,"stats":{"Line":0}},{"line":168,"address":[],"length":0,"stats":{"Line":0}},{"line":169,"address":[],"length":0,"stats":{"Line":0}},{"line":170,"address":[],"length":0,"stats":{"Line":0}},{"line":172,"address":[],"length":0,"stats":{"Line":0}},{"line":173,"address":[],"length":0,"stats":{"Line":0}},{"line":174,"address":[],"length":0,"stats":{"Line":0}},{"line":175,"address":[],"length":0,"stats":{"Line":0}},{"line":176,"address":[],"length":0,"stats":{"Line":0}},{"line":177,"address":[],"length":0,"stats":{"Line":0}},{"line":178,"address":[],"length":0,"stats":{"Line":0}},{"line":179,"address":[],"length":0,"stats":{"Line":0}},{"line":180,"address":[],"length":0,"stats":{"Line":0}},{"line":181,"address":[],"length":0,"stats":{"Line":0}},{"line":182,"address":[],"length":0,"stats":{"Line":0}},{"line":183,"address":[],"length":0,"stats":{"Line":0}},{"line":184,"address":[],"length":0,"stats":{"Line":0}},{"line":185,"address":[],"length":0,"stats":{"Line":0}},{"line":187,"address":[],"length":0,"stats":{"Line":0}},{"line":188,"address":[],"length":0,"stats":{"Line":0}},{"line":189,"address":[],"length":0,"stats":{"Line":0}},{"line":192,"address":[],"length":0,"stats":{"Line":0}},{"line":193,"address":[],"length":0,"stats":{"Line":0}},{"line":194,"address":[],"length":0,"stats":{"Line":0}},{"line":196,"address":[],"length":0,"stats":{"Line":0}},{"line":197,"address":[],"length":0,"stats":{"Line":0}},{"line":198,"address":[],"length":0,"stats":{"Line":0}},{"line":199,"address":[],"length":0,"stats":{"Line":0}},{"line":201,"address":[],"length":0,"stats":{"Line":0}},{"line":202,"address":[],"length":0,"stats":{"Line":0}},{"line":203,"address":[],"length":0,"stats":{"Line":0}},{"line":204,"address":[],"length":0,"stats":{"Line":0}},{"line":207,"address":[],"length":0,"stats":{"Line":0}},{"line":208,"address":[],"length":0,"stats":{"Line":0}},{"line":209,"address":[],"length":0,"stats":{"Line":0}},{"line":210,"address":[],"length":0,"stats":{"Line":0}},{"line":211,"address":[],"length":0,"stats":{"Line":0}},{"line":213,"address":[],"length":0,"stats":{"Line":0}},{"line":214,"address":[],"length":0,"stats":{"Line":0}},{"line":215,"address":[],"length":0,"stats":{"Line":0}},{"line":216,"address":[],"length":0,"stats":{"Line":0}},{"line":217,"address":[],"length":0,"stats":{"Line":0}},{"line":218,"address":[],"length":0,"stats":{"Line":0}},{"line":221,"address":[],"length":0,"stats":{"Line":0}},{"line":222,"address":[],"length":0,"stats":{"Line":0}},{"line":223,"address":[],"length":0,"stats":{"Line":0}},{"line":224,"address":[],"length":0,"stats":{"Line":0}},{"line":225,"address":[],"length":0,"stats":{"Line":0}},{"line":227,"address":[],"length":0,"stats":{"Line":0}},{"line":228,"address":[],"length":0,"stats":{"Line":0}},{"line":229,"address":[],"length":0,"stats":{"Line":0}},{"line":230,"address":[],"length":0,"stats":{"Line":0}},{"line":231,"address":[],"length":0,"stats":{"Line":0}},{"line":233,"address":[],"length":0,"stats":{"Line":0}},{"line":234,"address":[],"length":0,"stats":{"Line":0}},{"line":235,"address":[],"length":0,"stats":{"Line":0}},{"line":237,"address":[],"length":0,"stats":{"Line":0}},{"line":241,"address":[],"length":0,"stats":{"Line":0}},{"line":242,"address":[],"length":0,"stats":{"Line":0}},{"line":243,"address":[],"length":0,"stats":{"Line":0}},{"line":244,"address":[],"length":0,"stats":{"Line":0}},{"line":246,"address":[],"length":0,"stats":{"Line":0}},{"line":247,"address":[],"length":0,"stats":{"Line":0}},{"line":249,"address":[],"length":0,"stats":{"Line":0}},{"line":250,"address":[],"length":0,"stats":{"Line":0}},{"line":251,"address":[],"length":0,"stats":{"Line":0}},{"line":253,"address":[],"length":0,"stats":{"Line":0}},{"line":254,"address":[],"length":0,"stats":{"Line":0}},{"line":255,"address":[],"length":0,"stats":{"Line":0}},{"line":257,"address":[],"length":0,"stats":{"Line":0}},{"line":258,"address":[],"length":0,"stats":{"Line":0}},{"line":259,"address":[],"length":0,"stats":{"Line":0}},{"line":261,"address":[],"length":0,"stats":{"Line":0}},{"line":262,"address":[],"length":0,"stats":{"Line":0}},{"line":263,"address":[],"length":0,"stats":{"Line":0}},{"line":264,"address":[],"length":0,"stats":{"Line":0}},{"line":265,"address":[],"length":0,"stats":{"Line":0}},{"line":267,"address":[],"length":0,"stats":{"Line":0}},{"line":268,"address":[],"length":0,"stats":{"Line":0}},{"line":269,"address":[],"length":0,"stats":{"Line":0}},{"line":270,"address":[],"length":0,"stats":{"Line":0}},{"line":272,"address":[],"length":0,"stats":{"Line":0}},{"line":273,"address":[],"length":0,"stats":{"Line":0}},{"line":275,"address":[],"length":0,"stats":{"Line":0}},{"line":279,"address":[],"length":0,"stats":{"Line":0}},{"line":280,"address":[],"length":0,"stats":{"Line":0}},{"line":281,"address":[],"length":0,"stats":{"Line":0}},{"line":282,"address":[],"length":0,"stats":{"Line":0}},{"line":284,"address":[],"length":0,"stats":{"Line":0}},{"line":285,"address":[],"length":0,"stats":{"Line":0}},{"line":287,"address":[],"length":0,"stats":{"Line":0}},{"line":288,"address":[],"length":0,"stats":{"Line":0}},{"line":289,"address":[],"length":0,"stats":{"Line":0}},{"line":291,"address":[],"length":0,"stats":{"Line":0}},{"line":292,"address":[],"length":0,"stats":{"Line":0}},{"line":293,"address":[],"length":0,"stats":{"Line":0}},{"line":295,"address":[],"length":0,"stats":{"Line":0}},{"line":296,"address":[],"length":0,"stats":{"Line":0}},{"line":297,"address":[],"length":0,"stats":{"Line":0}},{"line":299,"address":[],"length":0,"stats":{"Line":0}},{"line":300,"address":[],"length":0,"stats":{"Line":0}},{"line":301,"address":[],"length":0,"stats":{"Line":0}},{"line":302,"address":[],"length":0,"stats":{"Line":0}},{"line":304,"address":[],"length":0,"stats":{"Line":0}},{"line":305,"address":[],"length":0,"stats":{"Line":0}},{"line":306,"address":[],"length":0,"stats":{"Line":0}},{"line":308,"address":[],"length":0,"stats":{"Line":0}},{"line":312,"address":[],"length":0,"stats":{"Line":0}},{"line":313,"address":[],"length":0,"stats":{"Line":0}},{"line":314,"address":[],"length":0,"stats":{"Line":0}},{"line":315,"address":[],"length":0,"stats":{"Line":0}},{"line":317,"address":[],"length":0,"stats":{"Line":0}},{"line":318,"address":[],"length":0,"stats":{"Line":0}},{"line":320,"address":[],"length":0,"stats":{"Line":0}},{"line":321,"address":[],"length":0,"stats":{"Line":0}},{"line":322,"address":[],"length":0,"stats":{"Line":0}},{"line":324,"address":[],"length":0,"stats":{"Line":0}},{"line":325,"address":[],"length":0,"stats":{"Line":0}},{"line":326,"address":[],"length":0,"stats":{"Line":0}},{"line":328,"address":[],"length":0,"stats":{"Line":0}},{"line":329,"address":[],"length":0,"stats":{"Line":0}},{"line":330,"address":[],"length":0,"stats":{"Line":0}},{"line":332,"address":[],"length":0,"stats":{"Line":0}},{"line":333,"address":[],"length":0,"stats":{"Line":0}},{"line":335,"address":[],"length":0,"stats":{"Line":0}},{"line":336,"address":[],"length":0,"stats":{"Line":0}},{"line":337,"address":[],"length":0,"stats":{"Line":0}},{"line":339,"address":[],"length":0,"stats":{"Line":0}},{"line":340,"address":[],"length":0,"stats":{"Line":0}},{"line":341,"address":[],"length":0,"stats":{"Line":0}},{"line":343,"address":[],"length":0,"stats":{"Line":0}},{"line":345,"address":[],"length":0,"stats":{"Line":0}},{"line":346,"address":[],"length":0,"stats":{"Line":0}},{"line":348,"address":[],"length":0,"stats":{"Line":0}},{"line":349,"address":[],"length":0,"stats":{"Line":0}},{"line":350,"address":[],"length":0,"stats":{"Line":0}},{"line":352,"address":[],"length":0,"stats":{"Line":0}},{"line":353,"address":[],"length":0,"stats":{"Line":0}},{"line":354,"address":[],"length":0,"stats":{"Line":0}},{"line":356,"address":[],"length":0,"stats":{"Line":0}},{"line":357,"address":[],"length":0,"stats":{"Line":0}},{"line":359,"address":[],"length":0,"stats":{"Line":0}},{"line":363,"address":[],"length":0,"stats":{"Line":0}},{"line":366,"address":[],"length":0,"stats":{"Line":0}},{"line":367,"address":[],"length":0,"stats":{"Line":0}},{"line":368,"address":[],"length":0,"stats":{"Line":0}},{"line":370,"address":[],"length":0,"stats":{"Line":0}},{"line":371,"address":[],"length":0,"stats":{"Line":0}},{"line":373,"address":[],"length":0,"stats":{"Line":0}},{"line":374,"address":[],"length":0,"stats":{"Line":0}},{"line":375,"address":[],"length":0,"stats":{"Line":0}},{"line":377,"address":[],"length":0,"stats":{"Line":0}},{"line":378,"address":[],"length":0,"stats":{"Line":0}},{"line":379,"address":[],"length":0,"stats":{"Line":0}},{"line":381,"address":[],"length":0,"stats":{"Line":0}},{"line":382,"address":[],"length":0,"stats":{"Line":0}},{"line":383,"address":[],"length":0,"stats":{"Line":0}},{"line":385,"address":[],"length":0,"stats":{"Line":0}},{"line":386,"address":[],"length":0,"stats":{"Line":0}},{"line":388,"address":[],"length":0,"stats":{"Line":0}},{"line":389,"address":[],"length":0,"stats":{"Line":0}},{"line":390,"address":[],"length":0,"stats":{"Line":0}},{"line":392,"address":[],"length":0,"stats":{"Line":0}},{"line":393,"address":[],"length":0,"stats":{"Line":0}},{"line":394,"address":[],"length":0,"stats":{"Line":0}},{"line":396,"address":[],"length":0,"stats":{"Line":0}},{"line":397,"address":[],"length":0,"stats":{"Line":0}},{"line":398,"address":[],"length":0,"stats":{"Line":0}},{"line":400,"address":[],"length":0,"stats":{"Line":0}},{"line":402,"address":[],"length":0,"stats":{"Line":0}},{"line":403,"address":[],"length":0,"stats":{"Line":0}},{"line":405,"address":[],"length":0,"stats":{"Line":0}},{"line":406,"address":[],"length":0,"stats":{"Line":0}},{"line":407,"address":[],"length":0,"stats":{"Line":0}},{"line":409,"address":[],"length":0,"stats":{"Line":0}},{"line":410,"address":[],"length":0,"stats":{"Line":0}},{"line":411,"address":[],"length":0,"stats":{"Line":0}},{"line":413,"address":[],"length":0,"stats":{"Line":0}},{"line":414,"address":[],"length":0,"stats":{"Line":0}},{"line":415,"address":[],"length":0,"stats":{"Line":0}},{"line":417,"address":[],"length":0,"stats":{"Line":0}},{"line":418,"address":[],"length":0,"stats":{"Line":0}},{"line":420,"address":[],"length":0,"stats":{"Line":0}},{"line":424,"address":[],"length":0,"stats":{"Line":0}},{"line":425,"address":[],"length":0,"stats":{"Line":0}},{"line":426,"address":[],"length":0,"stats":{"Line":0}},{"line":427,"address":[],"length":0,"stats":{"Line":0}},{"line":429,"address":[],"length":0,"stats":{"Line":0}},{"line":430,"address":[],"length":0,"stats":{"Line":0}},{"line":432,"address":[],"length":0,"stats":{"Line":0}},{"line":433,"address":[],"length":0,"stats":{"Line":0}},{"line":434,"address":[],"length":0,"stats":{"Line":0}},{"line":436,"address":[],"length":0,"stats":{"Line":0}},{"line":437,"address":[],"length":0,"stats":{"Line":0}},{"line":438,"address":[],"length":0,"stats":{"Line":0}},{"line":440,"address":[],"length":0,"stats":{"Line":0}},{"line":441,"address":[],"length":0,"stats":{"Line":0}},{"line":442,"address":[],"length":0,"stats":{"Line":0}},{"line":443,"address":[],"length":0,"stats":{"Line":0}},{"line":445,"address":[],"length":0,"stats":{"Line":0}},{"line":446,"address":[],"length":0,"stats":{"Line":0}},{"line":447,"address":[],"length":0,"stats":{"Line":0}},{"line":448,"address":[],"length":0,"stats":{"Line":0}},{"line":450,"address":[],"length":0,"stats":{"Line":0}},{"line":451,"address":[],"length":0,"stats":{"Line":0}},{"line":452,"address":[],"length":0,"stats":{"Line":0}},{"line":453,"address":[],"length":0,"stats":{"Line":0}},{"line":455,"address":[],"length":0,"stats":{"Line":0}},{"line":456,"address":[],"length":0,"stats":{"Line":0}},{"line":457,"address":[],"length":0,"stats":{"Line":0}},{"line":458,"address":[],"length":0,"stats":{"Line":0}},{"line":460,"address":[],"length":0,"stats":{"Line":0}},{"line":461,"address":[],"length":0,"stats":{"Line":0}},{"line":462,"address":[],"length":0,"stats":{"Line":0}},{"line":463,"address":[],"length":0,"stats":{"Line":0}},{"line":465,"address":[],"length":0,"stats":{"Line":0}},{"line":467,"address":[],"length":0,"stats":{"Line":0}},{"line":471,"address":[],"length":0,"stats":{"Line":0}},{"line":472,"address":[],"length":0,"stats":{"Line":0}},{"line":473,"address":[],"length":0,"stats":{"Line":0}},{"line":474,"address":[],"length":0,"stats":{"Line":0}},{"line":476,"address":[],"length":0,"stats":{"Line":0}},{"line":477,"address":[],"length":0,"stats":{"Line":0}},{"line":479,"address":[],"length":0,"stats":{"Line":0}},{"line":480,"address":[],"length":0,"stats":{"Line":0}},{"line":481,"address":[],"length":0,"stats":{"Line":0}},{"line":483,"address":[],"length":0,"stats":{"Line":0}},{"line":484,"address":[],"length":0,"stats":{"Line":0}},{"line":485,"address":[],"length":0,"stats":{"Line":0}},{"line":487,"address":[],"length":0,"stats":{"Line":0}},{"line":488,"address":[],"length":0,"stats":{"Line":0}},{"line":489,"address":[],"length":0,"stats":{"Line":0}},{"line":492,"address":[],"length":0,"stats":{"Line":0}},{"line":493,"address":[],"length":0,"stats":{"Line":0}},{"line":494,"address":[],"length":0,"stats":{"Line":0}},{"line":495,"address":[],"length":0,"stats":{"Line":0}},{"line":496,"address":[],"length":0,"stats":{"Line":0}},{"line":498,"address":[],"length":0,"stats":{"Line":0}},{"line":499,"address":[],"length":0,"stats":{"Line":0}},{"line":500,"address":[],"length":0,"stats":{"Line":0}},{"line":501,"address":[],"length":0,"stats":{"Line":0}},{"line":504,"address":[],"length":0,"stats":{"Line":0}},{"line":505,"address":[],"length":0,"stats":{"Line":0}},{"line":506,"address":[],"length":0,"stats":{"Line":0}},{"line":507,"address":[],"length":0,"stats":{"Line":0}},{"line":508,"address":[],"length":0,"stats":{"Line":0}},{"line":510,"address":[],"length":0,"stats":{"Line":0}},{"line":511,"address":[],"length":0,"stats":{"Line":0}},{"line":512,"address":[],"length":0,"stats":{"Line":0}},{"line":513,"address":[],"length":0,"stats":{"Line":0}},{"line":516,"address":[],"length":0,"stats":{"Line":0}},{"line":517,"address":[],"length":0,"stats":{"Line":0}},{"line":518,"address":[],"length":0,"stats":{"Line":0}},{"line":519,"address":[],"length":0,"stats":{"Line":0}},{"line":521,"address":[],"length":0,"stats":{"Line":0}},{"line":522,"address":[],"length":0,"stats":{"Line":0}},{"line":523,"address":[],"length":0,"stats":{"Line":0}},{"line":524,"address":[],"length":0,"stats":{"Line":0}},{"line":525,"address":[],"length":0,"stats":{"Line":0}},{"line":527,"address":[],"length":0,"stats":{"Line":0}},{"line":529,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":317},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","ui","src","panels","property_handlers.rs"],"content":"//! Property panel signal handlers\n//!\n//! Wires up the property panel UI controls to canvas object updates\n\nuse gtk4::prelude::*;\nuse testruct_core::document::DocumentElement;\nuse testruct_core::typography::TextAlignment;\n\nuse crate::app::AppState;\nuse crate::canvas::CanvasView;\nuse super::PropertyPanelComponents;\n\n/// Wire all property panel signals to update selected objects\npub fn wire_property_signals(\n    components: \u0026PropertyPanelComponents,\n    app_state: AppState,\n    canvas_view: \u0026CanvasView,\n) {\n    let drawing_area = canvas_view.drawing_area();\n    let render_state = canvas_view.render_state().clone();\n\n    // Font family selection\n    wire_font_family_signal(components, app_state.clone(), drawing_area.clone(), render_state.clone());\n\n    // Font size\n    wire_font_size_signal(components, app_state.clone(), drawing_area.clone(), render_state.clone());\n\n    // Stroke color\n    wire_stroke_color_signal(components, app_state.clone(), drawing_area.clone(), render_state.clone());\n\n    // Fill color\n    wire_fill_color_signal(components, app_state.clone(), drawing_area.clone(), render_state.clone());\n\n    // Text alignment dropdown\n    wire_alignment_dropdown(components, app_state.clone(), drawing_area.clone(), render_state.clone());\n\n    // Line height scale\n    wire_line_height_signal(components, app_state.clone(), drawing_area.clone(), render_state.clone());\n\n    tracing::info!(\" Property panel signals wired\");\n}\n\n/// Wire font family selection\nfn wire_font_family_signal(\n    components: \u0026PropertyPanelComponents,\n    app_state: AppState,\n    drawing_area: gtk4::DrawingArea,\n    render_state: crate::canvas::CanvasRenderState,\n) {\n    let combo = components.font_family_combo.clone();\n\n    combo.connect_notify_local(Some(\"selected\"), move |_combo_box, _pspec| {\n        // Font family dropdown selection changed\n        app_state.with_active_document(|doc| {\n            let selected = render_state.selected_ids.borrow();\n            if !selected.is_empty() {\n                if let Some(page) = doc.pages.first_mut() {\n                    for element in \u0026mut page.elements {\n                        match element {\n                            DocumentElement::Text(text) if selected.contains(\u0026text.id) =\u003e {\n                                // Default font family change notification\n                                tracing::debug!(\" Font family changed\");\n                            }\n                            _ =\u003e {}\n                        }\n                    }\n                }\n            }\n        });\n\n        drawing_area.queue_draw();\n    });\n}\n\n/// Wire font size spinner\nfn wire_font_size_signal(\n    components: \u0026PropertyPanelComponents,\n    app_state: AppState,\n    drawing_area: gtk4::DrawingArea,\n    render_state: crate::canvas::CanvasRenderState,\n) {\n    let spin = components.font_size_spin.clone();\n\n    spin.connect_value_changed(move |spinner| {\n        let font_size = spinner.value() as f32;\n\n        app_state.with_active_document(|doc| {\n            let selected = render_state.selected_ids.borrow();\n            if !selected.is_empty() {\n                if let Some(page) = doc.pages.first_mut() {\n                    for element in \u0026mut page.elements {\n                        match element {\n                            DocumentElement::Text(text) if selected.contains(\u0026text.id) =\u003e {\n                                text.style.font_size = font_size;\n                                tracing::debug!(\" Font size changed to: {}px\", font_size);\n                            }\n                            _ =\u003e {}\n                        }\n                    }\n                }\n            }\n        });\n\n        drawing_area.queue_draw();\n    });\n}\n\n/// Wire stroke color button\nfn wire_stroke_color_signal(\n    components: \u0026PropertyPanelComponents,\n    app_state: AppState,\n    drawing_area: gtk4::DrawingArea,\n    render_state: crate::canvas::CanvasRenderState,\n) {\n    let btn = components.stroke_color_button.clone();\n\n    btn.connect_clicked(move |_button| {\n        // Get current color from button CSS background\n        // For simplicity, we'll set a default stroke color\n        let stroke_color = testruct_core::typography::Color {\n            r: 0.0,\n            g: 0.0,\n            b: 0.0,\n            a: 1.0,\n        };\n\n        app_state.with_active_document(|doc| {\n            let selected = render_state.selected_ids.borrow();\n            if !selected.is_empty() {\n                if let Some(page) = doc.pages.first_mut() {\n                    for element in \u0026mut page.elements {\n                        match element {\n                            DocumentElement::Shape(shape) if selected.contains(\u0026shape.id) =\u003e {\n                                shape.stroke = Some(stroke_color.clone());\n                                tracing::debug!(\" Stroke color changed\");\n                            }\n                            _ =\u003e {}\n                        }\n                    }\n                }\n            }\n        });\n\n        drawing_area.queue_draw();\n    });\n}\n\n/// Wire fill color button\nfn wire_fill_color_signal(\n    components: \u0026PropertyPanelComponents,\n    app_state: AppState,\n    drawing_area: gtk4::DrawingArea,\n    render_state: crate::canvas::CanvasRenderState,\n) {\n    let btn = components.fill_color_button.clone();\n\n    btn.connect_clicked(move |_button| {\n        // Get current color from button CSS background\n        // For simplicity, we'll set a default fill color\n        let fill_color = testruct_core::typography::Color {\n            r: 1.0,\n            g: 1.0,\n            b: 1.0,\n            a: 1.0,\n        };\n\n        app_state.with_active_document(|doc| {\n            let selected = render_state.selected_ids.borrow();\n            if !selected.is_empty() {\n                if let Some(page) = doc.pages.first_mut() {\n                    for element in \u0026mut page.elements {\n                        match element {\n                            DocumentElement::Shape(shape) if selected.contains(\u0026shape.id) =\u003e {\n                                shape.fill = Some(fill_color.clone());\n                                tracing::debug!(\" Fill color changed\");\n                            }\n                            _ =\u003e {}\n                        }\n                    }\n                }\n            }\n        });\n\n        drawing_area.queue_draw();\n    });\n}\n\n/// Wire alignment dropdown\nfn wire_alignment_dropdown(\n    components: \u0026PropertyPanelComponents,\n    app_state: AppState,\n    drawing_area: gtk4::DrawingArea,\n    render_state: crate::canvas::CanvasRenderState,\n) {\n    let combo = components.text_align_combo.clone();\n\n    combo.connect_notify_local(Some(\"selected\"), move |combo_box, _pspec| {\n        // Get selected alignment option\n        let selected_index = combo_box.selected();\n        let alignment = match selected_index {\n            0 =\u003e TextAlignment::Start,    // \n            1 =\u003e TextAlignment::Center,   // \n            2 =\u003e TextAlignment::End,      // \n            3 =\u003e TextAlignment::Justified, // \n            _ =\u003e TextAlignment::Start,\n        };\n\n        app_state.with_active_document(|doc| {\n            let selected = render_state.selected_ids.borrow();\n            if !selected.is_empty() {\n                if let Some(page) = doc.pages.first_mut() {\n                    for element in \u0026mut page.elements {\n                        match element {\n                            DocumentElement::Text(text) if selected.contains(\u0026text.id) =\u003e {\n                                text.style.alignment = alignment;\n                                tracing::debug!(\" Text alignment changed to: {:?}\", alignment);\n                            }\n                            _ =\u003e {}\n                        }\n                    }\n                }\n            }\n        });\n\n        drawing_area.queue_draw();\n    });\n}\n\n/// Wire line height scale\nfn wire_line_height_signal(\n    components: \u0026PropertyPanelComponents,\n    app_state: AppState,\n    drawing_area: gtk4::DrawingArea,\n    render_state: crate::canvas::CanvasRenderState,\n) {\n    let scale = components.line_height_scale.clone();\n\n    scale.connect_value_changed(move |scale_widget| {\n        let line_height = scale_widget.value() as f32;\n\n        app_state.with_active_document(|doc| {\n            let selected = render_state.selected_ids.borrow();\n            if !selected.is_empty() {\n                if let Some(page) = doc.pages.first_mut() {\n                    for element in \u0026mut page.elements {\n                        match element {\n                            DocumentElement::Text(text) if selected.contains(\u0026text.id) =\u003e {\n                                text.style.line_height = line_height;\n                                tracing::debug!(\" Line height changed to: {}\", line_height);\n                            }\n                            _ =\u003e {}\n                        }\n                    }\n                }\n            }\n        });\n\n        drawing_area.queue_draw();\n    });\n}\n","traces":[{"line":14,"address":[],"length":0,"stats":{"Line":0}},{"line":19,"address":[],"length":0,"stats":{"Line":0}},{"line":20,"address":[],"length":0,"stats":{"Line":0}},{"line":23,"address":[],"length":0,"stats":{"Line":0}},{"line":26,"address":[],"length":0,"stats":{"Line":0}},{"line":29,"address":[],"length":0,"stats":{"Line":0}},{"line":32,"address":[],"length":0,"stats":{"Line":0}},{"line":35,"address":[],"length":0,"stats":{"Line":0}},{"line":38,"address":[],"length":0,"stats":{"Line":0}},{"line":40,"address":[],"length":0,"stats":{"Line":0}},{"line":44,"address":[],"length":0,"stats":{"Line":0}},{"line":50,"address":[],"length":0,"stats":{"Line":0}},{"line":52,"address":[],"length":0,"stats":{"Line":0}},{"line":54,"address":[],"length":0,"stats":{"Line":0}},{"line":55,"address":[],"length":0,"stats":{"Line":0}},{"line":56,"address":[],"length":0,"stats":{"Line":0}},{"line":57,"address":[],"length":0,"stats":{"Line":0}},{"line":58,"address":[],"length":0,"stats":{"Line":0}},{"line":59,"address":[],"length":0,"stats":{"Line":0}},{"line":60,"address":[],"length":0,"stats":{"Line":0}},{"line":62,"address":[],"length":0,"stats":{"Line":0}},{"line":64,"address":[],"length":0,"stats":{"Line":0}},{"line":71,"address":[],"length":0,"stats":{"Line":0}},{"line":76,"address":[],"length":0,"stats":{"Line":0}},{"line":82,"address":[],"length":0,"stats":{"Line":0}},{"line":84,"address":[],"length":0,"stats":{"Line":0}},{"line":85,"address":[],"length":0,"stats":{"Line":0}},{"line":87,"address":[],"length":0,"stats":{"Line":0}},{"line":88,"address":[],"length":0,"stats":{"Line":0}},{"line":89,"address":[],"length":0,"stats":{"Line":0}},{"line":90,"address":[],"length":0,"stats":{"Line":0}},{"line":91,"address":[],"length":0,"stats":{"Line":0}},{"line":92,"address":[],"length":0,"stats":{"Line":0}},{"line":93,"address":[],"length":0,"stats":{"Line":0}},{"line":94,"address":[],"length":0,"stats":{"Line":0}},{"line":95,"address":[],"length":0,"stats":{"Line":0}},{"line":97,"address":[],"length":0,"stats":{"Line":0}},{"line":104,"address":[],"length":0,"stats":{"Line":0}},{"line":109,"address":[],"length":0,"stats":{"Line":0}},{"line":115,"address":[],"length":0,"stats":{"Line":0}},{"line":117,"address":[],"length":0,"stats":{"Line":0}},{"line":120,"address":[],"length":0,"stats":{"Line":0}},{"line":121,"address":[],"length":0,"stats":{"Line":0}},{"line":122,"address":[],"length":0,"stats":{"Line":0}},{"line":123,"address":[],"length":0,"stats":{"Line":0}},{"line":124,"address":[],"length":0,"stats":{"Line":0}},{"line":127,"address":[],"length":0,"stats":{"Line":0}},{"line":128,"address":[],"length":0,"stats":{"Line":0}},{"line":129,"address":[],"length":0,"stats":{"Line":0}},{"line":130,"address":[],"length":0,"stats":{"Line":0}},{"line":131,"address":[],"length":0,"stats":{"Line":0}},{"line":132,"address":[],"length":0,"stats":{"Line":0}},{"line":133,"address":[],"length":0,"stats":{"Line":0}},{"line":134,"address":[],"length":0,"stats":{"Line":0}},{"line":135,"address":[],"length":0,"stats":{"Line":0}},{"line":137,"address":[],"length":0,"stats":{"Line":0}},{"line":144,"address":[],"length":0,"stats":{"Line":0}},{"line":149,"address":[],"length":0,"stats":{"Line":0}},{"line":155,"address":[],"length":0,"stats":{"Line":0}},{"line":157,"address":[],"length":0,"stats":{"Line":0}},{"line":160,"address":[],"length":0,"stats":{"Line":0}},{"line":161,"address":[],"length":0,"stats":{"Line":0}},{"line":162,"address":[],"length":0,"stats":{"Line":0}},{"line":163,"address":[],"length":0,"stats":{"Line":0}},{"line":164,"address":[],"length":0,"stats":{"Line":0}},{"line":167,"address":[],"length":0,"stats":{"Line":0}},{"line":168,"address":[],"length":0,"stats":{"Line":0}},{"line":169,"address":[],"length":0,"stats":{"Line":0}},{"line":170,"address":[],"length":0,"stats":{"Line":0}},{"line":171,"address":[],"length":0,"stats":{"Line":0}},{"line":172,"address":[],"length":0,"stats":{"Line":0}},{"line":173,"address":[],"length":0,"stats":{"Line":0}},{"line":174,"address":[],"length":0,"stats":{"Line":0}},{"line":175,"address":[],"length":0,"stats":{"Line":0}},{"line":177,"address":[],"length":0,"stats":{"Line":0}},{"line":184,"address":[],"length":0,"stats":{"Line":0}},{"line":189,"address":[],"length":0,"stats":{"Line":0}},{"line":195,"address":[],"length":0,"stats":{"Line":0}},{"line":197,"address":[],"length":0,"stats":{"Line":0}},{"line":199,"address":[],"length":0,"stats":{"Line":0}},{"line":200,"address":[],"length":0,"stats":{"Line":0}},{"line":201,"address":[],"length":0,"stats":{"Line":0}},{"line":202,"address":[],"length":0,"stats":{"Line":0}},{"line":203,"address":[],"length":0,"stats":{"Line":0}},{"line":204,"address":[],"length":0,"stats":{"Line":0}},{"line":205,"address":[],"length":0,"stats":{"Line":0}},{"line":208,"address":[],"length":0,"stats":{"Line":0}},{"line":209,"address":[],"length":0,"stats":{"Line":0}},{"line":210,"address":[],"length":0,"stats":{"Line":0}},{"line":211,"address":[],"length":0,"stats":{"Line":0}},{"line":212,"address":[],"length":0,"stats":{"Line":0}},{"line":213,"address":[],"length":0,"stats":{"Line":0}},{"line":214,"address":[],"length":0,"stats":{"Line":0}},{"line":215,"address":[],"length":0,"stats":{"Line":0}},{"line":216,"address":[],"length":0,"stats":{"Line":0}},{"line":218,"address":[],"length":0,"stats":{"Line":0}},{"line":225,"address":[],"length":0,"stats":{"Line":0}},{"line":230,"address":[],"length":0,"stats":{"Line":0}},{"line":236,"address":[],"length":0,"stats":{"Line":0}},{"line":238,"address":[],"length":0,"stats":{"Line":0}},{"line":239,"address":[],"length":0,"stats":{"Line":0}},{"line":241,"address":[],"length":0,"stats":{"Line":0}},{"line":242,"address":[],"length":0,"stats":{"Line":0}},{"line":243,"address":[],"length":0,"stats":{"Line":0}},{"line":244,"address":[],"length":0,"stats":{"Line":0}},{"line":245,"address":[],"length":0,"stats":{"Line":0}},{"line":246,"address":[],"length":0,"stats":{"Line":0}},{"line":247,"address":[],"length":0,"stats":{"Line":0}},{"line":248,"address":[],"length":0,"stats":{"Line":0}},{"line":249,"address":[],"length":0,"stats":{"Line":0}},{"line":251,"address":[],"length":0,"stats":{"Line":0}},{"line":258,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":112},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","ui","src","template_manager.rs"],"content":"//! Template manager UI integration\n//!\n//! Provides UI components for managing templates, including browsing,\n//! selecting, and creating documents from templates.\n\nuse gtk4::prelude::*;\nuse gtk4::{\n    Box as GtkBox, Button, ListBox, ListBoxRow, Orientation, ScrolledWindow, SearchEntry,\n};\nuse std::cell::RefCell;\nuse std::rc::Rc;\nuse testruct_core::template::Template;\n\n/// Template browser UI components\npub struct TemplateBrowser {\n    pub window: gtk4::ApplicationWindow,\n    pub list_box: ListBox,\n    pub search_entry: SearchEntry,\n    pub templates: Rc\u003cRefCell\u003cVec\u003cTemplate\u003e\u003e\u003e,\n    pub selected_template: Rc\u003cRefCell\u003cOption\u003cTemplate\u003e\u003e\u003e,\n}\n\nimpl TemplateBrowser {\n    /// Create a new template browser\n    pub fn new(parent: \u0026gtk4::ApplicationWindow) -\u003e Self {\n        let window = gtk4::ApplicationWindow::builder()\n            .transient_for(parent)\n            .modal(true)\n            .title(\"\")\n            .default_width(600)\n            .default_height(400)\n            .build();\n\n        let main_box = GtkBox::new(Orientation::Vertical, 12);\n        main_box.set_margin_start(12);\n        main_box.set_margin_end(12);\n        main_box.set_margin_top(12);\n        main_box.set_margin_bottom(12);\n\n        // Search bar\n        let search_box = GtkBox::new(Orientation::Horizontal, 6);\n        let search_label = gtk4::Label::new(Some(\":\"));\n        let search_entry = SearchEntry::new();\n        search_entry.set_hexpand(true);\n        search_entry.set_placeholder_text(Some(\"...\"));\n        search_box.append(\u0026search_label);\n        search_box.append(\u0026search_entry);\n        main_box.append(\u0026search_box);\n\n        // Template list\n        let scroller = ScrolledWindow::new();\n        scroller.set_vexpand(true);\n        scroller.set_hexpand(true);\n\n        let list_box = ListBox::new();\n        list_box.set_selection_mode(gtk4::SelectionMode::Single);\n        scroller.set_child(Some(\u0026list_box));\n        main_box.append(\u0026scroller);\n\n        // Button bar\n        let button_box = GtkBox::new(Orientation::Horizontal, 6);\n        button_box.set_homogeneous(true);\n\n        let create_btn = Button::with_label(\"\");\n        create_btn.add_css_class(\"suggested-action\");\n\n        let cancel_btn = Button::with_label(\"\");\n\n        button_box.append(\u0026create_btn);\n        button_box.append(\u0026cancel_btn);\n        main_box.append(\u0026button_box);\n\n        window.set_child(Some(\u0026main_box));\n\n        let templates = Rc::new(RefCell::new(Vec::new()));\n        let selected_template = Rc::new(RefCell::new(None));\n\n        Self {\n            window,\n            list_box,\n            search_entry,\n            templates,\n            selected_template,\n        }\n    }\n\n    /// Load templates into the browser\n    pub fn load_templates(\u0026self, templates: Vec\u003cTemplate\u003e) {\n        *self.templates.borrow_mut() = templates.clone();\n        self.populate_list(\u0026templates);\n    }\n\n    /// Populate the list box with templates\n    fn populate_list(\u0026self, templates: \u0026[Template]) {\n        // Clear existing rows\n        while let Some(row) = self.list_box.first_child() {\n            row.unparent();\n        }\n\n        // Add template rows\n        for template in templates {\n            let row = self.create_template_row(\u0026template);\n            self.list_box.append(\u0026row);\n        }\n    }\n\n    /// Create a list row for a template\n    fn create_template_row(\u0026self, template: \u0026Template) -\u003e ListBoxRow {\n        let row = ListBoxRow::new();\n\n        let box_content = GtkBox::new(Orientation::Vertical, 4);\n        box_content.set_margin_start(12);\n        box_content.set_margin_end(12);\n        box_content.set_margin_top(8);\n        box_content.set_margin_bottom(8);\n\n        // Template name\n        let name_label = gtk4::Label::new(Some(\u0026template.name));\n        name_label.add_css_class(\"heading\");\n        name_label.set_halign(gtk4::Align::Start);\n        box_content.append(\u0026name_label);\n\n        // Template description\n        if let Some(description) = \u0026template.description {\n            let desc_label = gtk4::Label::new(Some(description));\n            desc_label.add_css_class(\"dim-label\");\n            desc_label.set_halign(gtk4::Align::Start);\n            desc_label.set_wrap(true);\n            box_content.append(\u0026desc_label);\n        }\n\n        // Template ID\n        let id_label = gtk4::Label::new(Some(\u0026format!(\": {}\", template.pages.len())));\n        id_label.add_css_class(\"monospace\");\n        id_label.add_css_class(\"dim-label\");\n        box_content.append(\u0026id_label);\n\n        row.set_child(Some(\u0026box_content));\n        row\n    }\n\n    /// Filter templates by search text\n    pub fn filter_templates(\u0026self, search_text: \u0026str) {\n        let search_lower = search_text.to_lowercase();\n        let templates = self.templates.borrow();\n\n        let filtered: Vec\u003c_\u003e = templates\n            .iter()\n            .filter(|t| {\n                t.name.to_lowercase().contains(\u0026search_lower)\n                    || t.description\n                        .as_ref()\n                        .map(|d| d.to_lowercase().contains(\u0026search_lower))\n                        .unwrap_or(false)\n            })\n            .cloned()\n            .collect();\n\n        self.populate_list(\u0026filtered);\n    }\n\n    /// Get the selected template\n    pub fn selected_template(\u0026self) -\u003e Option\u003cTemplate\u003e {\n        self.selected_template.borrow().clone()\n    }\n\n    /// Set the selected template\n    pub fn set_selected_template(\u0026self, template: Template) {\n        *self.selected_template.borrow_mut() = Some(template);\n    }\n\n    /// Show the template browser window\n    pub fn show(\u0026self) {\n        self.window.present();\n    }\n\n    /// Close the template browser window\n    pub fn close(\u0026self) {\n        self.window.close();\n    }\n}\n\n/// Template builder for creating documents from templates\npub struct TemplateBuilder;\n\nimpl TemplateBuilder {\n    /// Create a document from a template\n    pub fn create_document_from_template(template: \u0026Template) -\u003e testruct_core::document::Document {\n        // Create a new document from template\n        // The document gets initialized with a blank page and the template's name\n        testruct_core::document::Document::empty(\u0026template.name)\n    }\n}\n\n/// Template selector dialog for creating new documents\npub fn create_template_selector_dialog(parent: \u0026gtk4::ApplicationWindow) -\u003e TemplateBrowser {\n    TemplateBrowser::new(parent)\n}\n","traces":[{"line":25,"address":[],"length":0,"stats":{"Line":0}},{"line":26,"address":[],"length":0,"stats":{"Line":0}},{"line":27,"address":[],"length":0,"stats":{"Line":0}},{"line":34,"address":[],"length":0,"stats":{"Line":0}},{"line":35,"address":[],"length":0,"stats":{"Line":0}},{"line":36,"address":[],"length":0,"stats":{"Line":0}},{"line":37,"address":[],"length":0,"stats":{"Line":0}},{"line":38,"address":[],"length":0,"stats":{"Line":0}},{"line":41,"address":[],"length":0,"stats":{"Line":0}},{"line":42,"address":[],"length":0,"stats":{"Line":0}},{"line":43,"address":[],"length":0,"stats":{"Line":0}},{"line":44,"address":[],"length":0,"stats":{"Line":0}},{"line":45,"address":[],"length":0,"stats":{"Line":0}},{"line":46,"address":[],"length":0,"stats":{"Line":0}},{"line":47,"address":[],"length":0,"stats":{"Line":0}},{"line":48,"address":[],"length":0,"stats":{"Line":0}},{"line":51,"address":[],"length":0,"stats":{"Line":0}},{"line":52,"address":[],"length":0,"stats":{"Line":0}},{"line":53,"address":[],"length":0,"stats":{"Line":0}},{"line":55,"address":[],"length":0,"stats":{"Line":0}},{"line":56,"address":[],"length":0,"stats":{"Line":0}},{"line":57,"address":[],"length":0,"stats":{"Line":0}},{"line":58,"address":[],"length":0,"stats":{"Line":0}},{"line":61,"address":[],"length":0,"stats":{"Line":0}},{"line":62,"address":[],"length":0,"stats":{"Line":0}},{"line":64,"address":[],"length":0,"stats":{"Line":0}},{"line":65,"address":[],"length":0,"stats":{"Line":0}},{"line":67,"address":[],"length":0,"stats":{"Line":0}},{"line":69,"address":[],"length":0,"stats":{"Line":0}},{"line":70,"address":[],"length":0,"stats":{"Line":0}},{"line":71,"address":[],"length":0,"stats":{"Line":0}},{"line":73,"address":[],"length":0,"stats":{"Line":0}},{"line":75,"address":[],"length":0,"stats":{"Line":0}},{"line":76,"address":[],"length":0,"stats":{"Line":0}},{"line":88,"address":[],"length":0,"stats":{"Line":0}},{"line":89,"address":[],"length":0,"stats":{"Line":0}},{"line":90,"address":[],"length":0,"stats":{"Line":0}},{"line":94,"address":[],"length":0,"stats":{"Line":0}},{"line":96,"address":[],"length":0,"stats":{"Line":0}},{"line":97,"address":[],"length":0,"stats":{"Line":0}},{"line":101,"address":[],"length":0,"stats":{"Line":0}},{"line":102,"address":[],"length":0,"stats":{"Line":0}},{"line":103,"address":[],"length":0,"stats":{"Line":0}},{"line":108,"address":[],"length":0,"stats":{"Line":0}},{"line":109,"address":[],"length":0,"stats":{"Line":0}},{"line":111,"address":[],"length":0,"stats":{"Line":0}},{"line":112,"address":[],"length":0,"stats":{"Line":0}},{"line":113,"address":[],"length":0,"stats":{"Line":0}},{"line":114,"address":[],"length":0,"stats":{"Line":0}},{"line":115,"address":[],"length":0,"stats":{"Line":0}},{"line":118,"address":[],"length":0,"stats":{"Line":0}},{"line":119,"address":[],"length":0,"stats":{"Line":0}},{"line":120,"address":[],"length":0,"stats":{"Line":0}},{"line":121,"address":[],"length":0,"stats":{"Line":0}},{"line":124,"address":[],"length":0,"stats":{"Line":0}},{"line":125,"address":[],"length":0,"stats":{"Line":0}},{"line":126,"address":[],"length":0,"stats":{"Line":0}},{"line":127,"address":[],"length":0,"stats":{"Line":0}},{"line":128,"address":[],"length":0,"stats":{"Line":0}},{"line":129,"address":[],"length":0,"stats":{"Line":0}},{"line":133,"address":[],"length":0,"stats":{"Line":0}},{"line":134,"address":[],"length":0,"stats":{"Line":0}},{"line":135,"address":[],"length":0,"stats":{"Line":0}},{"line":136,"address":[],"length":0,"stats":{"Line":0}},{"line":138,"address":[],"length":0,"stats":{"Line":0}},{"line":139,"address":[],"length":0,"stats":{"Line":0}},{"line":143,"address":[],"length":0,"stats":{"Line":0}},{"line":144,"address":[],"length":0,"stats":{"Line":0}},{"line":145,"address":[],"length":0,"stats":{"Line":0}},{"line":147,"address":[],"length":0,"stats":{"Line":0}},{"line":149,"address":[],"length":0,"stats":{"Line":0}},{"line":150,"address":[],"length":0,"stats":{"Line":0}},{"line":151,"address":[],"length":0,"stats":{"Line":0}},{"line":152,"address":[],"length":0,"stats":{"Line":0}},{"line":153,"address":[],"length":0,"stats":{"Line":0}},{"line":154,"address":[],"length":0,"stats":{"Line":0}},{"line":159,"address":[],"length":0,"stats":{"Line":0}},{"line":163,"address":[],"length":0,"stats":{"Line":0}},{"line":164,"address":[],"length":0,"stats":{"Line":0}},{"line":168,"address":[],"length":0,"stats":{"Line":0}},{"line":169,"address":[],"length":0,"stats":{"Line":0}},{"line":173,"address":[],"length":0,"stats":{"Line":0}},{"line":174,"address":[],"length":0,"stats":{"Line":0}},{"line":178,"address":[],"length":0,"stats":{"Line":0}},{"line":179,"address":[],"length":0,"stats":{"Line":0}},{"line":188,"address":[],"length":0,"stats":{"Line":0}},{"line":191,"address":[],"length":0,"stats":{"Line":0}},{"line":196,"address":[],"length":0,"stats":{"Line":0}},{"line":197,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":89},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","ui","src","templates","mod.rs"],"content":"//! Template system for document templates\n//!\n//! Provides functionality to save, load, and manage document templates.\n\nuse testruct_core::document::Document;\nuse std::fs;\nuse std::path::PathBuf;\n\n/// Get the templates directory path\npub fn templates_dir() -\u003e PathBuf {\n    dirs::config_dir()\n        .unwrap_or_else(|| PathBuf::from(\".\"))\n        .join(\"testruct\")\n        .join(\"templates\")\n}\n\n/// Initialize the templates directory\npub fn init_templates_dir() -\u003e std::io::Result\u003c()\u003e {\n    let dir = templates_dir();\n    fs::create_dir_all(\u0026dir)?;\n    Ok(())\n}\n\n/// Save document as a template\npub fn save_template(name: \u0026str, document: \u0026Document) -\u003e std::io::Result\u003c()\u003e {\n    init_templates_dir()?;\n\n    let dir = templates_dir();\n    let file_path = dir.join(format!(\"{}.json\", name));\n\n    let json = serde_json::to_string_pretty(document)\n        .map_err(|e| std::io::Error::new(std::io::ErrorKind::InvalidData, e))?;\n\n    fs::write(\u0026file_path, json)?;\n    tracing::info!(\" Template saved: {}\", file_path.display());\n    Ok(())\n}\n\n/// Load document from template\npub fn load_template(name: \u0026str) -\u003e std::io::Result\u003cDocument\u003e {\n    let dir = templates_dir();\n    let file_path = dir.join(format!(\"{}.json\", name));\n\n    let json = fs::read_to_string(\u0026file_path)?;\n    let document: Document = serde_json::from_str(\u0026json)\n        .map_err(|e| std::io::Error::new(std::io::ErrorKind::InvalidData, e))?;\n\n    tracing::info!(\" Template loaded: {}\", file_path.display());\n    Ok(document)\n}\n\n/// List all available templates\npub fn list_templates() -\u003e std::io::Result\u003cVec\u003cString\u003e\u003e {\n    init_templates_dir()?;\n\n    let dir = templates_dir();\n    let mut templates = Vec::new();\n\n    if !dir.exists() {\n        return Ok(templates);\n    }\n\n    for entry in fs::read_dir(\u0026dir)? {\n        let entry = entry?;\n        let path = entry.path();\n\n        if path.extension().map_or(false, |ext| ext == \"json\") {\n            if let Some(name) = path.file_stem() {\n                if let Some(name_str) = name.to_str() {\n                    templates.push(name_str.to_string());\n                }\n            }\n        }\n    }\n\n    templates.sort();\n    Ok(templates)\n}\n\n/// Delete a template\npub fn delete_template(name: \u0026str) -\u003e std::io::Result\u003c()\u003e {\n    let dir = templates_dir();\n    let file_path = dir.join(format!(\"{}.json\", name));\n\n    if file_path.exists() {\n        fs::remove_file(\u0026file_path)?;\n        tracing::info!(\" Template deleted: {}\", name);\n    }\n\n    Ok(())\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n\n    #[test]\n    fn test_templates_dir_exists() {\n        let dir = templates_dir();\n        assert!(!dir.as_os_str().is_empty());\n    }\n\n    #[test]\n    fn test_list_templates() {\n        let result = list_templates();\n        assert!(result.is_ok());\n    }\n}\n","traces":[{"line":10,"address":[],"length":0,"stats":{"Line":3}},{"line":11,"address":[],"length":0,"stats":{"Line":3}},{"line":12,"address":[],"length":0,"stats":{"Line":3}},{"line":18,"address":[],"length":0,"stats":{"Line":1}},{"line":19,"address":[],"length":0,"stats":{"Line":2}},{"line":20,"address":[],"length":0,"stats":{"Line":2}},{"line":21,"address":[],"length":0,"stats":{"Line":1}},{"line":25,"address":[],"length":0,"stats":{"Line":0}},{"line":26,"address":[],"length":0,"stats":{"Line":0}},{"line":28,"address":[],"length":0,"stats":{"Line":0}},{"line":29,"address":[],"length":0,"stats":{"Line":0}},{"line":31,"address":[],"length":0,"stats":{"Line":0}},{"line":32,"address":[],"length":0,"stats":{"Line":0}},{"line":34,"address":[],"length":0,"stats":{"Line":0}},{"line":35,"address":[],"length":0,"stats":{"Line":0}},{"line":36,"address":[],"length":0,"stats":{"Line":0}},{"line":40,"address":[],"length":0,"stats":{"Line":0}},{"line":41,"address":[],"length":0,"stats":{"Line":0}},{"line":42,"address":[],"length":0,"stats":{"Line":0}},{"line":44,"address":[],"length":0,"stats":{"Line":0}},{"line":45,"address":[],"length":0,"stats":{"Line":0}},{"line":46,"address":[],"length":0,"stats":{"Line":0}},{"line":48,"address":[],"length":0,"stats":{"Line":0}},{"line":49,"address":[],"length":0,"stats":{"Line":0}},{"line":53,"address":[],"length":0,"stats":{"Line":1}},{"line":54,"address":[],"length":0,"stats":{"Line":1}},{"line":56,"address":[],"length":0,"stats":{"Line":2}},{"line":57,"address":[],"length":0,"stats":{"Line":2}},{"line":59,"address":[],"length":0,"stats":{"Line":1}},{"line":60,"address":[],"length":0,"stats":{"Line":0}},{"line":63,"address":[],"length":0,"stats":{"Line":2}},{"line":64,"address":[],"length":0,"stats":{"Line":0}},{"line":65,"address":[],"length":0,"stats":{"Line":0}},{"line":67,"address":[],"length":0,"stats":{"Line":0}},{"line":68,"address":[],"length":0,"stats":{"Line":0}},{"line":69,"address":[],"length":0,"stats":{"Line":0}},{"line":70,"address":[],"length":0,"stats":{"Line":0}},{"line":76,"address":[],"length":0,"stats":{"Line":1}},{"line":77,"address":[],"length":0,"stats":{"Line":1}},{"line":81,"address":[],"length":0,"stats":{"Line":0}},{"line":82,"address":[],"length":0,"stats":{"Line":0}},{"line":83,"address":[],"length":0,"stats":{"Line":0}},{"line":85,"address":[],"length":0,"stats":{"Line":0}},{"line":86,"address":[],"length":0,"stats":{"Line":0}},{"line":87,"address":[],"length":0,"stats":{"Line":0}},{"line":90,"address":[],"length":0,"stats":{"Line":0}}],"covered":15,"coverable":46},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","ui","src","theme","mod.rs"],"content":"use gtk4::gdk::RGBA;\n\npub fn background_color() -\u003e RGBA {\n    RGBA::new(0.97, 0.97, 0.99, 1.0)\n}\n\npub fn accent_color() -\u003e RGBA {\n    RGBA::new(0.32, 0.54, 0.92, 1.0)\n}\n","traces":[{"line":3,"address":[],"length":0,"stats":{"Line":0}},{"line":4,"address":[],"length":0,"stats":{"Line":0}},{"line":7,"address":[],"length":0,"stats":{"Line":0}},{"line":8,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":4},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","ui","src","toolbar","mod.rs"],"content":"//! Toolbar construction and management\n//!\n//! Provides builders for the primary and secondary toolbars with all controls\n//! organized by functional groups.\n\npub mod tools;\n\nuse gtk4::prelude::*;\nuse gtk4::{\n    Button, Box as GtkBox, Label, MenuButton, Orientation, Popover, ScrolledWindow, Separator,\n    ToggleButton,\n};\n\n/// Container for all toolbar-related widgets\n#[derive(Clone)]\npub struct ToolbarWidgets {\n    /// Primary toolbar (document controls, history, workflow, view options, zoom)\n    pub primary_toolbar: GtkBox,\n    /// Secondary toolbar (object operations, view toggles)\n    pub secondary_toolbar: GtkBox,\n    /// All buttons referenced by event handlers\n    pub buttons: ToolbarButtons,\n    /// View options popover\n    pub view_popover: Popover,\n    /// Guide list popover\n    pub guide_list_popover: Popover,\n    /// Guide list box for dynamically adding guides\n    pub guide_list_box: GtkBox,\n}\n\n/// All toolbar buttons organized by function\n#[derive(Clone)]\npub struct ToolbarButtons {\n    // Document controls (Primary toolbar)\n    pub new_btn: Button,\n    pub open_btn: Button,\n    pub save_btn: Button,\n    pub export_btn: Button,\n    pub image_export_btn: Button,\n\n    // History controls (Primary toolbar)\n    pub undo_btn: Button,\n    pub redo_btn: Button,\n\n    // Workflow shortcuts (Primary toolbar)\n    pub template_btn: Button,\n    pub json_editor_btn: Button,\n    pub settings_btn: Button,\n\n    // Panel toggles (Primary toolbar)\n    pub item_library_btn: ToggleButton,\n    pub block_tools_btn: ToggleButton,\n\n    // View menu button (Primary toolbar)\n    pub view_menu_btn: MenuButton,\n\n    // Zoom controls (Primary toolbar)\n    pub zoom_out_btn: Button,\n    pub zoom_100_btn: Button,\n    pub zoom_in_btn: Button,\n\n    // Page info label (Primary toolbar)\n    pub page_info_label: Label,\n\n    // View popover toggles\n    pub ruler_menu_toggle: ToggleButton,\n    pub guides_menu_toggle: ToggleButton,\n    pub snap_to_guides_toggle: ToggleButton,\n    pub guide_list_menu_btn: Button,\n\n    // Object operations (Secondary toolbar)\n    pub group_btn: Button,\n    pub ungroup_btn: Button,\n    pub lock_btn: Button,\n    pub unlock_btn: Button,\n\n    // View toggles (Secondary toolbar)\n    pub grid_toggle_btn: ToggleButton,\n    pub guides_visible_btn: ToggleButton,\n    pub rulers_visible_btn: ToggleButton,\n    pub snap_to_guides_btn: ToggleButton,\n}\n\n/// Public build function for toolbar\npub fn build_toolbar() -\u003e ToolbarWidgets {\n    ToolbarBuilder::build()\n}\n\n/// Builder for toolbar construction\npub struct ToolbarBuilder;\n\nimpl ToolbarBuilder {\n    /// Build both primary and secondary toolbars with all controls\n    fn build() -\u003e ToolbarWidgets {\n        let (primary_toolbar, primary_buttons, guide_list_box) = Self::build_primary_toolbar();\n        let (secondary_toolbar, secondary_buttons) = Self::build_secondary_toolbar();\n\n        let buttons = ToolbarButtons {\n            new_btn: primary_buttons.new_btn,\n            open_btn: primary_buttons.open_btn,\n            save_btn: primary_buttons.save_btn,\n            export_btn: primary_buttons.export_btn,\n            image_export_btn: primary_buttons.image_export_btn,\n            undo_btn: primary_buttons.undo_btn,\n            redo_btn: primary_buttons.redo_btn,\n            template_btn: primary_buttons.template_btn,\n            json_editor_btn: primary_buttons.json_editor_btn,\n            settings_btn: primary_buttons.settings_btn,\n            item_library_btn: primary_buttons.item_library_btn,\n            block_tools_btn: primary_buttons.block_tools_btn,\n            view_menu_btn: primary_buttons.view_menu_btn,\n            zoom_out_btn: primary_buttons.zoom_out_btn,\n            zoom_100_btn: primary_buttons.zoom_100_btn,\n            zoom_in_btn: primary_buttons.zoom_in_btn,\n            page_info_label: primary_buttons.page_info_label,\n            ruler_menu_toggle: primary_buttons.ruler_menu_toggle,\n            guides_menu_toggle: primary_buttons.guides_menu_toggle,\n            snap_to_guides_toggle: primary_buttons.snap_to_guides_toggle,\n            guide_list_menu_btn: primary_buttons.guide_list_menu_btn,\n            group_btn: secondary_buttons.group_btn,\n            ungroup_btn: secondary_buttons.ungroup_btn,\n            lock_btn: secondary_buttons.lock_btn,\n            unlock_btn: secondary_buttons.unlock_btn,\n            grid_toggle_btn: secondary_buttons.grid_toggle_btn,\n            guides_visible_btn: secondary_buttons.guides_visible_btn,\n            rulers_visible_btn: secondary_buttons.rulers_visible_btn,\n            snap_to_guides_btn: secondary_buttons.snap_to_guides_btn,\n        };\n\n        ToolbarWidgets {\n            primary_toolbar,\n            secondary_toolbar,\n            buttons,\n            view_popover: primary_buttons.view_popover,\n            guide_list_popover: primary_buttons.guide_list_popover,\n            guide_list_box,\n        }\n    }\n\n    /// Build the primary toolbar with document, history, workflow, view, and zoom controls\n    fn build_primary_toolbar() -\u003e (GtkBox, PrimaryToolbarButtons, GtkBox) {\n        let primary_toolbar = GtkBox::new(Orientation::Horizontal, 10);\n        primary_toolbar.add_css_class(\"toolbar\");\n        primary_toolbar.set_margin_start(12);\n        primary_toolbar.set_margin_end(12);\n        primary_toolbar.set_margin_top(4);\n        primary_toolbar.set_margin_bottom(4);\n\n        // Document controls section\n        let document_controls = GtkBox::new(Orientation::Horizontal, 2);\n        document_controls.add_css_class(\"linked\");\n\n        let new_btn = Button::with_label(\"\");\n        new_btn.add_css_class(\"flat\");\n        new_btn.set_tooltip_text(Some(\"\"));\n        document_controls.append(\u0026new_btn);\n\n        let open_btn = Button::with_label(\"\");\n        open_btn.add_css_class(\"flat\");\n        open_btn.set_tooltip_text(Some(\"\"));\n        document_controls.append(\u0026open_btn);\n\n        let save_btn = Button::with_label(\"\");\n        save_btn.add_css_class(\"flat\");\n        save_btn.set_tooltip_text(Some(\"\"));\n        document_controls.append(\u0026save_btn);\n\n        let export_btn = Button::with_label(\"PDF\");\n        export_btn.add_css_class(\"flat\");\n        export_btn.set_tooltip_text(Some(\"PDF\"));\n        document_controls.append(\u0026export_btn);\n\n        let image_export_btn = Button::with_label(\"\");\n        image_export_btn.add_css_class(\"flat\");\n        image_export_btn.set_tooltip_text(Some(\"PNG/JPEG/SVG\"));\n        document_controls.append(\u0026image_export_btn);\n\n        primary_toolbar.append(\u0026document_controls);\n\n        let doc_separator = Separator::new(Orientation::Vertical);\n        doc_separator.set_margin_start(8);\n        doc_separator.set_margin_end(8);\n        primary_toolbar.append(\u0026doc_separator);\n\n        // History section (Undo/Redo)\n        let history_box = GtkBox::new(Orientation::Horizontal, 2);\n        history_box.add_css_class(\"linked\");\n\n        let undo_btn = Button::with_label(\"\");\n        undo_btn.add_css_class(\"flat\");\n        undo_btn.set_tooltip_text(Some(\" (Ctrl+Z)\"));\n        undo_btn.set_sensitive(false);\n        history_box.append(\u0026undo_btn);\n\n        let redo_btn = Button::with_label(\"\");\n        redo_btn.add_css_class(\"flat\");\n        redo_btn.set_tooltip_text(Some(\" (Ctrl+Shift+Z)\"));\n        redo_btn.set_sensitive(false);\n        history_box.append(\u0026redo_btn);\n\n        primary_toolbar.append(\u0026history_box);\n\n        let history_separator = Separator::new(Orientation::Vertical);\n        history_separator.set_margin_start(8);\n        history_separator.set_margin_end(8);\n        primary_toolbar.append(\u0026history_separator);\n\n        // Workflow section (Templates, JSON, Settings)\n        let workflow_box = GtkBox::new(Orientation::Horizontal, 2);\n        workflow_box.add_css_class(\"linked\");\n\n        let template_btn = Button::with_label(\"\");\n        template_btn.add_css_class(\"flat\");\n        template_btn.set_tooltip_text(Some(\"\"));\n        workflow_box.append(\u0026template_btn);\n\n        let json_editor_btn = Button::with_label(\"JSON\");\n        json_editor_btn.add_css_class(\"flat\");\n        json_editor_btn.set_tooltip_text(Some(\"JSON\"));\n        workflow_box.append(\u0026json_editor_btn);\n\n        let settings_btn = Button::with_label(\"\");\n        settings_btn.add_css_class(\"flat\");\n        settings_btn.set_tooltip_text(Some(\"\"));\n        workflow_box.append(\u0026settings_btn);\n\n        primary_toolbar.append(\u0026workflow_box);\n\n        let workflow_separator = Separator::new(Orientation::Vertical);\n        workflow_separator.set_margin_start(8);\n        workflow_separator.set_margin_end(8);\n        primary_toolbar.append(\u0026workflow_separator);\n\n        // Panel toggles (Item Library, Block Tools)\n        let panel_toggle_box = GtkBox::new(Orientation::Horizontal, 2);\n        panel_toggle_box.add_css_class(\"linked\");\n\n        let item_library_btn = ToggleButton::with_label(\"\");\n        item_library_btn.add_css_class(\"flat\");\n        item_library_btn.set_tooltip_text(Some(\"/\"));\n        panel_toggle_box.append(\u0026item_library_btn);\n\n        let block_tools_btn = ToggleButton::with_label(\"\");\n        block_tools_btn.add_css_class(\"flat\");\n        block_tools_btn.set_tooltip_text(Some(\"/\"));\n        panel_toggle_box.append(\u0026block_tools_btn);\n\n        primary_toolbar.append(\u0026panel_toggle_box);\n\n        let panel_separator = Separator::new(Orientation::Vertical);\n        panel_separator.set_margin_start(8);\n        panel_separator.set_margin_end(8);\n        primary_toolbar.append(\u0026panel_separator);\n\n        // View popover content\n        let view_popover = Popover::new();\n        let view_popover_box = GtkBox::new(Orientation::Vertical, 8);\n        view_popover_box.set_margin_start(12);\n        view_popover_box.set_margin_end(12);\n        view_popover_box.set_margin_top(12);\n        view_popover_box.set_margin_bottom(12);\n\n        let view_heading = Label::new(Some(\"\"));\n        view_heading.add_css_class(\"section-heading\");\n        view_popover_box.append(\u0026view_heading);\n\n        let ruler_menu_toggle = ToggleButton::with_label(\"\");\n        ruler_menu_toggle.add_css_class(\"flat\");\n        ruler_menu_toggle.set_active(true);\n        view_popover_box.append(\u0026ruler_menu_toggle);\n\n        let guides_menu_toggle = ToggleButton::with_label(\"\");\n        guides_menu_toggle.add_css_class(\"flat\");\n        guides_menu_toggle.set_active(true);\n        view_popover_box.append(\u0026guides_menu_toggle);\n\n        let snap_to_guides_toggle = ToggleButton::with_label(\"\");\n        snap_to_guides_toggle.add_css_class(\"flat\");\n        snap_to_guides_toggle.set_active(true);\n        view_popover_box.append(\u0026snap_to_guides_toggle);\n\n        let guide_list_popover = Popover::new();\n        let guide_list_box = GtkBox::new(Orientation::Vertical, 8);\n        let guide_list_scroller = ScrolledWindow::new();\n        guide_list_scroller.set_min_content_width(240);\n        guide_list_scroller.set_min_content_height(260);\n        guide_list_scroller.set_child(Some(\u0026guide_list_box));\n        guide_list_popover.set_child(Some(\u0026guide_list_scroller));\n\n        let guide_list_menu_btn = Button::with_label(\"\");\n        guide_list_menu_btn.add_css_class(\"flat\");\n        guide_list_menu_btn.set_halign(gtk4::Align::Start);\n        guide_list_popover.set_parent(\u0026guide_list_menu_btn);\n        view_popover_box.append(\u0026guide_list_menu_btn);\n\n        view_popover.set_child(Some(\u0026view_popover_box));\n\n        let view_menu_btn = MenuButton::builder().label(\"\").build();\n        view_menu_btn.add_css_class(\"flat\");\n        view_menu_btn.set_popover(Some(\u0026view_popover));\n        view_menu_btn.set_tooltip_text(Some(\"\"));\n        primary_toolbar.append(\u0026view_menu_btn);\n\n        let view_separator = Separator::new(Orientation::Vertical);\n        view_separator.set_margin_start(8);\n        view_separator.set_margin_end(8);\n        primary_toolbar.append(\u0026view_separator);\n\n        // Spacer before zoom controls\n        let toolbar_spacer = GtkBox::new(Orientation::Horizontal, 0);\n        toolbar_spacer.set_hexpand(true);\n        primary_toolbar.append(\u0026toolbar_spacer);\n\n        // Zoom controls\n        let zoom_box = GtkBox::new(Orientation::Horizontal, 2);\n        zoom_box.add_css_class(\"linked\");\n\n        let zoom_out_btn = Button::with_label(\"\");\n        zoom_out_btn.add_css_class(\"flat\");\n        zoom_out_btn.set_tooltip_text(Some(\" (Ctrl+-)\"));\n        zoom_box.append(\u0026zoom_out_btn);\n\n        let zoom_100_btn = Button::with_label(\"100%\");\n        zoom_100_btn.add_css_class(\"flat\");\n        zoom_100_btn.set_tooltip_text(Some(\" (Ctrl+0)\"));\n        zoom_box.append(\u0026zoom_100_btn);\n\n        let zoom_in_btn = Button::with_label(\"+\");\n        zoom_in_btn.add_css_class(\"flat\");\n        zoom_in_btn.set_tooltip_text(Some(\" (Ctrl+=)\"));\n        zoom_box.append(\u0026zoom_in_btn);\n\n        primary_toolbar.append(\u0026zoom_box);\n\n        let page_info_label = Label::new(Some(\"1 / 1\"));\n        page_info_label.add_css_class(\"dim-label\");\n        page_info_label.set_margin_start(12);\n        primary_toolbar.append(\u0026page_info_label);\n\n        (\n            primary_toolbar,\n            PrimaryToolbarButtons {\n                new_btn,\n                open_btn,\n                save_btn,\n                export_btn,\n                image_export_btn,\n                undo_btn,\n                redo_btn,\n                template_btn,\n                json_editor_btn,\n                settings_btn,\n                item_library_btn,\n                block_tools_btn,\n                view_menu_btn,\n                zoom_out_btn,\n                zoom_100_btn,\n                zoom_in_btn,\n                page_info_label,\n                ruler_menu_toggle,\n                guides_menu_toggle,\n                snap_to_guides_toggle,\n                guide_list_menu_btn,\n                view_popover,\n                guide_list_popover,\n            },\n            guide_list_box,\n        )\n    }\n\n    /// Build the secondary toolbar with object operations and view toggles\n    fn build_secondary_toolbar() -\u003e (GtkBox, SecondaryToolbarButtons) {\n        let secondary_toolbar = GtkBox::new(Orientation::Horizontal, 10);\n        secondary_toolbar.add_css_class(\"toolbar\");\n        secondary_toolbar.set_margin_start(12);\n        secondary_toolbar.set_margin_end(12);\n        secondary_toolbar.set_margin_top(2);\n        secondary_toolbar.set_margin_bottom(2);\n\n        let ops_label = Label::new(Some(\"\"));\n        ops_label.add_css_class(\"section-heading\");\n        secondary_toolbar.append(\u0026ops_label);\n\n        let ops_box = GtkBox::new(Orientation::Horizontal, 2);\n        ops_box.add_css_class(\"linked\");\n\n        let group_btn = Button::with_label(\"\");\n        group_btn.add_css_class(\"flat\");\n        group_btn.set_tooltip_text(Some(\" (Alt+G)\"));\n        ops_box.append(\u0026group_btn);\n\n        let ungroup_btn = Button::with_label(\"\");\n        ungroup_btn.add_css_class(\"flat\");\n        ungroup_btn.set_tooltip_text(Some(\"\"));\n        ops_box.append(\u0026ungroup_btn);\n\n        let lock_btn = Button::with_label(\"\");\n        lock_btn.add_css_class(\"flat\");\n        lock_btn.set_tooltip_text(Some(\"\"));\n        ops_box.append(\u0026lock_btn);\n\n        let unlock_btn = Button::with_label(\"\");\n        unlock_btn.add_css_class(\"flat\");\n        unlock_btn.set_tooltip_text(Some(\"\"));\n        ops_box.append(\u0026unlock_btn);\n\n        secondary_toolbar.append(\u0026ops_box);\n\n        let secondary_spacer = GtkBox::new(Orientation::Horizontal, 0);\n        secondary_spacer.set_hexpand(true);\n        secondary_toolbar.append(\u0026secondary_spacer);\n\n        let view_toggle_label = Label::new(Some(\"\"));\n        view_toggle_label.add_css_class(\"section-heading\");\n        secondary_toolbar.append(\u0026view_toggle_label);\n\n        let view_toggles_box = GtkBox::new(Orientation::Horizontal, 2);\n        view_toggles_box.add_css_class(\"linked\");\n\n        let grid_toggle_btn = ToggleButton::with_label(\": OFF\");\n        grid_toggle_btn.add_css_class(\"flat\");\n        grid_toggle_btn.set_tooltip_text(Some(\" ON/OFF\"));\n        grid_toggle_btn.set_active(false);\n        view_toggles_box.append(\u0026grid_toggle_btn);\n\n        let guides_visible_btn = ToggleButton::with_label(\": ON\");\n        guides_visible_btn.add_css_class(\"flat\");\n        guides_visible_btn.set_tooltip_text(Some(\" ON/OFF\"));\n        guides_visible_btn.set_active(true);\n        guides_visible_btn.add_css_class(\"suggested-action\");\n        view_toggles_box.append(\u0026guides_visible_btn);\n\n        let rulers_visible_btn = ToggleButton::with_label(\": ON\");\n        rulers_visible_btn.add_css_class(\"flat\");\n        rulers_visible_btn.set_tooltip_text(Some(\" ON/OFF\"));\n        rulers_visible_btn.set_active(true);\n        rulers_visible_btn.add_css_class(\"suggested-action\");\n        view_toggles_box.append(\u0026rulers_visible_btn);\n\n        let snap_to_guides_btn = ToggleButton::with_label(\": ON\");\n        snap_to_guides_btn.add_css_class(\"flat\");\n        snap_to_guides_btn.set_tooltip_text(Some(\"\"));\n        snap_to_guides_btn.set_active(true);\n        snap_to_guides_btn.add_css_class(\"suggested-action\");\n        view_toggles_box.append(\u0026snap_to_guides_btn);\n\n        secondary_toolbar.append(\u0026view_toggles_box);\n\n        (\n            secondary_toolbar,\n            SecondaryToolbarButtons {\n                group_btn,\n                ungroup_btn,\n                lock_btn,\n                unlock_btn,\n                grid_toggle_btn,\n                guides_visible_btn,\n                rulers_visible_btn,\n                snap_to_guides_btn,\n            },\n        )\n    }\n}\n\n/// Primary toolbar buttons (temporary structure for internal use)\nstruct PrimaryToolbarButtons {\n    new_btn: Button,\n    open_btn: Button,\n    save_btn: Button,\n    export_btn: Button,\n    image_export_btn: Button,\n    undo_btn: Button,\n    redo_btn: Button,\n    template_btn: Button,\n    json_editor_btn: Button,\n    settings_btn: Button,\n    item_library_btn: ToggleButton,\n    block_tools_btn: ToggleButton,\n    view_menu_btn: MenuButton,\n    zoom_out_btn: Button,\n    zoom_100_btn: Button,\n    zoom_in_btn: Button,\n    page_info_label: Label,\n    ruler_menu_toggle: ToggleButton,\n    guides_menu_toggle: ToggleButton,\n    snap_to_guides_toggle: ToggleButton,\n    guide_list_menu_btn: Button,\n    view_popover: Popover,\n    guide_list_popover: Popover,\n}\n\n/// Secondary toolbar buttons (temporary structure for internal use)\nstruct SecondaryToolbarButtons {\n    group_btn: Button,\n    ungroup_btn: Button,\n    lock_btn: Button,\n    unlock_btn: Button,\n    grid_toggle_btn: ToggleButton,\n    guides_visible_btn: ToggleButton,\n    rulers_visible_btn: ToggleButton,\n    snap_to_guides_btn: ToggleButton,\n}\n","traces":[{"line":85,"address":[],"length":0,"stats":{"Line":0}},{"line":86,"address":[],"length":0,"stats":{"Line":0}},{"line":94,"address":[],"length":0,"stats":{"Line":0}},{"line":95,"address":[],"length":0,"stats":{"Line":0}},{"line":96,"address":[],"length":0,"stats":{"Line":0}},{"line":99,"address":[],"length":0,"stats":{"Line":0}},{"line":100,"address":[],"length":0,"stats":{"Line":0}},{"line":101,"address":[],"length":0,"stats":{"Line":0}},{"line":102,"address":[],"length":0,"stats":{"Line":0}},{"line":103,"address":[],"length":0,"stats":{"Line":0}},{"line":104,"address":[],"length":0,"stats":{"Line":0}},{"line":105,"address":[],"length":0,"stats":{"Line":0}},{"line":106,"address":[],"length":0,"stats":{"Line":0}},{"line":107,"address":[],"length":0,"stats":{"Line":0}},{"line":108,"address":[],"length":0,"stats":{"Line":0}},{"line":109,"address":[],"length":0,"stats":{"Line":0}},{"line":110,"address":[],"length":0,"stats":{"Line":0}},{"line":111,"address":[],"length":0,"stats":{"Line":0}},{"line":112,"address":[],"length":0,"stats":{"Line":0}},{"line":113,"address":[],"length":0,"stats":{"Line":0}},{"line":114,"address":[],"length":0,"stats":{"Line":0}},{"line":115,"address":[],"length":0,"stats":{"Line":0}},{"line":116,"address":[],"length":0,"stats":{"Line":0}},{"line":117,"address":[],"length":0,"stats":{"Line":0}},{"line":118,"address":[],"length":0,"stats":{"Line":0}},{"line":119,"address":[],"length":0,"stats":{"Line":0}},{"line":120,"address":[],"length":0,"stats":{"Line":0}},{"line":121,"address":[],"length":0,"stats":{"Line":0}},{"line":122,"address":[],"length":0,"stats":{"Line":0}},{"line":123,"address":[],"length":0,"stats":{"Line":0}},{"line":124,"address":[],"length":0,"stats":{"Line":0}},{"line":125,"address":[],"length":0,"stats":{"Line":0}},{"line":126,"address":[],"length":0,"stats":{"Line":0}},{"line":127,"address":[],"length":0,"stats":{"Line":0}},{"line":134,"address":[],"length":0,"stats":{"Line":0}},{"line":135,"address":[],"length":0,"stats":{"Line":0}},{"line":141,"address":[],"length":0,"stats":{"Line":0}},{"line":142,"address":[],"length":0,"stats":{"Line":0}},{"line":143,"address":[],"length":0,"stats":{"Line":0}},{"line":144,"address":[],"length":0,"stats":{"Line":0}},{"line":145,"address":[],"length":0,"stats":{"Line":0}},{"line":146,"address":[],"length":0,"stats":{"Line":0}},{"line":147,"address":[],"length":0,"stats":{"Line":0}},{"line":150,"address":[],"length":0,"stats":{"Line":0}},{"line":151,"address":[],"length":0,"stats":{"Line":0}},{"line":153,"address":[],"length":0,"stats":{"Line":0}},{"line":154,"address":[],"length":0,"stats":{"Line":0}},{"line":155,"address":[],"length":0,"stats":{"Line":0}},{"line":156,"address":[],"length":0,"stats":{"Line":0}},{"line":158,"address":[],"length":0,"stats":{"Line":0}},{"line":159,"address":[],"length":0,"stats":{"Line":0}},{"line":160,"address":[],"length":0,"stats":{"Line":0}},{"line":161,"address":[],"length":0,"stats":{"Line":0}},{"line":163,"address":[],"length":0,"stats":{"Line":0}},{"line":164,"address":[],"length":0,"stats":{"Line":0}},{"line":165,"address":[],"length":0,"stats":{"Line":0}},{"line":166,"address":[],"length":0,"stats":{"Line":0}},{"line":168,"address":[],"length":0,"stats":{"Line":0}},{"line":169,"address":[],"length":0,"stats":{"Line":0}},{"line":170,"address":[],"length":0,"stats":{"Line":0}},{"line":171,"address":[],"length":0,"stats":{"Line":0}},{"line":173,"address":[],"length":0,"stats":{"Line":0}},{"line":174,"address":[],"length":0,"stats":{"Line":0}},{"line":175,"address":[],"length":0,"stats":{"Line":0}},{"line":176,"address":[],"length":0,"stats":{"Line":0}},{"line":178,"address":[],"length":0,"stats":{"Line":0}},{"line":180,"address":[],"length":0,"stats":{"Line":0}},{"line":181,"address":[],"length":0,"stats":{"Line":0}},{"line":182,"address":[],"length":0,"stats":{"Line":0}},{"line":183,"address":[],"length":0,"stats":{"Line":0}},{"line":186,"address":[],"length":0,"stats":{"Line":0}},{"line":187,"address":[],"length":0,"stats":{"Line":0}},{"line":189,"address":[],"length":0,"stats":{"Line":0}},{"line":190,"address":[],"length":0,"stats":{"Line":0}},{"line":191,"address":[],"length":0,"stats":{"Line":0}},{"line":192,"address":[],"length":0,"stats":{"Line":0}},{"line":193,"address":[],"length":0,"stats":{"Line":0}},{"line":195,"address":[],"length":0,"stats":{"Line":0}},{"line":196,"address":[],"length":0,"stats":{"Line":0}},{"line":197,"address":[],"length":0,"stats":{"Line":0}},{"line":198,"address":[],"length":0,"stats":{"Line":0}},{"line":199,"address":[],"length":0,"stats":{"Line":0}},{"line":201,"address":[],"length":0,"stats":{"Line":0}},{"line":203,"address":[],"length":0,"stats":{"Line":0}},{"line":204,"address":[],"length":0,"stats":{"Line":0}},{"line":205,"address":[],"length":0,"stats":{"Line":0}},{"line":206,"address":[],"length":0,"stats":{"Line":0}},{"line":209,"address":[],"length":0,"stats":{"Line":0}},{"line":210,"address":[],"length":0,"stats":{"Line":0}},{"line":212,"address":[],"length":0,"stats":{"Line":0}},{"line":213,"address":[],"length":0,"stats":{"Line":0}},{"line":214,"address":[],"length":0,"stats":{"Line":0}},{"line":215,"address":[],"length":0,"stats":{"Line":0}},{"line":217,"address":[],"length":0,"stats":{"Line":0}},{"line":218,"address":[],"length":0,"stats":{"Line":0}},{"line":219,"address":[],"length":0,"stats":{"Line":0}},{"line":220,"address":[],"length":0,"stats":{"Line":0}},{"line":222,"address":[],"length":0,"stats":{"Line":0}},{"line":223,"address":[],"length":0,"stats":{"Line":0}},{"line":224,"address":[],"length":0,"stats":{"Line":0}},{"line":225,"address":[],"length":0,"stats":{"Line":0}},{"line":227,"address":[],"length":0,"stats":{"Line":0}},{"line":229,"address":[],"length":0,"stats":{"Line":0}},{"line":230,"address":[],"length":0,"stats":{"Line":0}},{"line":231,"address":[],"length":0,"stats":{"Line":0}},{"line":232,"address":[],"length":0,"stats":{"Line":0}},{"line":235,"address":[],"length":0,"stats":{"Line":0}},{"line":236,"address":[],"length":0,"stats":{"Line":0}},{"line":238,"address":[],"length":0,"stats":{"Line":0}},{"line":239,"address":[],"length":0,"stats":{"Line":0}},{"line":240,"address":[],"length":0,"stats":{"Line":0}},{"line":241,"address":[],"length":0,"stats":{"Line":0}},{"line":243,"address":[],"length":0,"stats":{"Line":0}},{"line":244,"address":[],"length":0,"stats":{"Line":0}},{"line":245,"address":[],"length":0,"stats":{"Line":0}},{"line":246,"address":[],"length":0,"stats":{"Line":0}},{"line":248,"address":[],"length":0,"stats":{"Line":0}},{"line":250,"address":[],"length":0,"stats":{"Line":0}},{"line":251,"address":[],"length":0,"stats":{"Line":0}},{"line":252,"address":[],"length":0,"stats":{"Line":0}},{"line":253,"address":[],"length":0,"stats":{"Line":0}},{"line":256,"address":[],"length":0,"stats":{"Line":0}},{"line":257,"address":[],"length":0,"stats":{"Line":0}},{"line":258,"address":[],"length":0,"stats":{"Line":0}},{"line":259,"address":[],"length":0,"stats":{"Line":0}},{"line":260,"address":[],"length":0,"stats":{"Line":0}},{"line":261,"address":[],"length":0,"stats":{"Line":0}},{"line":263,"address":[],"length":0,"stats":{"Line":0}},{"line":264,"address":[],"length":0,"stats":{"Line":0}},{"line":265,"address":[],"length":0,"stats":{"Line":0}},{"line":267,"address":[],"length":0,"stats":{"Line":0}},{"line":268,"address":[],"length":0,"stats":{"Line":0}},{"line":269,"address":[],"length":0,"stats":{"Line":0}},{"line":270,"address":[],"length":0,"stats":{"Line":0}},{"line":272,"address":[],"length":0,"stats":{"Line":0}},{"line":273,"address":[],"length":0,"stats":{"Line":0}},{"line":274,"address":[],"length":0,"stats":{"Line":0}},{"line":275,"address":[],"length":0,"stats":{"Line":0}},{"line":277,"address":[],"length":0,"stats":{"Line":0}},{"line":278,"address":[],"length":0,"stats":{"Line":0}},{"line":279,"address":[],"length":0,"stats":{"Line":0}},{"line":280,"address":[],"length":0,"stats":{"Line":0}},{"line":282,"address":[],"length":0,"stats":{"Line":0}},{"line":283,"address":[],"length":0,"stats":{"Line":0}},{"line":284,"address":[],"length":0,"stats":{"Line":0}},{"line":285,"address":[],"length":0,"stats":{"Line":0}},{"line":286,"address":[],"length":0,"stats":{"Line":0}},{"line":287,"address":[],"length":0,"stats":{"Line":0}},{"line":288,"address":[],"length":0,"stats":{"Line":0}},{"line":290,"address":[],"length":0,"stats":{"Line":0}},{"line":291,"address":[],"length":0,"stats":{"Line":0}},{"line":292,"address":[],"length":0,"stats":{"Line":0}},{"line":293,"address":[],"length":0,"stats":{"Line":0}},{"line":294,"address":[],"length":0,"stats":{"Line":0}},{"line":296,"address":[],"length":0,"stats":{"Line":0}},{"line":298,"address":[],"length":0,"stats":{"Line":0}},{"line":299,"address":[],"length":0,"stats":{"Line":0}},{"line":300,"address":[],"length":0,"stats":{"Line":0}},{"line":301,"address":[],"length":0,"stats":{"Line":0}},{"line":302,"address":[],"length":0,"stats":{"Line":0}},{"line":304,"address":[],"length":0,"stats":{"Line":0}},{"line":305,"address":[],"length":0,"stats":{"Line":0}},{"line":306,"address":[],"length":0,"stats":{"Line":0}},{"line":307,"address":[],"length":0,"stats":{"Line":0}},{"line":310,"address":[],"length":0,"stats":{"Line":0}},{"line":311,"address":[],"length":0,"stats":{"Line":0}},{"line":312,"address":[],"length":0,"stats":{"Line":0}},{"line":315,"address":[],"length":0,"stats":{"Line":0}},{"line":316,"address":[],"length":0,"stats":{"Line":0}},{"line":318,"address":[],"length":0,"stats":{"Line":0}},{"line":319,"address":[],"length":0,"stats":{"Line":0}},{"line":320,"address":[],"length":0,"stats":{"Line":0}},{"line":321,"address":[],"length":0,"stats":{"Line":0}},{"line":323,"address":[],"length":0,"stats":{"Line":0}},{"line":324,"address":[],"length":0,"stats":{"Line":0}},{"line":325,"address":[],"length":0,"stats":{"Line":0}},{"line":326,"address":[],"length":0,"stats":{"Line":0}},{"line":328,"address":[],"length":0,"stats":{"Line":0}},{"line":329,"address":[],"length":0,"stats":{"Line":0}},{"line":330,"address":[],"length":0,"stats":{"Line":0}},{"line":331,"address":[],"length":0,"stats":{"Line":0}},{"line":333,"address":[],"length":0,"stats":{"Line":0}},{"line":335,"address":[],"length":0,"stats":{"Line":0}},{"line":336,"address":[],"length":0,"stats":{"Line":0}},{"line":337,"address":[],"length":0,"stats":{"Line":0}},{"line":338,"address":[],"length":0,"stats":{"Line":0}},{"line":341,"address":[],"length":0,"stats":{"Line":0}},{"line":342,"address":[],"length":0,"stats":{"Line":0}},{"line":343,"address":[],"length":0,"stats":{"Line":0}},{"line":344,"address":[],"length":0,"stats":{"Line":0}},{"line":345,"address":[],"length":0,"stats":{"Line":0}},{"line":346,"address":[],"length":0,"stats":{"Line":0}},{"line":347,"address":[],"length":0,"stats":{"Line":0}},{"line":348,"address":[],"length":0,"stats":{"Line":0}},{"line":349,"address":[],"length":0,"stats":{"Line":0}},{"line":350,"address":[],"length":0,"stats":{"Line":0}},{"line":351,"address":[],"length":0,"stats":{"Line":0}},{"line":352,"address":[],"length":0,"stats":{"Line":0}},{"line":353,"address":[],"length":0,"stats":{"Line":0}},{"line":354,"address":[],"length":0,"stats":{"Line":0}},{"line":355,"address":[],"length":0,"stats":{"Line":0}},{"line":356,"address":[],"length":0,"stats":{"Line":0}},{"line":357,"address":[],"length":0,"stats":{"Line":0}},{"line":358,"address":[],"length":0,"stats":{"Line":0}},{"line":359,"address":[],"length":0,"stats":{"Line":0}},{"line":360,"address":[],"length":0,"stats":{"Line":0}},{"line":361,"address":[],"length":0,"stats":{"Line":0}},{"line":362,"address":[],"length":0,"stats":{"Line":0}},{"line":363,"address":[],"length":0,"stats":{"Line":0}},{"line":364,"address":[],"length":0,"stats":{"Line":0}},{"line":365,"address":[],"length":0,"stats":{"Line":0}},{"line":367,"address":[],"length":0,"stats":{"Line":0}},{"line":372,"address":[],"length":0,"stats":{"Line":0}},{"line":373,"address":[],"length":0,"stats":{"Line":0}},{"line":374,"address":[],"length":0,"stats":{"Line":0}},{"line":375,"address":[],"length":0,"stats":{"Line":0}},{"line":376,"address":[],"length":0,"stats":{"Line":0}},{"line":377,"address":[],"length":0,"stats":{"Line":0}},{"line":378,"address":[],"length":0,"stats":{"Line":0}},{"line":380,"address":[],"length":0,"stats":{"Line":0}},{"line":381,"address":[],"length":0,"stats":{"Line":0}},{"line":382,"address":[],"length":0,"stats":{"Line":0}},{"line":384,"address":[],"length":0,"stats":{"Line":0}},{"line":385,"address":[],"length":0,"stats":{"Line":0}},{"line":387,"address":[],"length":0,"stats":{"Line":0}},{"line":388,"address":[],"length":0,"stats":{"Line":0}},{"line":389,"address":[],"length":0,"stats":{"Line":0}},{"line":390,"address":[],"length":0,"stats":{"Line":0}},{"line":392,"address":[],"length":0,"stats":{"Line":0}},{"line":393,"address":[],"length":0,"stats":{"Line":0}},{"line":394,"address":[],"length":0,"stats":{"Line":0}},{"line":395,"address":[],"length":0,"stats":{"Line":0}},{"line":397,"address":[],"length":0,"stats":{"Line":0}},{"line":398,"address":[],"length":0,"stats":{"Line":0}},{"line":399,"address":[],"length":0,"stats":{"Line":0}},{"line":400,"address":[],"length":0,"stats":{"Line":0}},{"line":402,"address":[],"length":0,"stats":{"Line":0}},{"line":403,"address":[],"length":0,"stats":{"Line":0}},{"line":404,"address":[],"length":0,"stats":{"Line":0}},{"line":405,"address":[],"length":0,"stats":{"Line":0}},{"line":407,"address":[],"length":0,"stats":{"Line":0}},{"line":409,"address":[],"length":0,"stats":{"Line":0}},{"line":410,"address":[],"length":0,"stats":{"Line":0}},{"line":411,"address":[],"length":0,"stats":{"Line":0}},{"line":413,"address":[],"length":0,"stats":{"Line":0}},{"line":414,"address":[],"length":0,"stats":{"Line":0}},{"line":415,"address":[],"length":0,"stats":{"Line":0}},{"line":417,"address":[],"length":0,"stats":{"Line":0}},{"line":418,"address":[],"length":0,"stats":{"Line":0}},{"line":420,"address":[],"length":0,"stats":{"Line":0}},{"line":421,"address":[],"length":0,"stats":{"Line":0}},{"line":422,"address":[],"length":0,"stats":{"Line":0}},{"line":423,"address":[],"length":0,"stats":{"Line":0}},{"line":424,"address":[],"length":0,"stats":{"Line":0}},{"line":426,"address":[],"length":0,"stats":{"Line":0}},{"line":427,"address":[],"length":0,"stats":{"Line":0}},{"line":428,"address":[],"length":0,"stats":{"Line":0}},{"line":429,"address":[],"length":0,"stats":{"Line":0}},{"line":430,"address":[],"length":0,"stats":{"Line":0}},{"line":431,"address":[],"length":0,"stats":{"Line":0}},{"line":433,"address":[],"length":0,"stats":{"Line":0}},{"line":434,"address":[],"length":0,"stats":{"Line":0}},{"line":435,"address":[],"length":0,"stats":{"Line":0}},{"line":436,"address":[],"length":0,"stats":{"Line":0}},{"line":437,"address":[],"length":0,"stats":{"Line":0}},{"line":438,"address":[],"length":0,"stats":{"Line":0}},{"line":440,"address":[],"length":0,"stats":{"Line":0}},{"line":441,"address":[],"length":0,"stats":{"Line":0}},{"line":442,"address":[],"length":0,"stats":{"Line":0}},{"line":443,"address":[],"length":0,"stats":{"Line":0}},{"line":444,"address":[],"length":0,"stats":{"Line":0}},{"line":445,"address":[],"length":0,"stats":{"Line":0}},{"line":447,"address":[],"length":0,"stats":{"Line":0}},{"line":450,"address":[],"length":0,"stats":{"Line":0}},{"line":451,"address":[],"length":0,"stats":{"Line":0}},{"line":452,"address":[],"length":0,"stats":{"Line":0}},{"line":453,"address":[],"length":0,"stats":{"Line":0}},{"line":454,"address":[],"length":0,"stats":{"Line":0}},{"line":455,"address":[],"length":0,"stats":{"Line":0}},{"line":456,"address":[],"length":0,"stats":{"Line":0}},{"line":457,"address":[],"length":0,"stats":{"Line":0}},{"line":458,"address":[],"length":0,"stats":{"Line":0}},{"line":459,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":283},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","ui","src","toolbar","tools.rs"],"content":"//! Tool selection controls for the toolbar\n//!\n//! Provides buttons for selecting canvas tools (Select, Rectangle, Circle, Text).\n\nuse gtk4::prelude::*;\nuse gtk4::{Box as GtkBox, Orientation, ToggleButton};\nuse crate::canvas::tools::ToolMode;\n\n/// Tool selection button group\npub struct ToolButtons {\n    pub select_btn: ToggleButton,\n    pub rectangle_btn: ToggleButton,\n    pub circle_btn: ToggleButton,\n    pub line_btn: ToggleButton,\n    pub arrow_btn: ToggleButton,\n    pub image_btn: ToggleButton,\n    pub text_btn: ToggleButton,\n}\n\nimpl ToolButtons {\n    /// Create a new tool button group\n    pub fn new() -\u003e Self {\n        Self {\n            select_btn: ToggleButton::with_label(\"Select\"),\n            rectangle_btn: ToggleButton::with_label(\"Rectangle\"),\n            circle_btn: ToggleButton::with_label(\"Circle\"),\n            line_btn: ToggleButton::with_label(\"Line\"),\n            arrow_btn: ToggleButton::with_label(\"Arrow\"),\n            image_btn: ToggleButton::with_label(\"Image\"),\n            text_btn: ToggleButton::with_label(\"Text\"),\n        }\n    }\n\n    /// Get the currently selected tool based on button state\n    pub fn get_selected_tool(\u0026self) -\u003e ToolMode {\n        if self.rectangle_btn.is_active() {\n            ToolMode::Rectangle\n        } else if self.circle_btn.is_active() {\n            ToolMode::Circle\n        } else if self.line_btn.is_active() {\n            ToolMode::Line\n        } else if self.arrow_btn.is_active() {\n            ToolMode::Arrow\n        } else if self.image_btn.is_active() {\n            ToolMode::Image\n        } else if self.text_btn.is_active() {\n            ToolMode::Text\n        } else {\n            ToolMode::Select\n        }\n    }\n\n    /// Set the currently selected tool\n    pub fn set_selected_tool(\u0026self, tool: ToolMode) {\n        // Deselect all buttons\n        self.select_btn.set_active(false);\n        self.rectangle_btn.set_active(false);\n        self.circle_btn.set_active(false);\n        self.line_btn.set_active(false);\n        self.arrow_btn.set_active(false);\n        self.image_btn.set_active(false);\n        self.text_btn.set_active(false);\n\n        // Activate the appropriate button\n        match tool {\n            ToolMode::Select =\u003e self.select_btn.set_active(true),\n            ToolMode::Rectangle =\u003e self.rectangle_btn.set_active(true),\n            ToolMode::Circle =\u003e self.circle_btn.set_active(true),\n            ToolMode::Line =\u003e self.line_btn.set_active(true),\n            ToolMode::Arrow =\u003e self.arrow_btn.set_active(true),\n            ToolMode::Image =\u003e self.image_btn.set_active(true),\n            ToolMode::Text =\u003e self.text_btn.set_active(true),\n            ToolMode::Pan =\u003e {}, // Pan is not a selectable tool button\n        }\n    }\n}\n\n/// Build tool selection toolbar section\npub fn build_tool_section(container: \u0026GtkBox) -\u003e ToolButtons {\n    let tool_header = GtkBox::new(Orientation::Horizontal, 8);\n    tool_header.set_margin_start(12);\n    tool_header.set_margin_top(12);\n\n    let tool_icon = gtk4::Label::new(Some(\"\"));\n    tool_icon.add_css_class(\"section-icon\");\n\n    let tool_label = gtk4::Label::new(Some(\"Shape Tools\"));\n    tool_label.add_css_class(\"section-heading\");\n    tool_label.set_halign(gtk4::Align::Start);\n\n    tool_header.append(\u0026tool_icon);\n    tool_header.append(\u0026tool_label);\n    container.append(\u0026tool_header);\n\n    let tool_buttons_box = GtkBox::new(Orientation::Vertical, 6);\n    tool_buttons_box.set_margin_start(12);\n    tool_buttons_box.set_margin_end(12);\n\n    let tool_row1 = GtkBox::new(Orientation::Horizontal, 6);\n    tool_row1.set_homogeneous(true);\n\n    let tool_row2 = GtkBox::new(Orientation::Horizontal, 6);\n    tool_row2.set_homogeneous(true);\n\n    let buttons = ToolButtons::new();\n\n    buttons.select_btn.set_active(true);  // Default to Select\n    buttons.select_btn.add_css_class(\"flat\");\n    tool_row1.append(\u0026buttons.select_btn);\n\n    buttons.rectangle_btn.add_css_class(\"flat\");\n    tool_row1.append(\u0026buttons.rectangle_btn);\n\n    buttons.circle_btn.add_css_class(\"flat\");\n    tool_row1.append(\u0026buttons.circle_btn);\n\n    buttons.line_btn.add_css_class(\"flat\");\n    tool_row1.append(\u0026buttons.line_btn);\n\n    buttons.arrow_btn.add_css_class(\"flat\");\n    tool_row2.append(\u0026buttons.arrow_btn);\n\n    buttons.image_btn.add_css_class(\"flat\");\n    tool_row2.append(\u0026buttons.image_btn);\n\n    buttons.text_btn.add_css_class(\"flat\");\n    tool_row2.append(\u0026buttons.text_btn);\n\n    tool_buttons_box.append(\u0026tool_row1);\n    tool_buttons_box.append(\u0026tool_row2);\n    container.append(\u0026tool_buttons_box);\n\n    buttons\n}\n","traces":[{"line":22,"address":[],"length":0,"stats":{"Line":0}},{"line":24,"address":[],"length":0,"stats":{"Line":0}},{"line":25,"address":[],"length":0,"stats":{"Line":0}},{"line":26,"address":[],"length":0,"stats":{"Line":0}},{"line":27,"address":[],"length":0,"stats":{"Line":0}},{"line":28,"address":[],"length":0,"stats":{"Line":0}},{"line":29,"address":[],"length":0,"stats":{"Line":0}},{"line":30,"address":[],"length":0,"stats":{"Line":0}},{"line":35,"address":[],"length":0,"stats":{"Line":0}},{"line":36,"address":[],"length":0,"stats":{"Line":0}},{"line":37,"address":[],"length":0,"stats":{"Line":0}},{"line":38,"address":[],"length":0,"stats":{"Line":0}},{"line":39,"address":[],"length":0,"stats":{"Line":0}},{"line":40,"address":[],"length":0,"stats":{"Line":0}},{"line":41,"address":[],"length":0,"stats":{"Line":0}},{"line":42,"address":[],"length":0,"stats":{"Line":0}},{"line":43,"address":[],"length":0,"stats":{"Line":0}},{"line":44,"address":[],"length":0,"stats":{"Line":0}},{"line":45,"address":[],"length":0,"stats":{"Line":0}},{"line":46,"address":[],"length":0,"stats":{"Line":0}},{"line":47,"address":[],"length":0,"stats":{"Line":0}},{"line":49,"address":[],"length":0,"stats":{"Line":0}},{"line":54,"address":[],"length":0,"stats":{"Line":0}},{"line":56,"address":[],"length":0,"stats":{"Line":0}},{"line":57,"address":[],"length":0,"stats":{"Line":0}},{"line":58,"address":[],"length":0,"stats":{"Line":0}},{"line":59,"address":[],"length":0,"stats":{"Line":0}},{"line":60,"address":[],"length":0,"stats":{"Line":0}},{"line":61,"address":[],"length":0,"stats":{"Line":0}},{"line":62,"address":[],"length":0,"stats":{"Line":0}},{"line":65,"address":[],"length":0,"stats":{"Line":0}},{"line":66,"address":[],"length":0,"stats":{"Line":0}},{"line":67,"address":[],"length":0,"stats":{"Line":0}},{"line":68,"address":[],"length":0,"stats":{"Line":0}},{"line":69,"address":[],"length":0,"stats":{"Line":0}},{"line":70,"address":[],"length":0,"stats":{"Line":0}},{"line":71,"address":[],"length":0,"stats":{"Line":0}},{"line":72,"address":[],"length":0,"stats":{"Line":0}},{"line":73,"address":[],"length":0,"stats":{"Line":0}},{"line":79,"address":[],"length":0,"stats":{"Line":0}},{"line":80,"address":[],"length":0,"stats":{"Line":0}},{"line":81,"address":[],"length":0,"stats":{"Line":0}},{"line":82,"address":[],"length":0,"stats":{"Line":0}},{"line":84,"address":[],"length":0,"stats":{"Line":0}},{"line":85,"address":[],"length":0,"stats":{"Line":0}},{"line":87,"address":[],"length":0,"stats":{"Line":0}},{"line":88,"address":[],"length":0,"stats":{"Line":0}},{"line":89,"address":[],"length":0,"stats":{"Line":0}},{"line":91,"address":[],"length":0,"stats":{"Line":0}},{"line":92,"address":[],"length":0,"stats":{"Line":0}},{"line":93,"address":[],"length":0,"stats":{"Line":0}},{"line":95,"address":[],"length":0,"stats":{"Line":0}},{"line":96,"address":[],"length":0,"stats":{"Line":0}},{"line":97,"address":[],"length":0,"stats":{"Line":0}},{"line":99,"address":[],"length":0,"stats":{"Line":0}},{"line":100,"address":[],"length":0,"stats":{"Line":0}},{"line":102,"address":[],"length":0,"stats":{"Line":0}},{"line":103,"address":[],"length":0,"stats":{"Line":0}},{"line":105,"address":[],"length":0,"stats":{"Line":0}},{"line":107,"address":[],"length":0,"stats":{"Line":0}},{"line":108,"address":[],"length":0,"stats":{"Line":0}},{"line":109,"address":[],"length":0,"stats":{"Line":0}},{"line":111,"address":[],"length":0,"stats":{"Line":0}},{"line":112,"address":[],"length":0,"stats":{"Line":0}},{"line":114,"address":[],"length":0,"stats":{"Line":0}},{"line":115,"address":[],"length":0,"stats":{"Line":0}},{"line":117,"address":[],"length":0,"stats":{"Line":0}},{"line":118,"address":[],"length":0,"stats":{"Line":0}},{"line":120,"address":[],"length":0,"stats":{"Line":0}},{"line":121,"address":[],"length":0,"stats":{"Line":0}},{"line":123,"address":[],"length":0,"stats":{"Line":0}},{"line":124,"address":[],"length":0,"stats":{"Line":0}},{"line":126,"address":[],"length":0,"stats":{"Line":0}},{"line":127,"address":[],"length":0,"stats":{"Line":0}},{"line":129,"address":[],"length":0,"stats":{"Line":0}},{"line":130,"address":[],"length":0,"stats":{"Line":0}},{"line":131,"address":[],"length":0,"stats":{"Line":0}},{"line":133,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":78},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","ui","src","undo_redo.rs"],"content":"//! Undo/Redo system for document operations\n//!\n//! Provides a command-based undo/redo stack for tracking and reverting\n//! document changes, with support for batched operations.\n\nuse std::collections::VecDeque;\n\n/// Command trait for undo/redo operations\npub trait Command: std::fmt::Debug {\n    /// Execute the command and return a description\n    fn execute(\u0026mut self) -\u003e Result\u003cString, String\u003e;\n\n    /// Undo the command\n    fn undo(\u0026mut self) -\u003e Result\u003cString, String\u003e;\n\n    /// Get a description of this command\n    fn description(\u0026self) -\u003e \u0026str;\n}\n\n/// Undo/Redo stack manager\n#[derive(Debug)]\npub struct UndoRedoStack {\n    /// Commands that can be undone (uses VecDeque for O(1) operations)\n    undo_stack: VecDeque\u003cBox\u003cdyn Command\u003e\u003e,\n\n    /// Commands that can be redone (uses VecDeque for O(1) operations)\n    redo_stack: VecDeque\u003cBox\u003cdyn Command\u003e\u003e,\n\n    /// Maximum number of commands to keep in history\n    max_history: usize,\n\n    /// Whether we're currently in the middle of a batch operation\n    in_batch: bool,\n\n    /// Batched commands being accumulated\n    batch_commands: Vec\u003cBox\u003cdyn Command\u003e\u003e,\n\n    /// Description for the current batch\n    batch_description: String,\n}\n\nimpl UndoRedoStack {\n    /// Create a new undo/redo stack with default capacity (100 commands)\n    pub fn new() -\u003e Self {\n        Self::with_capacity(100)\n    }\n\n    /// Create a new undo/redo stack with specified capacity\n    pub fn with_capacity(max_history: usize) -\u003e Self {\n        Self {\n            undo_stack: VecDeque::with_capacity(max_history),\n            redo_stack: VecDeque::with_capacity(max_history),\n            max_history,\n            in_batch: false,\n            batch_commands: Vec::new(),\n            batch_description: String::new(),\n        }\n    }\n\n    /// Push a command onto the undo stack\n    pub fn push(\u0026mut self, mut command: Box\u003cdyn Command\u003e) {\n        if let Ok(_desc) = command.execute() {\n            if self.in_batch {\n                // If in batch mode, accumulate the command\n                self.batch_commands.push(command);\n            } else {\n                // Clear redo stack when new command is executed\n                self.redo_stack.clear();\n\n                // Add to undo stack\n                self.undo_stack.push_back(command);\n\n                // Limit stack size (O(1) operation with VecDeque)\n                if self.undo_stack.len() \u003e self.max_history {\n                    self.undo_stack.pop_front();\n                }\n            }\n        }\n    }\n\n    /// Start a batch operation\n    pub fn begin_batch(\u0026mut self, description: \u0026str) {\n        self.in_batch = true;\n        self.batch_description = description.to_string();\n        self.batch_commands.clear();\n    }\n\n    /// End a batch operation and push as a single command\n    pub fn end_batch(\u0026mut self) {\n        if self.in_batch \u0026\u0026 !self.batch_commands.is_empty() {\n            let commands = std::mem::take(\u0026mut self.batch_commands);\n            let batch_cmd = BatchCommand::new(commands, \u0026self.batch_description);\n            self.undo_stack.push_back(Box::new(batch_cmd));\n\n            // Limit stack size\n            if self.undo_stack.len() \u003e self.max_history {\n                self.undo_stack.pop_front();\n            }\n\n            // Clear redo stack\n            self.redo_stack.clear();\n        }\n        self.in_batch = false;\n        self.batch_commands.clear();\n    }\n\n    /// Undo the last command\n    pub fn undo(\u0026mut self) -\u003e bool {\n        if let Some(mut command) = self.undo_stack.pop_back() {\n            if command.undo().is_ok() {\n                self.redo_stack.push_back(command);\n                return true;\n            }\n        }\n        false\n    }\n\n    /// Redo the last undone command\n    pub fn redo(\u0026mut self) -\u003e bool {\n        if let Some(mut command) = self.redo_stack.pop_back() {\n            if command.execute().is_ok() {\n                self.undo_stack.push_back(command);\n                return true;\n            }\n        }\n        false\n    }\n\n    /// Check if undo is available\n    pub fn can_undo(\u0026self) -\u003e bool {\n        !self.undo_stack.is_empty() \u0026\u0026 !self.in_batch\n    }\n\n    /// Check if redo is available\n    pub fn can_redo(\u0026self) -\u003e bool {\n        !self.redo_stack.is_empty() \u0026\u0026 !self.in_batch\n    }\n\n    /// Get description of the next undo command\n    pub fn undo_description(\u0026self) -\u003e Option\u003c\u0026str\u003e {\n        self.undo_stack.back().map(|cmd| cmd.description())\n    }\n\n    /// Get description of the next redo command\n    pub fn redo_description(\u0026self) -\u003e Option\u003c\u0026str\u003e {\n        self.redo_stack.back().map(|cmd| cmd.description())\n    }\n\n    /// Clear all history\n    pub fn clear(\u0026mut self) {\n        self.undo_stack.clear();\n        self.redo_stack.clear();\n    }\n\n    /// Get the number of commands in the undo stack\n    pub fn undo_count(\u0026self) -\u003e usize {\n        self.undo_stack.len()\n    }\n\n    /// Get the number of commands in the redo stack\n    pub fn redo_count(\u0026self) -\u003e usize {\n        self.redo_stack.len()\n    }\n}\n\nimpl Default for UndoRedoStack {\n    fn default() -\u003e Self {\n        Self::new()\n    }\n}\n\n/// A batch of multiple commands treated as one\n#[derive(Debug)]\nstruct BatchCommand {\n    commands: Vec\u003cBox\u003cdyn Command\u003e\u003e,\n    description: String,\n}\n\nimpl BatchCommand {\n    fn new(commands: Vec\u003cBox\u003cdyn Command\u003e\u003e, description: \u0026str) -\u003e Self {\n        Self {\n            commands,\n            description: description.to_string(),\n        }\n    }\n}\n\nimpl Command for BatchCommand {\n    fn execute(\u0026mut self) -\u003e Result\u003cString, String\u003e {\n        for cmd in \u0026mut self.commands {\n            cmd.execute()?;\n        }\n        Ok(self.description.clone())\n    }\n\n    fn undo(\u0026mut self) -\u003e Result\u003cString, String\u003e {\n        // Undo in reverse order\n        for cmd in self.commands.iter_mut().rev() {\n            cmd.undo()?;\n        }\n        Ok(format!(\"Undo: {}\", self.description))\n    }\n\n    fn description(\u0026self) -\u003e \u0026str {\n        \u0026self.description\n    }\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n\n    #[derive(Debug)]\n    struct MockCommand {\n        executed: bool,\n        description: String,\n    }\n\n    impl MockCommand {\n        fn new(desc: \u0026str) -\u003e Self {\n            Self {\n                executed: false,\n                description: desc.to_string(),\n            }\n        }\n    }\n\n    impl Command for MockCommand {\n        fn execute(\u0026mut self) -\u003e Result\u003cString, String\u003e {\n            self.executed = true;\n            Ok(self.description.clone())\n        }\n\n        fn undo(\u0026mut self) -\u003e Result\u003cString, String\u003e {\n            self.executed = false;\n            Ok(format!(\"Undo: {}\", self.description))\n        }\n\n        fn description(\u0026self) -\u003e \u0026str {\n            \u0026self.description\n        }\n    }\n\n    #[test]\n    fn test_undo_redo_stack_creation() {\n        let stack = UndoRedoStack::new();\n        assert_eq!(stack.undo_count(), 0);\n        assert_eq!(stack.redo_count(), 0);\n        assert!(!stack.can_undo());\n        assert!(!stack.can_redo());\n    }\n\n    #[test]\n    fn test_push_and_undo() {\n        let mut stack = UndoRedoStack::new();\n        let cmd = Box::new(MockCommand::new(\"Test command\"));\n        stack.push(cmd);\n\n        assert!(stack.can_undo());\n        assert!(!stack.can_redo());\n        assert!(stack.undo());\n        assert!(!stack.can_undo());\n        assert!(stack.can_redo());\n    }\n\n    #[test]\n    fn test_batch_commands() {\n        let mut stack = UndoRedoStack::new();\n\n        stack.begin_batch(\"Batch operation\");\n        stack.push(Box::new(MockCommand::new(\"Cmd 1\")));\n        stack.push(Box::new(MockCommand::new(\"Cmd 2\")));\n        stack.end_batch();\n\n        assert!(stack.can_undo());\n        assert_eq!(stack.undo_count(), 1); // Should be single batched command\n    }\n}\n\n/// Delete command for removing document elements\npub struct DeleteCommand {\n    document: std::sync::Arc\u003cstd::sync::Mutex\u003ctestruct_core::document::Document\u003e\u003e,\n    element_id: uuid::Uuid,\n    deleted_element: Option\u003ctestruct_core::document::DocumentElement\u003e,\n    deleted_page_index: usize,\n}\n\nimpl DeleteCommand {\n    /// Create a new delete command\n    pub fn new(\n        document: std::sync::Arc\u003cstd::sync::Mutex\u003ctestruct_core::document::Document\u003e\u003e,\n        element_id: uuid::Uuid,\n        page_index: usize,\n    ) -\u003e Self {\n        Self {\n            document,\n            element_id,\n            deleted_element: None,\n            deleted_page_index: page_index,\n        }\n    }\n}\n\nimpl Command for DeleteCommand {\n    fn execute(\u0026mut self) -\u003e Result\u003cString, String\u003e {\n        let mut doc = self.document.lock().expect(\"document lock\");\n\n        if self.deleted_page_index \u003e= doc.pages.len() {\n            return Err(\"Page index out of bounds\".to_string());\n        }\n\n        let page = \u0026mut doc.pages[self.deleted_page_index];\n\n        // Find and remove the element\n        if let Some(position) = page\n            .elements\n            .iter()\n            .position(|elem| elem_id(elem) == self.element_id)\n        {\n            self.deleted_element = Some(page.elements.remove(position));\n            Ok(format!(\"Deleted element {}\", self.element_id))\n        } else {\n            Err(format!(\"Element {} not found\", self.element_id))\n        }\n    }\n\n    fn undo(\u0026mut self) -\u003e Result\u003cString, String\u003e {\n        if let Some(element) = self.deleted_element.take() {\n            let mut doc = self.document.lock().expect(\"document lock\");\n\n            if self.deleted_page_index \u003e= doc.pages.len() {\n                return Err(\"Page index out of bounds\".to_string());\n            }\n\n            doc.pages[self.deleted_page_index].add_element(element);\n            Ok(format!(\"Restored element {}\", self.element_id))\n        } else {\n            Err(\"No deleted element to restore\".to_string())\n        }\n    }\n\n    fn description(\u0026self) -\u003e \u0026str {\n        \"Delete object\"\n    }\n}\n\nimpl std::fmt::Debug for DeleteCommand {\n    fn fmt(\u0026self, f: \u0026mut std::fmt::Formatter\u003c'_\u003e) -\u003e std::fmt::Result {\n        f.debug_struct(\"DeleteCommand\")\n            .field(\"element_id\", \u0026self.element_id)\n            .field(\"page_index\", \u0026self.deleted_page_index)\n            .finish()\n    }\n}\n\n/// Create command for adding new document elements\n#[derive(Debug)]\npub struct CreateCommand {\n    document: std::sync::Arc\u003cstd::sync::Mutex\u003ctestruct_core::document::Document\u003e\u003e,\n    element: Option\u003ctestruct_core::document::DocumentElement\u003e,\n    element_id: Option\u003cuuid::Uuid\u003e,\n    page_index: usize,\n}\n\nimpl CreateCommand {\n    /// Create a new create command\n    pub fn new(\n        document: std::sync::Arc\u003cstd::sync::Mutex\u003ctestruct_core::document::Document\u003e\u003e,\n        element: testruct_core::document::DocumentElement,\n        page_index: usize,\n    ) -\u003e Self {\n        let element_id = Some(elem_id(\u0026element));\n        Self {\n            document,\n            element: Some(element),\n            element_id,\n            page_index,\n        }\n    }\n}\n\nimpl Command for CreateCommand {\n    fn execute(\u0026mut self) -\u003e Result\u003cString, String\u003e {\n        if let Some(element) = self.element.take() {\n            let element_id = elem_id(\u0026element);\n            let mut doc = self.document.lock().expect(\"document lock\");\n\n            if self.page_index \u003e= doc.pages.len() {\n                return Err(\"Page index out of bounds\".to_string());\n            }\n\n            doc.pages[self.page_index].add_element(element);\n            Ok(format!(\"Created element {}\", element_id))\n        } else {\n            Err(\"No element to create\".to_string())\n        }\n    }\n\n    fn undo(\u0026mut self) -\u003e Result\u003cString, String\u003e {\n        // Find and remove the element we created by ID\n        if let Some(element_id) = self.element_id {\n            let mut doc = self.document.lock().expect(\"document lock\");\n\n            if self.page_index \u003e= doc.pages.len() {\n                return Err(\"Page index out of bounds\".to_string());\n            }\n\n            let page = \u0026mut doc.pages[self.page_index];\n            if let Some(position) = page\n                .elements\n                .iter()\n                .position(|elem| elem_id(elem) == element_id)\n            {\n                self.element = Some(page.elements.remove(position));\n                Ok(format!(\"Removed element {}\", element_id))\n            } else {\n                Err(format!(\"Element {} not found for undo\", element_id))\n            }\n        } else {\n            Err(\"No element ID stored for undo\".to_string())\n        }\n    }\n\n    fn description(\u0026self) -\u003e \u0026str {\n        \"Create object\"\n    }\n}\n\n/// Helper function to get element ID from DocumentElement enum\nfn elem_id(element: \u0026testruct_core::document::DocumentElement) -\u003e uuid::Uuid {\n    match element {\n        testruct_core::document::DocumentElement::Frame(f) =\u003e f.id,\n        testruct_core::document::DocumentElement::Text(t) =\u003e t.id,\n        testruct_core::document::DocumentElement::Image(i) =\u003e i.id,\n        testruct_core::document::DocumentElement::Shape(s) =\u003e s.id,\n    }\n}\n","traces":[{"line":44,"address":[],"length":0,"stats":{"Line":3}},{"line":45,"address":[],"length":0,"stats":{"Line":3}},{"line":49,"address":[],"length":0,"stats":{"Line":3}},{"line":51,"address":[],"length":0,"stats":{"Line":9}},{"line":52,"address":[],"length":0,"stats":{"Line":9}},{"line":55,"address":[],"length":0,"stats":{"Line":3}},{"line":56,"address":[],"length":0,"stats":{"Line":3}},{"line":61,"address":[],"length":0,"stats":{"Line":3}},{"line":62,"address":[],"length":0,"stats":{"Line":6}},{"line":63,"address":[],"length":0,"stats":{"Line":5}},{"line":65,"address":[],"length":0,"stats":{"Line":4}},{"line":68,"address":[],"length":0,"stats":{"Line":2}},{"line":71,"address":[],"length":0,"stats":{"Line":3}},{"line":74,"address":[],"length":0,"stats":{"Line":2}},{"line":75,"address":[],"length":0,"stats":{"Line":0}},{"line":82,"address":[],"length":0,"stats":{"Line":1}},{"line":83,"address":[],"length":0,"stats":{"Line":1}},{"line":84,"address":[],"length":0,"stats":{"Line":3}},{"line":85,"address":[],"length":0,"stats":{"Line":2}},{"line":89,"address":[],"length":0,"stats":{"Line":1}},{"line":90,"address":[],"length":0,"stats":{"Line":2}},{"line":91,"address":[],"length":0,"stats":{"Line":3}},{"line":92,"address":[],"length":0,"stats":{"Line":4}},{"line":93,"address":[],"length":0,"stats":{"Line":3}},{"line":96,"address":[],"length":0,"stats":{"Line":2}},{"line":97,"address":[],"length":0,"stats":{"Line":0}},{"line":101,"address":[],"length":0,"stats":{"Line":2}},{"line":103,"address":[],"length":0,"stats":{"Line":1}},{"line":104,"address":[],"length":0,"stats":{"Line":2}},{"line":108,"address":[],"length":0,"stats":{"Line":1}},{"line":109,"address":[],"length":0,"stats":{"Line":2}},{"line":110,"address":[],"length":0,"stats":{"Line":2}},{"line":111,"address":[],"length":0,"stats":{"Line":3}},{"line":112,"address":[],"length":0,"stats":{"Line":1}},{"line":115,"address":[],"length":0,"stats":{"Line":0}},{"line":119,"address":[],"length":0,"stats":{"Line":0}},{"line":120,"address":[],"length":0,"stats":{"Line":0}},{"line":121,"address":[],"length":0,"stats":{"Line":0}},{"line":122,"address":[],"length":0,"stats":{"Line":0}},{"line":123,"address":[],"length":0,"stats":{"Line":0}},{"line":126,"address":[],"length":0,"stats":{"Line":0}},{"line":130,"address":[],"length":0,"stats":{"Line":4}},{"line":131,"address":[],"length":0,"stats":{"Line":6}},{"line":135,"address":[],"length":0,"stats":{"Line":3}},{"line":136,"address":[],"length":0,"stats":{"Line":4}},{"line":140,"address":[],"length":0,"stats":{"Line":0}},{"line":141,"address":[],"length":0,"stats":{"Line":0}},{"line":145,"address":[],"length":0,"stats":{"Line":0}},{"line":146,"address":[],"length":0,"stats":{"Line":0}},{"line":150,"address":[],"length":0,"stats":{"Line":0}},{"line":151,"address":[],"length":0,"stats":{"Line":0}},{"line":152,"address":[],"length":0,"stats":{"Line":0}},{"line":156,"address":[],"length":0,"stats":{"Line":2}},{"line":157,"address":[],"length":0,"stats":{"Line":4}},{"line":161,"address":[],"length":0,"stats":{"Line":1}},{"line":162,"address":[],"length":0,"stats":{"Line":2}},{"line":167,"address":[],"length":0,"stats":{"Line":0}},{"line":168,"address":[],"length":0,"stats":{"Line":0}},{"line":180,"address":[],"length":0,"stats":{"Line":1}},{"line":183,"address":[],"length":0,"stats":{"Line":1}},{"line":189,"address":[],"length":0,"stats":{"Line":0}},{"line":190,"address":[],"length":0,"stats":{"Line":0}},{"line":191,"address":[],"length":0,"stats":{"Line":0}},{"line":193,"address":[],"length":0,"stats":{"Line":0}},{"line":196,"address":[],"length":0,"stats":{"Line":0}},{"line":198,"address":[],"length":0,"stats":{"Line":0}},{"line":199,"address":[],"length":0,"stats":{"Line":0}},{"line":201,"address":[],"length":0,"stats":{"Line":0}},{"line":204,"address":[],"length":0,"stats":{"Line":0}},{"line":205,"address":[],"length":0,"stats":{"Line":0}},{"line":290,"address":[],"length":0,"stats":{"Line":0}},{"line":305,"address":[],"length":0,"stats":{"Line":0}},{"line":306,"address":[],"length":0,"stats":{"Line":0}},{"line":308,"address":[],"length":0,"stats":{"Line":0}},{"line":309,"address":[],"length":0,"stats":{"Line":0}},{"line":312,"address":[],"length":0,"stats":{"Line":0}},{"line":315,"address":[],"length":0,"stats":{"Line":0}},{"line":316,"address":[],"length":0,"stats":{"Line":0}},{"line":318,"address":[],"length":0,"stats":{"Line":0}},{"line":320,"address":[],"length":0,"stats":{"Line":0}},{"line":321,"address":[],"length":0,"stats":{"Line":0}},{"line":323,"address":[],"length":0,"stats":{"Line":0}},{"line":327,"address":[],"length":0,"stats":{"Line":0}},{"line":328,"address":[],"length":0,"stats":{"Line":0}},{"line":329,"address":[],"length":0,"stats":{"Line":0}},{"line":331,"address":[],"length":0,"stats":{"Line":0}},{"line":332,"address":[],"length":0,"stats":{"Line":0}},{"line":335,"address":[],"length":0,"stats":{"Line":0}},{"line":336,"address":[],"length":0,"stats":{"Line":0}},{"line":338,"address":[],"length":0,"stats":{"Line":0}},{"line":342,"address":[],"length":0,"stats":{"Line":0}},{"line":343,"address":[],"length":0,"stats":{"Line":0}},{"line":348,"address":[],"length":0,"stats":{"Line":0}},{"line":349,"address":[],"length":0,"stats":{"Line":0}},{"line":350,"address":[],"length":0,"stats":{"Line":0}},{"line":351,"address":[],"length":0,"stats":{"Line":0}},{"line":367,"address":[],"length":0,"stats":{"Line":0}},{"line":372,"address":[],"length":0,"stats":{"Line":0}},{"line":375,"address":[],"length":0,"stats":{"Line":0}},{"line":383,"address":[],"length":0,"stats":{"Line":0}},{"line":384,"address":[],"length":0,"stats":{"Line":0}},{"line":385,"address":[],"length":0,"stats":{"Line":0}},{"line":386,"address":[],"length":0,"stats":{"Line":0}},{"line":388,"address":[],"length":0,"stats":{"Line":0}},{"line":389,"address":[],"length":0,"stats":{"Line":0}},{"line":392,"address":[],"length":0,"stats":{"Line":0}},{"line":393,"address":[],"length":0,"stats":{"Line":0}},{"line":395,"address":[],"length":0,"stats":{"Line":0}},{"line":399,"address":[],"length":0,"stats":{"Line":0}},{"line":401,"address":[],"length":0,"stats":{"Line":0}},{"line":402,"address":[],"length":0,"stats":{"Line":0}},{"line":404,"address":[],"length":0,"stats":{"Line":0}},{"line":405,"address":[],"length":0,"stats":{"Line":0}},{"line":408,"address":[],"length":0,"stats":{"Line":0}},{"line":409,"address":[],"length":0,"stats":{"Line":0}},{"line":410,"address":[],"length":0,"stats":{"Line":0}},{"line":412,"address":[],"length":0,"stats":{"Line":0}},{"line":414,"address":[],"length":0,"stats":{"Line":0}},{"line":415,"address":[],"length":0,"stats":{"Line":0}},{"line":417,"address":[],"length":0,"stats":{"Line":0}},{"line":420,"address":[],"length":0,"stats":{"Line":0}},{"line":424,"address":[],"length":0,"stats":{"Line":0}},{"line":425,"address":[],"length":0,"stats":{"Line":0}},{"line":430,"address":[],"length":0,"stats":{"Line":0}},{"line":431,"address":[],"length":0,"stats":{"Line":0}},{"line":432,"address":[],"length":0,"stats":{"Line":0}},{"line":433,"address":[],"length":0,"stats":{"Line":0}},{"line":434,"address":[],"length":0,"stats":{"Line":0}},{"line":435,"address":[],"length":0,"stats":{"Line":0}}],"covered":42,"coverable":129},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","ui","src","window","actions","alignment_actions.rs"],"content":"//! Alignment and distribution actions for selected objects\n//!\n//! Provides alignment operations: left, center (horizontal), right, top, center (vertical), bottom\n\nuse gtk4::prelude::*;\nuse testruct_core::layout::{Point, Rect};\nuse testruct_core::document::DocumentElement;\n\nuse super::common::add_window_action;\n\n/// Register alignment actions\npub fn register(\n    window: \u0026gtk4::ApplicationWindow,\n    state: crate::app::AppState,\n    canvas_view: \u0026crate::canvas::CanvasView,\n) {\n    let drawing_area = canvas_view.drawing_area();\n    let render_state = canvas_view.render_state().clone();\n\n    // Align left (leftmost object's x position)\n    {\n        let state_c = state.clone();\n        let render_c = render_state.clone();\n        let drawing_c = drawing_area.clone();\n\n        add_window_action(window, \"align-left\", move |_| {\n            let selected = render_c.selected_ids.borrow();\n            if selected.len() \u003e 1 {\n                apply_alignment(\n                    \u0026state_c,\n                    \u0026selected,\n                    AlignmentType::AlignLeft,\n                );\n                drawing_c.queue_draw();\n                tracing::info!(\" Objects aligned left\");\n            }\n        });\n    }\n\n    // Align center horizontal\n    {\n        let state_c = state.clone();\n        let render_c = render_state.clone();\n        let drawing_c = drawing_area.clone();\n\n        add_window_action(window, \"align-center-h\", move |_| {\n            let selected = render_c.selected_ids.borrow();\n            if selected.len() \u003e 1 {\n                apply_alignment(\n                    \u0026state_c,\n                    \u0026selected,\n                    AlignmentType::AlignCenterH,\n                );\n                drawing_c.queue_draw();\n                tracing::info!(\" Objects aligned center (horizontal)\");\n            }\n        });\n    }\n\n    // Align right\n    {\n        let state_c = state.clone();\n        let render_c = render_state.clone();\n        let drawing_c = drawing_area.clone();\n\n        add_window_action(window, \"align-right\", move |_| {\n            let selected = render_c.selected_ids.borrow();\n            if selected.len() \u003e 1 {\n                apply_alignment(\n                    \u0026state_c,\n                    \u0026selected,\n                    AlignmentType::AlignRight,\n                );\n                drawing_c.queue_draw();\n                tracing::info!(\" Objects aligned right\");\n            }\n        });\n    }\n\n    // Align top\n    {\n        let state_c = state.clone();\n        let render_c = render_state.clone();\n        let drawing_c = drawing_area.clone();\n\n        add_window_action(window, \"align-top\", move |_| {\n            let selected = render_c.selected_ids.borrow();\n            if selected.len() \u003e 1 {\n                apply_alignment(\n                    \u0026state_c,\n                    \u0026selected,\n                    AlignmentType::AlignTop,\n                );\n                drawing_c.queue_draw();\n                tracing::info!(\" Objects aligned top\");\n            }\n        });\n    }\n\n    // Align center vertical\n    {\n        let state_c = state.clone();\n        let render_c = render_state.clone();\n        let drawing_c = drawing_area.clone();\n\n        add_window_action(window, \"align-center-v\", move |_| {\n            let selected = render_c.selected_ids.borrow();\n            if selected.len() \u003e 1 {\n                apply_alignment(\n                    \u0026state_c,\n                    \u0026selected,\n                    AlignmentType::AlignCenterV,\n                );\n                drawing_c.queue_draw();\n                tracing::info!(\" Objects aligned center (vertical)\");\n            }\n        });\n    }\n\n    // Align bottom\n    {\n        let state_c = state.clone();\n        let render_c = render_state.clone();\n        let drawing_c = drawing_area.clone();\n\n        add_window_action(window, \"align-bottom\", move |_| {\n            let selected = render_c.selected_ids.borrow();\n            if selected.len() \u003e 1 {\n                apply_alignment(\n                    \u0026state_c,\n                    \u0026selected,\n                    AlignmentType::AlignBottom,\n                );\n                drawing_c.queue_draw();\n                tracing::info!(\" Objects aligned bottom\");\n            }\n        });\n    }\n}\n\n/// Alignment type\n#[derive(Clone, Copy, Debug)]\npub enum AlignmentType {\n    AlignLeft,\n    AlignCenterH,\n    AlignRight,\n    AlignTop,\n    AlignCenterV,\n    AlignBottom,\n}\n\n/// Helper function to get bounds from a DocumentElement\nfn get_element_bounds(element: \u0026DocumentElement) -\u003e Rect {\n    match element {\n        DocumentElement::Shape(shape) =\u003e shape.bounds,\n        DocumentElement::Text(text) =\u003e text.bounds,\n        DocumentElement::Image(image) =\u003e image.bounds,\n        DocumentElement::Frame(frame) =\u003e frame.bounds,\n    }\n}\n\n/// Apply alignment to selected objects\nfn apply_alignment(\n    state: \u0026crate::app::AppState,\n    selected_ids: \u0026[uuid::Uuid],\n    alignment_type: AlignmentType,\n) {\n    state.with_active_document(|doc| {\n        if let Some(page) = doc.pages.first_mut() {\n            // Collect bounds for all selected elements\n            let mut selected_bounds = Vec::new();\n            for element in \u0026page.elements {\n                if selected_ids.contains(\u0026element.id()) {\n                    selected_bounds.push((element.id(), get_element_bounds(element)));\n                }\n            }\n\n            if selected_bounds.len() \u003c 2 {\n                return;\n            }\n\n            // Calculate reference value based on alignment type\n            let reference = match alignment_type {\n                AlignmentType::AlignLeft =\u003e {\n                    selected_bounds.iter()\n                        .map(|(_, bounds)| bounds.origin.x)\n                        .fold(f32::INFINITY, f32::min)\n                }\n                AlignmentType::AlignRight =\u003e {\n                    selected_bounds.iter()\n                        .map(|(_, bounds)| bounds.origin.x + bounds.size.width)\n                        .fold(f32::NEG_INFINITY, f32::max)\n                }\n                AlignmentType::AlignCenterH =\u003e {\n                    let min_x = selected_bounds.iter()\n                        .map(|(_, bounds)| bounds.origin.x)\n                        .fold(f32::INFINITY, f32::min);\n                    let max_x = selected_bounds.iter()\n                        .map(|(_, bounds)| bounds.origin.x + bounds.size.width)\n                        .fold(f32::NEG_INFINITY, f32::max);\n                    (min_x + max_x) / 2.0\n                }\n                AlignmentType::AlignTop =\u003e {\n                    selected_bounds.iter()\n                        .map(|(_, bounds)| bounds.origin.y)\n                        .fold(f32::INFINITY, f32::min)\n                }\n                AlignmentType::AlignBottom =\u003e {\n                    selected_bounds.iter()\n                        .map(|(_, bounds)| bounds.origin.y + bounds.size.height)\n                        .fold(f32::NEG_INFINITY, f32::max)\n                }\n                AlignmentType::AlignCenterV =\u003e {\n                    let min_y = selected_bounds.iter()\n                        .map(|(_, bounds)| bounds.origin.y)\n                        .fold(f32::INFINITY, f32::min);\n                    let max_y = selected_bounds.iter()\n                        .map(|(_, bounds)| bounds.origin.y + bounds.size.height)\n                        .fold(f32::NEG_INFINITY, f32::max);\n                    (min_y + max_y) / 2.0\n                }\n            };\n\n            // Apply alignment to each selected element\n            for (element_id, _bounds) in selected_bounds {\n                for element in \u0026mut page.elements {\n                    if element.id() == element_id {\n                        let new_bounds = match alignment_type {\n                            AlignmentType::AlignLeft =\u003e {\n                                let elem_bounds = get_element_bounds(element);\n                                Rect {\n                                    origin: Point {\n                                        x: reference,\n                                        y: elem_bounds.origin.y,\n                                    },\n                                    size: elem_bounds.size,\n                                }\n                            }\n                            AlignmentType::AlignRight =\u003e {\n                                let elem_bounds = get_element_bounds(element);\n                                Rect {\n                                    origin: Point {\n                                        x: reference - elem_bounds.size.width,\n                                        y: elem_bounds.origin.y,\n                                    },\n                                    size: elem_bounds.size,\n                                }\n                            }\n                            AlignmentType::AlignCenterH =\u003e {\n                                let elem_bounds = get_element_bounds(element);\n                                Rect {\n                                    origin: Point {\n                                        x: reference - elem_bounds.size.width / 2.0,\n                                        y: elem_bounds.origin.y,\n                                    },\n                                    size: elem_bounds.size,\n                                }\n                            }\n                            AlignmentType::AlignTop =\u003e {\n                                let elem_bounds = get_element_bounds(element);\n                                Rect {\n                                    origin: Point {\n                                        x: elem_bounds.origin.x,\n                                        y: reference,\n                                    },\n                                    size: elem_bounds.size,\n                                }\n                            }\n                            AlignmentType::AlignBottom =\u003e {\n                                let elem_bounds = get_element_bounds(element);\n                                Rect {\n                                    origin: Point {\n                                        x: elem_bounds.origin.x,\n                                        y: reference - elem_bounds.size.height,\n                                    },\n                                    size: elem_bounds.size,\n                                }\n                            }\n                            AlignmentType::AlignCenterV =\u003e {\n                                let elem_bounds = get_element_bounds(element);\n                                Rect {\n                                    origin: Point {\n                                        x: elem_bounds.origin.x,\n                                        y: reference - elem_bounds.size.height / 2.0,\n                                    },\n                                    size: elem_bounds.size,\n                                }\n                            }\n                        };\n\n                        match element {\n                            DocumentElement::Shape(shape) =\u003e {\n                                shape.bounds = new_bounds;\n                            }\n                            DocumentElement::Text(text) =\u003e {\n                                text.bounds = new_bounds;\n                            }\n                            DocumentElement::Image(image) =\u003e {\n                                image.bounds = new_bounds;\n                            }\n                            DocumentElement::Frame(frame) =\u003e {\n                                frame.bounds = new_bounds;\n                            }\n                        }\n                        break;\n                    }\n                }\n            }\n        }\n    });\n}\n","traces":[{"line":12,"address":[],"length":0,"stats":{"Line":0}},{"line":17,"address":[],"length":0,"stats":{"Line":0}},{"line":18,"address":[],"length":0,"stats":{"Line":0}},{"line":22,"address":[],"length":0,"stats":{"Line":0}},{"line":23,"address":[],"length":0,"stats":{"Line":0}},{"line":24,"address":[],"length":0,"stats":{"Line":0}},{"line":26,"address":[],"length":0,"stats":{"Line":0}},{"line":27,"address":[],"length":0,"stats":{"Line":0}},{"line":28,"address":[],"length":0,"stats":{"Line":0}},{"line":29,"address":[],"length":0,"stats":{"Line":0}},{"line":30,"address":[],"length":0,"stats":{"Line":0}},{"line":31,"address":[],"length":0,"stats":{"Line":0}},{"line":32,"address":[],"length":0,"stats":{"Line":0}},{"line":34,"address":[],"length":0,"stats":{"Line":0}},{"line":35,"address":[],"length":0,"stats":{"Line":0}},{"line":42,"address":[],"length":0,"stats":{"Line":0}},{"line":43,"address":[],"length":0,"stats":{"Line":0}},{"line":44,"address":[],"length":0,"stats":{"Line":0}},{"line":46,"address":[],"length":0,"stats":{"Line":0}},{"line":47,"address":[],"length":0,"stats":{"Line":0}},{"line":48,"address":[],"length":0,"stats":{"Line":0}},{"line":49,"address":[],"length":0,"stats":{"Line":0}},{"line":50,"address":[],"length":0,"stats":{"Line":0}},{"line":51,"address":[],"length":0,"stats":{"Line":0}},{"line":52,"address":[],"length":0,"stats":{"Line":0}},{"line":54,"address":[],"length":0,"stats":{"Line":0}},{"line":55,"address":[],"length":0,"stats":{"Line":0}},{"line":62,"address":[],"length":0,"stats":{"Line":0}},{"line":63,"address":[],"length":0,"stats":{"Line":0}},{"line":64,"address":[],"length":0,"stats":{"Line":0}},{"line":66,"address":[],"length":0,"stats":{"Line":0}},{"line":67,"address":[],"length":0,"stats":{"Line":0}},{"line":68,"address":[],"length":0,"stats":{"Line":0}},{"line":69,"address":[],"length":0,"stats":{"Line":0}},{"line":70,"address":[],"length":0,"stats":{"Line":0}},{"line":71,"address":[],"length":0,"stats":{"Line":0}},{"line":72,"address":[],"length":0,"stats":{"Line":0}},{"line":74,"address":[],"length":0,"stats":{"Line":0}},{"line":75,"address":[],"length":0,"stats":{"Line":0}},{"line":82,"address":[],"length":0,"stats":{"Line":0}},{"line":83,"address":[],"length":0,"stats":{"Line":0}},{"line":84,"address":[],"length":0,"stats":{"Line":0}},{"line":86,"address":[],"length":0,"stats":{"Line":0}},{"line":87,"address":[],"length":0,"stats":{"Line":0}},{"line":88,"address":[],"length":0,"stats":{"Line":0}},{"line":89,"address":[],"length":0,"stats":{"Line":0}},{"line":90,"address":[],"length":0,"stats":{"Line":0}},{"line":91,"address":[],"length":0,"stats":{"Line":0}},{"line":92,"address":[],"length":0,"stats":{"Line":0}},{"line":94,"address":[],"length":0,"stats":{"Line":0}},{"line":95,"address":[],"length":0,"stats":{"Line":0}},{"line":102,"address":[],"length":0,"stats":{"Line":0}},{"line":103,"address":[],"length":0,"stats":{"Line":0}},{"line":104,"address":[],"length":0,"stats":{"Line":0}},{"line":106,"address":[],"length":0,"stats":{"Line":0}},{"line":107,"address":[],"length":0,"stats":{"Line":0}},{"line":108,"address":[],"length":0,"stats":{"Line":0}},{"line":109,"address":[],"length":0,"stats":{"Line":0}},{"line":110,"address":[],"length":0,"stats":{"Line":0}},{"line":111,"address":[],"length":0,"stats":{"Line":0}},{"line":112,"address":[],"length":0,"stats":{"Line":0}},{"line":114,"address":[],"length":0,"stats":{"Line":0}},{"line":115,"address":[],"length":0,"stats":{"Line":0}},{"line":122,"address":[],"length":0,"stats":{"Line":0}},{"line":123,"address":[],"length":0,"stats":{"Line":0}},{"line":124,"address":[],"length":0,"stats":{"Line":0}},{"line":126,"address":[],"length":0,"stats":{"Line":0}},{"line":127,"address":[],"length":0,"stats":{"Line":0}},{"line":128,"address":[],"length":0,"stats":{"Line":0}},{"line":129,"address":[],"length":0,"stats":{"Line":0}},{"line":130,"address":[],"length":0,"stats":{"Line":0}},{"line":131,"address":[],"length":0,"stats":{"Line":0}},{"line":132,"address":[],"length":0,"stats":{"Line":0}},{"line":134,"address":[],"length":0,"stats":{"Line":0}},{"line":135,"address":[],"length":0,"stats":{"Line":0}},{"line":153,"address":[],"length":0,"stats":{"Line":0}},{"line":154,"address":[],"length":0,"stats":{"Line":0}},{"line":155,"address":[],"length":0,"stats":{"Line":0}},{"line":156,"address":[],"length":0,"stats":{"Line":0}},{"line":157,"address":[],"length":0,"stats":{"Line":0}},{"line":158,"address":[],"length":0,"stats":{"Line":0}},{"line":163,"address":[],"length":0,"stats":{"Line":0}},{"line":168,"address":[],"length":0,"stats":{"Line":0}},{"line":169,"address":[],"length":0,"stats":{"Line":0}},{"line":171,"address":[],"length":0,"stats":{"Line":0}},{"line":172,"address":[],"length":0,"stats":{"Line":0}},{"line":173,"address":[],"length":0,"stats":{"Line":0}},{"line":174,"address":[],"length":0,"stats":{"Line":0}},{"line":178,"address":[],"length":0,"stats":{"Line":0}},{"line":179,"address":[],"length":0,"stats":{"Line":0}},{"line":183,"address":[],"length":0,"stats":{"Line":0}},{"line":185,"address":[],"length":0,"stats":{"Line":0}},{"line":186,"address":[],"length":0,"stats":{"Line":0}},{"line":187,"address":[],"length":0,"stats":{"Line":0}},{"line":190,"address":[],"length":0,"stats":{"Line":0}},{"line":191,"address":[],"length":0,"stats":{"Line":0}},{"line":192,"address":[],"length":0,"stats":{"Line":0}},{"line":195,"address":[],"length":0,"stats":{"Line":0}},{"line":196,"address":[],"length":0,"stats":{"Line":0}},{"line":197,"address":[],"length":0,"stats":{"Line":0}},{"line":198,"address":[],"length":0,"stats":{"Line":0}},{"line":199,"address":[],"length":0,"stats":{"Line":0}},{"line":200,"address":[],"length":0,"stats":{"Line":0}},{"line":201,"address":[],"length":0,"stats":{"Line":0}},{"line":204,"address":[],"length":0,"stats":{"Line":0}},{"line":205,"address":[],"length":0,"stats":{"Line":0}},{"line":206,"address":[],"length":0,"stats":{"Line":0}},{"line":209,"address":[],"length":0,"stats":{"Line":0}},{"line":210,"address":[],"length":0,"stats":{"Line":0}},{"line":211,"address":[],"length":0,"stats":{"Line":0}},{"line":214,"address":[],"length":0,"stats":{"Line":0}},{"line":215,"address":[],"length":0,"stats":{"Line":0}},{"line":216,"address":[],"length":0,"stats":{"Line":0}},{"line":217,"address":[],"length":0,"stats":{"Line":0}},{"line":218,"address":[],"length":0,"stats":{"Line":0}},{"line":219,"address":[],"length":0,"stats":{"Line":0}},{"line":220,"address":[],"length":0,"stats":{"Line":0}},{"line":225,"address":[],"length":0,"stats":{"Line":0}},{"line":226,"address":[],"length":0,"stats":{"Line":0}},{"line":227,"address":[],"length":0,"stats":{"Line":0}},{"line":228,"address":[],"length":0,"stats":{"Line":0}},{"line":230,"address":[],"length":0,"stats":{"Line":0}},{"line":231,"address":[],"length":0,"stats":{"Line":0}},{"line":232,"address":[],"length":0,"stats":{"Line":0}},{"line":233,"address":[],"length":0,"stats":{"Line":0}},{"line":234,"address":[],"length":0,"stats":{"Line":0}},{"line":236,"address":[],"length":0,"stats":{"Line":0}},{"line":240,"address":[],"length":0,"stats":{"Line":0}},{"line":241,"address":[],"length":0,"stats":{"Line":0}},{"line":242,"address":[],"length":0,"stats":{"Line":0}},{"line":243,"address":[],"length":0,"stats":{"Line":0}},{"line":244,"address":[],"length":0,"stats":{"Line":0}},{"line":246,"address":[],"length":0,"stats":{"Line":0}},{"line":250,"address":[],"length":0,"stats":{"Line":0}},{"line":251,"address":[],"length":0,"stats":{"Line":0}},{"line":252,"address":[],"length":0,"stats":{"Line":0}},{"line":253,"address":[],"length":0,"stats":{"Line":0}},{"line":254,"address":[],"length":0,"stats":{"Line":0}},{"line":256,"address":[],"length":0,"stats":{"Line":0}},{"line":260,"address":[],"length":0,"stats":{"Line":0}},{"line":261,"address":[],"length":0,"stats":{"Line":0}},{"line":262,"address":[],"length":0,"stats":{"Line":0}},{"line":263,"address":[],"length":0,"stats":{"Line":0}},{"line":264,"address":[],"length":0,"stats":{"Line":0}},{"line":266,"address":[],"length":0,"stats":{"Line":0}},{"line":270,"address":[],"length":0,"stats":{"Line":0}},{"line":271,"address":[],"length":0,"stats":{"Line":0}},{"line":272,"address":[],"length":0,"stats":{"Line":0}},{"line":273,"address":[],"length":0,"stats":{"Line":0}},{"line":274,"address":[],"length":0,"stats":{"Line":0}},{"line":276,"address":[],"length":0,"stats":{"Line":0}},{"line":280,"address":[],"length":0,"stats":{"Line":0}},{"line":281,"address":[],"length":0,"stats":{"Line":0}},{"line":282,"address":[],"length":0,"stats":{"Line":0}},{"line":283,"address":[],"length":0,"stats":{"Line":0}},{"line":284,"address":[],"length":0,"stats":{"Line":0}},{"line":286,"address":[],"length":0,"stats":{"Line":0}},{"line":291,"address":[],"length":0,"stats":{"Line":0}},{"line":292,"address":[],"length":0,"stats":{"Line":0}},{"line":293,"address":[],"length":0,"stats":{"Line":0}},{"line":295,"address":[],"length":0,"stats":{"Line":0}},{"line":296,"address":[],"length":0,"stats":{"Line":0}},{"line":298,"address":[],"length":0,"stats":{"Line":0}},{"line":299,"address":[],"length":0,"stats":{"Line":0}},{"line":301,"address":[],"length":0,"stats":{"Line":0}},{"line":302,"address":[],"length":0,"stats":{"Line":0}},{"line":305,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":167},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","ui","src","window","actions","clipboard_actions.rs"],"content":"//! Clipboard integration for copy/paste operations\n\nuse super::common::add_window_action;\nuse gtk4::prelude::*;\nuse std::cell::RefCell;\n\n// Thread-local storage for clipboard data\nthread_local! {\n    static CLIPBOARD_CONTENT: RefCell\u003cOption\u003cString\u003e\u003e = RefCell::new(None);\n}\n\n/// Register copy/paste actions\npub fn register(\n    window: \u0026gtk4::ApplicationWindow,\n    state: crate::app::AppState,\n    canvas_view: \u0026crate::canvas::CanvasView,\n) {\n    let copy_state = state.clone();\n    let copy_selected_ids = canvas_view.render_state().selected_ids.clone();\n    add_window_action(window, \"copy\", move |_| {\n        tracing::info!(\"Action: copy selected objects\");\n\n        let selected_ids = copy_selected_ids.borrow();\n\n        if selected_ids.is_empty() {\n            tracing::warn!(\"  No objects selected for copying\");\n            return;\n        }\n\n        copy_state.with_active_document(|doc| {\n            if let Some(page) = doc.pages.first() {\n                let mut elements_to_copy = Vec::new();\n\n                // Find all selected elements\n                for element in \u0026page.elements {\n                    if selected_ids.contains(\u0026element.id()) {\n                        elements_to_copy.push(element.clone());\n                    }\n                }\n\n                // Serialize elements to JSON\n                if let Ok(json) = serde_json::to_string(\u0026elements_to_copy) {\n                    CLIPBOARD_CONTENT.with(|cb| {\n                        *cb.borrow_mut() = Some(json);\n                    });\n                    tracing::info!(\" Copied {} objects to clipboard\", elements_to_copy.len());\n                } else {\n                    tracing::error!(\" Failed to serialize clipboard content\");\n                }\n            }\n        });\n    });\n\n    let paste_state = state.clone();\n    let paste_drawing_area = canvas_view.drawing_area();\n    let paste_selected_ids = canvas_view.render_state().selected_ids.clone();\n    add_window_action(window, \"paste\", move |_| {\n        tracing::info!(\"Action: paste from clipboard\");\n\n        let content = CLIPBOARD_CONTENT.with(|cb| cb.borrow().clone());\n\n        let Some(json_content) = content else {\n            tracing::warn!(\"  Clipboard is empty\");\n            return;\n        };\n\n        // Deserialize elements from JSON\n        let elements: Result\u003cVec\u003ctestruct_core::document::DocumentElement\u003e, _\u003e =\n            serde_json::from_str(\u0026json_content);\n\n        let Ok(mut elements_to_paste) = elements else {\n            tracing::error!(\" Failed to deserialize clipboard content\");\n            return;\n        };\n\n        // Generate new UUIDs for pasted elements and offset position\n        const PASTE_OFFSET: f32 = 20.0;\n        for element in \u0026mut elements_to_paste {\n            // Generate new ID\n            let new_id = uuid::Uuid::new_v4();\n\n            // Update element with new ID and offset position\n            match element {\n                testruct_core::document::DocumentElement::Frame(ref mut f) =\u003e {\n                    f.id = new_id;\n                    f.bounds.origin.x += PASTE_OFFSET;\n                    f.bounds.origin.y += PASTE_OFFSET;\n                }\n                testruct_core::document::DocumentElement::Text(ref mut t) =\u003e {\n                    t.id = new_id;\n                    t.bounds.origin.x += PASTE_OFFSET;\n                    t.bounds.origin.y += PASTE_OFFSET;\n                }\n                testruct_core::document::DocumentElement::Image(ref mut i) =\u003e {\n                    i.id = new_id;\n                    i.bounds.origin.x += PASTE_OFFSET;\n                    i.bounds.origin.y += PASTE_OFFSET;\n                }\n                testruct_core::document::DocumentElement::Shape(ref mut s) =\u003e {\n                    s.id = new_id;\n                    s.bounds.origin.x += PASTE_OFFSET;\n                    s.bounds.origin.y += PASTE_OFFSET;\n                }\n            }\n        }\n\n        paste_state.with_active_document(|doc| {\n            if let Some(page) = doc.pages.get_mut(0) {\n                // Clear current selection and add pasted elements\n                let pasted_count = elements_to_paste.len();\n                {\n                    let mut selected = paste_selected_ids.borrow_mut();\n                    selected.clear();\n\n                    // Add pasted elements and track their IDs\n                    for element in elements_to_paste {\n                        let element_id = element.id();\n                        page.add_element(element);\n                        selected.push(element_id);\n                    }\n                }\n\n                tracing::info!(\" Pasted {} objects from clipboard\", pasted_count);\n            }\n        });\n\n        // Redraw canvas\n        let _ = paste_drawing_area.queue_draw();\n    });\n}\n","traces":[{"line":13,"address":[],"length":0,"stats":{"Line":0}},{"line":18,"address":[],"length":0,"stats":{"Line":0}},{"line":19,"address":[],"length":0,"stats":{"Line":0}},{"line":20,"address":[],"length":0,"stats":{"Line":0}},{"line":21,"address":[],"length":0,"stats":{"Line":0}},{"line":23,"address":[],"length":0,"stats":{"Line":0}},{"line":25,"address":[],"length":0,"stats":{"Line":0}},{"line":26,"address":[],"length":0,"stats":{"Line":0}},{"line":27,"address":[],"length":0,"stats":{"Line":0}},{"line":30,"address":[],"length":0,"stats":{"Line":0}},{"line":31,"address":[],"length":0,"stats":{"Line":0}},{"line":32,"address":[],"length":0,"stats":{"Line":0}},{"line":35,"address":[],"length":0,"stats":{"Line":0}},{"line":36,"address":[],"length":0,"stats":{"Line":0}},{"line":37,"address":[],"length":0,"stats":{"Line":0}},{"line":42,"address":[],"length":0,"stats":{"Line":0}},{"line":43,"address":[],"length":0,"stats":{"Line":0}},{"line":44,"address":[],"length":0,"stats":{"Line":0}},{"line":46,"address":[],"length":0,"stats":{"Line":0}},{"line":48,"address":[],"length":0,"stats":{"Line":0}},{"line":54,"address":[],"length":0,"stats":{"Line":0}},{"line":55,"address":[],"length":0,"stats":{"Line":0}},{"line":56,"address":[],"length":0,"stats":{"Line":0}},{"line":57,"address":[],"length":0,"stats":{"Line":0}},{"line":58,"address":[],"length":0,"stats":{"Line":0}},{"line":60,"address":[],"length":0,"stats":{"Line":0}},{"line":62,"address":[],"length":0,"stats":{"Line":0}},{"line":63,"address":[],"length":0,"stats":{"Line":0}},{"line":64,"address":[],"length":0,"stats":{"Line":0}},{"line":68,"address":[],"length":0,"stats":{"Line":0}},{"line":69,"address":[],"length":0,"stats":{"Line":0}},{"line":71,"address":[],"length":0,"stats":{"Line":0}},{"line":72,"address":[],"length":0,"stats":{"Line":0}},{"line":73,"address":[],"length":0,"stats":{"Line":0}},{"line":78,"address":[],"length":0,"stats":{"Line":0}},{"line":80,"address":[],"length":0,"stats":{"Line":0}},{"line":83,"address":[],"length":0,"stats":{"Line":0}},{"line":84,"address":[],"length":0,"stats":{"Line":0}},{"line":85,"address":[],"length":0,"stats":{"Line":0}},{"line":86,"address":[],"length":0,"stats":{"Line":0}},{"line":87,"address":[],"length":0,"stats":{"Line":0}},{"line":89,"address":[],"length":0,"stats":{"Line":0}},{"line":90,"address":[],"length":0,"stats":{"Line":0}},{"line":91,"address":[],"length":0,"stats":{"Line":0}},{"line":92,"address":[],"length":0,"stats":{"Line":0}},{"line":94,"address":[],"length":0,"stats":{"Line":0}},{"line":95,"address":[],"length":0,"stats":{"Line":0}},{"line":96,"address":[],"length":0,"stats":{"Line":0}},{"line":97,"address":[],"length":0,"stats":{"Line":0}},{"line":99,"address":[],"length":0,"stats":{"Line":0}},{"line":100,"address":[],"length":0,"stats":{"Line":0}},{"line":101,"address":[],"length":0,"stats":{"Line":0}},{"line":102,"address":[],"length":0,"stats":{"Line":0}},{"line":107,"address":[],"length":0,"stats":{"Line":0}},{"line":108,"address":[],"length":0,"stats":{"Line":0}},{"line":110,"address":[],"length":0,"stats":{"Line":0}},{"line":112,"address":[],"length":0,"stats":{"Line":0}},{"line":113,"address":[],"length":0,"stats":{"Line":0}},{"line":116,"address":[],"length":0,"stats":{"Line":0}},{"line":117,"address":[],"length":0,"stats":{"Line":0}},{"line":118,"address":[],"length":0,"stats":{"Line":0}},{"line":119,"address":[],"length":0,"stats":{"Line":0}},{"line":123,"address":[],"length":0,"stats":{"Line":0}},{"line":128,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":64},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","ui","src","window","actions","common.rs"],"content":"//! Common action utilities and helpers\n\nuse gtk4::{gio, prelude::*};\n\n/// Add a window action with a callback\npub fn add_window_action\u003cF\u003e(window: \u0026gtk4::ApplicationWindow, name: \u0026str, callback: F)\nwhere\n    F: Fn(\u0026gtk4::ApplicationWindow) + 'static,\n{\n    let action = gio::SimpleAction::new(name, None);\n    let window_ref = window.clone();\n    action.connect_activate(move |_, _| callback(\u0026window_ref));\n    window.add_action(\u0026action);\n}\n\n/// Set keyboard accelerators for window-level actions\npub fn set_accelerators(window: \u0026gtk4::ApplicationWindow) {\n    let app = window.application().unwrap();\n\n    let shortcuts = [\n        (\"win.new\", \"\u003cPrimary\u003en\"),\n        (\"win.open\", \"\u003cPrimary\u003eo\"),\n        (\"win.save\", \"\u003cPrimary\u003es\"),\n        (\"win.save-as\", \"\u003cPrimary\u003e\u003cShift\u003es\"),\n        (\"win.undo\", \"\u003cPrimary\u003ez\"),\n        (\"win.redo\", \"\u003cPrimary\u003e\u003cShift\u003ez\"),\n        (\"win.select-all\", \"\u003cPrimary\u003ea\"),\n        (\"win.copy\", \"\u003cPrimary\u003ec\"),\n        (\"win.paste\", \"\u003cPrimary\u003ev\"),\n        (\"win.group\", \"\u003cPrimary\u003eg\"),\n        (\"win.ungroup\", \"\u003cPrimary\u003e\u003cShift\u003eg\"),\n        (\"win.add-page\", \"\u003cPrimary\u003e\u003cShift\u003en\"),\n        (\"win.delete-page\", \"\u003cPrimary\u003e\u003cShift\u003ed\"),\n        (\"win.duplicate-page\", \"\u003cPrimary\u003e\u003cShift\u003ed\"),\n        (\"win.move-page-up\", \"\u003cPrimary\u003e\u003cShift\u003ePage_Up\"),\n        (\"win.move-page-down\", \"\u003cPrimary\u003e\u003cShift\u003ePage_Down\"),\n        (\"win.insert-image\", \"\u003cPrimary\u003ei\"),\n        (\"win.toggle-grid\", \"F8\"),\n        (\"win.toggle-guides\", \"F7\"),\n        (\"win.toggle-rulers\", \"F6\"),\n    ];\n\n    for (action, accel) in \u0026shortcuts {\n        app.set_accels_for_action(action, \u0026[accel]);\n    }\n}\n","traces":[{"line":6,"address":[],"length":0,"stats":{"Line":0}},{"line":10,"address":[],"length":0,"stats":{"Line":0}},{"line":11,"address":[],"length":0,"stats":{"Line":0}},{"line":12,"address":[],"length":0,"stats":{"Line":0}},{"line":13,"address":[],"length":0,"stats":{"Line":0}},{"line":17,"address":[],"length":0,"stats":{"Line":0}},{"line":18,"address":[],"length":0,"stats":{"Line":0}},{"line":20,"address":[],"length":0,"stats":{"Line":0}},{"line":21,"address":[],"length":0,"stats":{"Line":0}},{"line":22,"address":[],"length":0,"stats":{"Line":0}},{"line":23,"address":[],"length":0,"stats":{"Line":0}},{"line":24,"address":[],"length":0,"stats":{"Line":0}},{"line":25,"address":[],"length":0,"stats":{"Line":0}},{"line":26,"address":[],"length":0,"stats":{"Line":0}},{"line":27,"address":[],"length":0,"stats":{"Line":0}},{"line":28,"address":[],"length":0,"stats":{"Line":0}},{"line":29,"address":[],"length":0,"stats":{"Line":0}},{"line":30,"address":[],"length":0,"stats":{"Line":0}},{"line":31,"address":[],"length":0,"stats":{"Line":0}},{"line":32,"address":[],"length":0,"stats":{"Line":0}},{"line":33,"address":[],"length":0,"stats":{"Line":0}},{"line":34,"address":[],"length":0,"stats":{"Line":0}},{"line":35,"address":[],"length":0,"stats":{"Line":0}},{"line":36,"address":[],"length":0,"stats":{"Line":0}},{"line":37,"address":[],"length":0,"stats":{"Line":0}},{"line":38,"address":[],"length":0,"stats":{"Line":0}},{"line":39,"address":[],"length":0,"stats":{"Line":0}},{"line":40,"address":[],"length":0,"stats":{"Line":0}},{"line":43,"address":[],"length":0,"stats":{"Line":0}},{"line":44,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":30},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","ui","src","window","actions","edit_actions.rs"],"content":"//! Edit action handlers (undo, redo, select-all)\n\nuse super::common::add_window_action;\nuse gtk4::prelude::*;\n\n/// Register edit menu actions\npub fn register(\n    window: \u0026gtk4::ApplicationWindow,\n    state: crate::app::AppState,\n    canvas_view: \u0026crate::canvas::CanvasView,\n) {\n    let undo_state = state.clone();\n    let undo_drawing_area = canvas_view.drawing_area();\n    add_window_action(window, \"undo\", move |_| {\n        tracing::info!(\"Action: undo\");\n        if undo_state.undo() {\n            tracing::info!(\" Undo successful\");\n            let _ = undo_drawing_area.queue_draw();\n        } else {\n            tracing::info!(\"  Nothing to undo\");\n        }\n    });\n\n    let redo_state = state.clone();\n    let redo_drawing_area = canvas_view.drawing_area();\n    add_window_action(window, \"redo\", move |_| {\n        tracing::info!(\"Action: redo\");\n        if redo_state.redo() {\n            tracing::info!(\" Redo successful\");\n            let _ = redo_drawing_area.queue_draw();\n        } else {\n            tracing::info!(\"  Nothing to redo\");\n        }\n    });\n\n    let select_all_state = state.clone();\n    let select_all_drawing_area = canvas_view.drawing_area();\n    let select_all_render_state = canvas_view.render_state().clone();\n    add_window_action(window, \"select-all\", move |_| {\n        tracing::info!(\"Action: select all objects\");\n\n        let all_ids = select_all_state.get_all_object_ids();\n\n        if all_ids.is_empty() {\n            tracing::info!(\"  No objects to select\");\n        } else {\n            let mut selected = select_all_render_state.selected_ids.borrow_mut();\n            selected.clear();\n            for id in \u0026all_ids {\n                selected.push(*id);\n            }\n            drop(selected);\n            let _ = select_all_drawing_area.queue_draw();\n            tracing::info!(\" Selected {} objects\", all_ids.len());\n        }\n    });\n}\n","traces":[{"line":7,"address":[],"length":0,"stats":{"Line":0}},{"line":12,"address":[],"length":0,"stats":{"Line":0}},{"line":13,"address":[],"length":0,"stats":{"Line":0}},{"line":14,"address":[],"length":0,"stats":{"Line":0}},{"line":15,"address":[],"length":0,"stats":{"Line":0}},{"line":16,"address":[],"length":0,"stats":{"Line":0}},{"line":17,"address":[],"length":0,"stats":{"Line":0}},{"line":18,"address":[],"length":0,"stats":{"Line":0}},{"line":20,"address":[],"length":0,"stats":{"Line":0}},{"line":24,"address":[],"length":0,"stats":{"Line":0}},{"line":25,"address":[],"length":0,"stats":{"Line":0}},{"line":26,"address":[],"length":0,"stats":{"Line":0}},{"line":27,"address":[],"length":0,"stats":{"Line":0}},{"line":28,"address":[],"length":0,"stats":{"Line":0}},{"line":29,"address":[],"length":0,"stats":{"Line":0}},{"line":30,"address":[],"length":0,"stats":{"Line":0}},{"line":32,"address":[],"length":0,"stats":{"Line":0}},{"line":36,"address":[],"length":0,"stats":{"Line":0}},{"line":37,"address":[],"length":0,"stats":{"Line":0}},{"line":38,"address":[],"length":0,"stats":{"Line":0}},{"line":39,"address":[],"length":0,"stats":{"Line":0}},{"line":40,"address":[],"length":0,"stats":{"Line":0}},{"line":42,"address":[],"length":0,"stats":{"Line":0}},{"line":44,"address":[],"length":0,"stats":{"Line":0}},{"line":45,"address":[],"length":0,"stats":{"Line":0}},{"line":47,"address":[],"length":0,"stats":{"Line":0}},{"line":48,"address":[],"length":0,"stats":{"Line":0}},{"line":49,"address":[],"length":0,"stats":{"Line":0}},{"line":50,"address":[],"length":0,"stats":{"Line":0}},{"line":52,"address":[],"length":0,"stats":{"Line":0}},{"line":53,"address":[],"length":0,"stats":{"Line":0}},{"line":54,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":32},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","ui","src","window","actions","export_actions.rs"],"content":"//! Export action handlers (PDF, PNG, JPEG, SVG)\n\nuse super::common::add_window_action;\nuse gtk4::prelude::*;\n\n/// Register export actions\npub fn register(window: \u0026gtk4::ApplicationWindow, state: crate::app::AppState) {\n    let export_state = state.clone();\n    let window_weak_pdf = window.downgrade();\n    add_window_action(window, \"export-pdf\", move |_| {\n        tracing::info!(\"Action: export as PDF\");\n        if let Some(window) = window_weak_pdf.upgrade() {\n            perform_pdf_export(\u0026window, \u0026export_state);\n        }\n    });\n\n    let export_state = state.clone();\n    let window_weak_png = window.downgrade();\n    add_window_action(window, \"export-png\", move |_| {\n        tracing::info!(\"Action: export as PNG\");\n        if let Some(window) = window_weak_png.upgrade() {\n            perform_image_export(\u0026window, \u0026export_state, \"png\");\n        }\n    });\n\n    let export_state = state.clone();\n    let window_weak_jpeg = window.downgrade();\n    add_window_action(window, \"export-jpeg\", move |_| {\n        tracing::info!(\"Action: export as JPEG\");\n        if let Some(window) = window_weak_jpeg.upgrade() {\n            perform_image_export(\u0026window, \u0026export_state, \"jpeg\");\n        }\n    });\n\n    let export_state = state.clone();\n    let window_weak_svg = window.downgrade();\n    add_window_action(window, \"export-svg\", move |_| {\n        tracing::info!(\"Action: export as SVG\");\n        if let Some(window) = window_weak_svg.upgrade() {\n            perform_image_export(\u0026window, \u0026export_state, \"svg\");\n        }\n    });\n}\n\n/// Perform PDF export\nfn perform_pdf_export(window: \u0026gtk4::ApplicationWindow, state: \u0026crate::app::AppState) {\n    if state.active_document().is_some() {\n        tracing::info!(\"Exporting active document to PDF\");\n\n        let window_clone = window.clone();\n        let state_clone = state.clone();\n\n        glib::spawn_future_local(async move {\n            if let Some(path) = crate::io::file_dialog::show_export_dialog(\u0026window_clone, \"pdf\").await {\n                let catalog = state_clone.asset_catalog();\n                let catalog_lock = catalog.lock().expect(\"Failed to lock asset catalog\");\n\n                match crate::export::export_pdf(\u0026state_clone.active_document().unwrap(), \u0026path, \u0026catalog_lock) {\n                    Ok(_) =\u003e {\n                        tracing::info!(\" PDF export completed: {}\", path.display());\n                    }\n                    Err(e) =\u003e {\n                        tracing::error!(\" PDF export failed: {}\", e);\n                    }\n                }\n            } else {\n                tracing::info!(\"PDF export cancelled by user\");\n            }\n        });\n    } else {\n        tracing::warn!(\"No active document to export\");\n    }\n}\n\n/// Perform image export (PNG/JPEG/SVG)\nfn perform_image_export(window: \u0026gtk4::ApplicationWindow, state: \u0026crate::app::AppState, format: \u0026str) {\n    if state.active_document().is_some() {\n        tracing::info!(\"Exporting active document to {}\", format.to_uppercase());\n\n        let window_clone = window.clone();\n        let state_clone = state.clone();\n        let format_str = format.to_string();\n\n        glib::spawn_future_local(async move {\n            if let Some(path) = crate::io::file_dialog::show_export_dialog(\u0026window_clone, \u0026format_str).await {\n                let catalog = state_clone.asset_catalog();\n                let catalog_lock = catalog.lock().expect(\"Failed to lock asset catalog\");\n\n                let result = match format_str.as_str() {\n                    \"png\" =\u003e crate::export::export_png(\u0026state_clone.active_document().unwrap(), \u0026path, 96.0, \u0026catalog_lock),\n                    \"jpeg\" =\u003e crate::export::export_jpeg(\u0026state_clone.active_document().unwrap(), \u0026path, 96.0, 95, \u0026catalog_lock),\n                    \"svg\" =\u003e crate::export::export_svg(\u0026state_clone.active_document().unwrap(), \u0026path, \u0026catalog_lock),\n                    _ =\u003e Err(anyhow::anyhow!(\"Unknown format: {}\", format_str)),\n                };\n\n                match result {\n                    Ok(_) =\u003e {\n                        tracing::info!(\" {} export completed: {}\", format_str.to_uppercase(), path.display());\n                    }\n                    Err(e) =\u003e {\n                        tracing::error!(\" {} export failed: {}\", format_str.to_uppercase(), e);\n                    }\n                }\n            } else {\n                tracing::info!(\"{} export cancelled by user\", format_str.to_uppercase());\n            }\n        });\n    } else {\n        tracing::warn!(\"No active document to export\");\n    }\n}\n","traces":[{"line":7,"address":[],"length":0,"stats":{"Line":0}},{"line":8,"address":[],"length":0,"stats":{"Line":0}},{"line":9,"address":[],"length":0,"stats":{"Line":0}},{"line":10,"address":[],"length":0,"stats":{"Line":0}},{"line":11,"address":[],"length":0,"stats":{"Line":0}},{"line":12,"address":[],"length":0,"stats":{"Line":0}},{"line":13,"address":[],"length":0,"stats":{"Line":0}},{"line":17,"address":[],"length":0,"stats":{"Line":0}},{"line":18,"address":[],"length":0,"stats":{"Line":0}},{"line":19,"address":[],"length":0,"stats":{"Line":0}},{"line":20,"address":[],"length":0,"stats":{"Line":0}},{"line":21,"address":[],"length":0,"stats":{"Line":0}},{"line":22,"address":[],"length":0,"stats":{"Line":0}},{"line":26,"address":[],"length":0,"stats":{"Line":0}},{"line":27,"address":[],"length":0,"stats":{"Line":0}},{"line":28,"address":[],"length":0,"stats":{"Line":0}},{"line":29,"address":[],"length":0,"stats":{"Line":0}},{"line":30,"address":[],"length":0,"stats":{"Line":0}},{"line":31,"address":[],"length":0,"stats":{"Line":0}},{"line":35,"address":[],"length":0,"stats":{"Line":0}},{"line":36,"address":[],"length":0,"stats":{"Line":0}},{"line":37,"address":[],"length":0,"stats":{"Line":0}},{"line":38,"address":[],"length":0,"stats":{"Line":0}},{"line":39,"address":[],"length":0,"stats":{"Line":0}},{"line":40,"address":[],"length":0,"stats":{"Line":0}},{"line":46,"address":[],"length":0,"stats":{"Line":0}},{"line":47,"address":[],"length":0,"stats":{"Line":0}},{"line":48,"address":[],"length":0,"stats":{"Line":0}},{"line":50,"address":[],"length":0,"stats":{"Line":0}},{"line":51,"address":[],"length":0,"stats":{"Line":0}},{"line":53,"address":[],"length":0,"stats":{"Line":0}},{"line":54,"address":[],"length":0,"stats":{"Line":0}},{"line":55,"address":[],"length":0,"stats":{"Line":0}},{"line":56,"address":[],"length":0,"stats":{"Line":0}},{"line":58,"address":[],"length":0,"stats":{"Line":0}},{"line":60,"address":[],"length":0,"stats":{"Line":0}},{"line":62,"address":[],"length":0,"stats":{"Line":0}},{"line":63,"address":[],"length":0,"stats":{"Line":0}},{"line":67,"address":[],"length":0,"stats":{"Line":0}},{"line":71,"address":[],"length":0,"stats":{"Line":0}},{"line":76,"address":[],"length":0,"stats":{"Line":0}},{"line":77,"address":[],"length":0,"stats":{"Line":0}},{"line":78,"address":[],"length":0,"stats":{"Line":0}},{"line":80,"address":[],"length":0,"stats":{"Line":0}},{"line":81,"address":[],"length":0,"stats":{"Line":0}},{"line":82,"address":[],"length":0,"stats":{"Line":0}},{"line":84,"address":[],"length":0,"stats":{"Line":0}},{"line":85,"address":[],"length":0,"stats":{"Line":0}},{"line":86,"address":[],"length":0,"stats":{"Line":0}},{"line":87,"address":[],"length":0,"stats":{"Line":0}},{"line":89,"address":[],"length":0,"stats":{"Line":0}},{"line":90,"address":[],"length":0,"stats":{"Line":0}},{"line":91,"address":[],"length":0,"stats":{"Line":0}},{"line":92,"address":[],"length":0,"stats":{"Line":0}},{"line":93,"address":[],"length":0,"stats":{"Line":0}},{"line":96,"address":[],"length":0,"stats":{"Line":0}},{"line":98,"address":[],"length":0,"stats":{"Line":0}},{"line":100,"address":[],"length":0,"stats":{"Line":0}},{"line":101,"address":[],"length":0,"stats":{"Line":0}},{"line":105,"address":[],"length":0,"stats":{"Line":0}},{"line":109,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":61},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","ui","src","window","actions","file_actions.rs"],"content":"//! File and page management action handlers\n\nuse super::common::add_window_action;\nuse gtk4::prelude::*;\n\n/// Register file menu actions\npub fn register(window: \u0026gtk4::ApplicationWindow, state: crate::app::AppState) {\n    // File menu actions\n    let new_state = state.clone();\n    add_window_action(window, \"new\", move |_| {\n        tracing::info!(\"Action: new document\");\n        perform_new_document(\u0026new_state);\n    });\n\n    let open_state = state.clone();\n    let window_weak_open = window.downgrade();\n    add_window_action(window, \"open\", move |_| {\n        tracing::info!(\"Action: open document\");\n        if let Some(window) = window_weak_open.upgrade() {\n            perform_open_document(\u0026window, \u0026open_state);\n        }\n    });\n\n    let save_state = state.clone();\n    add_window_action(window, \"save\", move |_| {\n        tracing::info!(\"Action: save document\");\n        perform_save_document(\u0026save_state);\n    });\n\n    let save_as_state = state.clone();\n    let window_weak_save = window.downgrade();\n    add_window_action(window, \"save-as\", move |_| {\n        tracing::info!(\"Action: save document as\");\n        if let Some(window) = window_weak_save.upgrade() {\n            perform_save_as_document(\u0026window, \u0026save_as_state);\n        }\n    });\n\n    // Page management actions\n    let page_state = state.clone();\n    add_window_action(window, \"add-page\", move |_| {\n        tracing::info!(\"Action: add page\");\n        match page_state.add_page() {\n            Ok(_) =\u003e {\n                tracing::info!(\" Page added. Total pages: {}\", page_state.page_count());\n            }\n            Err(e) =\u003e {\n                tracing::warn!(\"  Failed to add page: {}\", e);\n            }\n        }\n    });\n\n    let page_state = state.clone();\n    add_window_action(window, \"delete-page\", move |_| {\n        tracing::info!(\"Action: delete page\");\n        match page_state.delete_page(0) {\n            Ok(_) =\u003e {\n                tracing::info!(\" Page deleted. Total pages: {}\", page_state.page_count());\n            }\n            Err(e) =\u003e {\n                tracing::warn!(\"  Failed to delete page: {}\", e);\n            }\n        }\n    });\n\n    let page_state = state.clone();\n    add_window_action(window, \"duplicate-page\", move |_| {\n        tracing::info!(\"Action: duplicate page\");\n        match page_state.duplicate_page(0) {\n            Ok(_) =\u003e {\n                tracing::info!(\" Page duplicated. Total pages: {}\", page_state.page_count());\n            }\n            Err(e) =\u003e {\n                tracing::warn!(\"  Failed to duplicate page: {}\", e);\n            }\n        }\n    });\n\n    let page_state = state.clone();\n    add_window_action(window, \"move-page-up\", move |_| {\n        tracing::info!(\"Action: move page up\");\n        match page_state.move_page_up(0) {\n            Ok(_) =\u003e {\n                tracing::info!(\" Page moved up\");\n            }\n            Err(e) =\u003e {\n                tracing::warn!(\"  Failed to move page up: {}\", e);\n            }\n        }\n    });\n\n    let page_state = state.clone();\n    add_window_action(window, \"move-page-down\", move |_| {\n        tracing::info!(\"Action: move page down\");\n        match page_state.move_page_down(0) {\n            Ok(_) =\u003e {\n                tracing::info!(\" Page moved down\");\n            }\n            Err(e) =\u003e {\n                tracing::warn!(\"  Failed to move page down: {}\", e);\n            }\n        }\n    });\n}\n\n/// Perform new document creation\nfn perform_new_document(state: \u0026crate::app::AppState) {\n    tracing::info!(\"Creating new document\");\n\n    let doc = testruct_core::document::DocumentBuilder::new()\n        .with_title(\"Untitled\")\n        .add_page(testruct_core::document::Page::empty())\n        .build()\n        .expect(\"Failed to create document\");\n\n    // Get project and add document\n    let mut project = state.project();\n    let doc_id = doc.id;\n    project.add_document(doc.clone());\n\n    tracing::info!(\" New document created with ID: {:?}\", doc_id);\n}\n\n/// Perform open document with file dialog\nfn perform_open_document(window: \u0026gtk4::ApplicationWindow, state: \u0026crate::app::AppState) {\n    tracing::info!(\"Opening document\");\n\n    let window_clone = window.clone();\n    let state_clone = state.clone();\n\n    glib::spawn_future_local(async move {\n        if let Some(path) = crate::io::file_dialog::show_open_dialog(\u0026window_clone).await {\n            match crate::io::file_io::load_document(\u0026path) {\n                Ok(document) =\u003e {\n                    let mut project = state_clone.project();\n                    project.add_document(document);\n                    tracing::info!(\" Document loaded: {}\", path.display());\n                }\n                Err(e) =\u003e {\n                    tracing::error!(\" Failed to load document: {}\", e);\n                }\n            }\n        } else {\n            tracing::info!(\"File open cancelled by user\");\n        }\n    });\n}\n\n/// Perform save document\nfn perform_save_document(state: \u0026crate::app::AppState) {\n    tracing::info!(\"Saving document\");\n\n    if let Some(document) = state.active_document() {\n        let filename = format!(\"{}.json\", document.metadata.title);\n\n        if let Some(mut path) = crate::io::file_io::default_documents_dir() {\n            path.push(\u0026filename);\n\n            match crate::io::file_io::save_document(\u0026document, \u0026path) {\n                Ok(_) =\u003e {\n                    tracing::info!(\" Document saved: {}\", path.display());\n                }\n                Err(e) =\u003e {\n                    tracing::error!(\" Failed to save document: {}\", e);\n                }\n            }\n        } else {\n            tracing::error!(\" Could not determine documents directory\");\n        }\n    } else {\n        tracing::warn!(\"No active document to save\");\n    }\n}\n\n/// Perform save document with dialog\nfn perform_save_as_document(window: \u0026gtk4::ApplicationWindow, state: \u0026crate::app::AppState) {\n    tracing::info!(\"Saving document as\");\n\n    if let Some(_document) = state.active_document() {\n        let window_clone = window.clone();\n        let state_clone = state.clone();\n\n        glib::spawn_future_local(async move {\n            if let Some(path) = crate::io::file_dialog::show_save_dialog(\u0026window_clone).await {\n                match crate::io::file_io::save_document(\u0026state_clone.active_document().unwrap(), \u0026path) {\n                    Ok(_) =\u003e {\n                        tracing::info!(\" Document saved as: {}\", path.display());\n                    }\n                    Err(e) =\u003e {\n                        tracing::error!(\" Failed to save document: {}\", e);\n                    }\n                }\n            } else {\n                tracing::info!(\"Save as cancelled by user\");\n            }\n        });\n    } else {\n        tracing::warn!(\"No active document to save\");\n    }\n}\n","traces":[{"line":7,"address":[],"length":0,"stats":{"Line":0}},{"line":9,"address":[],"length":0,"stats":{"Line":0}},{"line":10,"address":[],"length":0,"stats":{"Line":0}},{"line":11,"address":[],"length":0,"stats":{"Line":0}},{"line":12,"address":[],"length":0,"stats":{"Line":0}},{"line":15,"address":[],"length":0,"stats":{"Line":0}},{"line":16,"address":[],"length":0,"stats":{"Line":0}},{"line":17,"address":[],"length":0,"stats":{"Line":0}},{"line":18,"address":[],"length":0,"stats":{"Line":0}},{"line":19,"address":[],"length":0,"stats":{"Line":0}},{"line":20,"address":[],"length":0,"stats":{"Line":0}},{"line":24,"address":[],"length":0,"stats":{"Line":0}},{"line":25,"address":[],"length":0,"stats":{"Line":0}},{"line":26,"address":[],"length":0,"stats":{"Line":0}},{"line":27,"address":[],"length":0,"stats":{"Line":0}},{"line":30,"address":[],"length":0,"stats":{"Line":0}},{"line":31,"address":[],"length":0,"stats":{"Line":0}},{"line":32,"address":[],"length":0,"stats":{"Line":0}},{"line":33,"address":[],"length":0,"stats":{"Line":0}},{"line":34,"address":[],"length":0,"stats":{"Line":0}},{"line":35,"address":[],"length":0,"stats":{"Line":0}},{"line":40,"address":[],"length":0,"stats":{"Line":0}},{"line":41,"address":[],"length":0,"stats":{"Line":0}},{"line":42,"address":[],"length":0,"stats":{"Line":0}},{"line":43,"address":[],"length":0,"stats":{"Line":0}},{"line":45,"address":[],"length":0,"stats":{"Line":0}},{"line":47,"address":[],"length":0,"stats":{"Line":0}},{"line":48,"address":[],"length":0,"stats":{"Line":0}},{"line":53,"address":[],"length":0,"stats":{"Line":0}},{"line":54,"address":[],"length":0,"stats":{"Line":0}},{"line":55,"address":[],"length":0,"stats":{"Line":0}},{"line":56,"address":[],"length":0,"stats":{"Line":0}},{"line":58,"address":[],"length":0,"stats":{"Line":0}},{"line":60,"address":[],"length":0,"stats":{"Line":0}},{"line":61,"address":[],"length":0,"stats":{"Line":0}},{"line":66,"address":[],"length":0,"stats":{"Line":0}},{"line":67,"address":[],"length":0,"stats":{"Line":0}},{"line":68,"address":[],"length":0,"stats":{"Line":0}},{"line":69,"address":[],"length":0,"stats":{"Line":0}},{"line":71,"address":[],"length":0,"stats":{"Line":0}},{"line":73,"address":[],"length":0,"stats":{"Line":0}},{"line":74,"address":[],"length":0,"stats":{"Line":0}},{"line":79,"address":[],"length":0,"stats":{"Line":0}},{"line":80,"address":[],"length":0,"stats":{"Line":0}},{"line":81,"address":[],"length":0,"stats":{"Line":0}},{"line":82,"address":[],"length":0,"stats":{"Line":0}},{"line":84,"address":[],"length":0,"stats":{"Line":0}},{"line":86,"address":[],"length":0,"stats":{"Line":0}},{"line":87,"address":[],"length":0,"stats":{"Line":0}},{"line":92,"address":[],"length":0,"stats":{"Line":0}},{"line":93,"address":[],"length":0,"stats":{"Line":0}},{"line":94,"address":[],"length":0,"stats":{"Line":0}},{"line":95,"address":[],"length":0,"stats":{"Line":0}},{"line":97,"address":[],"length":0,"stats":{"Line":0}},{"line":99,"address":[],"length":0,"stats":{"Line":0}},{"line":100,"address":[],"length":0,"stats":{"Line":0}},{"line":107,"address":[],"length":0,"stats":{"Line":0}},{"line":108,"address":[],"length":0,"stats":{"Line":0}},{"line":110,"address":[],"length":0,"stats":{"Line":0}},{"line":112,"address":[],"length":0,"stats":{"Line":0}},{"line":117,"address":[],"length":0,"stats":{"Line":0}},{"line":118,"address":[],"length":0,"stats":{"Line":0}},{"line":119,"address":[],"length":0,"stats":{"Line":0}},{"line":121,"address":[],"length":0,"stats":{"Line":0}},{"line":125,"address":[],"length":0,"stats":{"Line":0}},{"line":126,"address":[],"length":0,"stats":{"Line":0}},{"line":128,"address":[],"length":0,"stats":{"Line":0}},{"line":129,"address":[],"length":0,"stats":{"Line":0}},{"line":131,"address":[],"length":0,"stats":{"Line":0}},{"line":132,"address":[],"length":0,"stats":{"Line":0}},{"line":133,"address":[],"length":0,"stats":{"Line":0}},{"line":134,"address":[],"length":0,"stats":{"Line":0}},{"line":135,"address":[],"length":0,"stats":{"Line":0}},{"line":136,"address":[],"length":0,"stats":{"Line":0}},{"line":137,"address":[],"length":0,"stats":{"Line":0}},{"line":139,"address":[],"length":0,"stats":{"Line":0}},{"line":140,"address":[],"length":0,"stats":{"Line":0}},{"line":144,"address":[],"length":0,"stats":{"Line":0}},{"line":150,"address":[],"length":0,"stats":{"Line":0}},{"line":151,"address":[],"length":0,"stats":{"Line":0}},{"line":153,"address":[],"length":0,"stats":{"Line":0}},{"line":154,"address":[],"length":0,"stats":{"Line":0}},{"line":156,"address":[],"length":0,"stats":{"Line":0}},{"line":157,"address":[],"length":0,"stats":{"Line":0}},{"line":159,"address":[],"length":0,"stats":{"Line":0}},{"line":161,"address":[],"length":0,"stats":{"Line":0}},{"line":163,"address":[],"length":0,"stats":{"Line":0}},{"line":164,"address":[],"length":0,"stats":{"Line":0}},{"line":168,"address":[],"length":0,"stats":{"Line":0}},{"line":171,"address":[],"length":0,"stats":{"Line":0}},{"line":176,"address":[],"length":0,"stats":{"Line":0}},{"line":177,"address":[],"length":0,"stats":{"Line":0}},{"line":179,"address":[],"length":0,"stats":{"Line":0}},{"line":180,"address":[],"length":0,"stats":{"Line":0}},{"line":181,"address":[],"length":0,"stats":{"Line":0}},{"line":183,"address":[],"length":0,"stats":{"Line":0}},{"line":184,"address":[],"length":0,"stats":{"Line":0}},{"line":185,"address":[],"length":0,"stats":{"Line":0}},{"line":187,"address":[],"length":0,"stats":{"Line":0}},{"line":189,"address":[],"length":0,"stats":{"Line":0}},{"line":190,"address":[],"length":0,"stats":{"Line":0}},{"line":194,"address":[],"length":0,"stats":{"Line":0}},{"line":198,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":103},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","ui","src","window","actions","group_actions.rs"],"content":"//! Object grouping/ungrouping action handlers\n\nuse super::common::add_window_action;\nuse gtk4::prelude::*;\n\n/// Register group/ungroup actions\npub fn register(\n    window: \u0026gtk4::ApplicationWindow,\n    state: crate::app::AppState,\n    canvas_view: \u0026crate::canvas::CanvasView,\n) {\n    let group_state = state.clone();\n    let group_drawing_area = canvas_view.drawing_area();\n    let group_render_state = canvas_view.render_state().selected_ids.clone();\n    add_window_action(window, \"group\", move |_| {\n        tracing::info!(\"Action: group selected objects\");\n\n        let selected_ids = group_render_state.borrow();\n        if selected_ids.is_empty() {\n            tracing::warn!(\"  No objects selected for grouping\");\n            return;\n        }\n\n        if selected_ids.len() \u003c 2 {\n            tracing::warn!(\"  Need at least 2 objects to group\");\n            return;\n        }\n\n        group_state.with_active_document(|doc| {\n            if let Some(page) = doc.pages.get_mut(0) {\n                // Calculate bounding box of all selected elements\n                let mut min_x = f32::MAX;\n                let mut min_y = f32::MAX;\n                let mut max_x = f32::MIN;\n                let mut max_y = f32::MIN;\n\n                // First pass: calculate bounds\n                for element in \u0026page.elements {\n                    if selected_ids.contains(\u0026element.id()) {\n                        let bounds = match element {\n                            testruct_core::document::DocumentElement::Frame(f) =\u003e \u0026f.bounds,\n                            testruct_core::document::DocumentElement::Text(t) =\u003e \u0026t.bounds,\n                            testruct_core::document::DocumentElement::Image(i) =\u003e \u0026i.bounds,\n                            testruct_core::document::DocumentElement::Shape(s) =\u003e \u0026s.bounds,\n                        };\n\n                        min_x = min_x.min(bounds.origin.x);\n                        min_y = min_y.min(bounds.origin.y);\n                        max_x = max_x.max(bounds.origin.x + bounds.size.width);\n                        max_y = max_y.max(bounds.origin.y + bounds.size.height);\n                    }\n                }\n\n                // Create group frame with calculated bounds\n                let group_bounds = testruct_core::layout::Rect::new(\n                    testruct_core::layout::Point::new(min_x, min_y),\n                    testruct_core::layout::Size::new(max_x - min_x, max_y - min_y),\n                );\n\n                let mut group = testruct_core::document::FrameElement {\n                    id: uuid::Uuid::new_v4(),\n                    bounds: group_bounds,\n                    children: Vec::new(),\n                };\n\n                // Second pass: move selected elements to group\n                let mut indices_to_remove = Vec::new();\n                for (i, element) in page.elements.iter().enumerate() {\n                    if selected_ids.contains(\u0026element.id()) {\n                        indices_to_remove.push(i);\n                    }\n                }\n\n                // Remove in reverse order to maintain indices\n                for i in indices_to_remove.iter().rev() {\n                    let element = page.elements.remove(*i);\n                    group.children.push(element);\n                }\n\n                // Reverse to maintain original order\n                group.children.reverse();\n\n                // Add group to page\n                page.add_element(testruct_core::document::DocumentElement::Frame(group.clone()));\n\n                tracing::info!(\" Grouped {} objects\", group.children.len());\n            }\n        });\n\n        // Clear selection and redraw\n        group_render_state.borrow_mut().clear();\n        let _ = group_drawing_area.queue_draw();\n    });\n\n    let ungroup_state = state.clone();\n    let ungroup_drawing_area = canvas_view.drawing_area();\n    let ungroup_render_state = canvas_view.render_state().selected_ids.clone();\n    add_window_action(window, \"ungroup\", move |_| {\n        tracing::info!(\"Action: ungroup selected objects\");\n\n        let selected_ids = ungroup_render_state.borrow();\n        if selected_ids.is_empty() {\n            tracing::warn!(\"  No objects selected for ungrouping\");\n            return;\n        }\n\n        ungroup_state.with_active_document(|doc| {\n            if let Some(page) = doc.pages.get_mut(0) {\n                let mut indices_to_ungroup = Vec::new();\n                let mut children_to_add = Vec::new();\n\n                // Find group frames to ungroup\n                for (i, element) in page.elements.iter().enumerate() {\n                    if selected_ids.contains(\u0026element.id()) {\n                        if let testruct_core::document::DocumentElement::Frame(frame) = element {\n                            indices_to_ungroup.push(i);\n                            children_to_add.extend(frame.children.iter().cloned());\n                        }\n                    }\n                }\n\n                if indices_to_ungroup.is_empty() {\n                    tracing::warn!(\"  Selected items are not groups\");\n                    return;\n                }\n\n                // Remove groups in reverse order\n                for i in indices_to_ungroup.iter().rev() {\n                    page.elements.remove(*i);\n                }\n\n                // Add children back to page\n                page.elements.extend(children_to_add.clone());\n\n                tracing::info!(\" Ungrouped {} groups with {} objects\", indices_to_ungroup.len(), children_to_add.len());\n            }\n        });\n\n        // Clear selection and redraw\n        ungroup_render_state.borrow_mut().clear();\n        let _ = ungroup_drawing_area.queue_draw();\n    });\n}\n","traces":[{"line":7,"address":[],"length":0,"stats":{"Line":0}},{"line":12,"address":[],"length":0,"stats":{"Line":0}},{"line":13,"address":[],"length":0,"stats":{"Line":0}},{"line":14,"address":[],"length":0,"stats":{"Line":0}},{"line":15,"address":[],"length":0,"stats":{"Line":0}},{"line":16,"address":[],"length":0,"stats":{"Line":0}},{"line":18,"address":[],"length":0,"stats":{"Line":0}},{"line":19,"address":[],"length":0,"stats":{"Line":0}},{"line":20,"address":[],"length":0,"stats":{"Line":0}},{"line":21,"address":[],"length":0,"stats":{"Line":0}},{"line":24,"address":[],"length":0,"stats":{"Line":0}},{"line":25,"address":[],"length":0,"stats":{"Line":0}},{"line":26,"address":[],"length":0,"stats":{"Line":0}},{"line":29,"address":[],"length":0,"stats":{"Line":0}},{"line":30,"address":[],"length":0,"stats":{"Line":0}},{"line":32,"address":[],"length":0,"stats":{"Line":0}},{"line":33,"address":[],"length":0,"stats":{"Line":0}},{"line":34,"address":[],"length":0,"stats":{"Line":0}},{"line":35,"address":[],"length":0,"stats":{"Line":0}},{"line":38,"address":[],"length":0,"stats":{"Line":0}},{"line":39,"address":[],"length":0,"stats":{"Line":0}},{"line":40,"address":[],"length":0,"stats":{"Line":0}},{"line":41,"address":[],"length":0,"stats":{"Line":0}},{"line":42,"address":[],"length":0,"stats":{"Line":0}},{"line":43,"address":[],"length":0,"stats":{"Line":0}},{"line":44,"address":[],"length":0,"stats":{"Line":0}},{"line":47,"address":[],"length":0,"stats":{"Line":0}},{"line":48,"address":[],"length":0,"stats":{"Line":0}},{"line":49,"address":[],"length":0,"stats":{"Line":0}},{"line":50,"address":[],"length":0,"stats":{"Line":0}},{"line":55,"address":[],"length":0,"stats":{"Line":0}},{"line":56,"address":[],"length":0,"stats":{"Line":0}},{"line":57,"address":[],"length":0,"stats":{"Line":0}},{"line":60,"address":[],"length":0,"stats":{"Line":0}},{"line":61,"address":[],"length":0,"stats":{"Line":0}},{"line":62,"address":[],"length":0,"stats":{"Line":0}},{"line":63,"address":[],"length":0,"stats":{"Line":0}},{"line":67,"address":[],"length":0,"stats":{"Line":0}},{"line":68,"address":[],"length":0,"stats":{"Line":0}},{"line":69,"address":[],"length":0,"stats":{"Line":0}},{"line":70,"address":[],"length":0,"stats":{"Line":0}},{"line":75,"address":[],"length":0,"stats":{"Line":0}},{"line":76,"address":[],"length":0,"stats":{"Line":0}},{"line":77,"address":[],"length":0,"stats":{"Line":0}},{"line":81,"address":[],"length":0,"stats":{"Line":0}},{"line":84,"address":[],"length":0,"stats":{"Line":0}},{"line":86,"address":[],"length":0,"stats":{"Line":0}},{"line":91,"address":[],"length":0,"stats":{"Line":0}},{"line":92,"address":[],"length":0,"stats":{"Line":0}},{"line":95,"address":[],"length":0,"stats":{"Line":0}},{"line":96,"address":[],"length":0,"stats":{"Line":0}},{"line":97,"address":[],"length":0,"stats":{"Line":0}},{"line":98,"address":[],"length":0,"stats":{"Line":0}},{"line":99,"address":[],"length":0,"stats":{"Line":0}},{"line":101,"address":[],"length":0,"stats":{"Line":0}},{"line":102,"address":[],"length":0,"stats":{"Line":0}},{"line":103,"address":[],"length":0,"stats":{"Line":0}},{"line":104,"address":[],"length":0,"stats":{"Line":0}},{"line":107,"address":[],"length":0,"stats":{"Line":0}},{"line":108,"address":[],"length":0,"stats":{"Line":0}},{"line":109,"address":[],"length":0,"stats":{"Line":0}},{"line":110,"address":[],"length":0,"stats":{"Line":0}},{"line":113,"address":[],"length":0,"stats":{"Line":0}},{"line":114,"address":[],"length":0,"stats":{"Line":0}},{"line":115,"address":[],"length":0,"stats":{"Line":0}},{"line":116,"address":[],"length":0,"stats":{"Line":0}},{"line":117,"address":[],"length":0,"stats":{"Line":0}},{"line":122,"address":[],"length":0,"stats":{"Line":0}},{"line":123,"address":[],"length":0,"stats":{"Line":0}},{"line":124,"address":[],"length":0,"stats":{"Line":0}},{"line":128,"address":[],"length":0,"stats":{"Line":0}},{"line":129,"address":[],"length":0,"stats":{"Line":0}},{"line":133,"address":[],"length":0,"stats":{"Line":0}},{"line":135,"address":[],"length":0,"stats":{"Line":0}},{"line":140,"address":[],"length":0,"stats":{"Line":0}},{"line":141,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":76},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","ui","src","window","actions","help_actions.rs"],"content":"//! Help action handlers (manual, about, settings)\n\nuse super::common::add_window_action;\nuse gtk4::prelude::*;\n\n/// Register help menu actions\npub fn register(window: \u0026gtk4::ApplicationWindow, state: crate::app::AppState) {\n    let window_weak_settings = window.downgrade();\n    let state_settings = state.clone();\n    add_window_action(window, \"settings\", move |_| {\n        tracing::info!(\"Action: show settings\");\n        if let Some(window) = window_weak_settings.upgrade() {\n            let window_base = window.clone().upcast::\u003cgtk4::Window\u003e();\n            crate::dialogs::show_project_settings(\u0026window_base, state_settings.clone());\n            tracing::info!(\" Settings dialog displayed\");\n        }\n    });\n\n    let window_weak_manual = window.downgrade();\n    add_window_action(window, \"user-manual\", move |_| {\n        tracing::info!(\"Action: open user manual\");\n        if let Some(window) = window_weak_manual.upgrade() {\n            let window_base = window.clone().upcast::\u003cgtk4::Window\u003e();\n            crate::dialogs::show_user_manual_dialog(\u0026window_base);\n            tracing::info!(\" User manual dialog displayed\");\n        }\n    });\n\n    let window_weak_about = window.downgrade();\n    add_window_action(window, \"about\", move |_| {\n        tracing::info!(\"Action: show about dialog\");\n        if let Some(window) = window_weak_about.upgrade() {\n            let window_base = window.clone().upcast::\u003cgtk4::Window\u003e();\n            crate::dialogs::show_about_dialog(\u0026window_base);\n            tracing::info!(\" About dialog displayed\");\n        }\n    });\n\n    let window_weak_json = window.downgrade();\n    let state_json = state.clone();\n    add_window_action(window, \"json-editor\", move |_| {\n        tracing::info!(\"Action: open JSON editor\");\n        if let Some(window) = window_weak_json.upgrade() {\n            let window_base = window.clone().upcast::\u003cgtk4::Window\u003e();\n            crate::dialogs::show_json_editor(\u0026window_base, state_json.clone());\n            tracing::info!(\" JSON editor displayed\");\n        }\n    });\n}\n","traces":[{"line":7,"address":[],"length":0,"stats":{"Line":0}},{"line":8,"address":[],"length":0,"stats":{"Line":0}},{"line":9,"address":[],"length":0,"stats":{"Line":0}},{"line":10,"address":[],"length":0,"stats":{"Line":0}},{"line":11,"address":[],"length":0,"stats":{"Line":0}},{"line":12,"address":[],"length":0,"stats":{"Line":0}},{"line":13,"address":[],"length":0,"stats":{"Line":0}},{"line":14,"address":[],"length":0,"stats":{"Line":0}},{"line":15,"address":[],"length":0,"stats":{"Line":0}},{"line":19,"address":[],"length":0,"stats":{"Line":0}},{"line":20,"address":[],"length":0,"stats":{"Line":0}},{"line":21,"address":[],"length":0,"stats":{"Line":0}},{"line":22,"address":[],"length":0,"stats":{"Line":0}},{"line":23,"address":[],"length":0,"stats":{"Line":0}},{"line":24,"address":[],"length":0,"stats":{"Line":0}},{"line":25,"address":[],"length":0,"stats":{"Line":0}},{"line":29,"address":[],"length":0,"stats":{"Line":0}},{"line":30,"address":[],"length":0,"stats":{"Line":0}},{"line":31,"address":[],"length":0,"stats":{"Line":0}},{"line":32,"address":[],"length":0,"stats":{"Line":0}},{"line":33,"address":[],"length":0,"stats":{"Line":0}},{"line":34,"address":[],"length":0,"stats":{"Line":0}},{"line":35,"address":[],"length":0,"stats":{"Line":0}},{"line":39,"address":[],"length":0,"stats":{"Line":0}},{"line":40,"address":[],"length":0,"stats":{"Line":0}},{"line":41,"address":[],"length":0,"stats":{"Line":0}},{"line":42,"address":[],"length":0,"stats":{"Line":0}},{"line":43,"address":[],"length":0,"stats":{"Line":0}},{"line":44,"address":[],"length":0,"stats":{"Line":0}},{"line":45,"address":[],"length":0,"stats":{"Line":0}},{"line":46,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":31},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","ui","src","window","actions","layer_actions.rs"],"content":"//! Layer management actions (reordering, visibility, deletion)\n\nuse super::common::add_window_action;\n\n/// Register layer management actions\npub fn register(\n    window: \u0026gtk4::ApplicationWindow,\n    state: crate::app::AppState,\n    canvas_view: \u0026crate::canvas::CanvasView,\n) {\n    let drawing_area = canvas_view.drawing_area();\n    let render_state = canvas_view.render_state().clone();\n\n    // Move layer up (Ctrl+])\n    let move_up_state = state.clone();\n    let move_up_drawing = drawing_area.clone();\n    let move_up_render = render_state.clone();\n    add_window_action(window, \"move-layer-up\", move |_| {\n        let selected = move_up_render.selected_ids.borrow();\n        if let Some(element_id) = selected.first().copied() {\n            drop(selected);\n            crate::panels::reorder_layer(\n                \u0026move_up_state,\n                element_id,\n                crate::panels::LayerDirection::Up,\n                move_up_drawing.clone(),\n            );\n        }\n    });\n\n    // Move layer down (Ctrl+[)\n    let move_down_state = state.clone();\n    let move_down_drawing = drawing_area.clone();\n    let move_down_render = render_state.clone();\n    add_window_action(window, \"move-layer-down\", move |_| {\n        let selected = move_down_render.selected_ids.borrow();\n        if let Some(element_id) = selected.first().copied() {\n            drop(selected);\n            crate::panels::reorder_layer(\n                \u0026move_down_state,\n                element_id,\n                crate::panels::LayerDirection::Down,\n                move_down_drawing.clone(),\n            );\n        }\n    });\n}\n","traces":[{"line":6,"address":[],"length":0,"stats":{"Line":0}},{"line":11,"address":[],"length":0,"stats":{"Line":0}},{"line":12,"address":[],"length":0,"stats":{"Line":0}},{"line":15,"address":[],"length":0,"stats":{"Line":0}},{"line":16,"address":[],"length":0,"stats":{"Line":0}},{"line":17,"address":[],"length":0,"stats":{"Line":0}},{"line":18,"address":[],"length":0,"stats":{"Line":0}},{"line":19,"address":[],"length":0,"stats":{"Line":0}},{"line":20,"address":[],"length":0,"stats":{"Line":0}},{"line":21,"address":[],"length":0,"stats":{"Line":0}},{"line":22,"address":[],"length":0,"stats":{"Line":0}},{"line":23,"address":[],"length":0,"stats":{"Line":0}},{"line":24,"address":[],"length":0,"stats":{"Line":0}},{"line":25,"address":[],"length":0,"stats":{"Line":0}},{"line":26,"address":[],"length":0,"stats":{"Line":0}},{"line":32,"address":[],"length":0,"stats":{"Line":0}},{"line":33,"address":[],"length":0,"stats":{"Line":0}},{"line":34,"address":[],"length":0,"stats":{"Line":0}},{"line":35,"address":[],"length":0,"stats":{"Line":0}},{"line":36,"address":[],"length":0,"stats":{"Line":0}},{"line":37,"address":[],"length":0,"stats":{"Line":0}},{"line":38,"address":[],"length":0,"stats":{"Line":0}},{"line":39,"address":[],"length":0,"stats":{"Line":0}},{"line":40,"address":[],"length":0,"stats":{"Line":0}},{"line":41,"address":[],"length":0,"stats":{"Line":0}},{"line":42,"address":[],"length":0,"stats":{"Line":0}},{"line":43,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":27},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","ui","src","window","actions","mod.rs"],"content":"//! Window-level action handlers for menu and toolbar events\n//!\n//! This module organizes action callbacks into logical sections:\n//! - File operations (new, open, save, save-as)\n//! - Export operations (PDF, PNG, JPEG, SVG)\n//! - Edit operations (undo, redo, select-all)\n//! - View toggles (grid, guides, rulers)\n//! - Page management (add, delete, duplicate, move pages)\n//! - Tool operations (image insertion, templates)\n//! - Z-order operations (bring-to-front, send-to-back, etc.)\n//! - Grouping operations (group, ungroup)\n//! - Clipboard operations (copy, paste)\n//! - Help operations (manual, about, settings)\n\nmod common;\nmod file_actions;\nmod export_actions;\nmod edit_actions;\nmod view_actions;\nmod tools_actions;\nmod group_actions;\nmod clipboard_actions;\nmod help_actions;\nmod layer_actions;\nmod alignment_actions;\n\nuse gtk4::prelude::*;\nuse gtk4::Box as GtkBox;\nuse crate::window::actions::common::add_window_action;\n\n/// Register all window-level actions\npub fn register_window_actions(\n    window: \u0026gtk4::ApplicationWindow,\n    state: crate::app::AppState,\n    canvas_view: \u0026crate::canvas::CanvasView,\n    tool_palette: \u0026GtkBox,\n    properties_panel: \u0026GtkBox,\n    property_components: \u0026crate::panels::PropertyPanelComponents,\n) {\n    // Register actions from each module\n    file_actions::register(window, state.clone());\n    export_actions::register(window, state.clone());\n    edit_actions::register(window, state.clone(), canvas_view);\n    view_actions::register(window, canvas_view, tool_palette, properties_panel);\n    tools_actions::register(window, state.clone(), canvas_view, property_components);\n    group_actions::register(window, state.clone(), canvas_view);\n    clipboard_actions::register(window, state.clone(), canvas_view);\n    layer_actions::register(window, state.clone(), canvas_view);\n    alignment_actions::register(window, state.clone(), canvas_view);\n    help_actions::register(window, state.clone());\n\n    // Register block tools toggle action\n    add_window_action(window, \"toggle-block-tools\", |_| {\n        tracing::info!(\"Action: toggle block tools\");\n        // Block tools panel toggle is handled by the toolbar button binding\n        // The visibility state is managed by the GTK button's active state\n    });\n\n    // Set keyboard accelerators\n    common::set_accelerators(window);\n}\n","traces":[{"line":32,"address":[],"length":0,"stats":{"Line":0}},{"line":41,"address":[],"length":0,"stats":{"Line":0}},{"line":42,"address":[],"length":0,"stats":{"Line":0}},{"line":43,"address":[],"length":0,"stats":{"Line":0}},{"line":44,"address":[],"length":0,"stats":{"Line":0}},{"line":45,"address":[],"length":0,"stats":{"Line":0}},{"line":46,"address":[],"length":0,"stats":{"Line":0}},{"line":47,"address":[],"length":0,"stats":{"Line":0}},{"line":48,"address":[],"length":0,"stats":{"Line":0}},{"line":49,"address":[],"length":0,"stats":{"Line":0}},{"line":50,"address":[],"length":0,"stats":{"Line":0}},{"line":53,"address":[],"length":0,"stats":{"Line":0}},{"line":54,"address":[],"length":0,"stats":{"Line":0}},{"line":60,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":14},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","ui","src","window","actions","tools_actions.rs"],"content":"//! Tool action handlers (image insertion, templates, z-order)\n\nuse super::common::add_window_action;\nuse gtk4::prelude::*;\n\n/// Register tool menu actions and z-order button handlers\npub fn register(\n    window: \u0026gtk4::ApplicationWindow,\n    state: crate::app::AppState,\n    canvas_view: \u0026crate::canvas::CanvasView,\n    property_components: \u0026crate::panels::PropertyPanelComponents,\n) {\n    // Image insertion\n    let insert_image_state = state.clone();\n    let insert_image_window = window.clone();\n    let insert_image_drawing_area = canvas_view.drawing_area();\n    add_window_action(window, \"insert-image\", move |_| {\n        tracing::info!(\"Action: insert image\");\n\n        let window_ref = insert_image_window.clone();\n        let state_ref = insert_image_state.clone();\n        let drawing_area = insert_image_drawing_area.clone();\n\n        let window_as_base = window_ref.upcast::\u003cgtk4::Window\u003e();\n        crate::dialogs::show_image_chooser_async(\n            \u0026window_as_base,\n            Box::new(move |path| {\n                tracing::info!(\"Selected image file: {}\", path.display());\n\n                let asset_catalog = state_ref.asset_catalog();\n                let asset_ref = {\n                    let mut catalog = asset_catalog.lock().expect(\"asset catalog\");\n                    catalog.register(\u0026path)\n                };\n                tracing::info!(\" Registered image asset: {:?}\", asset_ref);\n\n                let image_element = testruct_core::document::ImageElement {\n                    id: uuid::Uuid::new_v4(),\n                    source: asset_ref,\n                    bounds: testruct_core::layout::Rect {\n                        origin: testruct_core::layout::Point { x: 100.0, y: 100.0 },\n                        size: testruct_core::layout::Size { width: 200.0, height: 200.0 },\n                    },\n                };\n\n                match state_ref.add_element_to_active_page(\n                    testruct_core::document::DocumentElement::Image(image_element),\n                ) {\n                    Ok(_) =\u003e {\n                        tracing::info!(\" Image inserted: {}\", path.display());\n                        let _ = drawing_area.queue_draw();\n                    }\n                    Err(e) =\u003e {\n                        tracing::error!(\" Failed to insert image: {}\", e);\n                    }\n                }\n            }),\n        );\n    });\n\n    // Template browser\n    let templates_state = state.clone();\n    let templates_window = window.clone();\n    add_window_action(window, \"templates\", move |_| {\n        tracing::info!(\"Action: show templates\");\n\n        let window_ref = templates_window.clone();\n        let state_ref = templates_state.clone();\n\n        let window_as_base = window_ref.clone().upcast::\u003cgtk4::Window\u003e();\n\n        let project = state_ref.project();\n        let templates: Vec\u003c_\u003e = project.templates.iter().collect();\n\n        if templates.is_empty() {\n            tracing::warn!(\"  No templates available\");\n            return;\n        }\n\n        crate::dialogs::show_template_browser_async(\n            \u0026window_as_base,\n            templates,\n            Box::new(move |selected_template| {\n                if let Some(template) = selected_template {\n                    tracing::info!(\" Template selected: {}\", template.name);\n\n                    let project = state_ref.project();\n                    if let Some(_new_doc) = project.apply_template(\n                        testruct_core::template::TemplateRef { id: template.id }\n                    ) {\n                        tracing::info!(\" New document created from template\");\n                    } else {\n                        tracing::error!(\" Failed to create document from template\");\n                    }\n                } else {\n                    tracing::info!(\"  Template selection cancelled\");\n                }\n            }),\n        );\n    });\n\n    // Z-order button handlers\n    register_zorder_actions(state, canvas_view, property_components);\n}\n\n/// Register z-order button handlers\nfn register_zorder_actions(\n    state: crate::app::AppState,\n    canvas_view: \u0026crate::canvas::CanvasView,\n    property_components: \u0026crate::panels::PropertyPanelComponents,\n) {\n    let bring_to_front_state = state.clone();\n    let bring_to_front_drawing_area = canvas_view.drawing_area();\n    let bring_to_front_render_state = canvas_view.render_state().selected_ids.clone();\n    property_components.bring_to_front_btn.connect_clicked(move |_| {\n        tracing::info!(\"Action: bring to front\");\n        let selected_ids = bring_to_front_render_state.borrow();\n        if let Some(element_id) = selected_ids.first().copied() {\n            bring_to_front_state.with_active_document(|doc| {\n                if let Some(page) = doc.pages.get_mut(0) {\n                    if page.bring_to_front(element_id) {\n                        tracing::info!(\" Element brought to front\");\n                        let _ = bring_to_front_drawing_area.queue_draw();\n                    } else {\n                        tracing::warn!(\"  Element not found\");\n                    }\n                } else {\n                    tracing::warn!(\"  No active page\");\n                }\n            });\n        } else {\n            tracing::warn!(\"  No element selected\");\n        }\n    });\n\n    let bring_forward_state = state.clone();\n    let bring_forward_drawing_area = canvas_view.drawing_area();\n    let bring_forward_render_state = canvas_view.render_state().selected_ids.clone();\n    property_components.bring_forward_btn.connect_clicked(move |_| {\n        tracing::info!(\"Action: bring forward\");\n        let selected_ids = bring_forward_render_state.borrow();\n        if let Some(element_id) = selected_ids.first().copied() {\n            bring_forward_state.with_active_document(|doc| {\n                if let Some(page) = doc.pages.get_mut(0) {\n                    if page.bring_forward(element_id) {\n                        tracing::info!(\" Element brought forward\");\n                        let _ = bring_forward_drawing_area.queue_draw();\n                    } else {\n                        tracing::warn!(\"  Element already at front or not found\");\n                    }\n                } else {\n                    tracing::warn!(\"  No active page\");\n                }\n            });\n        } else {\n            tracing::warn!(\"  No element selected\");\n        }\n    });\n\n    let send_to_back_state = state.clone();\n    let send_to_back_drawing_area = canvas_view.drawing_area();\n    let send_to_back_render_state = canvas_view.render_state().selected_ids.clone();\n    property_components.send_to_back_btn.connect_clicked(move |_| {\n        tracing::info!(\"Action: send to back\");\n        let selected_ids = send_to_back_render_state.borrow();\n        if let Some(element_id) = selected_ids.first().copied() {\n            send_to_back_state.with_active_document(|doc| {\n                if let Some(page) = doc.pages.get_mut(0) {\n                    if page.send_to_back(element_id) {\n                        tracing::info!(\" Element sent to back\");\n                        let _ = send_to_back_drawing_area.queue_draw();\n                    } else {\n                        tracing::warn!(\"  Element not found\");\n                    }\n                } else {\n                    tracing::warn!(\"  No active page\");\n                }\n            });\n        } else {\n            tracing::warn!(\"  No element selected\");\n        }\n    });\n\n    let send_backward_state = state.clone();\n    let send_backward_drawing_area = canvas_view.drawing_area();\n    let send_backward_render_state = canvas_view.render_state().selected_ids.clone();\n    property_components.send_backward_btn.connect_clicked(move |_| {\n        tracing::info!(\"Action: send backward\");\n        let selected_ids = send_backward_render_state.borrow();\n        if let Some(element_id) = selected_ids.first().copied() {\n            send_backward_state.with_active_document(|doc| {\n                if let Some(page) = doc.pages.get_mut(0) {\n                    if page.send_backward(element_id) {\n                        tracing::info!(\" Element sent backward\");\n                        let _ = send_backward_drawing_area.queue_draw();\n                    } else {\n                        tracing::warn!(\"  Element already at back or not found\");\n                    }\n                } else {\n                    tracing::warn!(\"  No active page\");\n                }\n            });\n        } else {\n            tracing::warn!(\"  No element selected\");\n        }\n    });\n}\n","traces":[{"line":7,"address":[],"length":0,"stats":{"Line":0}},{"line":14,"address":[],"length":0,"stats":{"Line":0}},{"line":15,"address":[],"length":0,"stats":{"Line":0}},{"line":16,"address":[],"length":0,"stats":{"Line":0}},{"line":17,"address":[],"length":0,"stats":{"Line":0}},{"line":18,"address":[],"length":0,"stats":{"Line":0}},{"line":20,"address":[],"length":0,"stats":{"Line":0}},{"line":21,"address":[],"length":0,"stats":{"Line":0}},{"line":22,"address":[],"length":0,"stats":{"Line":0}},{"line":24,"address":[],"length":0,"stats":{"Line":0}},{"line":25,"address":[],"length":0,"stats":{"Line":0}},{"line":26,"address":[],"length":0,"stats":{"Line":0}},{"line":27,"address":[],"length":0,"stats":{"Line":0}},{"line":28,"address":[],"length":0,"stats":{"Line":0}},{"line":30,"address":[],"length":0,"stats":{"Line":0}},{"line":31,"address":[],"length":0,"stats":{"Line":0}},{"line":32,"address":[],"length":0,"stats":{"Line":0}},{"line":33,"address":[],"length":0,"stats":{"Line":0}},{"line":35,"address":[],"length":0,"stats":{"Line":0}},{"line":37,"address":[],"length":0,"stats":{"Line":0}},{"line":38,"address":[],"length":0,"stats":{"Line":0}},{"line":39,"address":[],"length":0,"stats":{"Line":0}},{"line":40,"address":[],"length":0,"stats":{"Line":0}},{"line":41,"address":[],"length":0,"stats":{"Line":0}},{"line":42,"address":[],"length":0,"stats":{"Line":0}},{"line":46,"address":[],"length":0,"stats":{"Line":0}},{"line":47,"address":[],"length":0,"stats":{"Line":0}},{"line":50,"address":[],"length":0,"stats":{"Line":0}},{"line":51,"address":[],"length":0,"stats":{"Line":0}},{"line":53,"address":[],"length":0,"stats":{"Line":0}},{"line":54,"address":[],"length":0,"stats":{"Line":0}},{"line":62,"address":[],"length":0,"stats":{"Line":0}},{"line":63,"address":[],"length":0,"stats":{"Line":0}},{"line":64,"address":[],"length":0,"stats":{"Line":0}},{"line":65,"address":[],"length":0,"stats":{"Line":0}},{"line":67,"address":[],"length":0,"stats":{"Line":0}},{"line":68,"address":[],"length":0,"stats":{"Line":0}},{"line":70,"address":[],"length":0,"stats":{"Line":0}},{"line":72,"address":[],"length":0,"stats":{"Line":0}},{"line":73,"address":[],"length":0,"stats":{"Line":0}},{"line":75,"address":[],"length":0,"stats":{"Line":0}},{"line":76,"address":[],"length":0,"stats":{"Line":0}},{"line":77,"address":[],"length":0,"stats":{"Line":0}},{"line":80,"address":[],"length":0,"stats":{"Line":0}},{"line":81,"address":[],"length":0,"stats":{"Line":0}},{"line":82,"address":[],"length":0,"stats":{"Line":0}},{"line":83,"address":[],"length":0,"stats":{"Line":0}},{"line":84,"address":[],"length":0,"stats":{"Line":0}},{"line":85,"address":[],"length":0,"stats":{"Line":0}},{"line":87,"address":[],"length":0,"stats":{"Line":0}},{"line":88,"address":[],"length":0,"stats":{"Line":0}},{"line":89,"address":[],"length":0,"stats":{"Line":0}},{"line":91,"address":[],"length":0,"stats":{"Line":0}},{"line":93,"address":[],"length":0,"stats":{"Line":0}},{"line":96,"address":[],"length":0,"stats":{"Line":0}},{"line":103,"address":[],"length":0,"stats":{"Line":0}},{"line":107,"address":[],"length":0,"stats":{"Line":0}},{"line":112,"address":[],"length":0,"stats":{"Line":0}},{"line":113,"address":[],"length":0,"stats":{"Line":0}},{"line":114,"address":[],"length":0,"stats":{"Line":0}},{"line":115,"address":[],"length":0,"stats":{"Line":0}},{"line":116,"address":[],"length":0,"stats":{"Line":0}},{"line":117,"address":[],"length":0,"stats":{"Line":0}},{"line":118,"address":[],"length":0,"stats":{"Line":0}},{"line":119,"address":[],"length":0,"stats":{"Line":0}},{"line":120,"address":[],"length":0,"stats":{"Line":0}},{"line":121,"address":[],"length":0,"stats":{"Line":0}},{"line":122,"address":[],"length":0,"stats":{"Line":0}},{"line":123,"address":[],"length":0,"stats":{"Line":0}},{"line":125,"address":[],"length":0,"stats":{"Line":0}},{"line":128,"address":[],"length":0,"stats":{"Line":0}},{"line":132,"address":[],"length":0,"stats":{"Line":0}},{"line":136,"address":[],"length":0,"stats":{"Line":0}},{"line":137,"address":[],"length":0,"stats":{"Line":0}},{"line":138,"address":[],"length":0,"stats":{"Line":0}},{"line":139,"address":[],"length":0,"stats":{"Line":0}},{"line":140,"address":[],"length":0,"stats":{"Line":0}},{"line":141,"address":[],"length":0,"stats":{"Line":0}},{"line":142,"address":[],"length":0,"stats":{"Line":0}},{"line":143,"address":[],"length":0,"stats":{"Line":0}},{"line":144,"address":[],"length":0,"stats":{"Line":0}},{"line":145,"address":[],"length":0,"stats":{"Line":0}},{"line":146,"address":[],"length":0,"stats":{"Line":0}},{"line":147,"address":[],"length":0,"stats":{"Line":0}},{"line":149,"address":[],"length":0,"stats":{"Line":0}},{"line":152,"address":[],"length":0,"stats":{"Line":0}},{"line":156,"address":[],"length":0,"stats":{"Line":0}},{"line":160,"address":[],"length":0,"stats":{"Line":0}},{"line":161,"address":[],"length":0,"stats":{"Line":0}},{"line":162,"address":[],"length":0,"stats":{"Line":0}},{"line":163,"address":[],"length":0,"stats":{"Line":0}},{"line":164,"address":[],"length":0,"stats":{"Line":0}},{"line":165,"address":[],"length":0,"stats":{"Line":0}},{"line":166,"address":[],"length":0,"stats":{"Line":0}},{"line":167,"address":[],"length":0,"stats":{"Line":0}},{"line":168,"address":[],"length":0,"stats":{"Line":0}},{"line":169,"address":[],"length":0,"stats":{"Line":0}},{"line":170,"address":[],"length":0,"stats":{"Line":0}},{"line":171,"address":[],"length":0,"stats":{"Line":0}},{"line":173,"address":[],"length":0,"stats":{"Line":0}},{"line":176,"address":[],"length":0,"stats":{"Line":0}},{"line":180,"address":[],"length":0,"stats":{"Line":0}},{"line":184,"address":[],"length":0,"stats":{"Line":0}},{"line":185,"address":[],"length":0,"stats":{"Line":0}},{"line":186,"address":[],"length":0,"stats":{"Line":0}},{"line":187,"address":[],"length":0,"stats":{"Line":0}},{"line":188,"address":[],"length":0,"stats":{"Line":0}},{"line":189,"address":[],"length":0,"stats":{"Line":0}},{"line":190,"address":[],"length":0,"stats":{"Line":0}},{"line":191,"address":[],"length":0,"stats":{"Line":0}},{"line":192,"address":[],"length":0,"stats":{"Line":0}},{"line":193,"address":[],"length":0,"stats":{"Line":0}},{"line":194,"address":[],"length":0,"stats":{"Line":0}},{"line":195,"address":[],"length":0,"stats":{"Line":0}},{"line":197,"address":[],"length":0,"stats":{"Line":0}},{"line":200,"address":[],"length":0,"stats":{"Line":0}},{"line":204,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":117},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","ui","src","window","actions","view_actions.rs"],"content":"//! View action handlers (grid, guides, rulers, panels visibility)\n\nuse super::common::add_window_action;\nuse gtk4::{prelude::*, Box as GtkBox};\n\n/// Register view menu actions\npub fn register(\n    window: \u0026gtk4::ApplicationWindow,\n    canvas_view: \u0026crate::canvas::CanvasView,\n    tool_palette: \u0026GtkBox,\n    properties_panel: \u0026GtkBox,\n) {\n    let grid_drawing_area = canvas_view.drawing_area();\n    let grid_render_state = canvas_view.render_state().clone();\n    add_window_action(window, \"toggle-grid\", move |_| {\n        tracing::info!(\"Action: toggle grid visibility\");\n        let mut config = grid_render_state.config.borrow_mut();\n        config.show_grid = !config.show_grid;\n        let new_state = config.show_grid;\n        drop(config);\n        tracing::info!(\" Grid visibility toggled: {}\", new_state);\n        let _ = grid_drawing_area.queue_draw();\n    });\n\n    let guides_drawing_area = canvas_view.drawing_area();\n    let guides_render_state = canvas_view.render_state().clone();\n    add_window_action(window, \"toggle-guides\", move |_| {\n        tracing::info!(\"Action: toggle guides visibility\");\n        let mut config = guides_render_state.config.borrow_mut();\n        config.show_guides = !config.show_guides;\n        let new_state = config.show_guides;\n        drop(config);\n        tracing::info!(\" Guides visibility toggled: {}\", new_state);\n        let _ = guides_drawing_area.queue_draw();\n    });\n\n    let rulers_drawing_area = canvas_view.drawing_area();\n    let rulers_render_state = canvas_view.render_state().clone();\n    add_window_action(window, \"toggle-rulers\", move |_| {\n        tracing::info!(\"Action: toggle rulers\");\n        let mut config = rulers_render_state.config.borrow_mut();\n        config.show_rulers = !config.show_rulers;\n        let new_state = config.show_rulers;\n        drop(config);\n        tracing::info!(\" Rulers visibility toggled: {}\", new_state);\n        let _ = rulers_drawing_area.queue_draw();\n    });\n\n    let tool_palette_toggle = tool_palette.clone();\n    add_window_action(window, \"toggle-tool-palette\", move |_| {\n        tracing::info!(\"Action: toggle tool palette\");\n        let is_visible = tool_palette_toggle.is_visible();\n        tool_palette_toggle.set_visible(!is_visible);\n        tracing::info!(\" Tool palette visibility toggled: {}\", !is_visible);\n    });\n\n    let item_library_panel = properties_panel.clone();\n    add_window_action(window, \"toggle-item-library\", move |_| {\n        tracing::info!(\"Action: toggle item library\");\n        let is_visible = item_library_panel.is_visible();\n        item_library_panel.set_visible(!is_visible);\n        tracing::info!(\" Item library visibility toggled: {}\", !is_visible);\n    });\n}\n","traces":[{"line":7,"address":[],"length":0,"stats":{"Line":0}},{"line":13,"address":[],"length":0,"stats":{"Line":0}},{"line":14,"address":[],"length":0,"stats":{"Line":0}},{"line":15,"address":[],"length":0,"stats":{"Line":0}},{"line":16,"address":[],"length":0,"stats":{"Line":0}},{"line":17,"address":[],"length":0,"stats":{"Line":0}},{"line":18,"address":[],"length":0,"stats":{"Line":0}},{"line":19,"address":[],"length":0,"stats":{"Line":0}},{"line":20,"address":[],"length":0,"stats":{"Line":0}},{"line":21,"address":[],"length":0,"stats":{"Line":0}},{"line":22,"address":[],"length":0,"stats":{"Line":0}},{"line":25,"address":[],"length":0,"stats":{"Line":0}},{"line":26,"address":[],"length":0,"stats":{"Line":0}},{"line":27,"address":[],"length":0,"stats":{"Line":0}},{"line":28,"address":[],"length":0,"stats":{"Line":0}},{"line":29,"address":[],"length":0,"stats":{"Line":0}},{"line":30,"address":[],"length":0,"stats":{"Line":0}},{"line":31,"address":[],"length":0,"stats":{"Line":0}},{"line":32,"address":[],"length":0,"stats":{"Line":0}},{"line":33,"address":[],"length":0,"stats":{"Line":0}},{"line":34,"address":[],"length":0,"stats":{"Line":0}},{"line":37,"address":[],"length":0,"stats":{"Line":0}},{"line":38,"address":[],"length":0,"stats":{"Line":0}},{"line":39,"address":[],"length":0,"stats":{"Line":0}},{"line":40,"address":[],"length":0,"stats":{"Line":0}},{"line":41,"address":[],"length":0,"stats":{"Line":0}},{"line":42,"address":[],"length":0,"stats":{"Line":0}},{"line":43,"address":[],"length":0,"stats":{"Line":0}},{"line":44,"address":[],"length":0,"stats":{"Line":0}},{"line":45,"address":[],"length":0,"stats":{"Line":0}},{"line":46,"address":[],"length":0,"stats":{"Line":0}},{"line":49,"address":[],"length":0,"stats":{"Line":0}},{"line":50,"address":[],"length":0,"stats":{"Line":0}},{"line":51,"address":[],"length":0,"stats":{"Line":0}},{"line":52,"address":[],"length":0,"stats":{"Line":0}},{"line":53,"address":[],"length":0,"stats":{"Line":0}},{"line":54,"address":[],"length":0,"stats":{"Line":0}},{"line":57,"address":[],"length":0,"stats":{"Line":0}},{"line":58,"address":[],"length":0,"stats":{"Line":0}},{"line":59,"address":[],"length":0,"stats":{"Line":0}},{"line":60,"address":[],"length":0,"stats":{"Line":0}},{"line":61,"address":[],"length":0,"stats":{"Line":0}},{"line":62,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":43},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","ui","src","window","bindings.rs"],"content":"use super::WindowComponents;\nuse crate::app::AppState;\nuse gtk4::prelude::*;\n\npub fn bind_events(components: \u0026WindowComponents, _state: AppState) {\n    // CanvasView is already configured with event handlers and draw function\n    // during CanvasView::new() in layout::build_widgets()\n\n    // Bind toolbar buttons to window actions\n    bind_toolbar_buttons(components);\n\n    // Bind tool palette buttons to tool switching\n    bind_tool_selection(components);\n\n    components.window.set_focus_visible(true);\n}\n\n/// Bind toolbar buttons to corresponding window actions\nfn bind_toolbar_buttons(components: \u0026WindowComponents) {\n    let toolbar = \u0026components.toolbar.buttons;\n    let window = \u0026components.window;\n\n    // Document operations\n    bind_button(\u0026toolbar.new_btn, window, \"win.new\");\n    bind_button(\u0026toolbar.open_btn, window, \"win.open\");\n    bind_button(\u0026toolbar.save_btn, window, \"win.save\");\n    bind_button(\u0026toolbar.export_btn, window, \"win.export-pdf\");\n    bind_button(\u0026toolbar.image_export_btn, window, \"win.export-png\");\n\n    // History operations\n    bind_button(\u0026toolbar.undo_btn, window, \"win.undo\");\n    bind_button(\u0026toolbar.redo_btn, window, \"win.redo\");\n\n    // Workflow shortcuts\n    bind_button(\u0026toolbar.template_btn, window, \"win.templates\");\n    bind_button(\u0026toolbar.json_editor_btn, window, \"win.open-json-editor\");\n    bind_button(\u0026toolbar.settings_btn, window, \"win.settings\");\n\n    // View toggles\n    bind_toggle_button(\u0026toolbar.grid_toggle_btn, window, \"win.toggle-grid\");\n    bind_toggle_button(\u0026toolbar.guides_visible_btn, window, \"win.toggle-guides\");\n    bind_toggle_button(\u0026toolbar.rulers_visible_btn, window, \"win.toggle-rulers\");\n    bind_toggle_button(\u0026toolbar.item_library_btn, window, \"win.toggle-item-library\");\n    bind_toggle_button(\u0026toolbar.block_tools_btn, window, \"win.toggle-block-tools\");\n\n    // Popover toggles\n    bind_toggle_button(\u0026toolbar.ruler_menu_toggle, window, \"win.toggle-rulers\");\n    bind_toggle_button(\u0026toolbar.guides_menu_toggle, window, \"win.toggle-guides\");\n}\n\n/// Bind a regular button to a window action\nfn bind_button(button: \u0026gtk4::Button, window: \u0026gtk4::ApplicationWindow, action_name: \u0026str) {\n    let action_name = action_name.to_string();\n    let window_weak = window.downgrade();\n\n    button.connect_clicked(move |_| {\n        if let Some(window) = window_weak.upgrade() {\n            // Activate the action\n            if let Some(action) = window.lookup_action(\u0026action_name[4..]) {\n                action.activate(None);\n            }\n        }\n    });\n}\n\n/// Bind a toggle button to a window action\nfn bind_toggle_button(button: \u0026gtk4::ToggleButton, window: \u0026gtk4::ApplicationWindow, action_name: \u0026str) {\n    let action_name = action_name.to_string();\n    let window_weak = window.downgrade();\n\n    button.connect_toggled(move |_| {\n        if let Some(window) = window_weak.upgrade() {\n            // Activate the action\n            if let Some(action) = window.lookup_action(\u0026action_name[4..]) {\n                action.activate(None);\n            }\n        }\n    });\n}\n\n/// Bind tool palette buttons to tool mode switching\nfn bind_tool_selection(components: \u0026WindowComponents) {\n    use crate::canvas::tools::ToolMode;\n\n    let canvas_view = \u0026components.canvas_view;\n    let render_state = canvas_view.render_state().clone();\n    let tool_buttons = \u0026components.tool_palette_buttons;\n\n    // Select tool button\n    let state_select = render_state.clone();\n    tool_buttons.select_btn.connect_clicked(move |_| {\n        let mut tool_state = state_select.tool_state.borrow_mut();\n        tool_state.current_tool = ToolMode::Select;\n        tracing::debug!(\"Tool switched to: Select\");\n    });\n\n    // Rectangle tool button\n    let state_rect = render_state.clone();\n    tool_buttons.rect_btn.connect_clicked(move |_| {\n        let mut tool_state = state_rect.tool_state.borrow_mut();\n        tool_state.current_tool = ToolMode::Rectangle;\n        tracing::debug!(\"Tool switched to: Rectangle\");\n    });\n\n    // Circle tool button\n    let state_circle = render_state.clone();\n    tool_buttons.circle_btn.connect_clicked(move |_| {\n        let mut tool_state = state_circle.tool_state.borrow_mut();\n        tool_state.current_tool = ToolMode::Circle;\n        tracing::debug!(\"Tool switched to: Circle\");\n    });\n\n    // Text tool button\n    let state_text = render_state.clone();\n    tool_buttons.text_btn.connect_clicked(move |_| {\n        let mut tool_state = state_text.tool_state.borrow_mut();\n        tool_state.current_tool = ToolMode::Text;\n        tracing::debug!(\"Tool switched to: Text\");\n    });\n\n    // Line tool button\n    let state_line = render_state.clone();\n    tool_buttons.line_btn.connect_clicked(move |_| {\n        let mut tool_state = state_line.tool_state.borrow_mut();\n        tool_state.current_tool = ToolMode::Line;\n        tracing::debug!(\"Tool switched to: Line\");\n    });\n\n    // Arrow tool button\n    let state_arrow = render_state.clone();\n    tool_buttons.arrow_btn.connect_clicked(move |_| {\n        let mut tool_state = state_arrow.tool_state.borrow_mut();\n        tool_state.current_tool = ToolMode::Arrow;\n        tracing::debug!(\"Tool switched to: Arrow\");\n    });\n\n    // Image tool button\n    let state_image = render_state.clone();\n    tool_buttons.image_btn.connect_clicked(move |_| {\n        let mut tool_state = state_image.tool_state.borrow_mut();\n        tool_state.current_tool = ToolMode::Image;\n        tracing::debug!(\"Tool switched to: Image\");\n    });\n}\n","traces":[{"line":5,"address":[],"length":0,"stats":{"Line":0}},{"line":10,"address":[],"length":0,"stats":{"Line":0}},{"line":13,"address":[],"length":0,"stats":{"Line":0}},{"line":15,"address":[],"length":0,"stats":{"Line":0}},{"line":19,"address":[],"length":0,"stats":{"Line":0}},{"line":20,"address":[],"length":0,"stats":{"Line":0}},{"line":21,"address":[],"length":0,"stats":{"Line":0}},{"line":24,"address":[],"length":0,"stats":{"Line":0}},{"line":25,"address":[],"length":0,"stats":{"Line":0}},{"line":26,"address":[],"length":0,"stats":{"Line":0}},{"line":27,"address":[],"length":0,"stats":{"Line":0}},{"line":28,"address":[],"length":0,"stats":{"Line":0}},{"line":31,"address":[],"length":0,"stats":{"Line":0}},{"line":32,"address":[],"length":0,"stats":{"Line":0}},{"line":35,"address":[],"length":0,"stats":{"Line":0}},{"line":36,"address":[],"length":0,"stats":{"Line":0}},{"line":37,"address":[],"length":0,"stats":{"Line":0}},{"line":40,"address":[],"length":0,"stats":{"Line":0}},{"line":41,"address":[],"length":0,"stats":{"Line":0}},{"line":42,"address":[],"length":0,"stats":{"Line":0}},{"line":43,"address":[],"length":0,"stats":{"Line":0}},{"line":44,"address":[],"length":0,"stats":{"Line":0}},{"line":47,"address":[],"length":0,"stats":{"Line":0}},{"line":48,"address":[],"length":0,"stats":{"Line":0}},{"line":52,"address":[],"length":0,"stats":{"Line":0}},{"line":53,"address":[],"length":0,"stats":{"Line":0}},{"line":54,"address":[],"length":0,"stats":{"Line":0}},{"line":56,"address":[],"length":0,"stats":{"Line":0}},{"line":57,"address":[],"length":0,"stats":{"Line":0}},{"line":59,"address":[],"length":0,"stats":{"Line":0}},{"line":60,"address":[],"length":0,"stats":{"Line":0}},{"line":67,"address":[],"length":0,"stats":{"Line":0}},{"line":68,"address":[],"length":0,"stats":{"Line":0}},{"line":69,"address":[],"length":0,"stats":{"Line":0}},{"line":71,"address":[],"length":0,"stats":{"Line":0}},{"line":72,"address":[],"length":0,"stats":{"Line":0}},{"line":74,"address":[],"length":0,"stats":{"Line":0}},{"line":75,"address":[],"length":0,"stats":{"Line":0}},{"line":82,"address":[],"length":0,"stats":{"Line":0}},{"line":85,"address":[],"length":0,"stats":{"Line":0}},{"line":86,"address":[],"length":0,"stats":{"Line":0}},{"line":87,"address":[],"length":0,"stats":{"Line":0}},{"line":90,"address":[],"length":0,"stats":{"Line":0}},{"line":91,"address":[],"length":0,"stats":{"Line":0}},{"line":92,"address":[],"length":0,"stats":{"Line":0}},{"line":93,"address":[],"length":0,"stats":{"Line":0}},{"line":94,"address":[],"length":0,"stats":{"Line":0}},{"line":98,"address":[],"length":0,"stats":{"Line":0}},{"line":99,"address":[],"length":0,"stats":{"Line":0}},{"line":100,"address":[],"length":0,"stats":{"Line":0}},{"line":101,"address":[],"length":0,"stats":{"Line":0}},{"line":102,"address":[],"length":0,"stats":{"Line":0}},{"line":106,"address":[],"length":0,"stats":{"Line":0}},{"line":107,"address":[],"length":0,"stats":{"Line":0}},{"line":108,"address":[],"length":0,"stats":{"Line":0}},{"line":109,"address":[],"length":0,"stats":{"Line":0}},{"line":110,"address":[],"length":0,"stats":{"Line":0}},{"line":114,"address":[],"length":0,"stats":{"Line":0}},{"line":115,"address":[],"length":0,"stats":{"Line":0}},{"line":116,"address":[],"length":0,"stats":{"Line":0}},{"line":117,"address":[],"length":0,"stats":{"Line":0}},{"line":118,"address":[],"length":0,"stats":{"Line":0}},{"line":122,"address":[],"length":0,"stats":{"Line":0}},{"line":123,"address":[],"length":0,"stats":{"Line":0}},{"line":124,"address":[],"length":0,"stats":{"Line":0}},{"line":125,"address":[],"length":0,"stats":{"Line":0}},{"line":126,"address":[],"length":0,"stats":{"Line":0}},{"line":130,"address":[],"length":0,"stats":{"Line":0}},{"line":131,"address":[],"length":0,"stats":{"Line":0}},{"line":132,"address":[],"length":0,"stats":{"Line":0}},{"line":133,"address":[],"length":0,"stats":{"Line":0}},{"line":134,"address":[],"length":0,"stats":{"Line":0}},{"line":138,"address":[],"length":0,"stats":{"Line":0}},{"line":139,"address":[],"length":0,"stats":{"Line":0}},{"line":140,"address":[],"length":0,"stats":{"Line":0}},{"line":141,"address":[],"length":0,"stats":{"Line":0}},{"line":142,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":77},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","ui","src","window","layout.rs"],"content":"use super::{WindowComponents, layout_v2};\nuse crate::app::AppState;\nuse crate::menu::build_menu_bar;\nuse crate::toolbar::build_toolbar;\nuse gtk4::{prelude::*, Application, ApplicationWindow, Box as GtkBox, BuilderListItemFactory, ListView, NoSelection, Orientation};\n\npub fn build_widgets(app: \u0026Application, app_state: AppState) -\u003e WindowComponents {\n    let window = ApplicationWindow::builder()\n        .application(app)\n        .title(\"Testruct Studio\")\n        .default_width(1600)\n        .default_height(900)\n        .build();\n\n    // Root container (vertical)\n    let root = GtkBox::new(Orientation::Vertical, 0);\n\n    // Menu bar\n    let menu_bar = build_menu_bar();\n    root.append(\u0026menu_bar);\n\n    // Toolbars\n    let toolbar_widgets = build_toolbar();\n    root.append(\u0026toolbar_widgets.primary_toolbar);\n    root.append(\u0026toolbar_widgets.secondary_toolbar);\n\n    // Build main layout using layout_v2\n    let (main_content, canvas_view, tool_palette_buttons, tool_palette, properties_panel, property_components) = layout_v2::build_layout(app_state.clone(), toolbar_widgets.clone());\n    root.append(\u0026main_content);\n\n    window.set_child(Some(\u0026root));\n\n    // Create a dummy layer panel (ListView) - placeholder for future implementation\n    let layer_panel: ListView = ListView::new(None::\u003cNoSelection\u003e, None::\u003cBuilderListItemFactory\u003e);\n\n    WindowComponents::new(\n        window,\n        canvas_view,\n        layer_panel,\n        properties_panel.clone(),\n        menu_bar,\n        toolbar_widgets,\n        tool_palette_buttons,\n        tool_palette,\n        properties_panel,\n        property_components,\n    )\n}\n","traces":[{"line":7,"address":[],"length":0,"stats":{"Line":0}},{"line":8,"address":[],"length":0,"stats":{"Line":0}},{"line":9,"address":[],"length":0,"stats":{"Line":0}},{"line":16,"address":[],"length":0,"stats":{"Line":0}},{"line":19,"address":[],"length":0,"stats":{"Line":0}},{"line":20,"address":[],"length":0,"stats":{"Line":0}},{"line":23,"address":[],"length":0,"stats":{"Line":0}},{"line":24,"address":[],"length":0,"stats":{"Line":0}},{"line":25,"address":[],"length":0,"stats":{"Line":0}},{"line":28,"address":[],"length":0,"stats":{"Line":0}},{"line":29,"address":[],"length":0,"stats":{"Line":0}},{"line":31,"address":[],"length":0,"stats":{"Line":0}},{"line":34,"address":[],"length":0,"stats":{"Line":0}},{"line":37,"address":[],"length":0,"stats":{"Line":0}},{"line":38,"address":[],"length":0,"stats":{"Line":0}},{"line":39,"address":[],"length":0,"stats":{"Line":0}},{"line":40,"address":[],"length":0,"stats":{"Line":0}},{"line":41,"address":[],"length":0,"stats":{"Line":0}},{"line":42,"address":[],"length":0,"stats":{"Line":0}},{"line":43,"address":[],"length":0,"stats":{"Line":0}},{"line":44,"address":[],"length":0,"stats":{"Line":0}},{"line":45,"address":[],"length":0,"stats":{"Line":0}},{"line":46,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":23},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","ui","src","window","layout_v2.rs"],"content":"//! Complete window layout matching the original design\n//!\n//! Implements the 3-pane layout with:\n//! - Left: Tool Palette (fixed width)\n//! - Center: Canvas with overlay panels and page navigation\n//! - Right: Properties Panel (fixed width)\n//! - Bottom: Status Bar\n\nuse gtk4::prelude::*;\nuse gtk4::{\n    Align, Box as GtkBox, Button, Label, Orientation, Popover, Separator, Notebook,\n};\nuse crate::app::AppState;\nuse crate::canvas::CanvasView;\nuse crate::toolbar::ToolbarWidgets;\n\n/// Tool palette button references\n#[derive(Clone)]\npub struct ToolPaletteButtons {\n    pub select_btn: Button,\n    pub text_btn: Button,\n    pub image_btn: Button,\n    pub rect_btn: Button,\n    pub circle_btn: Button,\n    pub line_btn: Button,\n    pub arrow_btn: Button,\n}\n\n/// Build the complete window layout (content only - menubar and toolbars are added separately)\npub fn build_layout(\n    app_state: AppState,\n    _toolbar: ToolbarWidgets,\n) -\u003e (GtkBox, CanvasView, ToolPaletteButtons, GtkBox, GtkBox, crate::panels::PropertyPanelComponents) {\n    let main_container = GtkBox::new(Orientation::Vertical, 0);\n\n    // Note: Menubar and toolbars are added in layout.rs\n    // We only build the content pane here to avoid duplication\n\n    // 3. Main horizontal layout: Tool Palette | Canvas | Properties\n    let panes_box = GtkBox::new(Orientation::Horizontal, 0);\n    panes_box.set_vexpand(true);\n    panes_box.set_hexpand(true);\n\n    // LEFT: Tool Palette\n    let (tool_palette, tool_buttons) = build_tool_palette();\n    panes_box.append(\u0026tool_palette);\n\n    // CENTER: Canvas with overlays\n    let canvas_view = CanvasView::new(app_state.clone());\n    let (canvas_section, _page_nav_bar) = build_canvas_section(\u0026canvas_view);\n    panes_box.append(\u0026canvas_section);\n\n    // RIGHT: Properties Panel with Item Library\n    let (properties_panel, property_components) = build_properties_panel(\u0026app_state);\n    panes_box.append(\u0026properties_panel);\n\n    main_container.append(\u0026panes_box);\n\n    // 4. Status Bar\n    let status_bar = build_status_bar();\n    main_container.append(\u0026status_bar);\n\n    (main_container, canvas_view, tool_buttons, tool_palette, properties_panel, property_components)\n}\n\n/// Build the left tool palette\nfn build_tool_palette() -\u003e (GtkBox, ToolPaletteButtons) {\n    let palette = GtkBox::new(Orientation::Vertical, 6);\n    palette.add_css_class(\"tool-palette\");\n    palette.set_width_request(180);  // Fixed width for tool palette\n    palette.set_margin_start(12);\n    palette.set_margin_end(12);\n    palette.set_margin_top(16);\n    palette.set_margin_bottom(16);\n\n    // Tools section\n    let tools_heading = Label::new(Some(\"\"));\n    tools_heading.add_css_class(\"section-heading\");\n    tools_heading.set_halign(Align::Start);\n    palette.append(\u0026tools_heading);\n\n    let select_btn = Button::with_label(\"\");\n    select_btn.add_css_class(\"flat\");\n    select_btn.set_halign(Align::Fill);\n    select_btn.set_tooltip_text(Some(\" (V)\"));\n    palette.append(\u0026select_btn);\n\n    let text_btn = Button::with_label(\"\");\n    text_btn.add_css_class(\"flat\");\n    text_btn.set_halign(Align::Fill);\n    text_btn.set_tooltip_text(Some(\" (T)\"));\n    palette.append(\u0026text_btn);\n\n    let image_btn = Button::with_label(\"\");\n    image_btn.add_css_class(\"flat\");\n    image_btn.set_halign(Align::Fill);\n    image_btn.set_tooltip_text(Some(\" (I)\"));\n    palette.append(\u0026image_btn);\n\n    palette.append(\u0026Separator::new(Orientation::Horizontal));\n\n    // Shapes section\n    let shapes_heading = Label::new(Some(\"\"));\n    shapes_heading.add_css_class(\"section-heading\");\n    shapes_heading.set_halign(Align::Start);\n    palette.append(\u0026shapes_heading);\n\n    let rect_btn = Button::with_label(\"\");\n    rect_btn.add_css_class(\"flat\");\n    rect_btn.set_halign(Align::Fill);\n    palette.append(\u0026rect_btn);\n\n    let circle_btn = Button::with_label(\"\");\n    circle_btn.add_css_class(\"flat\");\n    circle_btn.set_halign(Align::Fill);\n    palette.append(\u0026circle_btn);\n\n    let line_btn = Button::with_label(\"\");\n    line_btn.add_css_class(\"flat\");\n    line_btn.set_halign(Align::Fill);\n    palette.append(\u0026line_btn);\n\n    let arrow_btn = Button::with_label(\"\");\n    arrow_btn.add_css_class(\"flat\");\n    arrow_btn.set_halign(Align::Fill);\n    palette.append(\u0026arrow_btn);\n\n    let tool_buttons = ToolPaletteButtons {\n        select_btn,\n        text_btn,\n        image_btn,\n        rect_btn,\n        circle_btn,\n        line_btn,\n        arrow_btn,\n    };\n\n    (palette, tool_buttons)\n}\n\n/// Build the center canvas section with page navigation\nfn build_canvas_section(canvas_view: \u0026CanvasView) -\u003e (GtkBox, GtkBox) {\n    let canvas_frame = GtkBox::new(Orientation::Vertical, 0);\n    canvas_frame.add_css_class(\"canvas-container\");\n    canvas_frame.set_hexpand(true);\n    canvas_frame.set_vexpand(true);\n    canvas_frame.set_margin_start(16);\n    canvas_frame.set_margin_end(16);\n\n    // Canvas scroll area\n    let canvas_container = canvas_view.container();\n    canvas_frame.append(\u0026canvas_container);\n\n    // Page navigation bar\n    let page_nav_bar = build_page_nav_bar();\n    canvas_frame.append(\u0026page_nav_bar);\n\n    (canvas_frame, page_nav_bar)\n}\n\n/// Build the page navigation bar\nfn build_page_nav_bar() -\u003e GtkBox {\n    let nav_bar = GtkBox::new(Orientation::Horizontal, 8);\n    nav_bar.add_css_class(\"page-nav-bar\");\n    nav_bar.set_margin_start(12);\n    nav_bar.set_margin_end(12);\n    nav_bar.set_margin_top(6);\n    nav_bar.set_margin_bottom(6);\n    nav_bar.set_hexpand(true);\n\n    // Navigation buttons\n    let nav_buttons = GtkBox::new(Orientation::Horizontal, 0);\n    nav_buttons.add_css_class(\"linked\");\n\n    let prev_btn = Button::with_label(\"\");\n    prev_btn.add_css_class(\"flat\");\n    prev_btn.set_tooltip_text(Some(\" (PageUp)\"));\n    nav_buttons.append(\u0026prev_btn);\n\n    let next_btn = Button::with_label(\"\");\n    next_btn.add_css_class(\"flat\");\n    next_btn.set_tooltip_text(Some(\" (PageDown)\"));\n    nav_buttons.append(\u0026next_btn);\n\n    nav_bar.append(\u0026nav_buttons);\n\n    // Page list popover\n    let page_list_popover = Popover::new();\n    let page_list_btn = Button::with_label(\"\");\n    page_list_btn.add_css_class(\"flat\");\n    page_list_btn.set_tooltip_text(Some(\"\"));\n    page_list_popover.set_parent(\u0026page_list_btn);\n    nav_bar.append(\u0026page_list_btn);\n\n    // Page count label\n    let page_label = Label::new(Some(\" 1 / 1\"));\n    page_label.add_css_class(\"dim-label\");\n    page_label.set_hexpand(true);\n    page_label.set_halign(Align::Center);\n    nav_bar.append(\u0026page_label);\n\n    // Page actions\n    let action_buttons = GtkBox::new(Orientation::Horizontal, 2);\n    action_buttons.add_css_class(\"linked\");\n\n    let add_btn = Button::with_label(\"\");\n    add_btn.add_css_class(\"flat\");\n    add_btn.set_tooltip_text(Some(\" (Ctrl+Shift+N)\"));\n    action_buttons.append(\u0026add_btn);\n\n    let duplicate_btn = Button::with_label(\"\");\n    duplicate_btn.add_css_class(\"flat\");\n    duplicate_btn.set_tooltip_text(Some(\"\"));\n    action_buttons.append(\u0026duplicate_btn);\n\n    let move_up_btn = Button::with_label(\"\");\n    move_up_btn.add_css_class(\"flat\");\n    move_up_btn.set_tooltip_text(Some(\"\"));\n    action_buttons.append(\u0026move_up_btn);\n\n    let move_down_btn = Button::with_label(\"\");\n    move_down_btn.add_css_class(\"flat\");\n    move_down_btn.set_tooltip_text(Some(\"\"));\n    action_buttons.append(\u0026move_down_btn);\n\n    let delete_btn = Button::with_label(\"\");\n    delete_btn.add_css_class(\"flat\");\n    delete_btn.set_tooltip_text(Some(\"\"));\n    action_buttons.append(\u0026delete_btn);\n\n    nav_bar.append(\u0026action_buttons);\n\n    nav_bar\n}\n\n/// Build the right properties panel with tabbed interface\nfn build_properties_panel(app_state: \u0026AppState) -\u003e (GtkBox, crate::panels::PropertyPanelComponents) {\n    let properties = GtkBox::new(Orientation::Vertical, 0);\n    properties.add_css_class(\"properties-panel\");\n    properties.set_width_request(240);  // Fixed width\n    properties.set_hexpand(false);\n    properties.set_vexpand(true);\n\n    // Create notebook for tabs\n    let notebook = Notebook::new();\n    notebook.set_vexpand(true);\n    notebook.set_hexpand(true);\n    properties.append(\u0026notebook);\n\n    // Tab 1: Properties\n    let (props_content, property_components) = crate::panels::build_property_panel_with_components();\n    let props_label = Label::new(Some(\"\"));\n    notebook.append_page(\u0026props_content, Some(\u0026props_label));\n\n    // Tab 2: Item Library\n    let item_bank = app_state.item_bank();\n    let item_lib_components = crate::panels::build_item_library_panel(item_bank);\n    let item_lib_label = Label::new(Some(\"\"));\n    notebook.append_page(\u0026item_lib_components.container, Some(\u0026item_lib_label));\n\n    (properties, property_components)\n}\n\n/// Build the status bar\nfn build_status_bar() -\u003e GtkBox {\n    let status_bar = GtkBox::new(Orientation::Horizontal, 12);\n    status_bar.add_css_class(\"status-bar\");\n    status_bar.set_margin_start(8);\n    status_bar.set_margin_end(8);\n    status_bar.set_margin_top(4);\n    status_bar.set_margin_bottom(4);\n\n    let status_label = Label::new(Some(\"\"));\n    status_label.set_halign(Align::Start);\n    status_bar.append(\u0026status_label);\n\n    let spacer = GtkBox::new(Orientation::Horizontal, 0);\n    spacer.set_hexpand(true);\n    status_bar.append(\u0026spacer);\n\n    let page_label = Label::new(Some(\" 1 / 1\"));\n    page_label.add_css_class(\"dim-label\");\n    status_bar.append(\u0026page_label);\n\n    status_bar.append(\u0026Separator::new(Orientation::Vertical));\n\n    let objects_label = Label::new(Some(\" 0\"));\n    objects_label.add_css_class(\"dim-label\");\n    status_bar.append(\u0026objects_label);\n\n    status_bar\n}\n","traces":[{"line":30,"address":[],"length":0,"stats":{"Line":0}},{"line":34,"address":[],"length":0,"stats":{"Line":0}},{"line":40,"address":[],"length":0,"stats":{"Line":0}},{"line":41,"address":[],"length":0,"stats":{"Line":0}},{"line":42,"address":[],"length":0,"stats":{"Line":0}},{"line":45,"address":[],"length":0,"stats":{"Line":0}},{"line":46,"address":[],"length":0,"stats":{"Line":0}},{"line":49,"address":[],"length":0,"stats":{"Line":0}},{"line":50,"address":[],"length":0,"stats":{"Line":0}},{"line":51,"address":[],"length":0,"stats":{"Line":0}},{"line":54,"address":[],"length":0,"stats":{"Line":0}},{"line":55,"address":[],"length":0,"stats":{"Line":0}},{"line":57,"address":[],"length":0,"stats":{"Line":0}},{"line":60,"address":[],"length":0,"stats":{"Line":0}},{"line":61,"address":[],"length":0,"stats":{"Line":0}},{"line":63,"address":[],"length":0,"stats":{"Line":0}},{"line":67,"address":[],"length":0,"stats":{"Line":0}},{"line":68,"address":[],"length":0,"stats":{"Line":0}},{"line":69,"address":[],"length":0,"stats":{"Line":0}},{"line":70,"address":[],"length":0,"stats":{"Line":0}},{"line":71,"address":[],"length":0,"stats":{"Line":0}},{"line":72,"address":[],"length":0,"stats":{"Line":0}},{"line":73,"address":[],"length":0,"stats":{"Line":0}},{"line":74,"address":[],"length":0,"stats":{"Line":0}},{"line":77,"address":[],"length":0,"stats":{"Line":0}},{"line":78,"address":[],"length":0,"stats":{"Line":0}},{"line":79,"address":[],"length":0,"stats":{"Line":0}},{"line":80,"address":[],"length":0,"stats":{"Line":0}},{"line":82,"address":[],"length":0,"stats":{"Line":0}},{"line":83,"address":[],"length":0,"stats":{"Line":0}},{"line":84,"address":[],"length":0,"stats":{"Line":0}},{"line":85,"address":[],"length":0,"stats":{"Line":0}},{"line":86,"address":[],"length":0,"stats":{"Line":0}},{"line":88,"address":[],"length":0,"stats":{"Line":0}},{"line":89,"address":[],"length":0,"stats":{"Line":0}},{"line":90,"address":[],"length":0,"stats":{"Line":0}},{"line":91,"address":[],"length":0,"stats":{"Line":0}},{"line":92,"address":[],"length":0,"stats":{"Line":0}},{"line":94,"address":[],"length":0,"stats":{"Line":0}},{"line":95,"address":[],"length":0,"stats":{"Line":0}},{"line":96,"address":[],"length":0,"stats":{"Line":0}},{"line":97,"address":[],"length":0,"stats":{"Line":0}},{"line":98,"address":[],"length":0,"stats":{"Line":0}},{"line":100,"address":[],"length":0,"stats":{"Line":0}},{"line":103,"address":[],"length":0,"stats":{"Line":0}},{"line":104,"address":[],"length":0,"stats":{"Line":0}},{"line":105,"address":[],"length":0,"stats":{"Line":0}},{"line":106,"address":[],"length":0,"stats":{"Line":0}},{"line":108,"address":[],"length":0,"stats":{"Line":0}},{"line":109,"address":[],"length":0,"stats":{"Line":0}},{"line":110,"address":[],"length":0,"stats":{"Line":0}},{"line":111,"address":[],"length":0,"stats":{"Line":0}},{"line":113,"address":[],"length":0,"stats":{"Line":0}},{"line":114,"address":[],"length":0,"stats":{"Line":0}},{"line":115,"address":[],"length":0,"stats":{"Line":0}},{"line":116,"address":[],"length":0,"stats":{"Line":0}},{"line":118,"address":[],"length":0,"stats":{"Line":0}},{"line":119,"address":[],"length":0,"stats":{"Line":0}},{"line":120,"address":[],"length":0,"stats":{"Line":0}},{"line":121,"address":[],"length":0,"stats":{"Line":0}},{"line":123,"address":[],"length":0,"stats":{"Line":0}},{"line":124,"address":[],"length":0,"stats":{"Line":0}},{"line":125,"address":[],"length":0,"stats":{"Line":0}},{"line":126,"address":[],"length":0,"stats":{"Line":0}},{"line":138,"address":[],"length":0,"stats":{"Line":0}},{"line":142,"address":[],"length":0,"stats":{"Line":0}},{"line":143,"address":[],"length":0,"stats":{"Line":0}},{"line":144,"address":[],"length":0,"stats":{"Line":0}},{"line":145,"address":[],"length":0,"stats":{"Line":0}},{"line":146,"address":[],"length":0,"stats":{"Line":0}},{"line":147,"address":[],"length":0,"stats":{"Line":0}},{"line":148,"address":[],"length":0,"stats":{"Line":0}},{"line":151,"address":[],"length":0,"stats":{"Line":0}},{"line":152,"address":[],"length":0,"stats":{"Line":0}},{"line":155,"address":[],"length":0,"stats":{"Line":0}},{"line":156,"address":[],"length":0,"stats":{"Line":0}},{"line":158,"address":[],"length":0,"stats":{"Line":0}},{"line":162,"address":[],"length":0,"stats":{"Line":0}},{"line":163,"address":[],"length":0,"stats":{"Line":0}},{"line":164,"address":[],"length":0,"stats":{"Line":0}},{"line":165,"address":[],"length":0,"stats":{"Line":0}},{"line":166,"address":[],"length":0,"stats":{"Line":0}},{"line":167,"address":[],"length":0,"stats":{"Line":0}},{"line":168,"address":[],"length":0,"stats":{"Line":0}},{"line":169,"address":[],"length":0,"stats":{"Line":0}},{"line":172,"address":[],"length":0,"stats":{"Line":0}},{"line":173,"address":[],"length":0,"stats":{"Line":0}},{"line":175,"address":[],"length":0,"stats":{"Line":0}},{"line":176,"address":[],"length":0,"stats":{"Line":0}},{"line":177,"address":[],"length":0,"stats":{"Line":0}},{"line":178,"address":[],"length":0,"stats":{"Line":0}},{"line":180,"address":[],"length":0,"stats":{"Line":0}},{"line":181,"address":[],"length":0,"stats":{"Line":0}},{"line":182,"address":[],"length":0,"stats":{"Line":0}},{"line":183,"address":[],"length":0,"stats":{"Line":0}},{"line":185,"address":[],"length":0,"stats":{"Line":0}},{"line":188,"address":[],"length":0,"stats":{"Line":0}},{"line":189,"address":[],"length":0,"stats":{"Line":0}},{"line":190,"address":[],"length":0,"stats":{"Line":0}},{"line":191,"address":[],"length":0,"stats":{"Line":0}},{"line":192,"address":[],"length":0,"stats":{"Line":0}},{"line":193,"address":[],"length":0,"stats":{"Line":0}},{"line":196,"address":[],"length":0,"stats":{"Line":0}},{"line":197,"address":[],"length":0,"stats":{"Line":0}},{"line":198,"address":[],"length":0,"stats":{"Line":0}},{"line":199,"address":[],"length":0,"stats":{"Line":0}},{"line":200,"address":[],"length":0,"stats":{"Line":0}},{"line":203,"address":[],"length":0,"stats":{"Line":0}},{"line":204,"address":[],"length":0,"stats":{"Line":0}},{"line":206,"address":[],"length":0,"stats":{"Line":0}},{"line":207,"address":[],"length":0,"stats":{"Line":0}},{"line":208,"address":[],"length":0,"stats":{"Line":0}},{"line":209,"address":[],"length":0,"stats":{"Line":0}},{"line":211,"address":[],"length":0,"stats":{"Line":0}},{"line":212,"address":[],"length":0,"stats":{"Line":0}},{"line":213,"address":[],"length":0,"stats":{"Line":0}},{"line":214,"address":[],"length":0,"stats":{"Line":0}},{"line":216,"address":[],"length":0,"stats":{"Line":0}},{"line":217,"address":[],"length":0,"stats":{"Line":0}},{"line":218,"address":[],"length":0,"stats":{"Line":0}},{"line":219,"address":[],"length":0,"stats":{"Line":0}},{"line":221,"address":[],"length":0,"stats":{"Line":0}},{"line":222,"address":[],"length":0,"stats":{"Line":0}},{"line":223,"address":[],"length":0,"stats":{"Line":0}},{"line":224,"address":[],"length":0,"stats":{"Line":0}},{"line":226,"address":[],"length":0,"stats":{"Line":0}},{"line":227,"address":[],"length":0,"stats":{"Line":0}},{"line":228,"address":[],"length":0,"stats":{"Line":0}},{"line":229,"address":[],"length":0,"stats":{"Line":0}},{"line":231,"address":[],"length":0,"stats":{"Line":0}},{"line":233,"address":[],"length":0,"stats":{"Line":0}},{"line":237,"address":[],"length":0,"stats":{"Line":0}},{"line":238,"address":[],"length":0,"stats":{"Line":0}},{"line":239,"address":[],"length":0,"stats":{"Line":0}},{"line":240,"address":[],"length":0,"stats":{"Line":0}},{"line":241,"address":[],"length":0,"stats":{"Line":0}},{"line":242,"address":[],"length":0,"stats":{"Line":0}},{"line":245,"address":[],"length":0,"stats":{"Line":0}},{"line":246,"address":[],"length":0,"stats":{"Line":0}},{"line":247,"address":[],"length":0,"stats":{"Line":0}},{"line":248,"address":[],"length":0,"stats":{"Line":0}},{"line":251,"address":[],"length":0,"stats":{"Line":0}},{"line":252,"address":[],"length":0,"stats":{"Line":0}},{"line":253,"address":[],"length":0,"stats":{"Line":0}},{"line":256,"address":[],"length":0,"stats":{"Line":0}},{"line":257,"address":[],"length":0,"stats":{"Line":0}},{"line":258,"address":[],"length":0,"stats":{"Line":0}},{"line":259,"address":[],"length":0,"stats":{"Line":0}},{"line":261,"address":[],"length":0,"stats":{"Line":0}},{"line":265,"address":[],"length":0,"stats":{"Line":0}},{"line":266,"address":[],"length":0,"stats":{"Line":0}},{"line":267,"address":[],"length":0,"stats":{"Line":0}},{"line":268,"address":[],"length":0,"stats":{"Line":0}},{"line":269,"address":[],"length":0,"stats":{"Line":0}},{"line":270,"address":[],"length":0,"stats":{"Line":0}},{"line":271,"address":[],"length":0,"stats":{"Line":0}},{"line":273,"address":[],"length":0,"stats":{"Line":0}},{"line":274,"address":[],"length":0,"stats":{"Line":0}},{"line":275,"address":[],"length":0,"stats":{"Line":0}},{"line":277,"address":[],"length":0,"stats":{"Line":0}},{"line":278,"address":[],"length":0,"stats":{"Line":0}},{"line":279,"address":[],"length":0,"stats":{"Line":0}},{"line":281,"address":[],"length":0,"stats":{"Line":0}},{"line":282,"address":[],"length":0,"stats":{"Line":0}},{"line":283,"address":[],"length":0,"stats":{"Line":0}},{"line":285,"address":[],"length":0,"stats":{"Line":0}},{"line":287,"address":[],"length":0,"stats":{"Line":0}},{"line":288,"address":[],"length":0,"stats":{"Line":0}},{"line":289,"address":[],"length":0,"stats":{"Line":0}},{"line":291,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":170},{"path":["/","Users","ken","Desktop","testruct-desktop-Rust","crates","ui","src","window","mod.rs"],"content":"mod bindings;\nmod layout;\nmod layout_v2;\nmod actions;\n\nuse crate::app::AppState;\nuse crate::canvas::CanvasView;\nuse crate::toolbar::ToolbarWidgets;\nuse crate::window::layout_v2::ToolPaletteButtons;\nuse gtk4::{Application, ApplicationWindow};\n\npub struct MainWindow {\n    pub window: ApplicationWindow,\n}\n\nimpl MainWindow {\n    pub fn build(app: \u0026Application, state: AppState) -\u003e ApplicationWindow {\n        let components = layout::build_widgets(app, state.clone());\n        actions::register_window_actions(\u0026components.window, state.clone(), \u0026components.canvas_view, \u0026components.tool_palette, \u0026components.properties_panel, \u0026components.property_components);\n        crate::panels::wire_property_signals(\u0026components.property_components, state.clone(), \u0026components.canvas_view);\n        bindings::bind_events(\u0026components, state);\n        components.window\n    }\n}\n\npub struct WindowComponents {\n    pub window: ApplicationWindow,\n    pub canvas_view: CanvasView,\n    pub layer_panel: gtk4::ListView,\n    pub property_panel: gtk4::Box,\n    pub menu_bar: gtk4::PopoverMenuBar,\n    pub toolbar: ToolbarWidgets,\n    pub tool_palette_buttons: ToolPaletteButtons,\n    pub tool_palette: gtk4::Box,\n    pub properties_panel: gtk4::Box,\n    pub property_components: crate::panels::PropertyPanelComponents,\n}\n\nimpl WindowComponents {\n    fn new(\n        window: ApplicationWindow,\n        canvas_view: CanvasView,\n        layer_panel: gtk4::ListView,\n        property_panel: gtk4::Box,\n        menu_bar: gtk4::PopoverMenuBar,\n        toolbar: ToolbarWidgets,\n        tool_palette_buttons: ToolPaletteButtons,\n        tool_palette: gtk4::Box,\n        properties_panel: gtk4::Box,\n        property_components: crate::panels::PropertyPanelComponents,\n    ) -\u003e Self {\n        Self {\n            window,\n            canvas_view,\n            layer_panel,\n            property_panel,\n            menu_bar,\n            toolbar,\n            tool_palette_buttons,\n            tool_palette,\n            properties_panel,\n            property_components,\n        }\n    }\n}\n","traces":[{"line":17,"address":[],"length":0,"stats":{"Line":0}},{"line":18,"address":[],"length":0,"stats":{"Line":0}},{"line":19,"address":[],"length":0,"stats":{"Line":0}},{"line":20,"address":[],"length":0,"stats":{"Line":0}},{"line":21,"address":[],"length":0,"stats":{"Line":0}},{"line":22,"address":[],"length":0,"stats":{"Line":0}},{"line":40,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":7}]};
        var previousData = null;
    </script>
    <script crossorigin>/** @license React v16.13.1
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
'use strict';(function(d,r){"object"===typeof exports&&"undefined"!==typeof module?r(exports):"function"===typeof define&&define.amd?define(["exports"],r):(d=d||self,r(d.React={}))})(this,function(d){function r(a){for(var b="https://reactjs.org/docs/error-decoder.html?invariant="+a,c=1;c<arguments.length;c++)b+="&args[]="+encodeURIComponent(arguments[c]);return"Minified React error #"+a+"; visit "+b+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}
function w(a,b,c){this.props=a;this.context=b;this.refs=ba;this.updater=c||ca}function da(){}function L(a,b,c){this.props=a;this.context=b;this.refs=ba;this.updater=c||ca}function ea(a,b,c){var g,e={},fa=null,d=null;if(null!=b)for(g in void 0!==b.ref&&(d=b.ref),void 0!==b.key&&(fa=""+b.key),b)ha.call(b,g)&&!ia.hasOwnProperty(g)&&(e[g]=b[g]);var h=arguments.length-2;if(1===h)e.children=c;else if(1<h){for(var k=Array(h),f=0;f<h;f++)k[f]=arguments[f+2];e.children=k}if(a&&a.defaultProps)for(g in h=a.defaultProps,
h)void 0===e[g]&&(e[g]=h[g]);return{$$typeof:x,type:a,key:fa,ref:d,props:e,_owner:M.current}}function va(a,b){return{$$typeof:x,type:a.type,key:b,ref:a.ref,props:a.props,_owner:a._owner}}function N(a){return"object"===typeof a&&null!==a&&a.$$typeof===x}function wa(a){var b={"=":"=0",":":"=2"};return"$"+(""+a).replace(/[=:]/g,function(a){return b[a]})}function ja(a,b,c,g){if(C.length){var e=C.pop();e.result=a;e.keyPrefix=b;e.func=c;e.context=g;e.count=0;return e}return{result:a,keyPrefix:b,func:c,
context:g,count:0}}function ka(a){a.result=null;a.keyPrefix=null;a.func=null;a.context=null;a.count=0;10>C.length&&C.push(a)}function O(a,b,c,g){var e=typeof a;if("undefined"===e||"boolean"===e)a=null;var d=!1;if(null===a)d=!0;else switch(e){case "string":case "number":d=!0;break;case "object":switch(a.$$typeof){case x:case xa:d=!0}}if(d)return c(g,a,""===b?"."+P(a,0):b),1;d=0;b=""===b?".":b+":";if(Array.isArray(a))for(var f=0;f<a.length;f++){e=a[f];var h=b+P(e,f);d+=O(e,h,c,g)}else if(null===a||
"object"!==typeof a?h=null:(h=la&&a[la]||a["@@iterator"],h="function"===typeof h?h:null),"function"===typeof h)for(a=h.call(a),f=0;!(e=a.next()).done;)e=e.value,h=b+P(e,f++),d+=O(e,h,c,g);else if("object"===e)throw c=""+a,Error(r(31,"[object Object]"===c?"object with keys {"+Object.keys(a).join(", ")+"}":c,""));return d}function Q(a,b,c){return null==a?0:O(a,"",b,c)}function P(a,b){return"object"===typeof a&&null!==a&&null!=a.key?wa(a.key):b.toString(36)}function ya(a,b,c){a.func.call(a.context,b,
a.count++)}function za(a,b,c){var g=a.result,e=a.keyPrefix;a=a.func.call(a.context,b,a.count++);Array.isArray(a)?R(a,g,c,function(a){return a}):null!=a&&(N(a)&&(a=va(a,e+(!a.key||b&&b.key===a.key?"":(""+a.key).replace(ma,"$&/")+"/")+c)),g.push(a))}function R(a,b,c,g,e){var d="";null!=c&&(d=(""+c).replace(ma,"$&/")+"/");b=ja(b,d,g,e);Q(a,za,b);ka(b)}function t(){var a=na.current;if(null===a)throw Error(r(321));return a}function S(a,b){var c=a.length;a.push(b);a:for(;;){var g=c-1>>>1,e=a[g];if(void 0!==
e&&0<D(e,b))a[g]=b,a[c]=e,c=g;else break a}}function n(a){a=a[0];return void 0===a?null:a}function E(a){var b=a[0];if(void 0!==b){var c=a.pop();if(c!==b){a[0]=c;a:for(var g=0,e=a.length;g<e;){var d=2*(g+1)-1,f=a[d],h=d+1,k=a[h];if(void 0!==f&&0>D(f,c))void 0!==k&&0>D(k,f)?(a[g]=k,a[h]=c,g=h):(a[g]=f,a[d]=c,g=d);else if(void 0!==k&&0>D(k,c))a[g]=k,a[h]=c,g=h;else break a}}return b}return null}function D(a,b){var c=a.sortIndex-b.sortIndex;return 0!==c?c:a.id-b.id}function F(a){for(var b=n(u);null!==
b;){if(null===b.callback)E(u);else if(b.startTime<=a)E(u),b.sortIndex=b.expirationTime,S(p,b);else break;b=n(u)}}function T(a){y=!1;F(a);if(!v)if(null!==n(p))v=!0,z(U);else{var b=n(u);null!==b&&G(T,b.startTime-a)}}function U(a,b){v=!1;y&&(y=!1,V());H=!0;var c=m;try{F(b);for(l=n(p);null!==l&&(!(l.expirationTime>b)||a&&!W());){var g=l.callback;if(null!==g){l.callback=null;m=l.priorityLevel;var e=g(l.expirationTime<=b);b=q();"function"===typeof e?l.callback=e:l===n(p)&&E(p);F(b)}else E(p);l=n(p)}if(null!==
l)var d=!0;else{var f=n(u);null!==f&&G(T,f.startTime-b);d=!1}return d}finally{l=null,m=c,H=!1}}function oa(a){switch(a){case 1:return-1;case 2:return 250;case 5:return 1073741823;case 4:return 1E4;default:return 5E3}}var f="function"===typeof Symbol&&Symbol.for,x=f?Symbol.for("react.element"):60103,xa=f?Symbol.for("react.portal"):60106,Aa=f?Symbol.for("react.fragment"):60107,Ba=f?Symbol.for("react.strict_mode"):60108,Ca=f?Symbol.for("react.profiler"):60114,Da=f?Symbol.for("react.provider"):60109,
Ea=f?Symbol.for("react.context"):60110,Fa=f?Symbol.for("react.forward_ref"):60112,Ga=f?Symbol.for("react.suspense"):60113,Ha=f?Symbol.for("react.memo"):60115,Ia=f?Symbol.for("react.lazy"):60116,la="function"===typeof Symbol&&Symbol.iterator,pa=Object.getOwnPropertySymbols,Ja=Object.prototype.hasOwnProperty,Ka=Object.prototype.propertyIsEnumerable,I=function(){try{if(!Object.assign)return!1;var a=new String("abc");a[5]="de";if("5"===Object.getOwnPropertyNames(a)[0])return!1;var b={};for(a=0;10>a;a++)b["_"+
String.fromCharCode(a)]=a;if("0123456789"!==Object.getOwnPropertyNames(b).map(function(a){return b[a]}).join(""))return!1;var c={};"abcdefghijklmnopqrst".split("").forEach(function(a){c[a]=a});return"abcdefghijklmnopqrst"!==Object.keys(Object.assign({},c)).join("")?!1:!0}catch(g){return!1}}()?Object.assign:function(a,b){if(null===a||void 0===a)throw new TypeError("Object.assign cannot be called with null or undefined");var c=Object(a);for(var g,e=1;e<arguments.length;e++){var d=Object(arguments[e]);
for(var f in d)Ja.call(d,f)&&(c[f]=d[f]);if(pa){g=pa(d);for(var h=0;h<g.length;h++)Ka.call(d,g[h])&&(c[g[h]]=d[g[h]])}}return c},ca={isMounted:function(a){return!1},enqueueForceUpdate:function(a,b,c){},enqueueReplaceState:function(a,b,c,d){},enqueueSetState:function(a,b,c,d){}},ba={};w.prototype.isReactComponent={};w.prototype.setState=function(a,b){if("object"!==typeof a&&"function"!==typeof a&&null!=a)throw Error(r(85));this.updater.enqueueSetState(this,a,b,"setState")};w.prototype.forceUpdate=
function(a){this.updater.enqueueForceUpdate(this,a,"forceUpdate")};da.prototype=w.prototype;f=L.prototype=new da;f.constructor=L;I(f,w.prototype);f.isPureReactComponent=!0;var M={current:null},ha=Object.prototype.hasOwnProperty,ia={key:!0,ref:!0,__self:!0,__source:!0},ma=/\/+/g,C=[],na={current:null},X;if("undefined"===typeof window||"function"!==typeof MessageChannel){var A=null,qa=null,ra=function(){if(null!==A)try{var a=q();A(!0,a);A=null}catch(b){throw setTimeout(ra,0),b;}},La=Date.now();var q=
function(){return Date.now()-La};var z=function(a){null!==A?setTimeout(z,0,a):(A=a,setTimeout(ra,0))};var G=function(a,b){qa=setTimeout(a,b)};var V=function(){clearTimeout(qa)};var W=function(){return!1};f=X=function(){}}else{var Y=window.performance,sa=window.Date,Ma=window.setTimeout,Na=window.clearTimeout;"undefined"!==typeof console&&(f=window.cancelAnimationFrame,"function"!==typeof window.requestAnimationFrame&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"),
"function"!==typeof f&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"));if("object"===typeof Y&&"function"===typeof Y.now)q=function(){return Y.now()};else{var Oa=sa.now();q=function(){return sa.now()-Oa}}var J=!1,K=null,Z=-1,ta=5,ua=0;W=function(){return q()>=ua};f=function(){};X=function(a){0>a||125<a?console.error("forceFrameRate takes a positive int between 0 and 125, forcing framerates higher than 125 fps is not unsupported"):
ta=0<a?Math.floor(1E3/a):5};var B=new MessageChannel,aa=B.port2;B.port1.onmessage=function(){if(null!==K){var a=q();ua=a+ta;try{K(!0,a)?aa.postMessage(null):(J=!1,K=null)}catch(b){throw aa.postMessage(null),b;}}else J=!1};z=function(a){K=a;J||(J=!0,aa.postMessage(null))};G=function(a,b){Z=Ma(function(){a(q())},b)};V=function(){Na(Z);Z=-1}}var p=[],u=[],Pa=1,l=null,m=3,H=!1,v=!1,y=!1,Qa=0;B={ReactCurrentDispatcher:na,ReactCurrentOwner:M,IsSomeRendererActing:{current:!1},assign:I};I(B,{Scheduler:{__proto__:null,
unstable_ImmediatePriority:1,unstable_UserBlockingPriority:2,unstable_NormalPriority:3,unstable_IdlePriority:5,unstable_LowPriority:4,unstable_runWithPriority:function(a,b){switch(a){case 1:case 2:case 3:case 4:case 5:break;default:a=3}var c=m;m=a;try{return b()}finally{m=c}},unstable_next:function(a){switch(m){case 1:case 2:case 3:var b=3;break;default:b=m}var c=m;m=b;try{return a()}finally{m=c}},unstable_scheduleCallback:function(a,b,c){var d=q();if("object"===typeof c&&null!==c){var e=c.delay;
e="number"===typeof e&&0<e?d+e:d;c="number"===typeof c.timeout?c.timeout:oa(a)}else c=oa(a),e=d;c=e+c;a={id:Pa++,callback:b,priorityLevel:a,startTime:e,expirationTime:c,sortIndex:-1};e>d?(a.sortIndex=e,S(u,a),null===n(p)&&a===n(u)&&(y?V():y=!0,G(T,e-d))):(a.sortIndex=c,S(p,a),v||H||(v=!0,z(U)));return a},unstable_cancelCallback:function(a){a.callback=null},unstable_wrapCallback:function(a){var b=m;return function(){var c=m;m=b;try{return a.apply(this,arguments)}finally{m=c}}},unstable_getCurrentPriorityLevel:function(){return m},
unstable_shouldYield:function(){var a=q();F(a);var b=n(p);return b!==l&&null!==l&&null!==b&&null!==b.callback&&b.startTime<=a&&b.expirationTime<l.expirationTime||W()},unstable_requestPaint:f,unstable_continueExecution:function(){v||H||(v=!0,z(U))},unstable_pauseExecution:function(){},unstable_getFirstCallbackNode:function(){return n(p)},get unstable_now(){return q},get unstable_forceFrameRate(){return X},unstable_Profiling:null},SchedulerTracing:{__proto__:null,__interactionsRef:null,__subscriberRef:null,
unstable_clear:function(a){return a()},unstable_getCurrent:function(){return null},unstable_getThreadID:function(){return++Qa},unstable_trace:function(a,b,c){return c()},unstable_wrap:function(a){return a},unstable_subscribe:function(a){},unstable_unsubscribe:function(a){}}});d.Children={map:function(a,b,c){if(null==a)return a;var d=[];R(a,d,null,b,c);return d},forEach:function(a,b,c){if(null==a)return a;b=ja(null,null,b,c);Q(a,ya,b);ka(b)},count:function(a){return Q(a,function(){return null},null)},
toArray:function(a){var b=[];R(a,b,null,function(a){return a});return b},only:function(a){if(!N(a))throw Error(r(143));return a}};d.Component=w;d.Fragment=Aa;d.Profiler=Ca;d.PureComponent=L;d.StrictMode=Ba;d.Suspense=Ga;d.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=B;d.cloneElement=function(a,b,c){if(null===a||void 0===a)throw Error(r(267,a));var d=I({},a.props),e=a.key,f=a.ref,m=a._owner;if(null!=b){void 0!==b.ref&&(f=b.ref,m=M.current);void 0!==b.key&&(e=""+b.key);if(a.type&&a.type.defaultProps)var h=
a.type.defaultProps;for(k in b)ha.call(b,k)&&!ia.hasOwnProperty(k)&&(d[k]=void 0===b[k]&&void 0!==h?h[k]:b[k])}var k=arguments.length-2;if(1===k)d.children=c;else if(1<k){h=Array(k);for(var l=0;l<k;l++)h[l]=arguments[l+2];d.children=h}return{$$typeof:x,type:a.type,key:e,ref:f,props:d,_owner:m}};d.createContext=function(a,b){void 0===b&&(b=null);a={$$typeof:Ea,_calculateChangedBits:b,_currentValue:a,_currentValue2:a,_threadCount:0,Provider:null,Consumer:null};a.Provider={$$typeof:Da,_context:a};return a.Consumer=
a};d.createElement=ea;d.createFactory=function(a){var b=ea.bind(null,a);b.type=a;return b};d.createRef=function(){return{current:null}};d.forwardRef=function(a){return{$$typeof:Fa,render:a}};d.isValidElement=N;d.lazy=function(a){return{$$typeof:Ia,_ctor:a,_status:-1,_result:null}};d.memo=function(a,b){return{$$typeof:Ha,type:a,compare:void 0===b?null:b}};d.useCallback=function(a,b){return t().useCallback(a,b)};d.useContext=function(a,b){return t().useContext(a,b)};d.useDebugValue=function(a,b){};
d.useEffect=function(a,b){return t().useEffect(a,b)};d.useImperativeHandle=function(a,b,c){return t().useImperativeHandle(a,b,c)};d.useLayoutEffect=function(a,b){return t().useLayoutEffect(a,b)};d.useMemo=function(a,b){return t().useMemo(a,b)};d.useReducer=function(a,b,c){return t().useReducer(a,b,c)};d.useRef=function(a){return t().useRef(a)};d.useState=function(a){return t().useState(a)};d.version="16.13.1"});
</script>
    <script crossorigin>/** @license React v16.13.1
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
/*
 Modernizr 3.0.0pre (Custom Build) | MIT
*/
'use strict';(function(I,ea){"object"===typeof exports&&"undefined"!==typeof module?ea(exports,require("react")):"function"===typeof define&&define.amd?define(["exports","react"],ea):(I=I||self,ea(I.ReactDOM={},I.React))})(this,function(I,ea){function k(a){for(var b="https://reactjs.org/docs/error-decoder.html?invariant="+a,c=1;c<arguments.length;c++)b+="&args[]="+encodeURIComponent(arguments[c]);return"Minified React error #"+a+"; visit "+b+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}
function ji(a,b,c,d,e,f,g,h,m){yb=!1;gc=null;ki.apply(li,arguments)}function mi(a,b,c,d,e,f,g,h,m){ji.apply(this,arguments);if(yb){if(yb){var n=gc;yb=!1;gc=null}else throw Error(k(198));hc||(hc=!0,pd=n)}}function lf(a,b,c){var d=a.type||"unknown-event";a.currentTarget=mf(c);mi(d,b,void 0,a);a.currentTarget=null}function nf(){if(ic)for(var a in cb){var b=cb[a],c=ic.indexOf(a);if(!(-1<c))throw Error(k(96,a));if(!jc[c]){if(!b.extractEvents)throw Error(k(97,a));jc[c]=b;c=b.eventTypes;for(var d in c){var e=
void 0;var f=c[d],g=b,h=d;if(qd.hasOwnProperty(h))throw Error(k(99,h));qd[h]=f;var m=f.phasedRegistrationNames;if(m){for(e in m)m.hasOwnProperty(e)&&of(m[e],g,h);e=!0}else f.registrationName?(of(f.registrationName,g,h),e=!0):e=!1;if(!e)throw Error(k(98,d,a));}}}}function of(a,b,c){if(db[a])throw Error(k(100,a));db[a]=b;rd[a]=b.eventTypes[c].dependencies}function pf(a){var b=!1,c;for(c in a)if(a.hasOwnProperty(c)){var d=a[c];if(!cb.hasOwnProperty(c)||cb[c]!==d){if(cb[c])throw Error(k(102,c));cb[c]=
d;b=!0}}b&&nf()}function qf(a){if(a=rf(a)){if("function"!==typeof sd)throw Error(k(280));var b=a.stateNode;b&&(b=td(b),sd(a.stateNode,a.type,b))}}function sf(a){eb?fb?fb.push(a):fb=[a]:eb=a}function tf(){if(eb){var a=eb,b=fb;fb=eb=null;qf(a);if(b)for(a=0;a<b.length;a++)qf(b[a])}}function ud(){if(null!==eb||null!==fb)vd(),tf()}function uf(a,b,c){if(wd)return a(b,c);wd=!0;try{return vf(a,b,c)}finally{wd=!1,ud()}}function ni(a){if(wf.call(xf,a))return!0;if(wf.call(yf,a))return!1;if(oi.test(a))return xf[a]=
!0;yf[a]=!0;return!1}function pi(a,b,c,d){if(null!==c&&0===c.type)return!1;switch(typeof b){case "function":case "symbol":return!0;case "boolean":if(d)return!1;if(null!==c)return!c.acceptsBooleans;a=a.toLowerCase().slice(0,5);return"data-"!==a&&"aria-"!==a;default:return!1}}function qi(a,b,c,d){if(null===b||"undefined"===typeof b||pi(a,b,c,d))return!0;if(d)return!1;if(null!==c)switch(c.type){case 3:return!b;case 4:return!1===b;case 5:return isNaN(b);case 6:return isNaN(b)||1>b}return!1}function L(a,
b,c,d,e,f){this.acceptsBooleans=2===b||3===b||4===b;this.attributeName=d;this.attributeNamespace=e;this.mustUseProperty=c;this.propertyName=a;this.type=b;this.sanitizeURL=f}function xd(a,b,c,d){var e=E.hasOwnProperty(b)?E[b]:null;var f=null!==e?0===e.type:d?!1:!(2<b.length)||"o"!==b[0]&&"O"!==b[0]||"n"!==b[1]&&"N"!==b[1]?!1:!0;f||(qi(b,c,e,d)&&(c=null),d||null===e?ni(b)&&(null===c?a.removeAttribute(b):a.setAttribute(b,""+c)):e.mustUseProperty?a[e.propertyName]=null===c?3===e.type?!1:"":c:(b=e.attributeName,
d=e.attributeNamespace,null===c?a.removeAttribute(b):(e=e.type,c=3===e||4===e&&!0===c?"":""+c,d?a.setAttributeNS(d,b,c):a.setAttribute(b,c))))}function zb(a){if(null===a||"object"!==typeof a)return null;a=zf&&a[zf]||a["@@iterator"];return"function"===typeof a?a:null}function ri(a){if(-1===a._status){a._status=0;var b=a._ctor;b=b();a._result=b;b.then(function(b){0===a._status&&(b=b.default,a._status=1,a._result=b)},function(b){0===a._status&&(a._status=2,a._result=b)})}}function na(a){if(null==a)return null;
if("function"===typeof a)return a.displayName||a.name||null;if("string"===typeof a)return a;switch(a){case Ma:return"Fragment";case gb:return"Portal";case kc:return"Profiler";case Af:return"StrictMode";case lc:return"Suspense";case yd:return"SuspenseList"}if("object"===typeof a)switch(a.$$typeof){case Bf:return"Context.Consumer";case Cf:return"Context.Provider";case zd:var b=a.render;b=b.displayName||b.name||"";return a.displayName||(""!==b?"ForwardRef("+b+")":"ForwardRef");case Ad:return na(a.type);
case Df:return na(a.render);case Ef:if(a=1===a._status?a._result:null)return na(a)}return null}function Bd(a){var b="";do{a:switch(a.tag){case 3:case 4:case 6:case 7:case 10:case 9:var c="";break a;default:var d=a._debugOwner,e=a._debugSource,f=na(a.type);c=null;d&&(c=na(d.type));d=f;f="";e?f=" (at "+e.fileName.replace(si,"")+":"+e.lineNumber+")":c&&(f=" (created by "+c+")");c="\n    in "+(d||"Unknown")+f}b+=c;a=a.return}while(a);return b}function va(a){switch(typeof a){case "boolean":case "number":case "object":case "string":case "undefined":return a;
default:return""}}function Ff(a){var b=a.type;return(a=a.nodeName)&&"input"===a.toLowerCase()&&("checkbox"===b||"radio"===b)}function ti(a){var b=Ff(a)?"checked":"value",c=Object.getOwnPropertyDescriptor(a.constructor.prototype,b),d=""+a[b];if(!a.hasOwnProperty(b)&&"undefined"!==typeof c&&"function"===typeof c.get&&"function"===typeof c.set){var e=c.get,f=c.set;Object.defineProperty(a,b,{configurable:!0,get:function(){return e.call(this)},set:function(a){d=""+a;f.call(this,a)}});Object.defineProperty(a,
b,{enumerable:c.enumerable});return{getValue:function(){return d},setValue:function(a){d=""+a},stopTracking:function(){a._valueTracker=null;delete a[b]}}}}function mc(a){a._valueTracker||(a._valueTracker=ti(a))}function Gf(a){if(!a)return!1;var b=a._valueTracker;if(!b)return!0;var c=b.getValue();var d="";a&&(d=Ff(a)?a.checked?"true":"false":a.value);a=d;return a!==c?(b.setValue(a),!0):!1}function Cd(a,b){var c=b.checked;return M({},b,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=
c?c:a._wrapperState.initialChecked})}function Hf(a,b){var c=null==b.defaultValue?"":b.defaultValue,d=null!=b.checked?b.checked:b.defaultChecked;c=va(null!=b.value?b.value:c);a._wrapperState={initialChecked:d,initialValue:c,controlled:"checkbox"===b.type||"radio"===b.type?null!=b.checked:null!=b.value}}function If(a,b){b=b.checked;null!=b&&xd(a,"checked",b,!1)}function Dd(a,b){If(a,b);var c=va(b.value),d=b.type;if(null!=c)if("number"===d){if(0===c&&""===a.value||a.value!=c)a.value=""+c}else a.value!==
""+c&&(a.value=""+c);else if("submit"===d||"reset"===d){a.removeAttribute("value");return}b.hasOwnProperty("value")?Ed(a,b.type,c):b.hasOwnProperty("defaultValue")&&Ed(a,b.type,va(b.defaultValue));null==b.checked&&null!=b.defaultChecked&&(a.defaultChecked=!!b.defaultChecked)}function Jf(a,b,c){if(b.hasOwnProperty("value")||b.hasOwnProperty("defaultValue")){var d=b.type;if(!("submit"!==d&&"reset"!==d||void 0!==b.value&&null!==b.value))return;b=""+a._wrapperState.initialValue;c||b===a.value||(a.value=
b);a.defaultValue=b}c=a.name;""!==c&&(a.name="");a.defaultChecked=!!a._wrapperState.initialChecked;""!==c&&(a.name=c)}function Ed(a,b,c){if("number"!==b||a.ownerDocument.activeElement!==a)null==c?a.defaultValue=""+a._wrapperState.initialValue:a.defaultValue!==""+c&&(a.defaultValue=""+c)}function ui(a){var b="";ea.Children.forEach(a,function(a){null!=a&&(b+=a)});return b}function Fd(a,b){a=M({children:void 0},b);if(b=ui(b.children))a.children=b;return a}function hb(a,b,c,d){a=a.options;if(b){b={};
for(var e=0;e<c.length;e++)b["$"+c[e]]=!0;for(c=0;c<a.length;c++)e=b.hasOwnProperty("$"+a[c].value),a[c].selected!==e&&(a[c].selected=e),e&&d&&(a[c].defaultSelected=!0)}else{c=""+va(c);b=null;for(e=0;e<a.length;e++){if(a[e].value===c){a[e].selected=!0;d&&(a[e].defaultSelected=!0);return}null!==b||a[e].disabled||(b=a[e])}null!==b&&(b.selected=!0)}}function Gd(a,b){if(null!=b.dangerouslySetInnerHTML)throw Error(k(91));return M({},b,{value:void 0,defaultValue:void 0,children:""+a._wrapperState.initialValue})}
function Kf(a,b){var c=b.value;if(null==c){c=b.children;b=b.defaultValue;if(null!=c){if(null!=b)throw Error(k(92));if(Array.isArray(c)){if(!(1>=c.length))throw Error(k(93));c=c[0]}b=c}null==b&&(b="");c=b}a._wrapperState={initialValue:va(c)}}function Lf(a,b){var c=va(b.value),d=va(b.defaultValue);null!=c&&(c=""+c,c!==a.value&&(a.value=c),null==b.defaultValue&&a.defaultValue!==c&&(a.defaultValue=c));null!=d&&(a.defaultValue=""+d)}function Mf(a,b){b=a.textContent;b===a._wrapperState.initialValue&&""!==
b&&null!==b&&(a.value=b)}function Nf(a){switch(a){case "svg":return"http://www.w3.org/2000/svg";case "math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Hd(a,b){return null==a||"http://www.w3.org/1999/xhtml"===a?Nf(b):"http://www.w3.org/2000/svg"===a&&"foreignObject"===b?"http://www.w3.org/1999/xhtml":a}function nc(a,b){var c={};c[a.toLowerCase()]=b.toLowerCase();c["Webkit"+a]="webkit"+b;c["Moz"+a]="moz"+b;return c}function oc(a){if(Id[a])return Id[a];
if(!ib[a])return a;var b=ib[a],c;for(c in b)if(b.hasOwnProperty(c)&&c in Of)return Id[a]=b[c];return a}function Jd(a){var b=Pf.get(a);void 0===b&&(b=new Map,Pf.set(a,b));return b}function Na(a){var b=a,c=a;if(a.alternate)for(;b.return;)b=b.return;else{a=b;do b=a,0!==(b.effectTag&1026)&&(c=b.return),a=b.return;while(a)}return 3===b.tag?c:null}function Qf(a){if(13===a.tag){var b=a.memoizedState;null===b&&(a=a.alternate,null!==a&&(b=a.memoizedState));if(null!==b)return b.dehydrated}return null}function Rf(a){if(Na(a)!==
a)throw Error(k(188));}function vi(a){var b=a.alternate;if(!b){b=Na(a);if(null===b)throw Error(k(188));return b!==a?null:a}for(var c=a,d=b;;){var e=c.return;if(null===e)break;var f=e.alternate;if(null===f){d=e.return;if(null!==d){c=d;continue}break}if(e.child===f.child){for(f=e.child;f;){if(f===c)return Rf(e),a;if(f===d)return Rf(e),b;f=f.sibling}throw Error(k(188));}if(c.return!==d.return)c=e,d=f;else{for(var g=!1,h=e.child;h;){if(h===c){g=!0;c=e;d=f;break}if(h===d){g=!0;d=e;c=f;break}h=h.sibling}if(!g){for(h=
f.child;h;){if(h===c){g=!0;c=f;d=e;break}if(h===d){g=!0;d=f;c=e;break}h=h.sibling}if(!g)throw Error(k(189));}}if(c.alternate!==d)throw Error(k(190));}if(3!==c.tag)throw Error(k(188));return c.stateNode.current===c?a:b}function Sf(a){a=vi(a);if(!a)return null;for(var b=a;;){if(5===b.tag||6===b.tag)return b;if(b.child)b.child.return=b,b=b.child;else{if(b===a)break;for(;!b.sibling;){if(!b.return||b.return===a)return null;b=b.return}b.sibling.return=b.return;b=b.sibling}}return null}function jb(a,b){if(null==
b)throw Error(k(30));if(null==a)return b;if(Array.isArray(a)){if(Array.isArray(b))return a.push.apply(a,b),a;a.push(b);return a}return Array.isArray(b)?[a].concat(b):[a,b]}function Kd(a,b,c){Array.isArray(a)?a.forEach(b,c):a&&b.call(c,a)}function pc(a){null!==a&&(Ab=jb(Ab,a));a=Ab;Ab=null;if(a){Kd(a,wi);if(Ab)throw Error(k(95));if(hc)throw a=pd,hc=!1,pd=null,a;}}function Ld(a){a=a.target||a.srcElement||window;a.correspondingUseElement&&(a=a.correspondingUseElement);return 3===a.nodeType?a.parentNode:
a}function Tf(a){if(!wa)return!1;a="on"+a;var b=a in document;b||(b=document.createElement("div"),b.setAttribute(a,"return;"),b="function"===typeof b[a]);return b}function Uf(a){a.topLevelType=null;a.nativeEvent=null;a.targetInst=null;a.ancestors.length=0;10>qc.length&&qc.push(a)}function Vf(a,b,c,d){if(qc.length){var e=qc.pop();e.topLevelType=a;e.eventSystemFlags=d;e.nativeEvent=b;e.targetInst=c;return e}return{topLevelType:a,eventSystemFlags:d,nativeEvent:b,targetInst:c,ancestors:[]}}function Wf(a){var b=
a.targetInst,c=b;do{if(!c){a.ancestors.push(c);break}var d=c;if(3===d.tag)d=d.stateNode.containerInfo;else{for(;d.return;)d=d.return;d=3!==d.tag?null:d.stateNode.containerInfo}if(!d)break;b=c.tag;5!==b&&6!==b||a.ancestors.push(c);c=Bb(d)}while(c);for(c=0;c<a.ancestors.length;c++){b=a.ancestors[c];var e=Ld(a.nativeEvent);d=a.topLevelType;var f=a.nativeEvent,g=a.eventSystemFlags;0===c&&(g|=64);for(var h=null,m=0;m<jc.length;m++){var n=jc[m];n&&(n=n.extractEvents(d,b,f,e,g))&&(h=jb(h,n))}pc(h)}}function Md(a,
b,c){if(!c.has(a)){switch(a){case "scroll":Cb(b,"scroll",!0);break;case "focus":case "blur":Cb(b,"focus",!0);Cb(b,"blur",!0);c.set("blur",null);c.set("focus",null);break;case "cancel":case "close":Tf(a)&&Cb(b,a,!0);break;case "invalid":case "submit":case "reset":break;default:-1===Db.indexOf(a)&&w(a,b)}c.set(a,null)}}function xi(a,b){var c=Jd(b);Nd.forEach(function(a){Md(a,b,c)});yi.forEach(function(a){Md(a,b,c)})}function Od(a,b,c,d,e){return{blockedOn:a,topLevelType:b,eventSystemFlags:c|32,nativeEvent:e,
container:d}}function Xf(a,b){switch(a){case "focus":case "blur":xa=null;break;case "dragenter":case "dragleave":ya=null;break;case "mouseover":case "mouseout":za=null;break;case "pointerover":case "pointerout":Eb.delete(b.pointerId);break;case "gotpointercapture":case "lostpointercapture":Fb.delete(b.pointerId)}}function Gb(a,b,c,d,e,f){if(null===a||a.nativeEvent!==f)return a=Od(b,c,d,e,f),null!==b&&(b=Hb(b),null!==b&&Yf(b)),a;a.eventSystemFlags|=d;return a}function zi(a,b,c,d,e){switch(b){case "focus":return xa=
Gb(xa,a,b,c,d,e),!0;case "dragenter":return ya=Gb(ya,a,b,c,d,e),!0;case "mouseover":return za=Gb(za,a,b,c,d,e),!0;case "pointerover":var f=e.pointerId;Eb.set(f,Gb(Eb.get(f)||null,a,b,c,d,e));return!0;case "gotpointercapture":return f=e.pointerId,Fb.set(f,Gb(Fb.get(f)||null,a,b,c,d,e)),!0}return!1}function Ai(a){var b=Bb(a.target);if(null!==b){var c=Na(b);if(null!==c)if(b=c.tag,13===b){if(b=Qf(c),null!==b){a.blockedOn=b;Pd(a.priority,function(){Bi(c)});return}}else if(3===b&&c.stateNode.hydrate){a.blockedOn=
3===c.tag?c.stateNode.containerInfo:null;return}}a.blockedOn=null}function rc(a){if(null!==a.blockedOn)return!1;var b=Qd(a.topLevelType,a.eventSystemFlags,a.container,a.nativeEvent);if(null!==b){var c=Hb(b);null!==c&&Yf(c);a.blockedOn=b;return!1}return!0}function Zf(a,b,c){rc(a)&&c.delete(b)}function Ci(){for(Rd=!1;0<fa.length;){var a=fa[0];if(null!==a.blockedOn){a=Hb(a.blockedOn);null!==a&&Di(a);break}var b=Qd(a.topLevelType,a.eventSystemFlags,a.container,a.nativeEvent);null!==b?a.blockedOn=b:fa.shift()}null!==
xa&&rc(xa)&&(xa=null);null!==ya&&rc(ya)&&(ya=null);null!==za&&rc(za)&&(za=null);Eb.forEach(Zf);Fb.forEach(Zf)}function Ib(a,b){a.blockedOn===b&&(a.blockedOn=null,Rd||(Rd=!0,$f(ag,Ci)))}function bg(a){if(0<fa.length){Ib(fa[0],a);for(var b=1;b<fa.length;b++){var c=fa[b];c.blockedOn===a&&(c.blockedOn=null)}}null!==xa&&Ib(xa,a);null!==ya&&Ib(ya,a);null!==za&&Ib(za,a);b=function(b){return Ib(b,a)};Eb.forEach(b);Fb.forEach(b);for(b=0;b<Jb.length;b++)c=Jb[b],c.blockedOn===a&&(c.blockedOn=null);for(;0<Jb.length&&
(b=Jb[0],null===b.blockedOn);)Ai(b),null===b.blockedOn&&Jb.shift()}function Sd(a,b){for(var c=0;c<a.length;c+=2){var d=a[c],e=a[c+1],f="on"+(e[0].toUpperCase()+e.slice(1));f={phasedRegistrationNames:{bubbled:f,captured:f+"Capture"},dependencies:[d],eventPriority:b};Td.set(d,b);cg.set(d,f);dg[e]=f}}function w(a,b){Cb(b,a,!1)}function Cb(a,b,c){var d=Td.get(b);switch(void 0===d?2:d){case 0:d=Ei.bind(null,b,1,a);break;case 1:d=Fi.bind(null,b,1,a);break;default:d=sc.bind(null,b,1,a)}c?a.addEventListener(b,
d,!0):a.addEventListener(b,d,!1)}function Ei(a,b,c,d){Oa||vd();var e=sc,f=Oa;Oa=!0;try{eg(e,a,b,c,d)}finally{(Oa=f)||ud()}}function Fi(a,b,c,d){Gi(Hi,sc.bind(null,a,b,c,d))}function sc(a,b,c,d){if(tc)if(0<fa.length&&-1<Nd.indexOf(a))a=Od(null,a,b,c,d),fa.push(a);else{var e=Qd(a,b,c,d);if(null===e)Xf(a,d);else if(-1<Nd.indexOf(a))a=Od(e,a,b,c,d),fa.push(a);else if(!zi(e,a,b,c,d)){Xf(a,d);a=Vf(a,d,null,b);try{uf(Wf,a)}finally{Uf(a)}}}}function Qd(a,b,c,d){c=Ld(d);c=Bb(c);if(null!==c){var e=Na(c);if(null===
e)c=null;else{var f=e.tag;if(13===f){c=Qf(e);if(null!==c)return c;c=null}else if(3===f){if(e.stateNode.hydrate)return 3===e.tag?e.stateNode.containerInfo:null;c=null}else e!==c&&(c=null)}}a=Vf(a,d,c,b);try{uf(Wf,a)}finally{Uf(a)}return null}function fg(a,b,c){return null==b||"boolean"===typeof b||""===b?"":c||"number"!==typeof b||0===b||Kb.hasOwnProperty(a)&&Kb[a]?(""+b).trim():b+"px"}function gg(a,b){a=a.style;for(var c in b)if(b.hasOwnProperty(c)){var d=0===c.indexOf("--"),e=fg(c,b[c],d);"float"===
c&&(c="cssFloat");d?a.setProperty(c,e):a[c]=e}}function Ud(a,b){if(b){if(Ii[a]&&(null!=b.children||null!=b.dangerouslySetInnerHTML))throw Error(k(137,a,""));if(null!=b.dangerouslySetInnerHTML){if(null!=b.children)throw Error(k(60));if(!("object"===typeof b.dangerouslySetInnerHTML&&"__html"in b.dangerouslySetInnerHTML))throw Error(k(61));}if(null!=b.style&&"object"!==typeof b.style)throw Error(k(62,""));}}function Vd(a,b){if(-1===a.indexOf("-"))return"string"===typeof b.is;switch(a){case "annotation-xml":case "color-profile":case "font-face":case "font-face-src":case "font-face-uri":case "font-face-format":case "font-face-name":case "missing-glyph":return!1;
default:return!0}}function oa(a,b){a=9===a.nodeType||11===a.nodeType?a:a.ownerDocument;var c=Jd(a);b=rd[b];for(var d=0;d<b.length;d++)Md(b[d],a,c)}function uc(){}function Wd(a){a=a||("undefined"!==typeof document?document:void 0);if("undefined"===typeof a)return null;try{return a.activeElement||a.body}catch(b){return a.body}}function hg(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function ig(a,b){var c=hg(a);a=0;for(var d;c;){if(3===c.nodeType){d=a+c.textContent.length;if(a<=b&&d>=b)return{node:c,
offset:b-a};a=d}a:{for(;c;){if(c.nextSibling){c=c.nextSibling;break a}c=c.parentNode}c=void 0}c=hg(c)}}function jg(a,b){return a&&b?a===b?!0:a&&3===a.nodeType?!1:b&&3===b.nodeType?jg(a,b.parentNode):"contains"in a?a.contains(b):a.compareDocumentPosition?!!(a.compareDocumentPosition(b)&16):!1:!1}function kg(){for(var a=window,b=Wd();b instanceof a.HTMLIFrameElement;){try{var c="string"===typeof b.contentWindow.location.href}catch(d){c=!1}if(c)a=b.contentWindow;else break;b=Wd(a.document)}return b}
function Xd(a){var b=a&&a.nodeName&&a.nodeName.toLowerCase();return b&&("input"===b&&("text"===a.type||"search"===a.type||"tel"===a.type||"url"===a.type||"password"===a.type)||"textarea"===b||"true"===a.contentEditable)}function lg(a,b){switch(a){case "button":case "input":case "select":case "textarea":return!!b.autoFocus}return!1}function Yd(a,b){return"textarea"===a||"option"===a||"noscript"===a||"string"===typeof b.children||"number"===typeof b.children||"object"===typeof b.dangerouslySetInnerHTML&&
null!==b.dangerouslySetInnerHTML&&null!=b.dangerouslySetInnerHTML.__html}function kb(a){for(;null!=a;a=a.nextSibling){var b=a.nodeType;if(1===b||3===b)break}return a}function mg(a){a=a.previousSibling;for(var b=0;a;){if(8===a.nodeType){var c=a.data;if(c===ng||c===Zd||c===$d){if(0===b)return a;b--}else c===og&&b++}a=a.previousSibling}return null}function Bb(a){var b=a[Aa];if(b)return b;for(var c=a.parentNode;c;){if(b=c[Lb]||c[Aa]){c=b.alternate;if(null!==b.child||null!==c&&null!==c.child)for(a=mg(a);null!==
a;){if(c=a[Aa])return c;a=mg(a)}return b}a=c;c=a.parentNode}return null}function Hb(a){a=a[Aa]||a[Lb];return!a||5!==a.tag&&6!==a.tag&&13!==a.tag&&3!==a.tag?null:a}function Pa(a){if(5===a.tag||6===a.tag)return a.stateNode;throw Error(k(33));}function ae(a){return a[vc]||null}function pa(a){do a=a.return;while(a&&5!==a.tag);return a?a:null}function pg(a,b){var c=a.stateNode;if(!c)return null;var d=td(c);if(!d)return null;c=d[b];a:switch(b){case "onClick":case "onClickCapture":case "onDoubleClick":case "onDoubleClickCapture":case "onMouseDown":case "onMouseDownCapture":case "onMouseMove":case "onMouseMoveCapture":case "onMouseUp":case "onMouseUpCapture":case "onMouseEnter":(d=
!d.disabled)||(a=a.type,d=!("button"===a||"input"===a||"select"===a||"textarea"===a));a=!d;break a;default:a=!1}if(a)return null;if(c&&"function"!==typeof c)throw Error(k(231,b,typeof c));return c}function qg(a,b,c){if(b=pg(a,c.dispatchConfig.phasedRegistrationNames[b]))c._dispatchListeners=jb(c._dispatchListeners,b),c._dispatchInstances=jb(c._dispatchInstances,a)}function Ji(a){if(a&&a.dispatchConfig.phasedRegistrationNames){for(var b=a._targetInst,c=[];b;)c.push(b),b=pa(b);for(b=c.length;0<b--;)qg(c[b],
"captured",a);for(b=0;b<c.length;b++)qg(c[b],"bubbled",a)}}function be(a,b,c){a&&c&&c.dispatchConfig.registrationName&&(b=pg(a,c.dispatchConfig.registrationName))&&(c._dispatchListeners=jb(c._dispatchListeners,b),c._dispatchInstances=jb(c._dispatchInstances,a))}function Ki(a){a&&a.dispatchConfig.registrationName&&be(a._targetInst,null,a)}function lb(a){Kd(a,Ji)}function rg(){if(wc)return wc;var a,b=ce,c=b.length,d,e="value"in Ba?Ba.value:Ba.textContent,f=e.length;for(a=0;a<c&&b[a]===e[a];a++);var g=
c-a;for(d=1;d<=g&&b[c-d]===e[f-d];d++);return wc=e.slice(a,1<d?1-d:void 0)}function xc(){return!0}function yc(){return!1}function R(a,b,c,d){this.dispatchConfig=a;this._targetInst=b;this.nativeEvent=c;a=this.constructor.Interface;for(var e in a)a.hasOwnProperty(e)&&((b=a[e])?this[e]=b(c):"target"===e?this.target=d:this[e]=c[e]);this.isDefaultPrevented=(null!=c.defaultPrevented?c.defaultPrevented:!1===c.returnValue)?xc:yc;this.isPropagationStopped=yc;return this}function Li(a,b,c,d){if(this.eventPool.length){var e=
this.eventPool.pop();this.call(e,a,b,c,d);return e}return new this(a,b,c,d)}function Mi(a){if(!(a instanceof this))throw Error(k(279));a.destructor();10>this.eventPool.length&&this.eventPool.push(a)}function sg(a){a.eventPool=[];a.getPooled=Li;a.release=Mi}function tg(a,b){switch(a){case "keyup":return-1!==Ni.indexOf(b.keyCode);case "keydown":return 229!==b.keyCode;case "keypress":case "mousedown":case "blur":return!0;default:return!1}}function ug(a){a=a.detail;return"object"===typeof a&&"data"in
a?a.data:null}function Oi(a,b){switch(a){case "compositionend":return ug(b);case "keypress":if(32!==b.which)return null;vg=!0;return wg;case "textInput":return a=b.data,a===wg&&vg?null:a;default:return null}}function Pi(a,b){if(mb)return"compositionend"===a||!de&&tg(a,b)?(a=rg(),wc=ce=Ba=null,mb=!1,a):null;switch(a){case "paste":return null;case "keypress":if(!(b.ctrlKey||b.altKey||b.metaKey)||b.ctrlKey&&b.altKey){if(b.char&&1<b.char.length)return b.char;if(b.which)return String.fromCharCode(b.which)}return null;
case "compositionend":return xg&&"ko"!==b.locale?null:b.data;default:return null}}function yg(a){var b=a&&a.nodeName&&a.nodeName.toLowerCase();return"input"===b?!!Qi[a.type]:"textarea"===b?!0:!1}function zg(a,b,c){a=R.getPooled(Ag.change,a,b,c);a.type="change";sf(c);lb(a);return a}function Ri(a){pc(a)}function zc(a){var b=Pa(a);if(Gf(b))return a}function Si(a,b){if("change"===a)return b}function Bg(){Mb&&(Mb.detachEvent("onpropertychange",Cg),Nb=Mb=null)}function Cg(a){if("value"===a.propertyName&&
zc(Nb))if(a=zg(Nb,a,Ld(a)),Oa)pc(a);else{Oa=!0;try{ee(Ri,a)}finally{Oa=!1,ud()}}}function Ti(a,b,c){"focus"===a?(Bg(),Mb=b,Nb=c,Mb.attachEvent("onpropertychange",Cg)):"blur"===a&&Bg()}function Ui(a,b){if("selectionchange"===a||"keyup"===a||"keydown"===a)return zc(Nb)}function Vi(a,b){if("click"===a)return zc(b)}function Wi(a,b){if("input"===a||"change"===a)return zc(b)}function Xi(a){var b=this.nativeEvent;return b.getModifierState?b.getModifierState(a):(a=Yi[a])?!!b[a]:!1}function fe(a){return Xi}
function Zi(a,b){return a===b&&(0!==a||1/a===1/b)||a!==a&&b!==b}function Ob(a,b){if(Qa(a,b))return!0;if("object"!==typeof a||null===a||"object"!==typeof b||null===b)return!1;var c=Object.keys(a),d=Object.keys(b);if(c.length!==d.length)return!1;for(d=0;d<c.length;d++)if(!$i.call(b,c[d])||!Qa(a[c[d]],b[c[d]]))return!1;return!0}function Dg(a,b){var c=b.window===b?b.document:9===b.nodeType?b:b.ownerDocument;if(ge||null==nb||nb!==Wd(c))return null;c=nb;"selectionStart"in c&&Xd(c)?c={start:c.selectionStart,
end:c.selectionEnd}:(c=(c.ownerDocument&&c.ownerDocument.defaultView||window).getSelection(),c={anchorNode:c.anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset});return Pb&&Ob(Pb,c)?null:(Pb=c,a=R.getPooled(Eg.select,he,a,b),a.type="select",a.target=nb,lb(a),a)}function Ac(a){var b=a.keyCode;"charCode"in a?(a=a.charCode,0===a&&13===b&&(a=13)):a=b;10===a&&(a=13);return 32<=a||13===a?a:0}function q(a,b){0>ob||(a.current=ie[ob],ie[ob]=null,ob--)}function y(a,b,c){ob++;
ie[ob]=a.current;a.current=b}function pb(a,b){var c=a.type.contextTypes;if(!c)return Ca;var d=a.stateNode;if(d&&d.__reactInternalMemoizedUnmaskedChildContext===b)return d.__reactInternalMemoizedMaskedChildContext;var e={},f;for(f in c)e[f]=b[f];d&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=b,a.__reactInternalMemoizedMaskedChildContext=e);return e}function N(a){a=a.childContextTypes;return null!==a&&void 0!==a}function Fg(a,b,c){if(B.current!==Ca)throw Error(k(168));y(B,b);y(G,c)}
function Gg(a,b,c){var d=a.stateNode;a=b.childContextTypes;if("function"!==typeof d.getChildContext)return c;d=d.getChildContext();for(var e in d)if(!(e in a))throw Error(k(108,na(b)||"Unknown",e));return M({},c,{},d)}function Bc(a){a=(a=a.stateNode)&&a.__reactInternalMemoizedMergedChildContext||Ca;Ra=B.current;y(B,a);y(G,G.current);return!0}function Hg(a,b,c){var d=a.stateNode;if(!d)throw Error(k(169));c?(a=Gg(a,b,Ra),d.__reactInternalMemoizedMergedChildContext=a,q(G),q(B),y(B,a)):q(G);y(G,c)}function Cc(){switch(aj()){case Dc:return 99;
case Ig:return 98;case Jg:return 97;case Kg:return 96;case Lg:return 95;default:throw Error(k(332));}}function Mg(a){switch(a){case 99:return Dc;case 98:return Ig;case 97:return Jg;case 96:return Kg;case 95:return Lg;default:throw Error(k(332));}}function Da(a,b){a=Mg(a);return bj(a,b)}function Ng(a,b,c){a=Mg(a);return je(a,b,c)}function Og(a){null===qa?(qa=[a],Ec=je(Dc,Pg)):qa.push(a);return Qg}function ha(){if(null!==Ec){var a=Ec;Ec=null;Rg(a)}Pg()}function Pg(){if(!ke&&null!==qa){ke=!0;var a=0;
try{var b=qa;Da(99,function(){for(;a<b.length;a++){var c=b[a];do c=c(!0);while(null!==c)}});qa=null}catch(c){throw null!==qa&&(qa=qa.slice(a+1)),je(Dc,ha),c;}finally{ke=!1}}}function Fc(a,b,c){c/=10;return 1073741821-(((1073741821-a+b/10)/c|0)+1)*c}function aa(a,b){if(a&&a.defaultProps){b=M({},b);a=a.defaultProps;for(var c in a)void 0===b[c]&&(b[c]=a[c])}return b}function le(){Gc=qb=Hc=null}function me(a){var b=Ic.current;q(Ic);a.type._context._currentValue=b}function Sg(a,b){for(;null!==a;){var c=
a.alternate;if(a.childExpirationTime<b)a.childExpirationTime=b,null!==c&&c.childExpirationTime<b&&(c.childExpirationTime=b);else if(null!==c&&c.childExpirationTime<b)c.childExpirationTime=b;else break;a=a.return}}function rb(a,b){Hc=a;Gc=qb=null;a=a.dependencies;null!==a&&null!==a.firstContext&&(a.expirationTime>=b&&(ia=!0),a.firstContext=null)}function W(a,b){if(Gc!==a&&!1!==b&&0!==b){if("number"!==typeof b||1073741823===b)Gc=a,b=1073741823;b={context:a,observedBits:b,next:null};if(null===qb){if(null===
Hc)throw Error(k(308));qb=b;Hc.dependencies={expirationTime:0,firstContext:b,responders:null}}else qb=qb.next=b}return a._currentValue}function ne(a){a.updateQueue={baseState:a.memoizedState,baseQueue:null,shared:{pending:null},effects:null}}function oe(a,b){a=a.updateQueue;b.updateQueue===a&&(b.updateQueue={baseState:a.baseState,baseQueue:a.baseQueue,shared:a.shared,effects:a.effects})}function Ea(a,b){a={expirationTime:a,suspenseConfig:b,tag:Tg,payload:null,callback:null,next:null};return a.next=
a}function Fa(a,b){a=a.updateQueue;if(null!==a){a=a.shared;var c=a.pending;null===c?b.next=b:(b.next=c.next,c.next=b);a.pending=b}}function Ug(a,b){var c=a.alternate;null!==c&&oe(c,a);a=a.updateQueue;c=a.baseQueue;null===c?(a.baseQueue=b.next=b,b.next=b):(b.next=c.next,c.next=b)}function Qb(a,b,c,d){var e=a.updateQueue;Ga=!1;var f=e.baseQueue,g=e.shared.pending;if(null!==g){if(null!==f){var h=f.next;f.next=g.next;g.next=h}f=g;e.shared.pending=null;h=a.alternate;null!==h&&(h=h.updateQueue,null!==h&&
(h.baseQueue=g))}if(null!==f){h=f.next;var m=e.baseState,n=0,k=null,ba=null,l=null;if(null!==h){var p=h;do{g=p.expirationTime;if(g<d){var t={expirationTime:p.expirationTime,suspenseConfig:p.suspenseConfig,tag:p.tag,payload:p.payload,callback:p.callback,next:null};null===l?(ba=l=t,k=m):l=l.next=t;g>n&&(n=g)}else{null!==l&&(l=l.next={expirationTime:1073741823,suspenseConfig:p.suspenseConfig,tag:p.tag,payload:p.payload,callback:p.callback,next:null});Vg(g,p.suspenseConfig);a:{var q=a,r=p;g=b;t=c;switch(r.tag){case 1:q=
r.payload;if("function"===typeof q){m=q.call(t,m,g);break a}m=q;break a;case 3:q.effectTag=q.effectTag&-4097|64;case Tg:q=r.payload;g="function"===typeof q?q.call(t,m,g):q;if(null===g||void 0===g)break a;m=M({},m,g);break a;case Jc:Ga=!0}}null!==p.callback&&(a.effectTag|=32,g=e.effects,null===g?e.effects=[p]:g.push(p))}p=p.next;if(null===p||p===h)if(g=e.shared.pending,null===g)break;else p=f.next=g.next,g.next=h,e.baseQueue=f=g,e.shared.pending=null}while(1)}null===l?k=m:l.next=ba;e.baseState=k;e.baseQueue=
l;Kc(n);a.expirationTime=n;a.memoizedState=m}}function Wg(a,b,c){a=b.effects;b.effects=null;if(null!==a)for(b=0;b<a.length;b++){var d=a[b],e=d.callback;if(null!==e){d.callback=null;d=e;e=c;if("function"!==typeof d)throw Error(k(191,d));d.call(e)}}}function Lc(a,b,c,d){b=a.memoizedState;c=c(d,b);c=null===c||void 0===c?b:M({},b,c);a.memoizedState=c;0===a.expirationTime&&(a.updateQueue.baseState=c)}function Xg(a,b,c,d,e,f,g){a=a.stateNode;return"function"===typeof a.shouldComponentUpdate?a.shouldComponentUpdate(d,
f,g):b.prototype&&b.prototype.isPureReactComponent?!Ob(c,d)||!Ob(e,f):!0}function Yg(a,b,c){var d=!1,e=Ca;var f=b.contextType;"object"===typeof f&&null!==f?f=W(f):(e=N(b)?Ra:B.current,d=b.contextTypes,f=(d=null!==d&&void 0!==d)?pb(a,e):Ca);b=new b(c,f);a.memoizedState=null!==b.state&&void 0!==b.state?b.state:null;b.updater=Mc;a.stateNode=b;b._reactInternalFiber=a;d&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=e,a.__reactInternalMemoizedMaskedChildContext=f);return b}function Zg(a,
b,c,d){a=b.state;"function"===typeof b.componentWillReceiveProps&&b.componentWillReceiveProps(c,d);"function"===typeof b.UNSAFE_componentWillReceiveProps&&b.UNSAFE_componentWillReceiveProps(c,d);b.state!==a&&Mc.enqueueReplaceState(b,b.state,null)}function pe(a,b,c,d){var e=a.stateNode;e.props=c;e.state=a.memoizedState;e.refs=$g;ne(a);var f=b.contextType;"object"===typeof f&&null!==f?e.context=W(f):(f=N(b)?Ra:B.current,e.context=pb(a,f));Qb(a,c,e,d);e.state=a.memoizedState;f=b.getDerivedStateFromProps;
"function"===typeof f&&(Lc(a,b,f,c),e.state=a.memoizedState);"function"===typeof b.getDerivedStateFromProps||"function"===typeof e.getSnapshotBeforeUpdate||"function"!==typeof e.UNSAFE_componentWillMount&&"function"!==typeof e.componentWillMount||(b=e.state,"function"===typeof e.componentWillMount&&e.componentWillMount(),"function"===typeof e.UNSAFE_componentWillMount&&e.UNSAFE_componentWillMount(),b!==e.state&&Mc.enqueueReplaceState(e,e.state,null),Qb(a,c,e,d),e.state=a.memoizedState);"function"===
typeof e.componentDidMount&&(a.effectTag|=4)}function Rb(a,b,c){a=c.ref;if(null!==a&&"function"!==typeof a&&"object"!==typeof a){if(c._owner){c=c._owner;if(c){if(1!==c.tag)throw Error(k(309));var d=c.stateNode}if(!d)throw Error(k(147,a));var e=""+a;if(null!==b&&null!==b.ref&&"function"===typeof b.ref&&b.ref._stringRef===e)return b.ref;b=function(a){var b=d.refs;b===$g&&(b=d.refs={});null===a?delete b[e]:b[e]=a};b._stringRef=e;return b}if("string"!==typeof a)throw Error(k(284));if(!c._owner)throw Error(k(290,
a));}return a}function Nc(a,b){if("textarea"!==a.type)throw Error(k(31,"[object Object]"===Object.prototype.toString.call(b)?"object with keys {"+Object.keys(b).join(", ")+"}":b,""));}function ah(a){function b(b,c){if(a){var d=b.lastEffect;null!==d?(d.nextEffect=c,b.lastEffect=c):b.firstEffect=b.lastEffect=c;c.nextEffect=null;c.effectTag=8}}function c(c,d){if(!a)return null;for(;null!==d;)b(c,d),d=d.sibling;return null}function d(a,b){for(a=new Map;null!==b;)null!==b.key?a.set(b.key,b):a.set(b.index,
b),b=b.sibling;return a}function e(a,b){a=Sa(a,b);a.index=0;a.sibling=null;return a}function f(b,c,d){b.index=d;if(!a)return c;d=b.alternate;if(null!==d)return d=d.index,d<c?(b.effectTag=2,c):d;b.effectTag=2;return c}function g(b){a&&null===b.alternate&&(b.effectTag=2);return b}function h(a,b,c,d){if(null===b||6!==b.tag)return b=qe(c,a.mode,d),b.return=a,b;b=e(b,c);b.return=a;return b}function m(a,b,c,d){if(null!==b&&b.elementType===c.type)return d=e(b,c.props),d.ref=Rb(a,b,c),d.return=a,d;d=Oc(c.type,
c.key,c.props,null,a.mode,d);d.ref=Rb(a,b,c);d.return=a;return d}function n(a,b,c,d){if(null===b||4!==b.tag||b.stateNode.containerInfo!==c.containerInfo||b.stateNode.implementation!==c.implementation)return b=re(c,a.mode,d),b.return=a,b;b=e(b,c.children||[]);b.return=a;return b}function l(a,b,c,d,f){if(null===b||7!==b.tag)return b=Ha(c,a.mode,d,f),b.return=a,b;b=e(b,c);b.return=a;return b}function ba(a,b,c){if("string"===typeof b||"number"===typeof b)return b=qe(""+b,a.mode,c),b.return=a,b;if("object"===
typeof b&&null!==b){switch(b.$$typeof){case Pc:return c=Oc(b.type,b.key,b.props,null,a.mode,c),c.ref=Rb(a,null,b),c.return=a,c;case gb:return b=re(b,a.mode,c),b.return=a,b}if(Qc(b)||zb(b))return b=Ha(b,a.mode,c,null),b.return=a,b;Nc(a,b)}return null}function p(a,b,c,d){var e=null!==b?b.key:null;if("string"===typeof c||"number"===typeof c)return null!==e?null:h(a,b,""+c,d);if("object"===typeof c&&null!==c){switch(c.$$typeof){case Pc:return c.key===e?c.type===Ma?l(a,b,c.props.children,d,e):m(a,b,c,
d):null;case gb:return c.key===e?n(a,b,c,d):null}if(Qc(c)||zb(c))return null!==e?null:l(a,b,c,d,null);Nc(a,c)}return null}function t(a,b,c,d,e){if("string"===typeof d||"number"===typeof d)return a=a.get(c)||null,h(b,a,""+d,e);if("object"===typeof d&&null!==d){switch(d.$$typeof){case Pc:return a=a.get(null===d.key?c:d.key)||null,d.type===Ma?l(b,a,d.props.children,e,d.key):m(b,a,d,e);case gb:return a=a.get(null===d.key?c:d.key)||null,n(b,a,d,e)}if(Qc(d)||zb(d))return a=a.get(c)||null,l(b,a,d,e,null);
Nc(b,d)}return null}function q(e,g,h,m){for(var n=null,k=null,l=g,r=g=0,C=null;null!==l&&r<h.length;r++){l.index>r?(C=l,l=null):C=l.sibling;var O=p(e,l,h[r],m);if(null===O){null===l&&(l=C);break}a&&l&&null===O.alternate&&b(e,l);g=f(O,g,r);null===k?n=O:k.sibling=O;k=O;l=C}if(r===h.length)return c(e,l),n;if(null===l){for(;r<h.length;r++)l=ba(e,h[r],m),null!==l&&(g=f(l,g,r),null===k?n=l:k.sibling=l,k=l);return n}for(l=d(e,l);r<h.length;r++)C=t(l,e,r,h[r],m),null!==C&&(a&&null!==C.alternate&&l.delete(null===
C.key?r:C.key),g=f(C,g,r),null===k?n=C:k.sibling=C,k=C);a&&l.forEach(function(a){return b(e,a)});return n}function w(e,g,h,n){var m=zb(h);if("function"!==typeof m)throw Error(k(150));h=m.call(h);if(null==h)throw Error(k(151));for(var l=m=null,r=g,C=g=0,O=null,v=h.next();null!==r&&!v.done;C++,v=h.next()){r.index>C?(O=r,r=null):O=r.sibling;var q=p(e,r,v.value,n);if(null===q){null===r&&(r=O);break}a&&r&&null===q.alternate&&b(e,r);g=f(q,g,C);null===l?m=q:l.sibling=q;l=q;r=O}if(v.done)return c(e,r),m;
if(null===r){for(;!v.done;C++,v=h.next())v=ba(e,v.value,n),null!==v&&(g=f(v,g,C),null===l?m=v:l.sibling=v,l=v);return m}for(r=d(e,r);!v.done;C++,v=h.next())v=t(r,e,C,v.value,n),null!==v&&(a&&null!==v.alternate&&r.delete(null===v.key?C:v.key),g=f(v,g,C),null===l?m=v:l.sibling=v,l=v);a&&r.forEach(function(a){return b(e,a)});return m}return function(a,d,f,h){var m="object"===typeof f&&null!==f&&f.type===Ma&&null===f.key;m&&(f=f.props.children);var n="object"===typeof f&&null!==f;if(n)switch(f.$$typeof){case Pc:a:{n=
f.key;for(m=d;null!==m;){if(m.key===n){switch(m.tag){case 7:if(f.type===Ma){c(a,m.sibling);d=e(m,f.props.children);d.return=a;a=d;break a}break;default:if(m.elementType===f.type){c(a,m.sibling);d=e(m,f.props);d.ref=Rb(a,m,f);d.return=a;a=d;break a}}c(a,m);break}else b(a,m);m=m.sibling}f.type===Ma?(d=Ha(f.props.children,a.mode,h,f.key),d.return=a,a=d):(h=Oc(f.type,f.key,f.props,null,a.mode,h),h.ref=Rb(a,d,f),h.return=a,a=h)}return g(a);case gb:a:{for(m=f.key;null!==d;){if(d.key===m)if(4===d.tag&&d.stateNode.containerInfo===
f.containerInfo&&d.stateNode.implementation===f.implementation){c(a,d.sibling);d=e(d,f.children||[]);d.return=a;a=d;break a}else{c(a,d);break}else b(a,d);d=d.sibling}d=re(f,a.mode,h);d.return=a;a=d}return g(a)}if("string"===typeof f||"number"===typeof f)return f=""+f,null!==d&&6===d.tag?(c(a,d.sibling),d=e(d,f),d.return=a,a=d):(c(a,d),d=qe(f,a.mode,h),d.return=a,a=d),g(a);if(Qc(f))return q(a,d,f,h);if(zb(f))return w(a,d,f,h);n&&Nc(a,f);if("undefined"===typeof f&&!m)switch(a.tag){case 1:case 0:throw a=
a.type,Error(k(152,a.displayName||a.name||"Component"));}return c(a,d)}}function Ta(a){if(a===Sb)throw Error(k(174));return a}function se(a,b){y(Tb,b);y(Ub,a);y(ja,Sb);a=b.nodeType;switch(a){case 9:case 11:b=(b=b.documentElement)?b.namespaceURI:Hd(null,"");break;default:a=8===a?b.parentNode:b,b=a.namespaceURI||null,a=a.tagName,b=Hd(b,a)}q(ja);y(ja,b)}function tb(a){q(ja);q(Ub);q(Tb)}function bh(a){Ta(Tb.current);var b=Ta(ja.current);var c=Hd(b,a.type);b!==c&&(y(Ub,a),y(ja,c))}function te(a){Ub.current===
a&&(q(ja),q(Ub))}function Rc(a){for(var b=a;null!==b;){if(13===b.tag){var c=b.memoizedState;if(null!==c&&(c=c.dehydrated,null===c||c.data===$d||c.data===Zd))return b}else if(19===b.tag&&void 0!==b.memoizedProps.revealOrder){if(0!==(b.effectTag&64))return b}else if(null!==b.child){b.child.return=b;b=b.child;continue}if(b===a)break;for(;null===b.sibling;){if(null===b.return||b.return===a)return null;b=b.return}b.sibling.return=b.return;b=b.sibling}return null}function ue(a,b){return{responder:a,props:b}}
function S(){throw Error(k(321));}function ve(a,b){if(null===b)return!1;for(var c=0;c<b.length&&c<a.length;c++)if(!Qa(a[c],b[c]))return!1;return!0}function we(a,b,c,d,e,f){Ia=f;z=b;b.memoizedState=null;b.updateQueue=null;b.expirationTime=0;Sc.current=null===a||null===a.memoizedState?dj:ej;a=c(d,e);if(b.expirationTime===Ia){f=0;do{b.expirationTime=0;if(!(25>f))throw Error(k(301));f+=1;J=K=null;b.updateQueue=null;Sc.current=fj;a=c(d,e)}while(b.expirationTime===Ia)}Sc.current=Tc;b=null!==K&&null!==K.next;
Ia=0;J=K=z=null;Uc=!1;if(b)throw Error(k(300));return a}function ub(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};null===J?z.memoizedState=J=a:J=J.next=a;return J}function vb(){if(null===K){var a=z.alternate;a=null!==a?a.memoizedState:null}else a=K.next;var b=null===J?z.memoizedState:J.next;if(null!==b)J=b,K=a;else{if(null===a)throw Error(k(310));K=a;a={memoizedState:K.memoizedState,baseState:K.baseState,baseQueue:K.baseQueue,queue:K.queue,next:null};null===J?z.memoizedState=
J=a:J=J.next=a}return J}function Ua(a,b){return"function"===typeof b?b(a):b}function Vc(a,b,c){b=vb();c=b.queue;if(null===c)throw Error(k(311));c.lastRenderedReducer=a;var d=K,e=d.baseQueue,f=c.pending;if(null!==f){if(null!==e){var g=e.next;e.next=f.next;f.next=g}d.baseQueue=e=f;c.pending=null}if(null!==e){e=e.next;d=d.baseState;var h=g=f=null,m=e;do{var n=m.expirationTime;if(n<Ia){var l={expirationTime:m.expirationTime,suspenseConfig:m.suspenseConfig,action:m.action,eagerReducer:m.eagerReducer,eagerState:m.eagerState,
next:null};null===h?(g=h=l,f=d):h=h.next=l;n>z.expirationTime&&(z.expirationTime=n,Kc(n))}else null!==h&&(h=h.next={expirationTime:1073741823,suspenseConfig:m.suspenseConfig,action:m.action,eagerReducer:m.eagerReducer,eagerState:m.eagerState,next:null}),Vg(n,m.suspenseConfig),d=m.eagerReducer===a?m.eagerState:a(d,m.action);m=m.next}while(null!==m&&m!==e);null===h?f=d:h.next=g;Qa(d,b.memoizedState)||(ia=!0);b.memoizedState=d;b.baseState=f;b.baseQueue=h;c.lastRenderedState=d}return[b.memoizedState,
c.dispatch]}function Wc(a,b,c){b=vb();c=b.queue;if(null===c)throw Error(k(311));c.lastRenderedReducer=a;var d=c.dispatch,e=c.pending,f=b.memoizedState;if(null!==e){c.pending=null;var g=e=e.next;do f=a(f,g.action),g=g.next;while(g!==e);Qa(f,b.memoizedState)||(ia=!0);b.memoizedState=f;null===b.baseQueue&&(b.baseState=f);c.lastRenderedState=f}return[f,d]}function xe(a){var b=ub();"function"===typeof a&&(a=a());b.memoizedState=b.baseState=a;a=b.queue={pending:null,dispatch:null,lastRenderedReducer:Ua,
lastRenderedState:a};a=a.dispatch=ch.bind(null,z,a);return[b.memoizedState,a]}function ye(a,b,c,d){a={tag:a,create:b,destroy:c,deps:d,next:null};b=z.updateQueue;null===b?(b={lastEffect:null},z.updateQueue=b,b.lastEffect=a.next=a):(c=b.lastEffect,null===c?b.lastEffect=a.next=a:(d=c.next,c.next=a,a.next=d,b.lastEffect=a));return a}function dh(a){return vb().memoizedState}function ze(a,b,c,d){var e=ub();z.effectTag|=a;e.memoizedState=ye(1|b,c,void 0,void 0===d?null:d)}function Ae(a,b,c,d){var e=vb();
d=void 0===d?null:d;var f=void 0;if(null!==K){var g=K.memoizedState;f=g.destroy;if(null!==d&&ve(d,g.deps)){ye(b,c,f,d);return}}z.effectTag|=a;e.memoizedState=ye(1|b,c,f,d)}function eh(a,b){return ze(516,4,a,b)}function Xc(a,b){return Ae(516,4,a,b)}function fh(a,b){return Ae(4,2,a,b)}function gh(a,b){if("function"===typeof b)return a=a(),b(a),function(){b(null)};if(null!==b&&void 0!==b)return a=a(),b.current=a,function(){b.current=null}}function hh(a,b,c){c=null!==c&&void 0!==c?c.concat([a]):null;
return Ae(4,2,gh.bind(null,b,a),c)}function Be(a,b){}function ih(a,b){ub().memoizedState=[a,void 0===b?null:b];return a}function Yc(a,b){var c=vb();b=void 0===b?null:b;var d=c.memoizedState;if(null!==d&&null!==b&&ve(b,d[1]))return d[0];c.memoizedState=[a,b];return a}function jh(a,b){var c=vb();b=void 0===b?null:b;var d=c.memoizedState;if(null!==d&&null!==b&&ve(b,d[1]))return d[0];a=a();c.memoizedState=[a,b];return a}function Ce(a,b,c){var d=Cc();Da(98>d?98:d,function(){a(!0)});Da(97<d?97:d,function(){var d=
X.suspense;X.suspense=void 0===b?null:b;try{a(!1),c()}finally{X.suspense=d}})}function ch(a,b,c){var d=ka(),e=Vb.suspense;d=Va(d,a,e);e={expirationTime:d,suspenseConfig:e,action:c,eagerReducer:null,eagerState:null,next:null};var f=b.pending;null===f?e.next=e:(e.next=f.next,f.next=e);b.pending=e;f=a.alternate;if(a===z||null!==f&&f===z)Uc=!0,e.expirationTime=Ia,z.expirationTime=Ia;else{if(0===a.expirationTime&&(null===f||0===f.expirationTime)&&(f=b.lastRenderedReducer,null!==f))try{var g=b.lastRenderedState,
h=f(g,c);e.eagerReducer=f;e.eagerState=h;if(Qa(h,g))return}catch(m){}finally{}Ja(a,d)}}function kh(a,b){var c=la(5,null,null,0);c.elementType="DELETED";c.type="DELETED";c.stateNode=b;c.return=a;c.effectTag=8;null!==a.lastEffect?(a.lastEffect.nextEffect=c,a.lastEffect=c):a.firstEffect=a.lastEffect=c}function lh(a,b){switch(a.tag){case 5:var c=a.type;b=1!==b.nodeType||c.toLowerCase()!==b.nodeName.toLowerCase()?null:b;return null!==b?(a.stateNode=b,!0):!1;case 6:return b=""===a.pendingProps||3!==b.nodeType?
null:b,null!==b?(a.stateNode=b,!0):!1;case 13:return!1;default:return!1}}function De(a){if(Wa){var b=Ka;if(b){var c=b;if(!lh(a,b)){b=kb(c.nextSibling);if(!b||!lh(a,b)){a.effectTag=a.effectTag&-1025|2;Wa=!1;ra=a;return}kh(ra,c)}ra=a;Ka=kb(b.firstChild)}else a.effectTag=a.effectTag&-1025|2,Wa=!1,ra=a}}function mh(a){for(a=a.return;null!==a&&5!==a.tag&&3!==a.tag&&13!==a.tag;)a=a.return;ra=a}function Zc(a){if(a!==ra)return!1;if(!Wa)return mh(a),Wa=!0,!1;var b=a.type;if(5!==a.tag||"head"!==b&&"body"!==
b&&!Yd(b,a.memoizedProps))for(b=Ka;b;)kh(a,b),b=kb(b.nextSibling);mh(a);if(13===a.tag){a=a.memoizedState;a=null!==a?a.dehydrated:null;if(!a)throw Error(k(317));a:{a=a.nextSibling;for(b=0;a;){if(8===a.nodeType){var c=a.data;if(c===og){if(0===b){Ka=kb(a.nextSibling);break a}b--}else c!==ng&&c!==Zd&&c!==$d||b++}a=a.nextSibling}Ka=null}}else Ka=ra?kb(a.stateNode.nextSibling):null;return!0}function Ee(){Ka=ra=null;Wa=!1}function T(a,b,c,d){b.child=null===a?Fe(b,null,c,d):wb(b,a.child,c,d)}function nh(a,
b,c,d,e){c=c.render;var f=b.ref;rb(b,e);d=we(a,b,c,d,f,e);if(null!==a&&!ia)return b.updateQueue=a.updateQueue,b.effectTag&=-517,a.expirationTime<=e&&(a.expirationTime=0),sa(a,b,e);b.effectTag|=1;T(a,b,d,e);return b.child}function oh(a,b,c,d,e,f){if(null===a){var g=c.type;if("function"===typeof g&&!Ge(g)&&void 0===g.defaultProps&&null===c.compare&&void 0===c.defaultProps)return b.tag=15,b.type=g,ph(a,b,g,d,e,f);a=Oc(c.type,null,d,null,b.mode,f);a.ref=b.ref;a.return=b;return b.child=a}g=a.child;if(e<
f&&(e=g.memoizedProps,c=c.compare,c=null!==c?c:Ob,c(e,d)&&a.ref===b.ref))return sa(a,b,f);b.effectTag|=1;a=Sa(g,d);a.ref=b.ref;a.return=b;return b.child=a}function ph(a,b,c,d,e,f){return null!==a&&Ob(a.memoizedProps,d)&&a.ref===b.ref&&(ia=!1,e<f)?(b.expirationTime=a.expirationTime,sa(a,b,f)):He(a,b,c,d,f)}function qh(a,b){var c=b.ref;if(null===a&&null!==c||null!==a&&a.ref!==c)b.effectTag|=128}function He(a,b,c,d,e){var f=N(c)?Ra:B.current;f=pb(b,f);rb(b,e);c=we(a,b,c,d,f,e);if(null!==a&&!ia)return b.updateQueue=
a.updateQueue,b.effectTag&=-517,a.expirationTime<=e&&(a.expirationTime=0),sa(a,b,e);b.effectTag|=1;T(a,b,c,e);return b.child}function rh(a,b,c,d,e){if(N(c)){var f=!0;Bc(b)}else f=!1;rb(b,e);if(null===b.stateNode)null!==a&&(a.alternate=null,b.alternate=null,b.effectTag|=2),Yg(b,c,d),pe(b,c,d,e),d=!0;else if(null===a){var g=b.stateNode,h=b.memoizedProps;g.props=h;var m=g.context,n=c.contextType;"object"===typeof n&&null!==n?n=W(n):(n=N(c)?Ra:B.current,n=pb(b,n));var l=c.getDerivedStateFromProps,k="function"===
typeof l||"function"===typeof g.getSnapshotBeforeUpdate;k||"function"!==typeof g.UNSAFE_componentWillReceiveProps&&"function"!==typeof g.componentWillReceiveProps||(h!==d||m!==n)&&Zg(b,g,d,n);Ga=!1;var p=b.memoizedState;g.state=p;Qb(b,d,g,e);m=b.memoizedState;h!==d||p!==m||G.current||Ga?("function"===typeof l&&(Lc(b,c,l,d),m=b.memoizedState),(h=Ga||Xg(b,c,h,d,p,m,n))?(k||"function"!==typeof g.UNSAFE_componentWillMount&&"function"!==typeof g.componentWillMount||("function"===typeof g.componentWillMount&&
g.componentWillMount(),"function"===typeof g.UNSAFE_componentWillMount&&g.UNSAFE_componentWillMount()),"function"===typeof g.componentDidMount&&(b.effectTag|=4)):("function"===typeof g.componentDidMount&&(b.effectTag|=4),b.memoizedProps=d,b.memoizedState=m),g.props=d,g.state=m,g.context=n,d=h):("function"===typeof g.componentDidMount&&(b.effectTag|=4),d=!1)}else g=b.stateNode,oe(a,b),h=b.memoizedProps,g.props=b.type===b.elementType?h:aa(b.type,h),m=g.context,n=c.contextType,"object"===typeof n&&null!==
n?n=W(n):(n=N(c)?Ra:B.current,n=pb(b,n)),l=c.getDerivedStateFromProps,(k="function"===typeof l||"function"===typeof g.getSnapshotBeforeUpdate)||"function"!==typeof g.UNSAFE_componentWillReceiveProps&&"function"!==typeof g.componentWillReceiveProps||(h!==d||m!==n)&&Zg(b,g,d,n),Ga=!1,m=b.memoizedState,g.state=m,Qb(b,d,g,e),p=b.memoizedState,h!==d||m!==p||G.current||Ga?("function"===typeof l&&(Lc(b,c,l,d),p=b.memoizedState),(l=Ga||Xg(b,c,h,d,m,p,n))?(k||"function"!==typeof g.UNSAFE_componentWillUpdate&&
"function"!==typeof g.componentWillUpdate||("function"===typeof g.componentWillUpdate&&g.componentWillUpdate(d,p,n),"function"===typeof g.UNSAFE_componentWillUpdate&&g.UNSAFE_componentWillUpdate(d,p,n)),"function"===typeof g.componentDidUpdate&&(b.effectTag|=4),"function"===typeof g.getSnapshotBeforeUpdate&&(b.effectTag|=256)):("function"!==typeof g.componentDidUpdate||h===a.memoizedProps&&m===a.memoizedState||(b.effectTag|=4),"function"!==typeof g.getSnapshotBeforeUpdate||h===a.memoizedProps&&m===
a.memoizedState||(b.effectTag|=256),b.memoizedProps=d,b.memoizedState=p),g.props=d,g.state=p,g.context=n,d=l):("function"!==typeof g.componentDidUpdate||h===a.memoizedProps&&m===a.memoizedState||(b.effectTag|=4),"function"!==typeof g.getSnapshotBeforeUpdate||h===a.memoizedProps&&m===a.memoizedState||(b.effectTag|=256),d=!1);return Ie(a,b,c,d,f,e)}function Ie(a,b,c,d,e,f){qh(a,b);var g=0!==(b.effectTag&64);if(!d&&!g)return e&&Hg(b,c,!1),sa(a,b,f);d=b.stateNode;gj.current=b;var h=g&&"function"!==typeof c.getDerivedStateFromError?
null:d.render();b.effectTag|=1;null!==a&&g?(b.child=wb(b,a.child,null,f),b.child=wb(b,null,h,f)):T(a,b,h,f);b.memoizedState=d.state;e&&Hg(b,c,!0);return b.child}function sh(a){var b=a.stateNode;b.pendingContext?Fg(a,b.pendingContext,b.pendingContext!==b.context):b.context&&Fg(a,b.context,!1);se(a,b.containerInfo)}function th(a,b,c){var d=b.mode,e=b.pendingProps,f=D.current,g=!1,h;(h=0!==(b.effectTag&64))||(h=0!==(f&2)&&(null===a||null!==a.memoizedState));h?(g=!0,b.effectTag&=-65):null!==a&&null===
a.memoizedState||void 0===e.fallback||!0===e.unstable_avoidThisFallback||(f|=1);y(D,f&1);if(null===a){void 0!==e.fallback&&De(b);if(g){g=e.fallback;e=Ha(null,d,0,null);e.return=b;if(0===(b.mode&2))for(a=null!==b.memoizedState?b.child.child:b.child,e.child=a;null!==a;)a.return=e,a=a.sibling;c=Ha(g,d,c,null);c.return=b;e.sibling=c;b.memoizedState=Je;b.child=e;return c}d=e.children;b.memoizedState=null;return b.child=Fe(b,null,d,c)}if(null!==a.memoizedState){a=a.child;d=a.sibling;if(g){e=e.fallback;
c=Sa(a,a.pendingProps);c.return=b;if(0===(b.mode&2)&&(g=null!==b.memoizedState?b.child.child:b.child,g!==a.child))for(c.child=g;null!==g;)g.return=c,g=g.sibling;d=Sa(d,e);d.return=b;c.sibling=d;c.childExpirationTime=0;b.memoizedState=Je;b.child=c;return d}c=wb(b,a.child,e.children,c);b.memoizedState=null;return b.child=c}a=a.child;if(g){g=e.fallback;e=Ha(null,d,0,null);e.return=b;e.child=a;null!==a&&(a.return=e);if(0===(b.mode&2))for(a=null!==b.memoizedState?b.child.child:b.child,e.child=a;null!==
a;)a.return=e,a=a.sibling;c=Ha(g,d,c,null);c.return=b;e.sibling=c;c.effectTag|=2;e.childExpirationTime=0;b.memoizedState=Je;b.child=e;return c}b.memoizedState=null;return b.child=wb(b,a,e.children,c)}function uh(a,b){a.expirationTime<b&&(a.expirationTime=b);var c=a.alternate;null!==c&&c.expirationTime<b&&(c.expirationTime=b);Sg(a.return,b)}function Ke(a,b,c,d,e,f){var g=a.memoizedState;null===g?a.memoizedState={isBackwards:b,rendering:null,renderingStartTime:0,last:d,tail:c,tailExpiration:0,tailMode:e,
lastEffect:f}:(g.isBackwards=b,g.rendering=null,g.renderingStartTime=0,g.last=d,g.tail=c,g.tailExpiration=0,g.tailMode=e,g.lastEffect=f)}function vh(a,b,c){var d=b.pendingProps,e=d.revealOrder,f=d.tail;T(a,b,d.children,c);d=D.current;if(0!==(d&2))d=d&1|2,b.effectTag|=64;else{if(null!==a&&0!==(a.effectTag&64))a:for(a=b.child;null!==a;){if(13===a.tag)null!==a.memoizedState&&uh(a,c);else if(19===a.tag)uh(a,c);else if(null!==a.child){a.child.return=a;a=a.child;continue}if(a===b)break a;for(;null===a.sibling;){if(null===
a.return||a.return===b)break a;a=a.return}a.sibling.return=a.return;a=a.sibling}d&=1}y(D,d);if(0===(b.mode&2))b.memoizedState=null;else switch(e){case "forwards":c=b.child;for(e=null;null!==c;)a=c.alternate,null!==a&&null===Rc(a)&&(e=c),c=c.sibling;c=e;null===c?(e=b.child,b.child=null):(e=c.sibling,c.sibling=null);Ke(b,!1,e,c,f,b.lastEffect);break;case "backwards":c=null;e=b.child;for(b.child=null;null!==e;){a=e.alternate;if(null!==a&&null===Rc(a)){b.child=e;break}a=e.sibling;e.sibling=c;c=e;e=a}Ke(b,
!0,c,null,f,b.lastEffect);break;case "together":Ke(b,!1,null,null,void 0,b.lastEffect);break;default:b.memoizedState=null}return b.child}function sa(a,b,c){null!==a&&(b.dependencies=a.dependencies);var d=b.expirationTime;0!==d&&Kc(d);if(b.childExpirationTime<c)return null;if(null!==a&&b.child!==a.child)throw Error(k(153));if(null!==b.child){a=b.child;c=Sa(a,a.pendingProps);b.child=c;for(c.return=b;null!==a.sibling;)a=a.sibling,c=c.sibling=Sa(a,a.pendingProps),c.return=b;c.sibling=null}return b.child}
function $c(a,b){switch(a.tailMode){case "hidden":b=a.tail;for(var c=null;null!==b;)null!==b.alternate&&(c=b),b=b.sibling;null===c?a.tail=null:c.sibling=null;break;case "collapsed":c=a.tail;for(var d=null;null!==c;)null!==c.alternate&&(d=c),c=c.sibling;null===d?b||null===a.tail?a.tail=null:a.tail.sibling=null:d.sibling=null}}function hj(a,b,c){var d=b.pendingProps;switch(b.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:return N(b.type)&&(q(G),q(B)),
null;case 3:return tb(),q(G),q(B),c=b.stateNode,c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),null!==a&&null!==a.child||!Zc(b)||(b.effectTag|=4),wh(b),null;case 5:te(b);c=Ta(Tb.current);var e=b.type;if(null!==a&&null!=b.stateNode)ij(a,b,e,d,c),a.ref!==b.ref&&(b.effectTag|=128);else{if(!d){if(null===b.stateNode)throw Error(k(166));return null}a=Ta(ja.current);if(Zc(b)){d=b.stateNode;e=b.type;var f=b.memoizedProps;d[Aa]=b;d[vc]=f;switch(e){case "iframe":case "object":case "embed":w("load",
d);break;case "video":case "audio":for(a=0;a<Db.length;a++)w(Db[a],d);break;case "source":w("error",d);break;case "img":case "image":case "link":w("error",d);w("load",d);break;case "form":w("reset",d);w("submit",d);break;case "details":w("toggle",d);break;case "input":Hf(d,f);w("invalid",d);oa(c,"onChange");break;case "select":d._wrapperState={wasMultiple:!!f.multiple};w("invalid",d);oa(c,"onChange");break;case "textarea":Kf(d,f),w("invalid",d),oa(c,"onChange")}Ud(e,f);a=null;for(var g in f)if(f.hasOwnProperty(g)){var h=
f[g];"children"===g?"string"===typeof h?d.textContent!==h&&(a=["children",h]):"number"===typeof h&&d.textContent!==""+h&&(a=["children",""+h]):db.hasOwnProperty(g)&&null!=h&&oa(c,g)}switch(e){case "input":mc(d);Jf(d,f,!0);break;case "textarea":mc(d);Mf(d);break;case "select":case "option":break;default:"function"===typeof f.onClick&&(d.onclick=uc)}c=a;b.updateQueue=c;null!==c&&(b.effectTag|=4)}else{g=9===c.nodeType?c:c.ownerDocument;"http://www.w3.org/1999/xhtml"===a&&(a=Nf(e));"http://www.w3.org/1999/xhtml"===
a?"script"===e?(a=g.createElement("div"),a.innerHTML="<script>\x3c/script>",a=a.removeChild(a.firstChild)):"string"===typeof d.is?a=g.createElement(e,{is:d.is}):(a=g.createElement(e),"select"===e&&(g=a,d.multiple?g.multiple=!0:d.size&&(g.size=d.size))):a=g.createElementNS(a,e);a[Aa]=b;a[vc]=d;jj(a,b,!1,!1);b.stateNode=a;g=Vd(e,d);switch(e){case "iframe":case "object":case "embed":w("load",a);h=d;break;case "video":case "audio":for(h=0;h<Db.length;h++)w(Db[h],a);h=d;break;case "source":w("error",a);
h=d;break;case "img":case "image":case "link":w("error",a);w("load",a);h=d;break;case "form":w("reset",a);w("submit",a);h=d;break;case "details":w("toggle",a);h=d;break;case "input":Hf(a,d);h=Cd(a,d);w("invalid",a);oa(c,"onChange");break;case "option":h=Fd(a,d);break;case "select":a._wrapperState={wasMultiple:!!d.multiple};h=M({},d,{value:void 0});w("invalid",a);oa(c,"onChange");break;case "textarea":Kf(a,d);h=Gd(a,d);w("invalid",a);oa(c,"onChange");break;default:h=d}Ud(e,h);var m=h;for(f in m)if(m.hasOwnProperty(f)){var n=
m[f];"style"===f?gg(a,n):"dangerouslySetInnerHTML"===f?(n=n?n.__html:void 0,null!=n&&xh(a,n)):"children"===f?"string"===typeof n?("textarea"!==e||""!==n)&&Wb(a,n):"number"===typeof n&&Wb(a,""+n):"suppressContentEditableWarning"!==f&&"suppressHydrationWarning"!==f&&"autoFocus"!==f&&(db.hasOwnProperty(f)?null!=n&&oa(c,f):null!=n&&xd(a,f,n,g))}switch(e){case "input":mc(a);Jf(a,d,!1);break;case "textarea":mc(a);Mf(a);break;case "option":null!=d.value&&a.setAttribute("value",""+va(d.value));break;case "select":a.multiple=
!!d.multiple;c=d.value;null!=c?hb(a,!!d.multiple,c,!1):null!=d.defaultValue&&hb(a,!!d.multiple,d.defaultValue,!0);break;default:"function"===typeof h.onClick&&(a.onclick=uc)}lg(e,d)&&(b.effectTag|=4)}null!==b.ref&&(b.effectTag|=128)}return null;case 6:if(a&&null!=b.stateNode)kj(a,b,a.memoizedProps,d);else{if("string"!==typeof d&&null===b.stateNode)throw Error(k(166));c=Ta(Tb.current);Ta(ja.current);Zc(b)?(c=b.stateNode,d=b.memoizedProps,c[Aa]=b,c.nodeValue!==d&&(b.effectTag|=4)):(c=(9===c.nodeType?
c:c.ownerDocument).createTextNode(d),c[Aa]=b,b.stateNode=c)}return null;case 13:q(D);d=b.memoizedState;if(0!==(b.effectTag&64))return b.expirationTime=c,b;c=null!==d;d=!1;null===a?void 0!==b.memoizedProps.fallback&&Zc(b):(e=a.memoizedState,d=null!==e,c||null===e||(e=a.child.sibling,null!==e&&(f=b.firstEffect,null!==f?(b.firstEffect=e,e.nextEffect=f):(b.firstEffect=b.lastEffect=e,e.nextEffect=null),e.effectTag=8)));if(c&&!d&&0!==(b.mode&2))if(null===a&&!0!==b.memoizedProps.unstable_avoidThisFallback||
0!==(D.current&1))F===Xa&&(F=ad);else{if(F===Xa||F===ad)F=bd;0!==Xb&&null!==U&&(Ya(U,P),yh(U,Xb))}if(c||d)b.effectTag|=4;return null;case 4:return tb(),wh(b),null;case 10:return me(b),null;case 17:return N(b.type)&&(q(G),q(B)),null;case 19:q(D);d=b.memoizedState;if(null===d)return null;e=0!==(b.effectTag&64);f=d.rendering;if(null===f)if(e)$c(d,!1);else{if(F!==Xa||null!==a&&0!==(a.effectTag&64))for(f=b.child;null!==f;){a=Rc(f);if(null!==a){b.effectTag|=64;$c(d,!1);e=a.updateQueue;null!==e&&(b.updateQueue=
e,b.effectTag|=4);null===d.lastEffect&&(b.firstEffect=null);b.lastEffect=d.lastEffect;for(d=b.child;null!==d;)e=d,f=c,e.effectTag&=2,e.nextEffect=null,e.firstEffect=null,e.lastEffect=null,a=e.alternate,null===a?(e.childExpirationTime=0,e.expirationTime=f,e.child=null,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null):(e.childExpirationTime=a.childExpirationTime,e.expirationTime=a.expirationTime,e.child=a.child,e.memoizedProps=a.memoizedProps,e.memoizedState=a.memoizedState,
e.updateQueue=a.updateQueue,f=a.dependencies,e.dependencies=null===f?null:{expirationTime:f.expirationTime,firstContext:f.firstContext,responders:f.responders}),d=d.sibling;y(D,D.current&1|2);return b.child}f=f.sibling}}else{if(!e)if(a=Rc(f),null!==a){if(b.effectTag|=64,e=!0,c=a.updateQueue,null!==c&&(b.updateQueue=c,b.effectTag|=4),$c(d,!0),null===d.tail&&"hidden"===d.tailMode&&!f.alternate)return b=b.lastEffect=d.lastEffect,null!==b&&(b.nextEffect=null),null}else 2*Y()-d.renderingStartTime>d.tailExpiration&&
1<c&&(b.effectTag|=64,e=!0,$c(d,!1),b.expirationTime=b.childExpirationTime=c-1);d.isBackwards?(f.sibling=b.child,b.child=f):(c=d.last,null!==c?c.sibling=f:b.child=f,d.last=f)}return null!==d.tail?(0===d.tailExpiration&&(d.tailExpiration=Y()+500),c=d.tail,d.rendering=c,d.tail=c.sibling,d.lastEffect=b.lastEffect,d.renderingStartTime=Y(),c.sibling=null,b=D.current,y(D,e?b&1|2:b&1),c):null}throw Error(k(156,b.tag));}function lj(a,b){switch(a.tag){case 1:return N(a.type)&&(q(G),q(B)),b=a.effectTag,b&4096?
(a.effectTag=b&-4097|64,a):null;case 3:tb();q(G);q(B);b=a.effectTag;if(0!==(b&64))throw Error(k(285));a.effectTag=b&-4097|64;return a;case 5:return te(a),null;case 13:return q(D),b=a.effectTag,b&4096?(a.effectTag=b&-4097|64,a):null;case 19:return q(D),null;case 4:return tb(),null;case 10:return me(a),null;default:return null}}function Le(a,b){return{value:a,source:b,stack:Bd(b)}}function Me(a,b){var c=b.source,d=b.stack;null===d&&null!==c&&(d=Bd(c));null!==c&&na(c.type);b=b.value;null!==a&&1===a.tag&&
na(a.type);try{console.error(b)}catch(e){setTimeout(function(){throw e;})}}function mj(a,b){try{b.props=a.memoizedProps,b.state=a.memoizedState,b.componentWillUnmount()}catch(c){Za(a,c)}}function zh(a){var b=a.ref;if(null!==b)if("function"===typeof b)try{b(null)}catch(c){Za(a,c)}else b.current=null}function nj(a,b){switch(b.tag){case 0:case 11:case 15:case 22:return;case 1:if(b.effectTag&256&&null!==a){var c=a.memoizedProps,d=a.memoizedState;a=b.stateNode;b=a.getSnapshotBeforeUpdate(b.elementType===
b.type?c:aa(b.type,c),d);a.__reactInternalSnapshotBeforeUpdate=b}return;case 3:case 5:case 6:case 4:case 17:return}throw Error(k(163));}function Ah(a,b){b=b.updateQueue;b=null!==b?b.lastEffect:null;if(null!==b){var c=b=b.next;do{if((c.tag&a)===a){var d=c.destroy;c.destroy=void 0;void 0!==d&&d()}c=c.next}while(c!==b)}}function Bh(a,b){b=b.updateQueue;b=null!==b?b.lastEffect:null;if(null!==b){var c=b=b.next;do{if((c.tag&a)===a){var d=c.create;c.destroy=d()}c=c.next}while(c!==b)}}function oj(a,b,c,d){switch(c.tag){case 0:case 11:case 15:case 22:Bh(3,
c);return;case 1:a=c.stateNode;c.effectTag&4&&(null===b?a.componentDidMount():(d=c.elementType===c.type?b.memoizedProps:aa(c.type,b.memoizedProps),a.componentDidUpdate(d,b.memoizedState,a.__reactInternalSnapshotBeforeUpdate)));b=c.updateQueue;null!==b&&Wg(c,b,a);return;case 3:b=c.updateQueue;if(null!==b){a=null;if(null!==c.child)switch(c.child.tag){case 5:a=c.child.stateNode;break;case 1:a=c.child.stateNode}Wg(c,b,a)}return;case 5:a=c.stateNode;null===b&&c.effectTag&4&&lg(c.type,c.memoizedProps)&&
a.focus();return;case 6:return;case 4:return;case 12:return;case 13:null===c.memoizedState&&(c=c.alternate,null!==c&&(c=c.memoizedState,null!==c&&(c=c.dehydrated,null!==c&&bg(c))));return;case 19:case 17:case 20:case 21:return}throw Error(k(163));}function Ch(a,b,c){"function"===typeof Ne&&Ne(b);switch(b.tag){case 0:case 11:case 14:case 15:case 22:a=b.updateQueue;if(null!==a&&(a=a.lastEffect,null!==a)){var d=a.next;Da(97<c?97:c,function(){var a=d;do{var c=a.destroy;if(void 0!==c){var g=b;try{c()}catch(h){Za(g,
h)}}a=a.next}while(a!==d)})}break;case 1:zh(b);c=b.stateNode;"function"===typeof c.componentWillUnmount&&mj(b,c);break;case 5:zh(b);break;case 4:Dh(a,b,c)}}function Eh(a){var b=a.alternate;a.return=null;a.child=null;a.memoizedState=null;a.updateQueue=null;a.dependencies=null;a.alternate=null;a.firstEffect=null;a.lastEffect=null;a.pendingProps=null;a.memoizedProps=null;a.stateNode=null;null!==b&&Eh(b)}function Fh(a){return 5===a.tag||3===a.tag||4===a.tag}function Gh(a){a:{for(var b=a.return;null!==
b;){if(Fh(b)){var c=b;break a}b=b.return}throw Error(k(160));}b=c.stateNode;switch(c.tag){case 5:var d=!1;break;case 3:b=b.containerInfo;d=!0;break;case 4:b=b.containerInfo;d=!0;break;default:throw Error(k(161));}c.effectTag&16&&(Wb(b,""),c.effectTag&=-17);a:b:for(c=a;;){for(;null===c.sibling;){if(null===c.return||Fh(c.return)){c=null;break a}c=c.return}c.sibling.return=c.return;for(c=c.sibling;5!==c.tag&&6!==c.tag&&18!==c.tag;){if(c.effectTag&2)continue b;if(null===c.child||4===c.tag)continue b;
else c.child.return=c,c=c.child}if(!(c.effectTag&2)){c=c.stateNode;break a}}d?Oe(a,c,b):Pe(a,c,b)}function Oe(a,b,c){var d=a.tag,e=5===d||6===d;if(e)a=e?a.stateNode:a.stateNode.instance,b?8===c.nodeType?c.parentNode.insertBefore(a,b):c.insertBefore(a,b):(8===c.nodeType?(b=c.parentNode,b.insertBefore(a,c)):(b=c,b.appendChild(a)),c=c._reactRootContainer,null!==c&&void 0!==c||null!==b.onclick||(b.onclick=uc));else if(4!==d&&(a=a.child,null!==a))for(Oe(a,b,c),a=a.sibling;null!==a;)Oe(a,b,c),a=a.sibling}
function Pe(a,b,c){var d=a.tag,e=5===d||6===d;if(e)a=e?a.stateNode:a.stateNode.instance,b?c.insertBefore(a,b):c.appendChild(a);else if(4!==d&&(a=a.child,null!==a))for(Pe(a,b,c),a=a.sibling;null!==a;)Pe(a,b,c),a=a.sibling}function Dh(a,b,c){for(var d=b,e=!1,f,g;;){if(!e){e=d.return;a:for(;;){if(null===e)throw Error(k(160));f=e.stateNode;switch(e.tag){case 5:g=!1;break a;case 3:f=f.containerInfo;g=!0;break a;case 4:f=f.containerInfo;g=!0;break a}e=e.return}e=!0}if(5===d.tag||6===d.tag){a:for(var h=
a,m=d,n=c,l=m;;)if(Ch(h,l,n),null!==l.child&&4!==l.tag)l.child.return=l,l=l.child;else{if(l===m)break a;for(;null===l.sibling;){if(null===l.return||l.return===m)break a;l=l.return}l.sibling.return=l.return;l=l.sibling}g?(h=f,m=d.stateNode,8===h.nodeType?h.parentNode.removeChild(m):h.removeChild(m)):f.removeChild(d.stateNode)}else if(4===d.tag){if(null!==d.child){f=d.stateNode.containerInfo;g=!0;d.child.return=d;d=d.child;continue}}else if(Ch(a,d,c),null!==d.child){d.child.return=d;d=d.child;continue}if(d===
b)break;for(;null===d.sibling;){if(null===d.return||d.return===b)return;d=d.return;4===d.tag&&(e=!1)}d.sibling.return=d.return;d=d.sibling}}function Qe(a,b){switch(b.tag){case 0:case 11:case 14:case 15:case 22:Ah(3,b);return;case 1:return;case 5:var c=b.stateNode;if(null!=c){var d=b.memoizedProps,e=null!==a?a.memoizedProps:d;a=b.type;var f=b.updateQueue;b.updateQueue=null;if(null!==f){c[vc]=d;"input"===a&&"radio"===d.type&&null!=d.name&&If(c,d);Vd(a,e);b=Vd(a,d);for(e=0;e<f.length;e+=2){var g=f[e],
h=f[e+1];"style"===g?gg(c,h):"dangerouslySetInnerHTML"===g?xh(c,h):"children"===g?Wb(c,h):xd(c,g,h,b)}switch(a){case "input":Dd(c,d);break;case "textarea":Lf(c,d);break;case "select":b=c._wrapperState.wasMultiple,c._wrapperState.wasMultiple=!!d.multiple,a=d.value,null!=a?hb(c,!!d.multiple,a,!1):b!==!!d.multiple&&(null!=d.defaultValue?hb(c,!!d.multiple,d.defaultValue,!0):hb(c,!!d.multiple,d.multiple?[]:"",!1))}}}return;case 6:if(null===b.stateNode)throw Error(k(162));b.stateNode.nodeValue=b.memoizedProps;
return;case 3:b=b.stateNode;b.hydrate&&(b.hydrate=!1,bg(b.containerInfo));return;case 12:return;case 13:c=b;null===b.memoizedState?d=!1:(d=!0,c=b.child,Re=Y());if(null!==c)a:for(a=c;;){if(5===a.tag)f=a.stateNode,d?(f=f.style,"function"===typeof f.setProperty?f.setProperty("display","none","important"):f.display="none"):(f=a.stateNode,e=a.memoizedProps.style,e=void 0!==e&&null!==e&&e.hasOwnProperty("display")?e.display:null,f.style.display=fg("display",e));else if(6===a.tag)a.stateNode.nodeValue=d?
"":a.memoizedProps;else if(13===a.tag&&null!==a.memoizedState&&null===a.memoizedState.dehydrated){f=a.child.sibling;f.return=a;a=f;continue}else if(null!==a.child){a.child.return=a;a=a.child;continue}if(a===c)break;for(;null===a.sibling;){if(null===a.return||a.return===c)break a;a=a.return}a.sibling.return=a.return;a=a.sibling}Hh(b);return;case 19:Hh(b);return;case 17:return}throw Error(k(163));}function Hh(a){var b=a.updateQueue;if(null!==b){a.updateQueue=null;var c=a.stateNode;null===c&&(c=a.stateNode=
new pj);b.forEach(function(b){var d=qj.bind(null,a,b);c.has(b)||(c.add(b),b.then(d,d))})}}function Ih(a,b,c){c=Ea(c,null);c.tag=3;c.payload={element:null};var d=b.value;c.callback=function(){cd||(cd=!0,Se=d);Me(a,b)};return c}function Jh(a,b,c){c=Ea(c,null);c.tag=3;var d=a.type.getDerivedStateFromError;if("function"===typeof d){var e=b.value;c.payload=function(){Me(a,b);return d(e)}}var f=a.stateNode;null!==f&&"function"===typeof f.componentDidCatch&&(c.callback=function(){"function"!==typeof d&&
(null===La?La=new Set([this]):La.add(this),Me(a,b));var c=b.stack;this.componentDidCatch(b.value,{componentStack:null!==c?c:""})});return c}function ka(){return(p&(ca|ma))!==H?1073741821-(Y()/10|0):0!==dd?dd:dd=1073741821-(Y()/10|0)}function Va(a,b,c){b=b.mode;if(0===(b&2))return 1073741823;var d=Cc();if(0===(b&4))return 99===d?1073741823:1073741822;if((p&ca)!==H)return P;if(null!==c)a=Fc(a,c.timeoutMs|0||5E3,250);else switch(d){case 99:a=1073741823;break;case 98:a=Fc(a,150,100);break;case 97:case 96:a=
Fc(a,5E3,250);break;case 95:a=2;break;default:throw Error(k(326));}null!==U&&a===P&&--a;return a}function ed(a,b){a.expirationTime<b&&(a.expirationTime=b);var c=a.alternate;null!==c&&c.expirationTime<b&&(c.expirationTime=b);var d=a.return,e=null;if(null===d&&3===a.tag)e=a.stateNode;else for(;null!==d;){c=d.alternate;d.childExpirationTime<b&&(d.childExpirationTime=b);null!==c&&c.childExpirationTime<b&&(c.childExpirationTime=b);if(null===d.return&&3===d.tag){e=d.stateNode;break}d=d.return}null!==e&&
(U===e&&(Kc(b),F===bd&&Ya(e,P)),yh(e,b));return e}function fd(a){var b=a.lastExpiredTime;if(0!==b)return b;b=a.firstPendingTime;if(!Kh(a,b))return b;var c=a.lastPingedTime;a=a.nextKnownPendingLevel;a=c>a?c:a;return 2>=a&&b!==a?0:a}function V(a){if(0!==a.lastExpiredTime)a.callbackExpirationTime=1073741823,a.callbackPriority=99,a.callbackNode=Og(Te.bind(null,a));else{var b=fd(a),c=a.callbackNode;if(0===b)null!==c&&(a.callbackNode=null,a.callbackExpirationTime=0,a.callbackPriority=90);else{var d=ka();
1073741823===b?d=99:1===b||2===b?d=95:(d=10*(1073741821-b)-10*(1073741821-d),d=0>=d?99:250>=d?98:5250>=d?97:95);if(null!==c){var e=a.callbackPriority;if(a.callbackExpirationTime===b&&e>=d)return;c!==Qg&&Rg(c)}a.callbackExpirationTime=b;a.callbackPriority=d;b=1073741823===b?Og(Te.bind(null,a)):Ng(d,Lh.bind(null,a),{timeout:10*(1073741821-b)-Y()});a.callbackNode=b}}}function Lh(a,b){dd=0;if(b)return b=ka(),Ue(a,b),V(a),null;var c=fd(a);if(0!==c){b=a.callbackNode;if((p&(ca|ma))!==H)throw Error(k(327));
xb();a===U&&c===P||$a(a,c);if(null!==t){var d=p;p|=ca;var e=Mh();do try{rj();break}catch(h){Nh(a,h)}while(1);le();p=d;gd.current=e;if(F===hd)throw b=id,$a(a,c),Ya(a,c),V(a),b;if(null===t)switch(e=a.finishedWork=a.current.alternate,a.finishedExpirationTime=c,d=F,U=null,d){case Xa:case hd:throw Error(k(345));case Oh:Ue(a,2<c?2:c);break;case ad:Ya(a,c);d=a.lastSuspendedTime;c===d&&(a.nextKnownPendingLevel=Ve(e));if(1073741823===ta&&(e=Re+Ph-Y(),10<e)){if(jd){var f=a.lastPingedTime;if(0===f||f>=c){a.lastPingedTime=
c;$a(a,c);break}}f=fd(a);if(0!==f&&f!==c)break;if(0!==d&&d!==c){a.lastPingedTime=d;break}a.timeoutHandle=We(ab.bind(null,a),e);break}ab(a);break;case bd:Ya(a,c);d=a.lastSuspendedTime;c===d&&(a.nextKnownPendingLevel=Ve(e));if(jd&&(e=a.lastPingedTime,0===e||e>=c)){a.lastPingedTime=c;$a(a,c);break}e=fd(a);if(0!==e&&e!==c)break;if(0!==d&&d!==c){a.lastPingedTime=d;break}1073741823!==Yb?d=10*(1073741821-Yb)-Y():1073741823===ta?d=0:(d=10*(1073741821-ta)-5E3,e=Y(),c=10*(1073741821-c)-e,d=e-d,0>d&&(d=0),d=
(120>d?120:480>d?480:1080>d?1080:1920>d?1920:3E3>d?3E3:4320>d?4320:1960*sj(d/1960))-d,c<d&&(d=c));if(10<d){a.timeoutHandle=We(ab.bind(null,a),d);break}ab(a);break;case Xe:if(1073741823!==ta&&null!==kd){f=ta;var g=kd;d=g.busyMinDurationMs|0;0>=d?d=0:(e=g.busyDelayMs|0,f=Y()-(10*(1073741821-f)-(g.timeoutMs|0||5E3)),d=f<=e?0:e+d-f);if(10<d){Ya(a,c);a.timeoutHandle=We(ab.bind(null,a),d);break}}ab(a);break;default:throw Error(k(329));}V(a);if(a.callbackNode===b)return Lh.bind(null,a)}}return null}function Te(a){var b=
a.lastExpiredTime;b=0!==b?b:1073741823;if((p&(ca|ma))!==H)throw Error(k(327));xb();a===U&&b===P||$a(a,b);if(null!==t){var c=p;p|=ca;var d=Mh();do try{tj();break}catch(e){Nh(a,e)}while(1);le();p=c;gd.current=d;if(F===hd)throw c=id,$a(a,b),Ya(a,b),V(a),c;if(null!==t)throw Error(k(261));a.finishedWork=a.current.alternate;a.finishedExpirationTime=b;U=null;ab(a);V(a)}return null}function uj(){if(null!==bb){var a=bb;bb=null;a.forEach(function(a,c){Ue(c,a);V(c)});ha()}}function Qh(a,b){var c=p;p|=1;try{return a(b)}finally{p=
c,p===H&&ha()}}function Rh(a,b){var c=p;p&=-2;p|=Ye;try{return a(b)}finally{p=c,p===H&&ha()}}function $a(a,b){a.finishedWork=null;a.finishedExpirationTime=0;var c=a.timeoutHandle;-1!==c&&(a.timeoutHandle=-1,vj(c));if(null!==t)for(c=t.return;null!==c;){var d=c;switch(d.tag){case 1:d=d.type.childContextTypes;null!==d&&void 0!==d&&(q(G),q(B));break;case 3:tb();q(G);q(B);break;case 5:te(d);break;case 4:tb();break;case 13:q(D);break;case 19:q(D);break;case 10:me(d)}c=c.return}U=a;t=Sa(a.current,null);
P=b;F=Xa;id=null;Yb=ta=1073741823;kd=null;Xb=0;jd=!1}function Nh(a,b){do{try{le();Sc.current=Tc;if(Uc)for(var c=z.memoizedState;null!==c;){var d=c.queue;null!==d&&(d.pending=null);c=c.next}Ia=0;J=K=z=null;Uc=!1;if(null===t||null===t.return)return F=hd,id=b,t=null;a:{var e=a,f=t.return,g=t,h=b;b=P;g.effectTag|=2048;g.firstEffect=g.lastEffect=null;if(null!==h&&"object"===typeof h&&"function"===typeof h.then){var m=h;if(0===(g.mode&2)){var n=g.alternate;n?(g.updateQueue=n.updateQueue,g.memoizedState=
n.memoizedState,g.expirationTime=n.expirationTime):(g.updateQueue=null,g.memoizedState=null)}var l=0!==(D.current&1),k=f;do{var p;if(p=13===k.tag){var q=k.memoizedState;if(null!==q)p=null!==q.dehydrated?!0:!1;else{var w=k.memoizedProps;p=void 0===w.fallback?!1:!0!==w.unstable_avoidThisFallback?!0:l?!1:!0}}if(p){var y=k.updateQueue;if(null===y){var r=new Set;r.add(m);k.updateQueue=r}else y.add(m);if(0===(k.mode&2)){k.effectTag|=64;g.effectTag&=-2981;if(1===g.tag)if(null===g.alternate)g.tag=17;else{var O=
Ea(1073741823,null);O.tag=Jc;Fa(g,O)}g.expirationTime=1073741823;break a}h=void 0;g=b;var v=e.pingCache;null===v?(v=e.pingCache=new wj,h=new Set,v.set(m,h)):(h=v.get(m),void 0===h&&(h=new Set,v.set(m,h)));if(!h.has(g)){h.add(g);var x=xj.bind(null,e,m,g);m.then(x,x)}k.effectTag|=4096;k.expirationTime=b;break a}k=k.return}while(null!==k);h=Error((na(g.type)||"A React component")+" suspended while rendering, but no fallback UI was specified.\n\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display."+
Bd(g))}F!==Xe&&(F=Oh);h=Le(h,g);k=f;do{switch(k.tag){case 3:m=h;k.effectTag|=4096;k.expirationTime=b;var A=Ih(k,m,b);Ug(k,A);break a;case 1:m=h;var u=k.type,B=k.stateNode;if(0===(k.effectTag&64)&&("function"===typeof u.getDerivedStateFromError||null!==B&&"function"===typeof B.componentDidCatch&&(null===La||!La.has(B)))){k.effectTag|=4096;k.expirationTime=b;var H=Jh(k,m,b);Ug(k,H);break a}}k=k.return}while(null!==k)}t=Sh(t)}catch(cj){b=cj;continue}break}while(1)}function Mh(a){a=gd.current;gd.current=
Tc;return null===a?Tc:a}function Vg(a,b){a<ta&&2<a&&(ta=a);null!==b&&a<Yb&&2<a&&(Yb=a,kd=b)}function Kc(a){a>Xb&&(Xb=a)}function tj(){for(;null!==t;)t=Th(t)}function rj(){for(;null!==t&&!yj();)t=Th(t)}function Th(a){var b=zj(a.alternate,a,P);a.memoizedProps=a.pendingProps;null===b&&(b=Sh(a));Uh.current=null;return b}function Sh(a){t=a;do{var b=t.alternate;a=t.return;if(0===(t.effectTag&2048)){b=hj(b,t,P);if(1===P||1!==t.childExpirationTime){for(var c=0,d=t.child;null!==d;){var e=d.expirationTime,
f=d.childExpirationTime;e>c&&(c=e);f>c&&(c=f);d=d.sibling}t.childExpirationTime=c}if(null!==b)return b;null!==a&&0===(a.effectTag&2048)&&(null===a.firstEffect&&(a.firstEffect=t.firstEffect),null!==t.lastEffect&&(null!==a.lastEffect&&(a.lastEffect.nextEffect=t.firstEffect),a.lastEffect=t.lastEffect),1<t.effectTag&&(null!==a.lastEffect?a.lastEffect.nextEffect=t:a.firstEffect=t,a.lastEffect=t))}else{b=lj(t);if(null!==b)return b.effectTag&=2047,b;null!==a&&(a.firstEffect=a.lastEffect=null,a.effectTag|=
2048)}b=t.sibling;if(null!==b)return b;t=a}while(null!==t);F===Xa&&(F=Xe);return null}function Ve(a){var b=a.expirationTime;a=a.childExpirationTime;return b>a?b:a}function ab(a){var b=Cc();Da(99,Aj.bind(null,a,b));return null}function Aj(a,b){do xb();while(null!==Zb);if((p&(ca|ma))!==H)throw Error(k(327));var c=a.finishedWork,d=a.finishedExpirationTime;if(null===c)return null;a.finishedWork=null;a.finishedExpirationTime=0;if(c===a.current)throw Error(k(177));a.callbackNode=null;a.callbackExpirationTime=
0;a.callbackPriority=90;a.nextKnownPendingLevel=0;var e=Ve(c);a.firstPendingTime=e;d<=a.lastSuspendedTime?a.firstSuspendedTime=a.lastSuspendedTime=a.nextKnownPendingLevel=0:d<=a.firstSuspendedTime&&(a.firstSuspendedTime=d-1);d<=a.lastPingedTime&&(a.lastPingedTime=0);d<=a.lastExpiredTime&&(a.lastExpiredTime=0);a===U&&(t=U=null,P=0);1<c.effectTag?null!==c.lastEffect?(c.lastEffect.nextEffect=c,e=c.firstEffect):e=c:e=c.firstEffect;if(null!==e){var f=p;p|=ma;Uh.current=null;Ze=tc;var g=kg();if(Xd(g)){if("selectionStart"in
g)var h={start:g.selectionStart,end:g.selectionEnd};else a:{h=(h=g.ownerDocument)&&h.defaultView||window;var m=h.getSelection&&h.getSelection();if(m&&0!==m.rangeCount){h=m.anchorNode;var n=m.anchorOffset,q=m.focusNode;m=m.focusOffset;try{h.nodeType,q.nodeType}catch(sb){h=null;break a}var ba=0,w=-1,y=-1,B=0,D=0,r=g,z=null;b:for(;;){for(var v;;){r!==h||0!==n&&3!==r.nodeType||(w=ba+n);r!==q||0!==m&&3!==r.nodeType||(y=ba+m);3===r.nodeType&&(ba+=r.nodeValue.length);if(null===(v=r.firstChild))break;z=r;
r=v}for(;;){if(r===g)break b;z===h&&++B===n&&(w=ba);z===q&&++D===m&&(y=ba);if(null!==(v=r.nextSibling))break;r=z;z=r.parentNode}r=v}h=-1===w||-1===y?null:{start:w,end:y}}else h=null}h=h||{start:0,end:0}}else h=null;$e={activeElementDetached:null,focusedElem:g,selectionRange:h};tc=!1;l=e;do try{Bj()}catch(sb){if(null===l)throw Error(k(330));Za(l,sb);l=l.nextEffect}while(null!==l);l=e;do try{for(g=a,h=b;null!==l;){var x=l.effectTag;x&16&&Wb(l.stateNode,"");if(x&128){var A=l.alternate;if(null!==A){var u=
A.ref;null!==u&&("function"===typeof u?u(null):u.current=null)}}switch(x&1038){case 2:Gh(l);l.effectTag&=-3;break;case 6:Gh(l);l.effectTag&=-3;Qe(l.alternate,l);break;case 1024:l.effectTag&=-1025;break;case 1028:l.effectTag&=-1025;Qe(l.alternate,l);break;case 4:Qe(l.alternate,l);break;case 8:n=l,Dh(g,n,h),Eh(n)}l=l.nextEffect}}catch(sb){if(null===l)throw Error(k(330));Za(l,sb);l=l.nextEffect}while(null!==l);u=$e;A=kg();x=u.focusedElem;h=u.selectionRange;if(A!==x&&x&&x.ownerDocument&&jg(x.ownerDocument.documentElement,
x)){null!==h&&Xd(x)&&(A=h.start,u=h.end,void 0===u&&(u=A),"selectionStart"in x?(x.selectionStart=A,x.selectionEnd=Math.min(u,x.value.length)):(u=(A=x.ownerDocument||document)&&A.defaultView||window,u.getSelection&&(u=u.getSelection(),n=x.textContent.length,g=Math.min(h.start,n),h=void 0===h.end?g:Math.min(h.end,n),!u.extend&&g>h&&(n=h,h=g,g=n),n=ig(x,g),q=ig(x,h),n&&q&&(1!==u.rangeCount||u.anchorNode!==n.node||u.anchorOffset!==n.offset||u.focusNode!==q.node||u.focusOffset!==q.offset)&&(A=A.createRange(),
A.setStart(n.node,n.offset),u.removeAllRanges(),g>h?(u.addRange(A),u.extend(q.node,q.offset)):(A.setEnd(q.node,q.offset),u.addRange(A))))));A=[];for(u=x;u=u.parentNode;)1===u.nodeType&&A.push({element:u,left:u.scrollLeft,top:u.scrollTop});"function"===typeof x.focus&&x.focus();for(x=0;x<A.length;x++)u=A[x],u.element.scrollLeft=u.left,u.element.scrollTop=u.top}tc=!!Ze;$e=Ze=null;a.current=c;l=e;do try{for(x=a;null!==l;){var F=l.effectTag;F&36&&oj(x,l.alternate,l);if(F&128){A=void 0;var E=l.ref;if(null!==
E){var G=l.stateNode;switch(l.tag){case 5:A=G;break;default:A=G}"function"===typeof E?E(A):E.current=A}}l=l.nextEffect}}catch(sb){if(null===l)throw Error(k(330));Za(l,sb);l=l.nextEffect}while(null!==l);l=null;Cj();p=f}else a.current=c;if(ld)ld=!1,Zb=a,$b=b;else for(l=e;null!==l;)b=l.nextEffect,l.nextEffect=null,l=b;b=a.firstPendingTime;0===b&&(La=null);1073741823===b?a===af?ac++:(ac=0,af=a):ac=0;"function"===typeof bf&&bf(c.stateNode,d);V(a);if(cd)throw cd=!1,a=Se,Se=null,a;if((p&Ye)!==H)return null;
ha();return null}function Bj(){for(;null!==l;){var a=l.effectTag;0!==(a&256)&&nj(l.alternate,l);0===(a&512)||ld||(ld=!0,Ng(97,function(){xb();return null}));l=l.nextEffect}}function xb(){if(90!==$b){var a=97<$b?97:$b;$b=90;return Da(a,Dj)}}function Dj(){if(null===Zb)return!1;var a=Zb;Zb=null;if((p&(ca|ma))!==H)throw Error(k(331));var b=p;p|=ma;for(a=a.current.firstEffect;null!==a;){try{var c=a;if(0!==(c.effectTag&512))switch(c.tag){case 0:case 11:case 15:case 22:Ah(5,c),Bh(5,c)}}catch(d){if(null===
a)throw Error(k(330));Za(a,d)}c=a.nextEffect;a.nextEffect=null;a=c}p=b;ha();return!0}function Vh(a,b,c){b=Le(c,b);b=Ih(a,b,1073741823);Fa(a,b);a=ed(a,1073741823);null!==a&&V(a)}function Za(a,b){if(3===a.tag)Vh(a,a,b);else for(var c=a.return;null!==c;){if(3===c.tag){Vh(c,a,b);break}else if(1===c.tag){var d=c.stateNode;if("function"===typeof c.type.getDerivedStateFromError||"function"===typeof d.componentDidCatch&&(null===La||!La.has(d))){a=Le(b,a);a=Jh(c,a,1073741823);Fa(c,a);c=ed(c,1073741823);null!==
c&&V(c);break}}c=c.return}}function xj(a,b,c){var d=a.pingCache;null!==d&&d.delete(b);U===a&&P===c?F===bd||F===ad&&1073741823===ta&&Y()-Re<Ph?$a(a,P):jd=!0:Kh(a,c)&&(b=a.lastPingedTime,0!==b&&b<c||(a.lastPingedTime=c,V(a)))}function qj(a,b){var c=a.stateNode;null!==c&&c.delete(b);b=0;0===b&&(b=ka(),b=Va(b,a,null));a=ed(a,b);null!==a&&V(a)}function Ej(a){if("undefined"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)return!1;var b=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(b.isDisabled||!b.supportsFiber)return!0;try{var c=
b.inject(a);bf=function(a,e){try{b.onCommitFiberRoot(c,a,void 0,64===(a.current.effectTag&64))}catch(f){}};Ne=function(a){try{b.onCommitFiberUnmount(c,a)}catch(e){}}}catch(d){}return!0}function Fj(a,b,c,d){this.tag=a;this.key=c;this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null;this.index=0;this.ref=null;this.pendingProps=b;this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null;this.mode=d;this.effectTag=0;this.lastEffect=this.firstEffect=this.nextEffect=
null;this.childExpirationTime=this.expirationTime=0;this.alternate=null}function Ge(a){a=a.prototype;return!(!a||!a.isReactComponent)}function Gj(a){if("function"===typeof a)return Ge(a)?1:0;if(void 0!==a&&null!==a){a=a.$$typeof;if(a===zd)return 11;if(a===Ad)return 14}return 2}function Sa(a,b){var c=a.alternate;null===c?(c=la(a.tag,b,a.key,a.mode),c.elementType=a.elementType,c.type=a.type,c.stateNode=a.stateNode,c.alternate=a,a.alternate=c):(c.pendingProps=b,c.effectTag=0,c.nextEffect=null,c.firstEffect=
null,c.lastEffect=null);c.childExpirationTime=a.childExpirationTime;c.expirationTime=a.expirationTime;c.child=a.child;c.memoizedProps=a.memoizedProps;c.memoizedState=a.memoizedState;c.updateQueue=a.updateQueue;b=a.dependencies;c.dependencies=null===b?null:{expirationTime:b.expirationTime,firstContext:b.firstContext,responders:b.responders};c.sibling=a.sibling;c.index=a.index;c.ref=a.ref;return c}function Oc(a,b,c,d,e,f){var g=2;d=a;if("function"===typeof a)Ge(a)&&(g=1);else if("string"===typeof a)g=
5;else a:switch(a){case Ma:return Ha(c.children,e,f,b);case Hj:g=8;e|=7;break;case Af:g=8;e|=1;break;case kc:return a=la(12,c,b,e|8),a.elementType=kc,a.type=kc,a.expirationTime=f,a;case lc:return a=la(13,c,b,e),a.type=lc,a.elementType=lc,a.expirationTime=f,a;case yd:return a=la(19,c,b,e),a.elementType=yd,a.expirationTime=f,a;default:if("object"===typeof a&&null!==a)switch(a.$$typeof){case Cf:g=10;break a;case Bf:g=9;break a;case zd:g=11;break a;case Ad:g=14;break a;case Ef:g=16;d=null;break a;case Df:g=
22;break a}throw Error(k(130,null==a?a:typeof a,""));}b=la(g,c,b,e);b.elementType=a;b.type=d;b.expirationTime=f;return b}function Ha(a,b,c,d){a=la(7,a,d,b);a.expirationTime=c;return a}function qe(a,b,c){a=la(6,a,null,b);a.expirationTime=c;return a}function re(a,b,c){b=la(4,null!==a.children?a.children:[],a.key,b);b.expirationTime=c;b.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation};return b}function Ij(a,b,c){this.tag=b;this.current=null;this.containerInfo=
a;this.pingCache=this.pendingChildren=null;this.finishedExpirationTime=0;this.finishedWork=null;this.timeoutHandle=-1;this.pendingContext=this.context=null;this.hydrate=c;this.callbackNode=null;this.callbackPriority=90;this.lastExpiredTime=this.lastPingedTime=this.nextKnownPendingLevel=this.lastSuspendedTime=this.firstSuspendedTime=this.firstPendingTime=0}function Kh(a,b){var c=a.firstSuspendedTime;a=a.lastSuspendedTime;return 0!==c&&c>=b&&a<=b}function Ya(a,b){var c=a.firstSuspendedTime,d=a.lastSuspendedTime;
c<b&&(a.firstSuspendedTime=b);if(d>b||0===c)a.lastSuspendedTime=b;b<=a.lastPingedTime&&(a.lastPingedTime=0);b<=a.lastExpiredTime&&(a.lastExpiredTime=0)}function yh(a,b){b>a.firstPendingTime&&(a.firstPendingTime=b);var c=a.firstSuspendedTime;0!==c&&(b>=c?a.firstSuspendedTime=a.lastSuspendedTime=a.nextKnownPendingLevel=0:b>=a.lastSuspendedTime&&(a.lastSuspendedTime=b+1),b>a.nextKnownPendingLevel&&(a.nextKnownPendingLevel=b))}function Ue(a,b){var c=a.lastExpiredTime;if(0===c||c>b)a.lastExpiredTime=b}
function md(a,b,c,d){var e=b.current,f=ka(),g=Vb.suspense;f=Va(f,e,g);a:if(c){c=c._reactInternalFiber;b:{if(Na(c)!==c||1!==c.tag)throw Error(k(170));var h=c;do{switch(h.tag){case 3:h=h.stateNode.context;break b;case 1:if(N(h.type)){h=h.stateNode.__reactInternalMemoizedMergedChildContext;break b}}h=h.return}while(null!==h);throw Error(k(171));}if(1===c.tag){var m=c.type;if(N(m)){c=Gg(c,m,h);break a}}c=h}else c=Ca;null===b.context?b.context=c:b.pendingContext=c;b=Ea(f,g);b.payload={element:a};d=void 0===
d?null:d;null!==d&&(b.callback=d);Fa(e,b);Ja(e,f);return f}function cf(a){a=a.current;if(!a.child)return null;switch(a.child.tag){case 5:return a.child.stateNode;default:return a.child.stateNode}}function Wh(a,b){a=a.memoizedState;null!==a&&null!==a.dehydrated&&a.retryTime<b&&(a.retryTime=b)}function df(a,b){Wh(a,b);(a=a.alternate)&&Wh(a,b)}function ef(a,b,c){c=null!=c&&!0===c.hydrate;var d=new Ij(a,b,c),e=la(3,null,null,2===b?7:1===b?3:0);d.current=e;e.stateNode=d;ne(e);a[Lb]=d.current;c&&0!==b&&
xi(a,9===a.nodeType?a:a.ownerDocument);this._internalRoot=d}function bc(a){return!(!a||1!==a.nodeType&&9!==a.nodeType&&11!==a.nodeType&&(8!==a.nodeType||" react-mount-point-unstable "!==a.nodeValue))}function Jj(a,b){b||(b=a?9===a.nodeType?a.documentElement:a.firstChild:null,b=!(!b||1!==b.nodeType||!b.hasAttribute("data-reactroot")));if(!b)for(var c;c=a.lastChild;)a.removeChild(c);return new ef(a,0,b?{hydrate:!0}:void 0)}function nd(a,b,c,d,e){var f=c._reactRootContainer;if(f){var g=f._internalRoot;
if("function"===typeof e){var h=e;e=function(){var a=cf(g);h.call(a)}}md(b,g,a,e)}else{f=c._reactRootContainer=Jj(c,d);g=f._internalRoot;if("function"===typeof e){var m=e;e=function(){var a=cf(g);m.call(a)}}Rh(function(){md(b,g,a,e)})}return cf(g)}function Kj(a,b,c){var d=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:gb,key:null==d?null:""+d,children:a,containerInfo:b,implementation:c}}function Xh(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;
if(!bc(b))throw Error(k(200));return Kj(a,b,null,c)}if(!ea)throw Error(k(227));var ki=function(a,b,c,d,e,f,g,h,m){var n=Array.prototype.slice.call(arguments,3);try{b.apply(c,n)}catch(C){this.onError(C)}},yb=!1,gc=null,hc=!1,pd=null,li={onError:function(a){yb=!0;gc=a}},td=null,rf=null,mf=null,ic=null,cb={},jc=[],qd={},db={},rd={},wa=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),M=ea.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.assign,
sd=null,eb=null,fb=null,ee=function(a,b){return a(b)},eg=function(a,b,c,d,e){return a(b,c,d,e)},vd=function(){},vf=ee,Oa=!1,wd=!1,Z=ea.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.Scheduler,Lj=Z.unstable_cancelCallback,ff=Z.unstable_now,$f=Z.unstable_scheduleCallback,Mj=Z.unstable_shouldYield,Yh=Z.unstable_requestPaint,Pd=Z.unstable_runWithPriority,Nj=Z.unstable_getCurrentPriorityLevel,Oj=Z.unstable_ImmediatePriority,Zh=Z.unstable_UserBlockingPriority,ag=Z.unstable_NormalPriority,Pj=Z.unstable_LowPriority,
Qj=Z.unstable_IdlePriority,oi=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,wf=Object.prototype.hasOwnProperty,yf={},xf={},E={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(a){E[a]=
new L(a,0,!1,a,null,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(a){var b=a[0];E[b]=new L(b,1,!1,a[1],null,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(a){E[a]=new L(a,2,!1,a.toLowerCase(),null,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(a){E[a]=new L(a,2,!1,a,null,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(a){E[a]=
new L(a,3,!1,a.toLowerCase(),null,!1)});["checked","multiple","muted","selected"].forEach(function(a){E[a]=new L(a,3,!0,a,null,!1)});["capture","download"].forEach(function(a){E[a]=new L(a,4,!1,a,null,!1)});["cols","rows","size","span"].forEach(function(a){E[a]=new L(a,6,!1,a,null,!1)});["rowSpan","start"].forEach(function(a){E[a]=new L(a,5,!1,a.toLowerCase(),null,!1)});var gf=/[\-:]([a-z])/g,hf=function(a){return a[1].toUpperCase()};"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(a){var b=
a.replace(gf,hf);E[b]=new L(b,1,!1,a,null,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(a){var b=a.replace(gf,hf);E[b]=new L(b,1,!1,a,"http://www.w3.org/1999/xlink",!1)});["xml:base","xml:lang","xml:space"].forEach(function(a){var b=a.replace(gf,hf);E[b]=new L(b,1,!1,a,"http://www.w3.org/XML/1998/namespace",!1)});["tabIndex","crossOrigin"].forEach(function(a){E[a]=new L(a,1,!1,a.toLowerCase(),null,!1)});E.xlinkHref=new L("xlinkHref",1,
!1,"xlink:href","http://www.w3.org/1999/xlink",!0);["src","href","action","formAction"].forEach(function(a){E[a]=new L(a,1,!1,a.toLowerCase(),null,!0)});var da=ea.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;da.hasOwnProperty("ReactCurrentDispatcher")||(da.ReactCurrentDispatcher={current:null});da.hasOwnProperty("ReactCurrentBatchConfig")||(da.ReactCurrentBatchConfig={suspense:null});var si=/^(.*)[\\\/]/,Q="function"===typeof Symbol&&Symbol.for,Pc=Q?Symbol.for("react.element"):60103,gb=Q?Symbol.for("react.portal"):
60106,Ma=Q?Symbol.for("react.fragment"):60107,Af=Q?Symbol.for("react.strict_mode"):60108,kc=Q?Symbol.for("react.profiler"):60114,Cf=Q?Symbol.for("react.provider"):60109,Bf=Q?Symbol.for("react.context"):60110,Hj=Q?Symbol.for("react.concurrent_mode"):60111,zd=Q?Symbol.for("react.forward_ref"):60112,lc=Q?Symbol.for("react.suspense"):60113,yd=Q?Symbol.for("react.suspense_list"):60120,Ad=Q?Symbol.for("react.memo"):60115,Ef=Q?Symbol.for("react.lazy"):60116,Df=Q?Symbol.for("react.block"):60121,zf="function"===
typeof Symbol&&Symbol.iterator,od,xh=function(a){return"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(b,c,d,e){MSApp.execUnsafeLocalFunction(function(){return a(b,c,d,e)})}:a}(function(a,b){if("http://www.w3.org/2000/svg"!==a.namespaceURI||"innerHTML"in a)a.innerHTML=b;else{od=od||document.createElement("div");od.innerHTML="<svg>"+b.valueOf().toString()+"</svg>";for(b=od.firstChild;a.firstChild;)a.removeChild(a.firstChild);for(;b.firstChild;)a.appendChild(b.firstChild)}}),Wb=function(a,
b){if(b){var c=a.firstChild;if(c&&c===a.lastChild&&3===c.nodeType){c.nodeValue=b;return}}a.textContent=b},ib={animationend:nc("Animation","AnimationEnd"),animationiteration:nc("Animation","AnimationIteration"),animationstart:nc("Animation","AnimationStart"),transitionend:nc("Transition","TransitionEnd")},Id={},Of={};wa&&(Of=document.createElement("div").style,"AnimationEvent"in window||(delete ib.animationend.animation,delete ib.animationiteration.animation,delete ib.animationstart.animation),"TransitionEvent"in
window||delete ib.transitionend.transition);var $h=oc("animationend"),ai=oc("animationiteration"),bi=oc("animationstart"),ci=oc("transitionend"),Db="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Pf=new ("function"===typeof WeakMap?WeakMap:Map),Ab=null,wi=function(a){if(a){var b=a._dispatchListeners,c=a._dispatchInstances;
if(Array.isArray(b))for(var d=0;d<b.length&&!a.isPropagationStopped();d++)lf(a,b[d],c[d]);else b&&lf(a,b,c);a._dispatchListeners=null;a._dispatchInstances=null;a.isPersistent()||a.constructor.release(a)}},qc=[],Rd=!1,fa=[],xa=null,ya=null,za=null,Eb=new Map,Fb=new Map,Jb=[],Nd="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput close cancel copy cut paste click change contextmenu reset submit".split(" "),
yi="focus blur dragenter dragleave mouseover mouseout pointerover pointerout gotpointercapture lostpointercapture".split(" "),dg={},cg=new Map,Td=new Map,Rj=["abort","abort",$h,"animationEnd",ai,"animationIteration",bi,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata",
"loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",ci,"transitionEnd","waiting","waiting"];Sd("blur blur cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focus focus input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),
0);Sd("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1);Sd(Rj,2);(function(a,b){for(var c=0;c<a.length;c++)Td.set(a[c],b)})("change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),0);var Hi=Zh,Gi=Pd,tc=!0,Kb={animationIterationCount:!0,
borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,
strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Sj=["Webkit","ms","Moz","O"];Object.keys(Kb).forEach(function(a){Sj.forEach(function(b){b=b+a.charAt(0).toUpperCase()+a.substring(1);Kb[b]=Kb[a]})});var Ii=M({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0}),ng="$",og="/$",$d="$?",Zd="$!",Ze=null,$e=null,We="function"===typeof setTimeout?setTimeout:void 0,vj="function"===
typeof clearTimeout?clearTimeout:void 0,jf=Math.random().toString(36).slice(2),Aa="__reactInternalInstance$"+jf,vc="__reactEventHandlers$"+jf,Lb="__reactContainere$"+jf,Ba=null,ce=null,wc=null;M(R.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():"unknown"!==typeof a.returnValue&&(a.returnValue=!1),this.isDefaultPrevented=xc)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():"unknown"!==
typeof a.cancelBubble&&(a.cancelBubble=!0),this.isPropagationStopped=xc)},persist:function(){this.isPersistent=xc},isPersistent:yc,destructor:function(){var a=this.constructor.Interface,b;for(b in a)this[b]=null;this.nativeEvent=this._targetInst=this.dispatchConfig=null;this.isPropagationStopped=this.isDefaultPrevented=yc;this._dispatchInstances=this._dispatchListeners=null}});R.Interface={type:null,target:null,currentTarget:function(){return null},eventPhase:null,bubbles:null,cancelable:null,timeStamp:function(a){return a.timeStamp||
Date.now()},defaultPrevented:null,isTrusted:null};R.extend=function(a){function b(){return c.apply(this,arguments)}var c=this,d=function(){};d.prototype=c.prototype;d=new d;M(d,b.prototype);b.prototype=d;b.prototype.constructor=b;b.Interface=M({},c.Interface,a);b.extend=c.extend;sg(b);return b};sg(R);var Tj=R.extend({data:null}),Uj=R.extend({data:null}),Ni=[9,13,27,32],de=wa&&"CompositionEvent"in window,cc=null;wa&&"documentMode"in document&&(cc=document.documentMode);var Vj=wa&&"TextEvent"in window&&
!cc,xg=wa&&(!de||cc&&8<cc&&11>=cc),wg=String.fromCharCode(32),ua={beforeInput:{phasedRegistrationNames:{bubbled:"onBeforeInput",captured:"onBeforeInputCapture"},dependencies:["compositionend","keypress","textInput","paste"]},compositionEnd:{phasedRegistrationNames:{bubbled:"onCompositionEnd",captured:"onCompositionEndCapture"},dependencies:"blur compositionend keydown keypress keyup mousedown".split(" ")},compositionStart:{phasedRegistrationNames:{bubbled:"onCompositionStart",captured:"onCompositionStartCapture"},
dependencies:"blur compositionstart keydown keypress keyup mousedown".split(" ")},compositionUpdate:{phasedRegistrationNames:{bubbled:"onCompositionUpdate",captured:"onCompositionUpdateCapture"},dependencies:"blur compositionupdate keydown keypress keyup mousedown".split(" ")}},vg=!1,mb=!1,Wj={eventTypes:ua,extractEvents:function(a,b,c,d,e){var f;if(de)b:{switch(a){case "compositionstart":var g=ua.compositionStart;break b;case "compositionend":g=ua.compositionEnd;break b;case "compositionupdate":g=
ua.compositionUpdate;break b}g=void 0}else mb?tg(a,c)&&(g=ua.compositionEnd):"keydown"===a&&229===c.keyCode&&(g=ua.compositionStart);g?(xg&&"ko"!==c.locale&&(mb||g!==ua.compositionStart?g===ua.compositionEnd&&mb&&(f=rg()):(Ba=d,ce="value"in Ba?Ba.value:Ba.textContent,mb=!0)),e=Tj.getPooled(g,b,c,d),f?e.data=f:(f=ug(c),null!==f&&(e.data=f)),lb(e),f=e):f=null;(a=Vj?Oi(a,c):Pi(a,c))?(b=Uj.getPooled(ua.beforeInput,b,c,d),b.data=a,lb(b)):b=null;return null===f?b:null===b?f:[f,b]}},Qi={color:!0,date:!0,
datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0},Ag={change:{phasedRegistrationNames:{bubbled:"onChange",captured:"onChangeCapture"},dependencies:"blur change click focus input keydown keyup selectionchange".split(" ")}},Mb=null,Nb=null,kf=!1;wa&&(kf=Tf("input")&&(!document.documentMode||9<document.documentMode));var Xj={eventTypes:Ag,_isInputEventSupported:kf,extractEvents:function(a,b,c,d,e){e=b?Pa(b):window;var f=
e.nodeName&&e.nodeName.toLowerCase();if("select"===f||"input"===f&&"file"===e.type)var g=Si;else if(yg(e))if(kf)g=Wi;else{g=Ui;var h=Ti}else(f=e.nodeName)&&"input"===f.toLowerCase()&&("checkbox"===e.type||"radio"===e.type)&&(g=Vi);if(g&&(g=g(a,b)))return zg(g,c,d);h&&h(a,e,b);"blur"===a&&(a=e._wrapperState)&&a.controlled&&"number"===e.type&&Ed(e,"number",e.value)}},dc=R.extend({view:null,detail:null}),Yi={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"},di=0,ei=0,fi=!1,gi=!1,ec=dc.extend({screenX:null,
screenY:null,clientX:null,clientY:null,pageX:null,pageY:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,getModifierState:fe,button:null,buttons:null,relatedTarget:function(a){return a.relatedTarget||(a.fromElement===a.srcElement?a.toElement:a.fromElement)},movementX:function(a){if("movementX"in a)return a.movementX;var b=di;di=a.screenX;return fi?"mousemove"===a.type?a.screenX-b:0:(fi=!0,0)},movementY:function(a){if("movementY"in a)return a.movementY;var b=ei;ei=a.screenY;return gi?"mousemove"===
a.type?a.screenY-b:0:(gi=!0,0)}}),hi=ec.extend({pointerId:null,width:null,height:null,pressure:null,tangentialPressure:null,tiltX:null,tiltY:null,twist:null,pointerType:null,isPrimary:null}),fc={mouseEnter:{registrationName:"onMouseEnter",dependencies:["mouseout","mouseover"]},mouseLeave:{registrationName:"onMouseLeave",dependencies:["mouseout","mouseover"]},pointerEnter:{registrationName:"onPointerEnter",dependencies:["pointerout","pointerover"]},pointerLeave:{registrationName:"onPointerLeave",dependencies:["pointerout",
"pointerover"]}},Yj={eventTypes:fc,extractEvents:function(a,b,c,d,e){var f="mouseover"===a||"pointerover"===a,g="mouseout"===a||"pointerout"===a;if(f&&0===(e&32)&&(c.relatedTarget||c.fromElement)||!g&&!f)return null;f=d.window===d?d:(f=d.ownerDocument)?f.defaultView||f.parentWindow:window;if(g){if(g=b,b=(b=c.relatedTarget||c.toElement)?Bb(b):null,null!==b){var h=Na(b);if(b!==h||5!==b.tag&&6!==b.tag)b=null}}else g=null;if(g===b)return null;if("mouseout"===a||"mouseover"===a){var m=ec;var n=fc.mouseLeave;
var l=fc.mouseEnter;var k="mouse"}else if("pointerout"===a||"pointerover"===a)m=hi,n=fc.pointerLeave,l=fc.pointerEnter,k="pointer";a=null==g?f:Pa(g);f=null==b?f:Pa(b);n=m.getPooled(n,g,c,d);n.type=k+"leave";n.target=a;n.relatedTarget=f;c=m.getPooled(l,b,c,d);c.type=k+"enter";c.target=f;c.relatedTarget=a;d=g;k=b;if(d&&k)a:{m=d;l=k;g=0;for(a=m;a;a=pa(a))g++;a=0;for(b=l;b;b=pa(b))a++;for(;0<g-a;)m=pa(m),g--;for(;0<a-g;)l=pa(l),a--;for(;g--;){if(m===l||m===l.alternate)break a;m=pa(m);l=pa(l)}m=null}else m=
null;l=m;for(m=[];d&&d!==l;){g=d.alternate;if(null!==g&&g===l)break;m.push(d);d=pa(d)}for(d=[];k&&k!==l;){g=k.alternate;if(null!==g&&g===l)break;d.push(k);k=pa(k)}for(k=0;k<m.length;k++)be(m[k],"bubbled",n);for(k=d.length;0<k--;)be(d[k],"captured",c);return 0===(e&64)?[n]:[n,c]}},Qa="function"===typeof Object.is?Object.is:Zi,$i=Object.prototype.hasOwnProperty,Zj=wa&&"documentMode"in document&&11>=document.documentMode,Eg={select:{phasedRegistrationNames:{bubbled:"onSelect",captured:"onSelectCapture"},
dependencies:"blur contextmenu dragend focus keydown keyup mousedown mouseup selectionchange".split(" ")}},nb=null,he=null,Pb=null,ge=!1,ak={eventTypes:Eg,extractEvents:function(a,b,c,d,e,f){e=f||(d.window===d?d.document:9===d.nodeType?d:d.ownerDocument);if(!(f=!e)){a:{e=Jd(e);f=rd.onSelect;for(var g=0;g<f.length;g++)if(!e.has(f[g])){e=!1;break a}e=!0}f=!e}if(f)return null;e=b?Pa(b):window;switch(a){case "focus":if(yg(e)||"true"===e.contentEditable)nb=e,he=b,Pb=null;break;case "blur":Pb=he=nb=null;
break;case "mousedown":ge=!0;break;case "contextmenu":case "mouseup":case "dragend":return ge=!1,Dg(c,d);case "selectionchange":if(Zj)break;case "keydown":case "keyup":return Dg(c,d)}return null}},bk=R.extend({animationName:null,elapsedTime:null,pseudoElement:null}),ck=R.extend({clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),dk=dc.extend({relatedTarget:null}),ek={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",
Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},fk={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",
224:"Meta"},gk=dc.extend({key:function(a){if(a.key){var b=ek[a.key]||a.key;if("Unidentified"!==b)return b}return"keypress"===a.type?(a=Ac(a),13===a?"Enter":String.fromCharCode(a)):"keydown"===a.type||"keyup"===a.type?fk[a.keyCode]||"Unidentified":""},location:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,repeat:null,locale:null,getModifierState:fe,charCode:function(a){return"keypress"===a.type?Ac(a):0},keyCode:function(a){return"keydown"===a.type||"keyup"===a.type?a.keyCode:0},which:function(a){return"keypress"===
a.type?Ac(a):"keydown"===a.type||"keyup"===a.type?a.keyCode:0}}),hk=ec.extend({dataTransfer:null}),ik=dc.extend({touches:null,targetTouches:null,changedTouches:null,altKey:null,metaKey:null,ctrlKey:null,shiftKey:null,getModifierState:fe}),jk=R.extend({propertyName:null,elapsedTime:null,pseudoElement:null}),kk=ec.extend({deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?
-a.wheelDelta:0},deltaZ:null,deltaMode:null}),lk={eventTypes:dg,extractEvents:function(a,b,c,d,e){e=cg.get(a);if(!e)return null;switch(a){case "keypress":if(0===Ac(c))return null;case "keydown":case "keyup":a=gk;break;case "blur":case "focus":a=dk;break;case "click":if(2===c.button)return null;case "auxclick":case "dblclick":case "mousedown":case "mousemove":case "mouseup":case "mouseout":case "mouseover":case "contextmenu":a=ec;break;case "drag":case "dragend":case "dragenter":case "dragexit":case "dragleave":case "dragover":case "dragstart":case "drop":a=
hk;break;case "touchcancel":case "touchend":case "touchmove":case "touchstart":a=ik;break;case $h:case ai:case bi:a=bk;break;case ci:a=jk;break;case "scroll":a=dc;break;case "wheel":a=kk;break;case "copy":case "cut":case "paste":a=ck;break;case "gotpointercapture":case "lostpointercapture":case "pointercancel":case "pointerdown":case "pointermove":case "pointerout":case "pointerover":case "pointerup":a=hi;break;default:a=R}b=a.getPooled(e,b,c,d);lb(b);return b}};(function(a){if(ic)throw Error(k(101));
ic=Array.prototype.slice.call(a);nf()})("ResponderEventPlugin SimpleEventPlugin EnterLeaveEventPlugin ChangeEventPlugin SelectEventPlugin BeforeInputEventPlugin".split(" "));(function(a,b,c){td=a;rf=b;mf=c})(ae,Hb,Pa);pf({SimpleEventPlugin:lk,EnterLeaveEventPlugin:Yj,ChangeEventPlugin:Xj,SelectEventPlugin:ak,BeforeInputEventPlugin:Wj});var ie=[],ob=-1,Ca={},B={current:Ca},G={current:!1},Ra=Ca,bj=Pd,je=$f,Rg=Lj,aj=Nj,Dc=Oj,Ig=Zh,Jg=ag,Kg=Pj,Lg=Qj,Qg={},yj=Mj,Cj=void 0!==Yh?Yh:function(){},qa=null,
Ec=null,ke=!1,ii=ff(),Y=1E4>ii?ff:function(){return ff()-ii},Ic={current:null},Hc=null,qb=null,Gc=null,Tg=0,Jc=2,Ga=!1,Vb=da.ReactCurrentBatchConfig,$g=(new ea.Component).refs,Mc={isMounted:function(a){return(a=a._reactInternalFiber)?Na(a)===a:!1},enqueueSetState:function(a,b,c){a=a._reactInternalFiber;var d=ka(),e=Vb.suspense;d=Va(d,a,e);e=Ea(d,e);e.payload=b;void 0!==c&&null!==c&&(e.callback=c);Fa(a,e);Ja(a,d)},enqueueReplaceState:function(a,b,c){a=a._reactInternalFiber;var d=ka(),e=Vb.suspense;
d=Va(d,a,e);e=Ea(d,e);e.tag=1;e.payload=b;void 0!==c&&null!==c&&(e.callback=c);Fa(a,e);Ja(a,d)},enqueueForceUpdate:function(a,b){a=a._reactInternalFiber;var c=ka(),d=Vb.suspense;c=Va(c,a,d);d=Ea(c,d);d.tag=Jc;void 0!==b&&null!==b&&(d.callback=b);Fa(a,d);Ja(a,c)}},Qc=Array.isArray,wb=ah(!0),Fe=ah(!1),Sb={},ja={current:Sb},Ub={current:Sb},Tb={current:Sb},D={current:0},Sc=da.ReactCurrentDispatcher,X=da.ReactCurrentBatchConfig,Ia=0,z=null,K=null,J=null,Uc=!1,Tc={readContext:W,useCallback:S,useContext:S,
useEffect:S,useImperativeHandle:S,useLayoutEffect:S,useMemo:S,useReducer:S,useRef:S,useState:S,useDebugValue:S,useResponder:S,useDeferredValue:S,useTransition:S},dj={readContext:W,useCallback:ih,useContext:W,useEffect:eh,useImperativeHandle:function(a,b,c){c=null!==c&&void 0!==c?c.concat([a]):null;return ze(4,2,gh.bind(null,b,a),c)},useLayoutEffect:function(a,b){return ze(4,2,a,b)},useMemo:function(a,b){var c=ub();b=void 0===b?null:b;a=a();c.memoizedState=[a,b];return a},useReducer:function(a,b,c){var d=
ub();b=void 0!==c?c(b):b;d.memoizedState=d.baseState=b;a=d.queue={pending:null,dispatch:null,lastRenderedReducer:a,lastRenderedState:b};a=a.dispatch=ch.bind(null,z,a);return[d.memoizedState,a]},useRef:function(a){var b=ub();a={current:a};return b.memoizedState=a},useState:xe,useDebugValue:Be,useResponder:ue,useDeferredValue:function(a,b){var c=xe(a),d=c[0],e=c[1];eh(function(){var c=X.suspense;X.suspense=void 0===b?null:b;try{e(a)}finally{X.suspense=c}},[a,b]);return d},useTransition:function(a){var b=
xe(!1),c=b[0];b=b[1];return[ih(Ce.bind(null,b,a),[b,a]),c]}},ej={readContext:W,useCallback:Yc,useContext:W,useEffect:Xc,useImperativeHandle:hh,useLayoutEffect:fh,useMemo:jh,useReducer:Vc,useRef:dh,useState:function(a){return Vc(Ua)},useDebugValue:Be,useResponder:ue,useDeferredValue:function(a,b){var c=Vc(Ua),d=c[0],e=c[1];Xc(function(){var c=X.suspense;X.suspense=void 0===b?null:b;try{e(a)}finally{X.suspense=c}},[a,b]);return d},useTransition:function(a){var b=Vc(Ua),c=b[0];b=b[1];return[Yc(Ce.bind(null,
b,a),[b,a]),c]}},fj={readContext:W,useCallback:Yc,useContext:W,useEffect:Xc,useImperativeHandle:hh,useLayoutEffect:fh,useMemo:jh,useReducer:Wc,useRef:dh,useState:function(a){return Wc(Ua)},useDebugValue:Be,useResponder:ue,useDeferredValue:function(a,b){var c=Wc(Ua),d=c[0],e=c[1];Xc(function(){var c=X.suspense;X.suspense=void 0===b?null:b;try{e(a)}finally{X.suspense=c}},[a,b]);return d},useTransition:function(a){var b=Wc(Ua),c=b[0];b=b[1];return[Yc(Ce.bind(null,b,a),[b,a]),c]}},ra=null,Ka=null,Wa=
!1,gj=da.ReactCurrentOwner,ia=!1,Je={dehydrated:null,retryTime:0};var jj=function(a,b,c,d){for(c=b.child;null!==c;){if(5===c.tag||6===c.tag)a.appendChild(c.stateNode);else if(4!==c.tag&&null!==c.child){c.child.return=c;c=c.child;continue}if(c===b)break;for(;null===c.sibling;){if(null===c.return||c.return===b)return;c=c.return}c.sibling.return=c.return;c=c.sibling}};var wh=function(a){};var ij=function(a,b,c,d,e){var f=a.memoizedProps;if(f!==d){var g=b.stateNode;Ta(ja.current);a=null;switch(c){case "input":f=
Cd(g,f);d=Cd(g,d);a=[];break;case "option":f=Fd(g,f);d=Fd(g,d);a=[];break;case "select":f=M({},f,{value:void 0});d=M({},d,{value:void 0});a=[];break;case "textarea":f=Gd(g,f);d=Gd(g,d);a=[];break;default:"function"!==typeof f.onClick&&"function"===typeof d.onClick&&(g.onclick=uc)}Ud(c,d);var h,m;c=null;for(h in f)if(!d.hasOwnProperty(h)&&f.hasOwnProperty(h)&&null!=f[h])if("style"===h)for(m in g=f[h],g)g.hasOwnProperty(m)&&(c||(c={}),c[m]="");else"dangerouslySetInnerHTML"!==h&&"children"!==h&&"suppressContentEditableWarning"!==
h&&"suppressHydrationWarning"!==h&&"autoFocus"!==h&&(db.hasOwnProperty(h)?a||(a=[]):(a=a||[]).push(h,null));for(h in d){var k=d[h];g=null!=f?f[h]:void 0;if(d.hasOwnProperty(h)&&k!==g&&(null!=k||null!=g))if("style"===h)if(g){for(m in g)!g.hasOwnProperty(m)||k&&k.hasOwnProperty(m)||(c||(c={}),c[m]="");for(m in k)k.hasOwnProperty(m)&&g[m]!==k[m]&&(c||(c={}),c[m]=k[m])}else c||(a||(a=[]),a.push(h,c)),c=k;else"dangerouslySetInnerHTML"===h?(k=k?k.__html:void 0,g=g?g.__html:void 0,null!=k&&g!==k&&(a=a||
[]).push(h,k)):"children"===h?g===k||"string"!==typeof k&&"number"!==typeof k||(a=a||[]).push(h,""+k):"suppressContentEditableWarning"!==h&&"suppressHydrationWarning"!==h&&(db.hasOwnProperty(h)?(null!=k&&oa(e,h),a||g===k||(a=[])):(a=a||[]).push(h,k))}c&&(a=a||[]).push("style",c);e=a;if(b.updateQueue=e)b.effectTag|=4}};var kj=function(a,b,c,d){c!==d&&(b.effectTag|=4)};var pj="function"===typeof WeakSet?WeakSet:Set,wj="function"===typeof WeakMap?WeakMap:Map,sj=Math.ceil,gd=da.ReactCurrentDispatcher,
Uh=da.ReactCurrentOwner,H=0,Ye=8,ca=16,ma=32,Xa=0,hd=1,Oh=2,ad=3,bd=4,Xe=5,p=H,U=null,t=null,P=0,F=Xa,id=null,ta=1073741823,Yb=1073741823,kd=null,Xb=0,jd=!1,Re=0,Ph=500,l=null,cd=!1,Se=null,La=null,ld=!1,Zb=null,$b=90,bb=null,ac=0,af=null,dd=0,Ja=function(a,b){if(50<ac)throw ac=0,af=null,Error(k(185));a=ed(a,b);if(null!==a){var c=Cc();1073741823===b?(p&Ye)!==H&&(p&(ca|ma))===H?Te(a):(V(a),p===H&&ha()):V(a);(p&4)===H||98!==c&&99!==c||(null===bb?bb=new Map([[a,b]]):(c=bb.get(a),(void 0===c||c>b)&&bb.set(a,
b)))}};var zj=function(a,b,c){var d=b.expirationTime;if(null!==a){var e=b.pendingProps;if(a.memoizedProps!==e||G.current)ia=!0;else{if(d<c){ia=!1;switch(b.tag){case 3:sh(b);Ee();break;case 5:bh(b);if(b.mode&4&&1!==c&&e.hidden)return b.expirationTime=b.childExpirationTime=1,null;break;case 1:N(b.type)&&Bc(b);break;case 4:se(b,b.stateNode.containerInfo);break;case 10:d=b.memoizedProps.value;e=b.type._context;y(Ic,e._currentValue);e._currentValue=d;break;case 13:if(null!==b.memoizedState){d=b.child.childExpirationTime;
if(0!==d&&d>=c)return th(a,b,c);y(D,D.current&1);b=sa(a,b,c);return null!==b?b.sibling:null}y(D,D.current&1);break;case 19:d=b.childExpirationTime>=c;if(0!==(a.effectTag&64)){if(d)return vh(a,b,c);b.effectTag|=64}e=b.memoizedState;null!==e&&(e.rendering=null,e.tail=null);y(D,D.current);if(!d)return null}return sa(a,b,c)}ia=!1}}else ia=!1;b.expirationTime=0;switch(b.tag){case 2:d=b.type;null!==a&&(a.alternate=null,b.alternate=null,b.effectTag|=2);a=b.pendingProps;e=pb(b,B.current);rb(b,c);e=we(null,
b,d,a,e,c);b.effectTag|=1;if("object"===typeof e&&null!==e&&"function"===typeof e.render&&void 0===e.$$typeof){b.tag=1;b.memoizedState=null;b.updateQueue=null;if(N(d)){var f=!0;Bc(b)}else f=!1;b.memoizedState=null!==e.state&&void 0!==e.state?e.state:null;ne(b);var g=d.getDerivedStateFromProps;"function"===typeof g&&Lc(b,d,g,a);e.updater=Mc;b.stateNode=e;e._reactInternalFiber=b;pe(b,d,a,c);b=Ie(null,b,d,!0,f,c)}else b.tag=0,T(null,b,e,c),b=b.child;return b;case 16:a:{e=b.elementType;null!==a&&(a.alternate=
null,b.alternate=null,b.effectTag|=2);a=b.pendingProps;ri(e);if(1!==e._status)throw e._result;e=e._result;b.type=e;f=b.tag=Gj(e);a=aa(e,a);switch(f){case 0:b=He(null,b,e,a,c);break a;case 1:b=rh(null,b,e,a,c);break a;case 11:b=nh(null,b,e,a,c);break a;case 14:b=oh(null,b,e,aa(e.type,a),d,c);break a}throw Error(k(306,e,""));}return b;case 0:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:aa(d,e),He(a,b,d,e,c);case 1:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:aa(d,e),rh(a,b,d,e,c);
case 3:sh(b);d=b.updateQueue;if(null===a||null===d)throw Error(k(282));d=b.pendingProps;e=b.memoizedState;e=null!==e?e.element:null;oe(a,b);Qb(b,d,null,c);d=b.memoizedState.element;if(d===e)Ee(),b=sa(a,b,c);else{if(e=b.stateNode.hydrate)Ka=kb(b.stateNode.containerInfo.firstChild),ra=b,e=Wa=!0;if(e)for(c=Fe(b,null,d,c),b.child=c;c;)c.effectTag=c.effectTag&-3|1024,c=c.sibling;else T(a,b,d,c),Ee();b=b.child}return b;case 5:return bh(b),null===a&&De(b),d=b.type,e=b.pendingProps,f=null!==a?a.memoizedProps:
null,g=e.children,Yd(d,e)?g=null:null!==f&&Yd(d,f)&&(b.effectTag|=16),qh(a,b),b.mode&4&&1!==c&&e.hidden?(b.expirationTime=b.childExpirationTime=1,b=null):(T(a,b,g,c),b=b.child),b;case 6:return null===a&&De(b),null;case 13:return th(a,b,c);case 4:return se(b,b.stateNode.containerInfo),d=b.pendingProps,null===a?b.child=wb(b,null,d,c):T(a,b,d,c),b.child;case 11:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:aa(d,e),nh(a,b,d,e,c);case 7:return T(a,b,b.pendingProps,c),b.child;case 8:return T(a,
b,b.pendingProps.children,c),b.child;case 12:return T(a,b,b.pendingProps.children,c),b.child;case 10:a:{d=b.type._context;e=b.pendingProps;g=b.memoizedProps;f=e.value;var h=b.type._context;y(Ic,h._currentValue);h._currentValue=f;if(null!==g)if(h=g.value,f=Qa(h,f)?0:("function"===typeof d._calculateChangedBits?d._calculateChangedBits(h,f):1073741823)|0,0===f){if(g.children===e.children&&!G.current){b=sa(a,b,c);break a}}else for(h=b.child,null!==h&&(h.return=b);null!==h;){var m=h.dependencies;if(null!==
m){g=h.child;for(var l=m.firstContext;null!==l;){if(l.context===d&&0!==(l.observedBits&f)){1===h.tag&&(l=Ea(c,null),l.tag=Jc,Fa(h,l));h.expirationTime<c&&(h.expirationTime=c);l=h.alternate;null!==l&&l.expirationTime<c&&(l.expirationTime=c);Sg(h.return,c);m.expirationTime<c&&(m.expirationTime=c);break}l=l.next}}else g=10===h.tag?h.type===b.type?null:h.child:h.child;if(null!==g)g.return=h;else for(g=h;null!==g;){if(g===b){g=null;break}h=g.sibling;if(null!==h){h.return=g.return;g=h;break}g=g.return}h=
g}T(a,b,e.children,c);b=b.child}return b;case 9:return e=b.type,f=b.pendingProps,d=f.children,rb(b,c),e=W(e,f.unstable_observedBits),d=d(e),b.effectTag|=1,T(a,b,d,c),b.child;case 14:return e=b.type,f=aa(e,b.pendingProps),f=aa(e.type,f),oh(a,b,e,f,d,c);case 15:return ph(a,b,b.type,b.pendingProps,d,c);case 17:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:aa(d,e),null!==a&&(a.alternate=null,b.alternate=null,b.effectTag|=2),b.tag=1,N(d)?(a=!0,Bc(b)):a=!1,rb(b,c),Yg(b,d,e),pe(b,d,e,c),Ie(null,
b,d,!0,a,c);case 19:return vh(a,b,c)}throw Error(k(156,b.tag));};var bf=null,Ne=null,la=function(a,b,c,d){return new Fj(a,b,c,d)};ef.prototype.render=function(a){md(a,this._internalRoot,null,null)};ef.prototype.unmount=function(){var a=this._internalRoot,b=a.containerInfo;md(null,a,null,function(){b[Lb]=null})};var Di=function(a){if(13===a.tag){var b=Fc(ka(),150,100);Ja(a,b);df(a,b)}};var Yf=function(a){13===a.tag&&(Ja(a,3),df(a,3))};var Bi=function(a){if(13===a.tag){var b=ka();b=Va(b,a,null);Ja(a,
b);df(a,b)}};sd=function(a,b,c){switch(b){case "input":Dd(a,c);b=c.name;if("radio"===c.type&&null!=b){for(c=a;c.parentNode;)c=c.parentNode;c=c.querySelectorAll("input[name="+JSON.stringify(""+b)+'][type="radio"]');for(b=0;b<c.length;b++){var d=c[b];if(d!==a&&d.form===a.form){var e=ae(d);if(!e)throw Error(k(90));Gf(d);Dd(d,e)}}}break;case "textarea":Lf(a,c);break;case "select":b=c.value,null!=b&&hb(a,!!c.multiple,b,!1)}};(function(a,b,c,d){ee=a;eg=b;vd=c;vf=d})(Qh,function(a,b,c,d,e){var f=p;p|=4;
try{return Da(98,a.bind(null,b,c,d,e))}finally{p=f,p===H&&ha()}},function(){(p&(1|ca|ma))===H&&(uj(),xb())},function(a,b){var c=p;p|=2;try{return a(b)}finally{p=c,p===H&&ha()}});var mk={Events:[Hb,Pa,ae,pf,qd,lb,function(a){Kd(a,Ki)},sf,tf,sc,pc,xb,{current:!1}]};(function(a){var b=a.findFiberByHostInstance;return Ej(M({},a,{overrideHookState:null,overrideProps:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:da.ReactCurrentDispatcher,findHostInstanceByFiber:function(a){a=Sf(a);
return null===a?null:a.stateNode},findFiberByHostInstance:function(a){return b?b(a):null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null}))})({findFiberByHostInstance:Bb,bundleType:0,version:"16.13.1",rendererPackageName:"react-dom"});I.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=mk;I.createPortal=Xh;I.findDOMNode=function(a){if(null==a)return null;if(1===a.nodeType)return a;var b=a._reactInternalFiber;if(void 0===
b){if("function"===typeof a.render)throw Error(k(188));throw Error(k(268,Object.keys(a)));}a=Sf(b);a=null===a?null:a.stateNode;return a};I.flushSync=function(a,b){if((p&(ca|ma))!==H)throw Error(k(187));var c=p;p|=1;try{return Da(99,a.bind(null,b))}finally{p=c,ha()}};I.hydrate=function(a,b,c){if(!bc(b))throw Error(k(200));return nd(null,a,b,!0,c)};I.render=function(a,b,c){if(!bc(b))throw Error(k(200));return nd(null,a,b,!1,c)};I.unmountComponentAtNode=function(a){if(!bc(a))throw Error(k(40));return a._reactRootContainer?
(Rh(function(){nd(null,null,a,!1,function(){a._reactRootContainer=null;a[Lb]=null})}),!0):!1};I.unstable_batchedUpdates=Qh;I.unstable_createPortal=function(a,b){return Xh(a,b,2<arguments.length&&void 0!==arguments[2]?arguments[2]:null)};I.unstable_renderSubtreeIntoContainer=function(a,b,c,d){if(!bc(c))throw Error(k(200));if(null==a||void 0===a._reactInternalFiber)throw Error(k(38));return nd(a,b,c,!1,d)};I.version="16.13.1"});
</script>
    <script>const e = React.createElement;

function pathToString(path) {
  if (path[0] === '/') {
    return '/' + path.slice(1).join('/');
  } else {
    return path.join('/');
  }
}

function findCommonPath(files) {
  if (!files || !files.length) {
    return [];
  }

  function isPrefix(arr, prefix) {
    if (arr.length < prefix.length) {
      return false;
    }
    for (let i = prefix.length - 1; i >= 0; --i) {
      if (arr[i] !== prefix[i]) {
        return false;
      }
    }
    return true;
  }

  let commonPath = files[0].path.slice(0, -1);
  while (commonPath.length) {
    if (files.every(file => isPrefix(file.path, commonPath))) {
      break;
    }
    commonPath.pop();
  }
  return commonPath;
}

function findFolders(files) {
  if (!files || !files.length) {
    return [];
  }

  let folders = files.filter(file => file.path.length > 1).map(file => file.path[0]);
  folders = [...new Set(folders)]; // unique
  folders.sort();

  folders = folders.map(folder => {
    let filesInFolder = files
      .filter(file => file.path[0] === folder)
      .map(file => ({
        ...file,
        path: file.path.slice(1),
        parent: [...file.parent, file.path[0]],
      }));

    const children = findFolders(filesInFolder); // recursion

    return {
      is_folder: true,
      path: [folder],
      parent: files[0].parent,
      children,
      covered: children.reduce((sum, file) => sum + file.covered, 0),
      coverable: children.reduce((sum, file) => sum + file.coverable, 0),
      prevRun: {
        covered: children.reduce((sum, file) => sum + file.prevRun.covered, 0),
        coverable: children.reduce((sum, file) => sum + file.prevRun.coverable, 0),
      },
    };
  });

  return [...folders, ...files.filter(file => file.path.length === 1)];
}

class App extends React.Component {
  constructor(...args) {
    super(...args);

    this.state = {
      current: [],
    };
  }

  componentDidMount() {
    this.updateStateFromLocation();
    window.addEventListener('hashchange', () => this.updateStateFromLocation(), false);
  }

  updateStateFromLocation() {
    if (window.location.hash.length > 1) {
      const current = window.location.hash.slice(1).split('/');
      this.setState({current});
    } else {
      this.setState({current: []});
    }
  }

  getCurrentPath() {
    let file = this.props.root;
    let path = [file];
    for (let p of this.state.current) {
      file = file.children.find(file => file.path[0] === p);
      if (!file) {
        return path;
      }
      path.push(file);
    }
    return path;
  }

  render() {
    const path = this.getCurrentPath();
    const file = path[path.length - 1];

    let w = null;
    if (file.is_folder) {
      w = e(FilesList, {
        folder: file,
        onSelectFile: this.selectFile.bind(this),
        onBack: path.length > 1 ? this.back.bind(this) : null,
      });
    } else {
      w = e(DisplayFile, {
        file,
        onBack: this.back.bind(this),
      });
    }

    return e('div', {className: 'app'}, w);
  }

  selectFile(file) {
    this.setState(
      ({current}) => {
        return {current: [...current, file.path[0]]};
      },
      () => this.updateHash(),
    );
  }

  back(file) {
    this.setState(
      ({current}) => {
        return {current: current.slice(0, current.length - 1)};
      },
      () => this.updateHash(),
    );
  }

  updateHash() {
    if (!this.state.current || !this.state.current.length) {
      window.location = '#';
    } else {
      window.location = '#' + this.state.current.join('/');
    }
  }
}

function FilesList({folder, onSelectFile, onBack}) {
  let files = folder.children;
  return e(
    'div',
    {className: 'display-folder'},
    e(FileHeader, {file: folder, onBack}),
    e(
      'table',
      {className: 'files-list'},
      e('thead', {className: 'files-list__head'}, e('tr', null, e('th', null, 'Path'), e('th', null, 'Coverage'))),
      e(
        'tbody',
        {className: 'files-list__body'},
        files.map(file => e(File, {file, onClick: onSelectFile})),
      ),
    ),
  );
}

function File({file, onClick}) {
  const coverage = file.coverable ? (file.covered / file.coverable) * 100 : -1;
  const coverageDelta =
    file.prevRun && (file.covered / file.coverable) * 100 - (file.prevRun.covered / file.prevRun.coverable) * 100;

  return e(
    'tr',
    {
      className:
        'files-list__file' +
        (coverage >= 0 && coverage < 50 ? ' files-list__file_low' : '') +
        (coverage >= 50 && coverage < 80 ? ' files-list__file_medium' : '') +
        (coverage >= 80 ? ' files-list__file_high' : '') +
        (file.is_folder ? ' files-list__file_folder' : ''),
      onClick: () => onClick(file),
    },
    e('td', null, e('a', null, pathToString(file.path))),
    e(
      'td',
      null,
      file.covered + ' / ' + file.coverable + (coverage >= 0 ? ' (' + coverage.toFixed(2) + '%)' : ''),
      e(
        'span',
        {title: 'Change from the previous run'},
        coverageDelta ? ` (${coverageDelta > 0 ? '+' : ''}${coverageDelta.toFixed(2)}%)` : '',
      ),
    ),
  );
}

function DisplayFile({file, onBack}) {
  return e('div', {className: 'display-file'}, e(FileHeader, {file, onBack}), e(FileContent, {file}));
}

function FileHeader({file, onBack}) {
  const coverage = (file.covered / file.coverable) * 100;
  const coverageDelta = file.prevRun && coverage - (file.prevRun.covered / file.prevRun.coverable) * 100;

  return e(
    'div',
    {className: 'file-header'},
    onBack ? e('a', {className: 'file-header__back', onClick: onBack}, 'Back') : null,
    e('div', {className: 'file-header__name'}, pathToString([...file.parent, ...file.path])),
    e(
      'div',
      {className: 'file-header__stat'},
      'Covered: ' + file.covered + ' of ' + file.coverable + (file.coverable ? ' (' + coverage.toFixed(2) + '%)' : ''),
      e(
        'span',
        {title: 'Change from the previous run'},
        coverageDelta ? ` (${coverageDelta > 0 ? '+' : ''}${coverageDelta.toFixed(2)}%)` : '',
      ),
      e('input', {id: 'theme-toggle', type: 'checkbox', hidden: true}),
      e('label', {for: 'theme-toggle', id: 'theme-toggle-label'}, ''),
    ),
  );
}

function FileContent({file}) {
  return e(
    'pre',
    {className: 'file-content'},
    file.content.split(/\r?\n/).map((line, index) => {
      const trace = file.traces.find(trace => trace.line === index + 1);
      const covered = trace && trace.stats.Line;
      const uncovered = trace && !trace.stats.Line;
      return e(
        'code',
        {
          className: 'code-line' + (covered ? ' code-line_covered' : '') + (uncovered ? ' code-line_uncovered' : ''),
          title: trace ? JSON.stringify(trace.stats, null, 2) : null,
        },
        line,
      );
    }),
  );
}

(function () {
  const commonPath = findCommonPath(data.files);
  const prevFilesMap = new Map();

  previousData &&
    previousData.files.forEach(file => {
      const path = file.path.slice(commonPath.length).join('/');
      prevFilesMap.set(path, file);
    });

  const files = data.files.map(file => {
    const path = file.path.slice(commonPath.length);
    const {covered = 0, coverable = 0} = prevFilesMap.get(path.join('/')) || {};
    return {
      ...file,
      path,
      parent: commonPath,
      prevRun: {covered, coverable},
    };
  });

  const children = findFolders(files);

  const root = {
    is_folder: true,
    children,
    path: commonPath,
    parent: [],
    covered: children.reduce((sum, file) => sum + file.covered, 0),
    coverable: children.reduce((sum, file) => sum + file.coverable, 0),
    prevRun: {
      covered: children.reduce((sum, file) => sum + file.prevRun.covered, 0),
      coverable: children.reduce((sum, file) => sum + file.prevRun.coverable, 0),
    },
  };

  ReactDOM.render(e(App, {root, prevFilesMap}), document.getElementById('root'));

  const toggle = document.getElementById('theme-toggle');
  const label = document.getElementById('theme-toggle-label');
  label.textContent = '';

  toggle.addEventListener('change', () => {
    if (toggle.checked) {
      document.documentElement.setAttribute('data-theme', 'dark');
      label.textContent = '';
    } else {
      document.documentElement.removeAttribute('data-theme');
      label.textContent = '';
    }
  });
})();
</script>
</body>
</html>