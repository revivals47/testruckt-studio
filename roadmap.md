# testruct-desktop-Rust Roadmap

## ゴール
- 既存アプリのレイアウト/UXを保ちながら、Rustで保守しやすい構造を0から再構築する
- 変更容易性とテスト性を高め、今後のバグ修正や機能追加をスムーズにする

## 基本原則
1. 1ファイル1機能 (Single Responsibility per File)
   - 機能単位でモジュール/ファイルを分割し、それぞれの責務を明確にする
   - 共有ロジックは`core`などの下層モジュールに切り出して再利用性を確保する
2. 1ファイル500行前後
   - 500行を超える場合は、さらに下位モジュールやコンポーネントに分割する
   - 巨大化する前にリファクタリング・抽象化を行い、レビュー可能なサイズに保つ

## 旧プロジェクトから継承する開発方針
- **レイヤードアーキテクチャ**: Presentation(UI) → Application → Domain/Core の依存方向を厳守し、下層が上層に依存しない（`docs/REFACTORING_GUIDE.md:11`, `docs/REFACTORING_GUIDE.md:25`）。
- **ファイルサイズ指標**: 200-500行を理想とし、800行超は即リファクタリング検討（`docs/REFACTORING_GUIDE.md:36`）。新実装でも同指標を採用する。
- **巨大モジュールの分割計画**: 旧`window_setup.rs`や`widget_events_mouse.rs`で提案されている責務分割を新プロジェクトでも実現し、UI構築・イベント処理・座標変換・IOをモジュール単位に切り出す（`docs/REFACTORING_GUIDE.md:45`, `docs/REFACTORING_GUIDE.md:68`）。
- **キャンバス機能の再現**: 既存のキャンバス、イベントハンドリング、ツールモードなど完成済み機能を踏襲しつつリライトする（`docs/PROJECT_STATUS.md:34`）。
- **ビルド/依存環境**: GTK4 + Cairo + Pango環境でのビルド手順やツールチェーン要件を`docs/DEVELOPMENT.md:1`に従って整備する。
- **報告スタイル**: 作業完了後の進捗報告は日本語で行い、意思疎通を円滑に保つ。

## 初期ステップ
1. **ドメイン設計**: ドキュメント/テンプレート/キャンバスなど主要ドメインを整理し、モジュール構成案を決める
2. **crate構成**: `core`(ビジネスロジック), `ui`(GTKフロントエンド), `cli`(ユーティリティ) など用途別にcrateを用意する
3. **UIレイアウト再現**: 既存レイアウトと同等の画面を小さなウィジェット単位で再構築し、複雑なウィンドウはビルダー/DSLで分割する
4. **イベント/コマンド整理**: 入力イベントやコマンド処理をカテゴリごとに分割し、テスト可能な境界を設ける
5. **段階的移行**: レイアウトが再現できた段階で、旧実装のロジックを新アーキテクチャに適用しながら段階的に移植・検証する

## 継続的な取り組み
- 定期的にファイルサイズを計測し、閾値超過時はリファクタリングを検討する
- モジュールごとに単体テスト・統合テストを整備し、回帰を防ぐ
- ドキュメント(README, 開発ガイド)を並行更新し、チーム内の共通理解を維持する
